---
title: データのラベル付けプロジェクトを作成する
titleSuffix: Azure Machine Learning
description: ラベル付けプロジェクトを作成して実行し、機械学習用のデータにタグを付ける方法について説明します。 支援付き機械学習ラベル付け、つまり人間参加型 (Human in the loop) のラベル付けを使用して、このタスクを補助します。
author: sdgilley
ms.author: sgilley
ms.service: machine-learning
ms.subservice: core
ms.topic: tutorial
ms.date: 07/27/2020
ms.custom: data4ml
ms.openlocfilehash: 62801d40295762b0066f0d2887d7d528ee7b7c2a
ms.sourcegitcommit: b4647f06c0953435af3cb24baaf6d15a5a761a9c
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/02/2021
ms.locfileid: "101656824"
---
# <a name="create-a-data-labeling-project-and-export-labels"></a>データのラベル付けプロジェクトを作成してラベルをエクスポートする 

Azure Machine Learning でデータにタグを付けるデータのラベル付けプロジェクトを作成して実行する方法について説明します。  このタスクを補助するために、支援付き機械学習データ ラベル付け、つまり人間参加型 (Human in the loop) のラベル付けを使用します。


## <a name="data-labeling-capabilities"></a>データのラベル付け機能

> [!Important]
> Azure BLOB データストア内の画像データにアクセスできることが必要です。 (既存のデータストアがない場合は、プロジェクトの作成時に画像をアップロードすることができます。)

Azure Machine Learning のデータのラベル付け機能を通じて、ラベル付けプロジェクトの作成、管理、監視を一元的に行うことができます。
 - データ、ラベル、チーム メンバーを調整して、ラベル付けタスクを効率的に管理する。 
 - 進行状況を追跡し、未完了のラベル付けタスクのキューを維持する。
 - プロジェクトを開始および停止し、ラベル付けの進行状況を制御する。
 - ラベル付きのデータを確認し、COCO 形式または Azure Machine Learning データセットとしてエクスポートする。

## <a name="prerequisites"></a>前提条件

* ローカル ファイルまたは Azure Blob Storage 内にある、ラベル付け対象のデータ。
* 適用するラベルのセット。
* ラベル付けに関する指示。
* Azure サブスクリプション。 Azure サブスクリプションをお持ちでない場合は、開始する前に [無料アカウント](https://aka.ms/AMLFree) を作成してください。
* Machine Learning ワークスペース。 [Azure Machine Learning ワークスペースを作成する](how-to-manage-workspace.md)方法に関するページを参照してください。

## <a name="create-a-data-labeling-project"></a>データのラベル付けプロジェクトを作成する

ラベル付けプロジェクトは、Azure Machine Learning から管理します。 **[Labeling projects]\(ラベル付けプロジェクト\)** ページを使用して、プロジェクトを管理します。

データが既に Azure Blob Storage 内にある場合は、ラベル付けプロジェクトを作成する前に、それをデータストアとして使用できるようにする必要があります。 データストアの使用例については、[初めての画像分類のラベル付けプロジェクトの作成に関するチュートリアル](tutorial-labeling.md)を参照してください。

プロジェクトを作成するには、 **[プロジェクトの追加]** を選択します。 プロジェクトに適切な名前を付け、 **[ラベル付けタスクの種類]** を選択します。 プロジェクト名を再利用することはできません。プロジェクトを将来削除するとしても同様です。

:::image type="content" source="media/how-to-create-labeling-projects/labeling-creation-wizard.png" alt-text="ラベル付けプロジェクト作成ウィザード":::

* ラベルのセットから "*1 つのラベル*" だけを画像に適用する場合は、プロジェクトに対して **[イメージ分類の複数クラス]** を選択します。
* ラベルのセットから "*1 つまたは複数*" のラベルを画像に適用する場合は、プロジェクトに対して **[Image Classification Multi-label]\(画像分類の複数ラベル\)** を選択します。 たとえば、犬の写真には "*犬*" と "*日中*" の両方のラベルが付けられる可能性があります。
* 画像内の各オブジェクトにラベルと境界ボックスを割り当てる場合は、プロジェクトに対して **[オブジェクト ID (四角形領域)]** を選択します。
* 画像内の各オブジェクトにラベルを割り当て、その周囲にポリゴンを描画する場合は、プロジェクトに対して **[インスタンスのセグメント化 (ポリゴン)] (プレビュー)** を選択します。

> [!IMPORTANT]
> "インスタンスのセグメント化 (ポリゴン)" はパブリック プレビューの段階にあります。
> プレビュー バージョンはサービス レベル アグリーメントなしで提供されています。運用環境のワークロードに使用することはお勧めできません。 特定の機能はサポート対象ではなく、機能が制限されることがあります。 詳しくは、[Microsoft Azure プレビューの追加使用条件](https://azure.microsoft.com/support/legal/preview-supplemental-terms/)に関するページをご覧ください。

続行する準備ができたら、 **[次へ]** を選択します。

## <a name="specify-the-data-to-label"></a>ラベル付けの対象データを指定する

対象のデータが含まれるデータセットを既に作成済みの場合は、 **[既存のデータセットを選択します]** ボックスの一覧から選択します。 または、 **[Create a dataset]\(データセットの作成\)** を選択して、既存の Azure データストアを選択するか、ローカル ファイルをアップロードします。

> [!NOTE]
> 1 つのプロジェクトに 50 万を超える画像を含めることはできません。  データセットにそれを超える画像がある場合は、最初の 50 万件だけが読み込まれます。  

### <a name="create-a-dataset-from-an-azure-datastore"></a>Azure データストアからデータセットを作成する

多くの場合は、ローカル ファイルをアップロードするだけでかまいません。 ただし、[Azure Storage Explorer](https://azure.microsoft.com/features/storage-explorer/) には、大量のデータをより高速かつ堅牢に転送する方法が用意されています。 既定のファイル移動方法としては、Storage Explorer をお勧めします。

Azure Blob Storage に既に格納済みのデータからデータセットを作成するには:

1. **[Create a dataset]\(データセットの作成\)**  >  **[From datastore]\(データストアから\)** の順に選択します。
1. データセットに **名前** を割り当てます。
1. **[データセットの種類]** として **[ファイル]** を選択します。  ファイルというデータセットの種類のみがサポートされています。
1. データストアを選択します。
1. データがお使いの Blob Storage 内のサブフォルダーにある場合は、 **[参照]** を選択してパスを選択します。
    * 選択したパスのサブフォルダー内にあるすべてのファイルを含めるには、パスの末尾に "/**" を追加します。
    * 現在のコンテナーとそのサブフォルダー内にあるすべてのデータを含めるには、"* */* .*" を追加します。
1. データセットの説明を入力します。
1. **[次へ]** を選択します。
1. 詳細を確認します。 **[戻る]** を選択して設定を変更するか、 **[作成]** を選択してデータセットを作成します。


### <a name="create-a-dataset-from-uploaded-data"></a>アップロードしたデータからデータセットを作成する

データを直接アップロードするには:

1. **[Create a dataset]\(データセットの作成\)**  >  **[From local files]\(ローカル ファイルから\)** の順に選択します。
1. データセットに **名前** を割り当てます。
1. **[データセットの種類]** として [ファイル] を選択します。
1. *省略可能:* **[詳細設定]** を選択して、データストア、コンテナー、およびデータへのパスをカスタマイズします。
1. **[参照]** を選択し、アップロードするローカル ファイルを選択します。
1. データセットの説明を入力します。
1. **[次へ]** を選択します。
1. 詳細を確認します。 **[戻る]** を選択して設定を変更するか、 **[作成]** を選択してデータセットを作成します。

データは、Machine Learning ワークスペースの既定の BLOB ストア ("workspaceblobstore") にアップロードされます。

## <a name="configure-incremental-refresh"></a><a name="incremental-refresh"> </a> 増分更新を構成する

新しい画像をデータセットに追加する予定がある場合、増分更新を使用して、これらの新しい画像をプロジェクトに追加します。   **増分更新** が有効になっている場合、ラベル付けの完了率に基づいて、プロジェクトに追加する新しい画像がないかどうかデータセットが定期的にチェックされます。   プロジェクトに最大 50 万件の画像が含まれている場合は、新しいデータのチェックは停止されます。

プロジェクトにさらに多くのイメージを追加するには、[Azure Storage Explorer](https://azure.microsoft.com/features/storage-explorer/) を使用して、BLOB ストレージ内の適切なフォルダーにアップロードします。 

プロジェクトでデータストア内の新しいデータを継続的に監視する場合は、 **[Enable incremental refresh]\(増分更新を有効にする\)** チェックボックスをオンにします。 有効にすると、このデータは 1 日に 1 回プロジェクトにプルされるため、データストアに追加した新しいデータがプロジェクトに表示されるまで待つ必要があります。  データが最後に更新されたときのタイムスタンプは、プロジェクトの **[詳細]** タブの **[増分更新]** セクションで確認できます。

データストアに表示される新しい画像をプロジェクトに追加しない場合は、このチェックボックスをオフにします。

## <a name="specify-label-classes"></a>ラベル クラスを指定する

**[ラベル クラス]** ページで、データを分類するためのクラスのセットを指定します。 適切なクラスを選択できるかどうかが、ラベラーの正確さと速さに影響します。 たとえば、植物や動物の属や種を略さずに使用するのではなく、フィールド コードを使用したり属を省略したりします。

ラベルは 1 行に 1 つずつ入力します。 新しい行を追加するには、 **[+]** ボタンを使用します。 ラベルの数が 3 または 4 以上 10 未満の場合は、名前の前に数字 ("1: "、"2: ") を付けることで、ラベラーが数字キーを使用して作業を高速化できるようになります。

## <a name="describe-the-data-labeling-task"></a>データのラベル付けタスクを説明する

ラベル付けタスクをわかりやすく説明することが重要です。 **[ラベル付けの手順]** ページで、ラベル付けの手順に関する外部サイトへのリンクを追加できます。または、ページ上のエディット ボックスに手順を入力することもできます。 指示は、タスク指向で、対象ユーザーに適したものにします。 次の質問を考慮してください。

* どのようなラベルが表示され、どのような方法で選択しますか。 参照する参照テキストはありますか。
* 適切なラベルが見あたらない場合はどうすればよいですか。
* 適切に見えるラベルが複数ある場合はどうすればよいですか。
* どのような信頼度しきい値をラベルに適用する必要がありますか。 確実にわからない場合は、"最善の推測" で選択させますか。
* 対象のオブジェクトが部分的にオクルージョンされている場合、または重なっている場合は、どうすればよいですか。
* 対象のオブジェクトが画像の端によってクリップされている場合は、どうすればよいですか。
* ラベルを送信した後に間違いに気付いた場合はどうすればよいですか。

境界ボックスについては、次のような重要な質問があります。

* このタスクでは境界ボックスはどのように定義されていますか。 完全にオブジェクトの内側に配置すべきですか、それとも外側に配置するべきですか。 できるだけ近くなるようにトリミングする必要がありますか、それともある程度の余白は許容されますか。
* 境界ボックスを定義する際にラベラーがどの程度の注意と一貫性を適用することを期待しますか。
* 画像内に一部しか表示されていないオブジェクトにラベル付けするにはどうすればよいですか。 
* 他のオブジェクトによって部分的に覆い隠されているオブジェクトにラベル付けするにはどうすればよいですか。

>[!NOTE]
> ラベラーは最初の 9 つのラベルを 1 から 9 の数字キーを使用して選択できることを必ず明記してください。

## <a name="use-ml-assisted-data-labeling"></a>支援付き機械学習データ ラベル付けを使用する

**[ML-assisted labeling]\(支援付き機械学習ラベル付け\)** ページでは、自動機械学習モデルをトリガーして、ラベル付けタスクを高速化することができます。 ラベル付けプロジェクトの初めに、潜在的な偏りを減らすために、画像はランダムな順序にシャッフルされます。 ただし、データセットに偏りが存在すれば、それがトレーニング済みのモデルに反映されます。 たとえば、使用する画像の 80% が単一のクラスに属している場合、モデルのトレーニングに使用されたデータの約 80% は、そのクラスに属すことになります。 このトレーニングに、アクティブ ラーニングは含まれません。


ML によるラベル付けは、 *[ML によるラベル付けを有効にする]* を選択し、GPU を指定することによって有効になります。これは、次の 2 つのフェーズで構成されています。
* クラスタリング
* 事前ラベル付け

ML によるラベル付けを開始するために必要とされるラベル付けされた画像の正確な数は固定されていません。  これは、ラベル付けプロジェクトごとに大きく異なる場合があります。 プロジェクトによっては、300 枚の画像を手動でラベル付けすれば、事前ラベル付けまたはクラスターのタスクが可能になります。 ML によるラベル付けでは、"*転移学習*" と呼ばれる手法が使用されます。この手法では、事前トレーニング済みモデルを使用してトレーニング プロセスを開始します。 対象となるデータセットのクラスが、事前トレーニング済みモデル内のクラスと似ている場合、手動でラベル付けされた画像が数百枚あれば、事前に作成されたラベルを利用できる可能性があります。 対象となるデータセットが、モデルの事前トレーニングに使用されたデータと大きく異なる場合には、さらに時間がかかる可能性があります。

最終的なラベルは依然としてラベラーからの入力に依存するため、この技術は "*人間参加 (Human in the loop) 型*" のラベル付けと呼ばれることがあります。

> [!NOTE]
> ML によるデータのラベル付けでは、[仮想ネットワーク](how-to-network-security-overview.md)の背後でセキュリティ保護された既定のストレージ アカウントはサポートされていません。 ML によるデータのラベル付けには、既定以外のストレージ アカウントを使用する必要があります。 既定以外のストレージ アカウントは、仮想ネットワークの背後でセキュリティ保護できます。

### <a name="clustering"></a>クラスタリング

一定数のラベルが送信されると、画像分類の機械学習モデルは、類似する画像をグループ化し始めます。  手動でのタグ付けにかかる時間を短縮するために、これらの類似する画像は同じ画面上でラベラーに表示されます。 ラベラーに表示される画像が 4 枚、6 枚、9 枚のいずれかのグリッドであるとき、クラスタリングは特に効果的です。 

手動でラベル付けされたデータで機械学習モデルのトレーニングが完了すると、モデルは切り詰められて、その最後の全結合層に到達します。 ラベル付けされていない画像は、その後、切り詰められたモデルを介し、一般に "埋め込み" や "特徴付け" として知られるプロセスに渡されます。 このようにそれぞれの画像が、このモデル レイヤーによって定義された高次元空間に埋め込まれます。 この空間内でニアレストネイバーとなった画像が、クラスタリング タスクに使用されます。 

オブジェクト検出モデルにはクラスタリング フェーズは表示されません。

### <a name="prelabeling"></a>事前ラベル付け

十分な数の画像ラベルが送信されると、分類モデルを使用して画像のタグが予測されます。 または、オブジェクト検出モデルを使用して境界ボックスが予測されます。 今度は、それぞれの画像に既に存在する予測済みのラベルを含むページがラベラーに表示されます。 オブジェクト検出では、予測されたボックスも表示されます。 その後、このタスクでは、これらの予測をレビューし、間違ってラベル付けされた画像を修正してから、ページを送信します。  

手動でラベル付けされたデータで機械学習モデルのトレーニングが完了すると、手動でラベル付けされた画像のテスト セットでモデルが評価され、さまざまな信頼度のしきい値でその精度が判定されます。 事前ラベルを表示するだけの精度がモデルにあるかどうかの基準となる信頼度のしきい値は、この評価プロセスを使用して割り出されます。 その後、このモデルは、ラベル付けされていないデータに対して評価されます。 予測の信頼度がこのしきい値を超える画像が、事前ラベル付けに使用されます。

## <a name="initialize-the-data-labeling-project"></a>データ ラベル付けプロジェクトを初期化する

ラベル付けプロジェクトが初期化された後、プロジェクトのいくつかの部分は変更できなくなります。 タスクの種類やデータセットを変更することはできません。 ラベルや、タスクの説明の URL は変更 "*できます*"。 プロジェクトを作成する前に、設定を慎重に確認してください。 プロジェクトを送信すると、 **[データのラベル付け]** ホーム ページに戻り、プロジェクトが **[Initializing]\(初期化中\)** と表示されます。

> [!NOTE]
> このページは自動的に更新されない場合があります。 そのため、しばらくしてからページを手動で更新すると、プロジェクトの状態が **[Created]\(作成済み\)** と表示されます。

## <a name="run-and-monitor-the-project"></a>プロジェクトを実行して監視する
プロジェクトを初期化すると、Azure によって実行が開始されます。 メインの **[データのラベル付け]** ページでプロジェクトを選択して、プロジェクトの詳細を確認します。

プロジェクトを一時停止または再起動するには、右上の **[実行中]** 状態を切り替えます。 データにラベルを付けることができるのは、プロジェクトが実行されているときだけです。

### <a name="dashboard"></a>ダッシュボード

**[ダッシュボード]** タブに、ラベル付けタスクの進行状況が表示されます。

:::image type="content" source="media/how-to-create-labeling-projects/labeling-dashboard.png" alt-text="データのラベル付けダッシュボード":::

進行状況グラフには、ラベル付けされた項目の数と、まだそれが行われていない項目の数が表示されます。  保留中の項目は次のとおりです。

* まだタスクに追加されていない
* ラベラーに割り当てられているがまだ完了していないタスクに含まれている 
* これから割り当てられるタスクのキュー内にある

中央のセクションには、これから割り当てられるタスクのキューが表示されます。 ML によるラベル付けが無効になっている場合、このセクションには割り当てられる手動タスクの数が表示されます。 ML によるラベル付けがオンになっている場合は、次の内容が表示されます。

* キュー内にクラスター化された項目を含むタスク
* キュー内に事前にラベル付けされた項目を含むタスク

また、ML によるラベル付けが有効になっている場合は、次のトレーニングが実行されるタイミングが、小さな進行状況バーに表示されます。  [実験] セクションには、機械学習の各実行に対してリンクが用意されています。

* トレーニング - ラベルを予測できるようにモデルをトレーニングする
* 検証 - このモデルの予測を項目の事前ラベル付けのために使用するかどうかを判断する 
* 推論 - 新しい項目について予測を実行する
* 特徴量化 - 項目をクラスター化する (画像の分類プロジェクトの場合のみ)

右側にあるのは、完了している当該タスクのラベルの分布です。  プロジェクトの種類によっては、1 つの項目に複数のラベルを含めることができ、その場合、ラベルの合計数が、項目の合計数よりも大きくなる可能性があるので注意してください。

### <a name="data-tab"></a>[データ] タブ

**[データ]** タブでは、データセットを表示して、ラベル付けされたデータを確認できます。 間違ってラベル付けされたデータが表示された場合は、それを選択して **[拒否]** を選択することで、ラベルを削除し、データをラベルなしのキューに戻すことができます。

### <a name="details-tab"></a>[詳細] タブ

プロジェクトの詳細を表示します。  このタブでは、次のことができます。

* プロジェクトの詳細と入力データセットを表示する
* 増分更新を有効にする
* プロジェクトでのラベル付きの出力を格納するために使用するストレージ コンテナーの詳細を表示する
* プロジェクトにラベルを追加する
* ラベルに付ける指示を編集する
* ML によるラベル付けの詳細を編集する (有効、無効を含む)

### <a name="access-for-labelers"></a>ラベラー用のアクセス権

お客様のワークスペースへのアクセス権を持つユーザーはいずれも、お客様のプロジェクト内のデータにラベルを付けることができます。  お客様のラベラー用のアクセス許可をカスタマイズすることで、それらがラベル付けにはアクセスできるが、ワークスペースまたはお客様のラベル付けプロジェクトの他の部分にはアクセスできないようにすることもできます。  詳細については、「[Azure Machine Learning ワークスペースへのアクセスの管理](how-to-assign-roles.md)」を参照してください。また、[ラベラーのカスタム ロール](how-to-assign-roles.md#labeler)を作成する方法についても確認してください。

## <a name="add-new-label-class-to-a-project"></a>プロジェクトに新しいラベル クラスを追加する

データのラベル付けプロセス中に、画像を分類するためにラベルを追加する必要性が生じることがあります。  たとえば、"不明" や "その他" など、わかりにくい画像を示すラベルを追加したい場合があります。

プロジェクトにラベルを追加するには、次の手順に従います。

1. メインの **[データのラベル付け]** ページでプロジェクトを選択します。
1. ページの右上にある **[実行中]** を **[一時停止]** に切り替えて、ラベラーのアクティビティを停止します。
1. **[詳細]** タブを選択します。
1. 左側の一覧で、 **[ラベル クラス]** を選択します。
1. リストの上部で、 **[+ ラベルを追加]** を選択します。![ラベルを追加する](media/how-to-create-labeling-projects/add-label.png)
1. フォームで新しいラベルを追加し、続行方法を選択します。  画像に対して選択できるラベルを変更したので、既にラベル付けされたデータの扱いを選択します。
    * 既存のすべてのラベルを削除して最初からやり直します。  新たに追加されたすべてのラベルを使用して最初からラベル付けしたい場合は、このオプションを選択します。 
    * 既存のすべてのラベルを保持したまま最初からやり直します。  すべてのデータをまだラベル付けされていないものとしてマークしたうえで、過去にラベル付けされた画像について、既存のラベルを既定のタグとして保持する場合は、このオプションを選択します。
    * 既存のすべてのラベルを保持したまま続行します。 既にラベル付けされたデータはすべてそのまま維持し、まだラベル付けされていないデータについては、以降、新しいラベルを使用する場合は、このオプションを選択します。
1. 新しいラベルの指示ページを必要に応じて変更します。
1. 新しいラベルをすべて追加したら、ページの右上で **[一時停止]** を **[実行中]** に切り替えて、プロジェクトを再開します。  

## <a name="export-the-labels"></a>ラベルをエクスポートする

いつでも、Machine Learning の実験用にラベル データをエクスポートできます。 画像のラベルは、[COCO 形式](http://cocodataset.org/#format-data)または[ラベル付き Azure Machine Learning データセット](how-to-use-labeled-dataset.md)としてエクスポートできます。 ラベル付けプロジェクトの **[プロジェクトの詳細]** ページにある **[エクスポート]** ボタンを使用します。

COCO ファイルは、Azure Machine Learning ワークスペースの既定の BLOB ストアにある *export/coco* 内のフォルダーに作成されます。 エクスポートした Azure Machine Learning データセットには、Machine Learning の **[データセット]** セクションでアクセスできます。 また、データセットの詳細ページには、Python からラベルにアクセスするためのサンプル コードも表示されます。

![エクスポートされたデータセット](./media/how-to-create-labeling-projects/exported-dataset.png)

## <a name="troubleshooting"></a>トラブルシューティング

これらの問題が発生した場合は、次のヒントを参考にしてください。

|問題  |解決方法  |
|---------|---------|
|BLOB データストアに作成されたデータセットしか使用できない。     |  これは、現在のリリースの既知の制限です。       |
|作成後、プロジェクトで "Initializing (初期化しています)" と長時間にわたり表示される。     | ページを手動で最新の情報に更新してください。 初期化の進行速度は、1 秒あたり約 20 データポイントです。 自動更新が実行されない問題が確認されています。         |
|画像をレビューする際に、新しくラベル付けされた画像が表示されない。     |   ラベル付けされたすべての画像を読み込むには、 **[First]\(1 番目\)** ボタンを選択します。 **[First]\(1 番目\)** ボタンを選択すると、リストの先頭に戻りますが、ラベル付けされたデータはすべて読み込まれます。      |
|オブジェクト検出のラベル付け中に Esc キーを押すと、左上隅にゼロ サイズのラベルが作成されます。 この状態でラベルを送信することはできません。     |   ラベルの横にある交差マークをクリックして、ラベルを削除してください。  |
|特定のラベラーに一連のタスクを割り当てることができない。     |   これは、現在のリリースの既知の制限です。  |

## <a name="next-steps"></a>次のステップ

* [チュートリアル:初めての画像分類のラベル付けプロジェクトの作成に関するチュートリアル](tutorial-labeling.md)を参照してください。
* [画像の分類またはオブジェクトの検出](how-to-label-images.md)のために、画像にラベルを付けます
* [Azure Machine Learning と Machine Learning Studio (クラシック)](./overview-what-is-machine-learning-studio.md#ml-studio-classic-vs-azure-machine-learning-studio) について学習します
