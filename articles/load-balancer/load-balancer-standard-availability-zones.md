---
title: Azure Standard Load Balancer と可用性ゾーン
titleSuffix: Azure Load Balancer
description: このラーニング パスを使用して、Azure Standard Load Balancer と Availability Zones の使用を開始します。
services: load-balancer
documentationcenter: na
author: asudbring
ms.custom: seodec18
ms.service: load-balancer
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 08/07/2019
ms.author: allensu
ms.openlocfilehash: 9e585f7d13e1686f125055056fd1e2d88e2bf8ff
ms.sourcegitcommit: 3eb0cc8091c8e4ae4d537051c3265b92427537fe
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 01/11/2020
ms.locfileid: "75903344"
---
# <a name="standard-load-balancer-and-availability-zones"></a>Standard Load Balancer と可用性ゾーン

Azure Standard Load Balancer は、[可用性ゾーン](../availability-zones/az-overview.md)のシナリオをサポートしています。 Standard Load Balancer を使用することで、リソースをゾーンに一致させて、複数のゾーンに分散させることにより、エンド ツー エンドのシナリオで可用性を最適化させることができます。  可用性ゾーンとは何か、現在可用性ゾーンをサポートしているリージョン、その他の関連する概念と製品については、[可用性ゾーン](../availability-zones/az-overview.md)に関する記事をご覧ください。 可用性ゾーンと Standard Load Balancer の組み合わせは、さまざまなシナリオを作成できる拡張性と柔軟性の高い機能セットです。  このドキュメントを読んで、これらの[概念](#concepts)と基本的なシナリオの[設計ガイダンス](#design)を理解してください。

>[!IMPORTANT]
>リージョン固有の情報を含む関連トピックについては、[Availability Zones](../availability-zones/az-overview.md) に関するページを参照してください。

## <a name="concepts"></a> Load Balancer に適用される可用性ゾーンの概念

Load Balancer のリソースと実際のインフラストラクチャの間に直接的な関係はありません。Load Balancer を作成しても、インスタンスは作成されません。 Load Balancer のリソースはオブジェクトであり、その中では、ユーザーが作成したいシナリオを実現するために Azure がその構築済みマルチ テナント インフラストラクチャをプログラミングする方法を表すことができます。  これは、1 つの Load Balancer リソースで複数の可用性ゾーンのインフラストラクチャのプログラミングを制御でき、一方でゾーン冗長サービスは顧客の観点からは 1 つのリソースに見えるので、ゾーンの可用性のコンテキストでは重要なことです。  

Load Balancer リソース自体はリージョン ベースであり、ゾーン ベースではありません。  また、VNet とサブネットも常にリージョン ベースであり、ゾーン ベースではありません。 構成できる対象の粒度は、フロントエンド、規則、およびバックエンド プール定義の各構成によって制限されます。

可用性ゾーンのコンテキストでは、Load Balancer 規則の動作とプロパティは、ゾーン冗長またはゾーン ベースとして記述されます。  ゾーン冗長とゾーン ベースは、プロパティのゾーン性を記述します。  Load Balancer のコンテキストでは、ゾーン冗長は常に "*ゾーン*" を意味し、ゾーン ベースはサービスを "*単一のゾーン*" に分離することを意味します。

パブリックと内部のどちらの Load Balancer も、ゾーン冗長とゾーン ベースのシナリオをサポートし、必要に応じて、ゾーン間でトラフィックを受け渡しできます ("*ゾーン間負荷分散*")。 

### <a name="frontend"></a>フロントエンド

Load Balancer のフロントエンドは、仮想ネットワーク リソースのサブネット内のパブリック IP アドレス リソースまたはプライベート IP アドレスのいずれかを参照するフロントエンド IP 構成です。  サービスが公開される負荷分散されたエンドポイントを形成します。

Load Balancer リソースは、ゾーン ベースのフロントエンドとゾーン冗長のフロントエンドの規則を同時に含むことができます。 

パブリック IP リソースまたはプライベート IP アドレスがゾーンに対して保証されている場合、ゾーン性 (またはその欠如) は変更できません。  パブリック IP またはプライベート IP アドレスのフロントエンドのゾーン性を変更または省略する必要がある場合は、適切なゾーンでパブリック IP を再作成する必要があります。  可用性ゾーンでは、複数のフロントエンドについての制約が変更されません。この機能の詳細については、「[Load Balancer の複数フロントエンド](load-balancer-multivip-overview.md)」を確認してください。

#### <a name="zone-redundant-by-default"></a>既定で冗長なゾーン

可用性ゾーンのあるリージョンでは、Standard Load Balancer のフロントエンドは既定でゾーン冗長になります。  ゾーン冗長とは、すべての受信フローまたは送信フローが、1 つの IP アドレスを使って、リージョン内の複数の可用性ゾーンにより同時に処理されることを意味します。 DNS の冗長性スキームは必要ありません。 1 つのフロントエンド IP アドレスがゾーンの障害に対応でき、ゾーンに関係なくすべての (影響を受けない) バックエンド プール メンバーへのアクセスに使用できます。 1 つまたは複数の可用性ゾーンで障害が発生しても対応可能であり、リージョン内に正常なゾーンが 1 つでも残っていれば、データ パスは存続します。 フロントエンドの単一の IP アドレスは、複数の可用性ゾーンで複数の独立したインフラストラクチャ展開によって同時に処理されます。  これはヒットレス データ パスを意味するものではなく、ゾーンの障害による影響を受けていない他のゾーンですべての再試行または再確立が成功します。   

次の抜粋は、パブリック Standard Load Balancer で使用するゾーン冗長のパブリック IP アドレスを定義する方法を示しています。 構成で既存の Resource Manager テンプレートを使用している場合は、これらのテンプレートに **sku** セクションを追加してください。

```json
            "apiVersion": "2017-08-01",
            "type": "Microsoft.Network/publicIPAddresses",
            "name": "public_ip_standard",
            "location": "region",
            "sku":
            {
                "name": "Standard"
            },
```

次の抜粋は、内部 Standard Load Balancer に対してゾーン冗長のフロントエンド IP アドレスを定義する方法を示しています。 構成で既存の Resource Manager テンプレートを使用している場合は、これらのテンプレートに **sku** セクションを追加してください。

```json
            "apiVersion": "2017-08-01",
            "type": "Microsoft.Network/loadBalancers",
            "name": "load_balancer_standard",
            "location": "region",
            "sku":
            {
                "name": "Standard"
            },
            "properties": {
                "frontendIPConfigurations": [
                    {
                        "name": "zone_redundant_frontend",
                        "properties": {
                            "subnet": {
                                "Id": "[variables('subnetRef')]"
                            },
                            "privateIPAddress": "10.0.0.6",
                            "privateIPAllocationMethod": "Static"
                        }
                    },
                ],
```

前の抜粋は完全なテンプレートではありませんが、可用性ゾーンのプロパティを表す方法を示すことを目的としています。  これらのステートメントをお使いのテンプレートに組み込む必要があります。

#### <a name="optional-zone-isolation"></a>省略可能なゾーンの分離

単一ゾーンを保証されたフロントエンドにすることができます。これは、"*ゾーン ベースのフロントエンド*" と呼ばれます。  これは、すべての受信または送信フローが、リージョン内の 1 つのゾーンによって処理されることを意味します。  フロントエンドは、ゾーンの正常性に左右されます。  データ パスは、それが保証されたゾーン以外のゾーンのエラーによっては影響を受けません。 ゾーン ベースのフロントエンドを使って、可用性ゾーンごとに IP アドレスを公開することができます。  

また、各ゾーン内の負荷分散されたエンドポイントに対して、ゾーン ベースのフロントエンドを直接使用することもできます。 これを使ってゾーンごとに負荷分散されたエンドポイントを公開し、各ゾーンを個別に監視することもできます。  また、パブリック エンドポイントの場合は、これらを [Traffic Manager](../traffic-manager/traffic-manager-overview.md) などの DNS 負荷分散製品と統合して、1 つの DNS 名を使用できます。 その後、クライアントは、複数のゾーン ベースの IP アドレスにこの DNS 名を解決します。  

これらの概念を組み合わせる (同じバックエンドでゾーン冗長とゾーン ベースを使う) 場合は、[Azure Load Balancer での複数のフロントエンド](load-balancer-multivip-overview.md)に関するページをご覧ください。

パブリック Load Balancer フロントエンドの場合は、それぞれの規則によって使用されるフロントエンド IP 構成が参照するパブリック IP リソースに *zones* パラメーターを追加します。

内部 Load Balancer フロントエンドの場合は、内部 Load Balancer のフロントエンド IP 構成に *zones* パラメーターを追加します。 ゾーン ベースのフロントエンドでは、Load Balancer は特定のゾーンに対してサブネット内の IP アドレスを保証します。

次の抜粋は、可用性ゾーン 1 でゾーン ベースの Standard パブリック IP アドレスを定義する方法を示しています。 構成で既存の Resource Manager テンプレートを使用している場合は、これらのテンプレートに **sku** セクションを追加してください。

```json
            "apiVersion": "2017-08-01",
            "type": "Microsoft.Network/publicIPAddresses",
            "name": "public_ip_standard",
            "location": "region",
            "zones": [ "1" ],
            "sku":
            {
                "name": "Standard"
            },
```

次の抜粋は、可用性ゾーン 1 で内部 Standard Load Balancer フロントエンドを定義する方法を示しています。 構成で既存の Resource Manager テンプレートを使用している場合は、これらのテンプレートに **sku** セクションを追加してください。 また、子リソースのフロントエンド IP 構成で **zones** プロパティを定義します。

```json
            "apiVersion": "2017-08-01",
            "type": "Microsoft.Network/loadBalancers",
            "name": "load_balancer_standard",
            "location": "region",
            "sku":
            {
                "name": "Standard"
            },
            "properties": {
                "frontendIPConfigurations": [
                    {
                        "name": "zonal_frontend_in_az1",
                        "zones": [ "1" ],
                        "properties": {
                            "subnet": {
                                "Id": "[variables('subnetRef')]"
                            },
                            "privateIPAddress": "10.0.0.6",
                            "privateIPAllocationMethod": "Static"
                        }
                    },
                ],
```

前の抜粋は完全なテンプレートではありませんが、可用性ゾーンのプロパティを表す方法を示すことを目的としています。  これらのステートメントをお使いのテンプレートに組み込む必要があります。

### <a name="cross-zone-load-balancing"></a>クロスゾーン負荷分散

クロスゾーンの負荷分散は、任意のゾーン内のバックエンド エンドポイントに到達する Load Balancer の機能であり、フロントエンドおよびそのゾーン性からは独立しています。  すべての負荷分散規則は、任意の可用性ゾーンまたはリージョン インスタンスのバックエンド インスタンスを対象にすることができます。

可用性ゾーンの概念を表す方法でシナリオを構築する必要があります。 たとえば、単一または複数のゾーン内で仮想マシン展開を保証し、ゾーン ベースのフロントエンド リソースとゾーン ベースのバックエンド リソースを同じゾーンに揃える必要があります。  ゾーン ベースのリソースのみで可用性ゾーンをクロスさせる場合、そのシナリオは機能しますが、可用性ゾーンに関して明確な障害モードがない場合があります。 

### <a name="backend"></a>バックエンド

Load Balancer は仮想マシン インスタンスで動作します。  これらは、スタンドアロン、可用性セット、または仮想マシン スケール セットです。  ゾーンに対して保証されていたかどうか、またはどのゾーンが保証対象であったかに関係なく、単一の仮想ネットワーク内の任意の仮想マシンが、バックエンド プールの一部になることができます。

フロントエンドとバックエンドを 1 つのゾーンに揃えて保証する場合は、同じゾーン内の仮想マシンのみをそれぞれのバックエンド プールに配置します。

複数のゾーンの仮想マシンに対応したい場合は、単に複数のゾーンからの仮想マシンを同じバックエンド プールに配置します。  仮想マシン スケール セットを使っているときは、1 つまたは複数の仮想マシン スケール セットを同じバックエンド プールに配置できます。  また、これらの各仮想マシン スケール セットを 1 つまたは複数のゾーンに配置できます。

### <a name="outbound-connections"></a>送信接続

[送信接続](load-balancer-outbound-connections.md)には同じゾーン冗長プロパティとゾーン ベースのプロパティが適用されます。  送信接続に使用されるゾーン冗長パブリック IP アドレスは、すべてのゾーンによって処理されます。 ゾーン ベースのパブリック IP アドレスは、それが保証されているゾーンによってのみ処理されます。  送信接続 SNAT ポートの割り当ては、ゾーンの障害でも維持され、ゾーンの障害による影響を受けていない場合、このシナリオでは引き続き送信 SNAT 接続が提供されます。  これは、影響を受けたゾーンによってフローが処理された場合、ゾーン冗長のシナリオで転送または接続の再確立が必要になることがあります。  影響を受けるゾーン以外のゾーン内のフローは、影響を受けません。

SNAT ポートの事前割り当てアルゴリズムは、可用性ゾーンがあってもなくても同じです。

### <a name="health-probes"></a>正常性プローブ

既存の正常性プローブの定義は、可用性ゾーンがない場合でも同じです。  ただし、正常性モデルはインフラストラクチャ レベルで拡張されています。 

ゾーン冗長のフロントエンドを使うと、Load Balancer の内部正常性モデルは、各可用性ゾーンからの仮想マシンの到達可能性を独立してプローブし、障害が発生した可能性のあるゾーンとのパスをユーザーの介入なしにシャットダウンするように、拡張されます。  あるゾーンの Load Balancer インフラストラクチャから別のゾーン内の仮想マシンへの特定のパスを使用できない場合、Load Balancer はこの障害を検出して回避することができます。 この VM に到達できる他のゾーンは、それぞれのフロントエンドから VM の処理を続けることができます。  その結果、障害が発生している間は、エンド ツー エンドのサービスの全体的な正常性を保護するために、各ゾーンで新しいフローのディストリビューションが若干異なる可能性があります。

## <a name="design"></a> 設計上の考慮事項

Load Balancer は、可用性ゾーンのコンテキストにおいて柔軟性を持つように意図されています。 ゾーンに一致させることも、規則ごとにゾーン冗長にすることもできます。  可用性を高めると複雑さが増す可能性があり、パフォーマンスが最適になるように可用性を設計する必要があります。  以下では、設計に関する重要な考慮事項を示します。

### <a name="automatic-zone-redundancy"></a>自動ゾーン冗長性

Load Balancer を使うと、ゾーン冗長フロントエンドとして 1 つの IP アドレスを簡単に持つことができます。 ゾーン冗長 IP アドレスは、任意のゾーンでゾーン ベースのリソースを安全に提供でき、リージョン内に正常なゾーンが 1 つでも残っている限り、1 つまたは複数のゾーンで障害があっても存続できます。 逆に、ゾーン ベースのフロントエンドは、単一のゾーンへのサービスの縮小であり、対応するゾーンの正常性に依存します。

ゾーンの冗長性は、ヒットレス データパスまたは制御プレーンを意味するものではなく、データ プレーンを明示します。 ゾーン冗長なフローは任意のゾーンを使うことができ、ユーザーのフローはリージョン内で正常なすべてのゾーンを使います。 ゾーンで障害が発生すると、その時点で正常なゾーンを使っているトラフィック フローは影響を受けません。  ゾーンで障害が発生したときにゾーンを使用しているトラフィック フローは影響を受ける可能性がありますが、アプリケーションは復旧できます。 Azure がゾーンの障害を収束したら、再送信または再確立時にリージョン内に残っている正常なゾーンでこれらのフローを続行できます。

### <a name="xzonedesign"></a> ゾーンの境界を越える

エンド ツー エンドのサービスがゾーンを越えるときは常に、1 つのゾーンではなく複数のゾーンの正常性に依存する可能性があることを理解しておくことが重要です。  その結果、エンド ツー エンドのサービスは、ゾーン ベースではない展開より可用性が高くならない可能性があります。

可用性ゾーンを使ったときの可用性のメリットがなくなる、意図しないクロスゾーンの依存関係が発生しないようにします。  アプリケーションが複数のコンポーネントで構成されていて、ゾーンの障害に対する回復力が必要な場合は、ゾーンで障害が発生したときに十分な数の重要なコンポーネントが存続するように注意する必要があります。  たとえば、アプリケーションの 1 つの重要なコンポーネントが、障害を存続できなかったゾーンに存在していた場合、アプリケーション全体に影響する可能性があります。  さらに、ゾーンの復元とアプリケーションの収束方法についても検討します。 アプリケーションがその一部の障害に関してどのように判別するかを理解する必要があります。 以下で確認する重要な点を、特定のシナリオについて考えるときの質問の参考にしてください。

- アプリケーションに 2 つのコンポーネント (たとえば、IP アドレスと、マネージド ディスクを含む仮想マシン) があり、ゾーン 1 とゾーン 2 で保証されている場合、ゾーン 1 で障害が発生すると、エンド ツー エンド サービスは存続できません。  潜在的に危険性のある障害モードを作成していることをよく理解していない限り、ゾーン ベースのシナリオでゾーンをクロスさせないようにしてください。  このシナリオでは柔軟性を提供できます。

- アプリケーションに 2 つのコンポーネント (たとえば、IP アドレスと、マネージド ディスクを含む仮想マシン) があり、それぞれでゾーン冗長とゾーン 1 が保証されている場合、ゾーン 1 さえ正常であれば、ゾーン 2 とゾーン 3 のどちらか一方または両方で障害が発生しても、エンド ツー エンドのサービスは存続できます。  ただし、フロントエンドの到達可能性だけを観察している場合は、サービスの正常性を判断する機能が若干失われます。  さらに広範な正常性と容量のモデルの開発を検討します。  ゾーン冗長とゾーン ベースの概念を組み合わせて、洞察と管理容易性を拡張する場合があります。

- アプリケーションの 2 つのコンポーネント (たとえば、ゾーン冗長な Load Balancer フロントエンドと、クロスゾーンの仮想マシン スケール セット) が 3 つのゾーンに存在している場合、障害の影響を受けないゾーンのリソースは使用できますが、エンド ツー エンド サービスの容量はゾーン障害の間に低下する可能性があります。 インフラストラクチャの観点からは、1 つ以上のゾーンで障害が発生しても展開は存続することができ、これにより次のような質問が発生します。
  - このような障害および容量低下をアプリケーションが判断する方法を理解していますか。
  - サービスには、必要に応じてリージョン ペアに強制的にフェールオーバーする安全策が必要ですか。
  - どのような方法で、このようなシナリオを監視、検出、軽減しますか。 Standard Load Balancer の診断機能を使って、エンド ツー エンド サービスのパフォーマンスの監視を強化できる場合があります。 使用可能なもの、および全体像のために拡張が必要なものを検討します。

- ゾーンを使うと、障害の把握と阻止が容易になる可能性があります。  ただし、タイムアウト、再試行、バックオフ アルゴリズムなどの概念に関しては、ゾーンの障害も他の障害と違いはありません。 Azure Load Balancer がゾーン冗長なパスを提供し、迅速な復旧を試みる場合であっても、リアルタイムのパケット レベルでは、障害が発生すると再送信または再確立が行われる可能性があり、アプリケーションが障害に対処する方法を理解しておくことが重要です。 負荷分散スキームは存続しますが、次のことを計画する必要があります。
  - ゾーンで障害が発生した場合、エンド ツー エンド サービスはそれを認識しますか。また、状態が失われた場合、どのようにして復旧しますか。
  - ゾーンが復帰したとき、アプリケーションは安全に収束する方法を認識しますか。

障害シナリオに対するアプリケーションの回復性を向上させるには、[Azure クラウド設計パターン](https://docs.microsoft.com/azure/architecture/patterns/)に関する記事を参照してください。

### <a name="zonalityguidance"></a> ゾーン冗長とゾーン ベースの比較

ゾーン冗長は、ゾーンに依存しないオプションと、サービスに対する単一の IP アドレスでの回復性オプションの併用により、シンプルさを実現します。  さらに、複雑さを低下させることができます。  ゾーン冗長は、ゾーンを越えて移動することもでき、任意のゾーンのリソースで安全に使用できます。  また、可用性ゾーンのないリージョンでも将来的に保証されており、リージョンで可用性ゾーンを利用できるようになったときに必要な変更を制限できます。  ゾーン冗長の IP アドレスまたはフロントエンドの構成構文は、可用性ゾーンがないリージョンも含めて、すべてのリージョンで成功します。ゾーンはリソースの zones プロパティ内で指定されません。

ゾーン ベースは、1 つのゾーンに対する明示的な保証を提供し、そのゾーンの正常性に明示的に依存します。 ゾーン ベースの IP アドレス フロントエンドまたはゾーン ベースの内部 Load Balancer フロントエンドを使用した Load Balancer 規則の作成は、アタッチされているリソースが同じゾーン内のゾーン ベースの仮想マシンであるときは特に望ましい場合があります。  そうでなければおそらく、アプリケーションはリソースが存在するゾーンを前もって明確に知る必要があり、ユーザーは別のゾーンの可用性を明示的に判別する必要があります。  複数のゾーンに分散されているエンド ツー エンド サービスに対し、複数のゾーン ベースのフロントエンドを公開することもできます (つまり、複数のゾーン ベースの仮想マシン スケール セットに対して、ゾーンごとのゾーン ベースのフロントエンド)。  また、ゾーン ベースのフロントエンドがパブリック IP アドレスである場合は、これらの複数のゾーン ベースのフロントエンドを使って、[Traffic Manager](../traffic-manager/traffic-manager-overview.md) でサービスを公開することができます。  または、複数のゾーン ベースのフロントエンドを使うと、サード パーティ製の監視ソリューションによりゾーンごとの正常性とパフォーマンスの洞察を取得でき、ゾーン冗長なフロントエンドでサービス全体を公開することができます。 ゾーン ベースのリソースの提供は、同じゾーンに揃えられたゾーン ベースのフロントエンドでのみ行う必要があり、ゾーン ベースのリソースに対して潜在的に危険なクロスゾーン シナリオは回避する必要があります。  ゾーン ベースのリソースは、可用性ゾーンが存在するリージョンにのみ存在します。

サービス アーキテクチャを理解することなく、選択肢の優劣を判断するための一般的なガイダンスはありません。  障害シナリオに対するアプリケーションの回復性を向上させるには、[Azure クラウド設計パターン](https://docs.microsoft.com/azure/architecture/patterns/)に関する記事を参照してください。

## <a name="next-steps"></a>次のステップ
- [可用性ゾーン](../availability-zones/az-overview.md)の詳細を確認する
- [Standard Load Balancer](load-balancer-standard-overview.md) の詳細を確認する
- [ゾーン フロントエンドによる Standard Load Balancer を使用した単一のゾーン内での VM の負荷分散](load-balancer-standard-public-zonal-cli.md)を確認する
- [ゾーン冗長フロントエンドによる Standard Load Balancer を使用したゾーン間での VM の負荷分散](load-balancer-standard-public-zone-redundant-cli.md)を確認する
- 障害シナリオに対するアプリケーションの回復性を向上させるために、[Azure クラウド設計パターン](https://docs.microsoft.com/azure/architecture/patterns/)についての記事を確認する。
