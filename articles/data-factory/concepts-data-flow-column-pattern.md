---
title: Azure Data Factory のマッピング データ フローにおける列パターン
description: Azure Data Factory のマッピング データ フローにおける列パターンを使って一般化されたデータ変換パターンを作成する
author: kromerm
ms.author: makromer
ms.reviewer: daperlov
ms.service: data-factory
ms.topic: conceptual
ms.date: 10/21/2019
ms.openlocfilehash: aacec8830948e08f66d71da88897670f7ef43788
ms.sourcegitcommit: 849bb1729b89d075eed579aa36395bf4d29f3bd9
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/28/2020
ms.locfileid: "81606132"
---
# <a name="using-column-patterns-in-mapping-data-flow"></a>マッピング データ フロー内の列パターンを使用する

[!INCLUDE[appliesto-adf-asa-md](includes/appliesto-adf-asa-md.md)]

複数のマッピング データ フローの変換によって、ハードコーディングされた列名ではなく、パターンに基づいてテンプレート列を参照できるようになります。 このマッチングは、"*列パターン*" と呼ばれます。 正確なフィールド名を必要とするのではなく、パターンを定義して名前、データ、型、ストリーム、位置に基づいて列を照合できます。 列パターンが役立つシナリオが 2 つあります。

* 受信ソース フィールドが頻繁に変更される場合。テキスト ファイルや NoSQL データベースの列が変更されるケースなどです。 このシナリオは、[スキーマの誤差](concepts-data-flow-schema-drift.md)と呼ばれます。
* 大規模な列グループに対して共通の操作を実行したい場合。 列名に ' total ' が含まれているすべての列を double 型にキャストするなどです。

列パターンは現在、派生列、集計、選択、およびシンクの変換に使用できます。

## <a name="column-patterns-in-derived-column-and-aggregate"></a>派生列および集計の列パターン

派生列内または集計変換の [集計] タブ内で列パターンを追加するには、既存の列の右側にあるプラス記号のアイコンをクリックします。 **[Add column pattern]\(列パターンを追加する\)** を選択します。 

![列パターン](media/data-flow/columnpattern.png "列パターン")

[式ビルダー](concepts-data-flow-expression-builder.md)を使用して、一致条件を入力します。 列の `name`、`type`、`stream`、および `position` を基に列と照合するブール式を作成します。 パターンは、条件から true が返される任意の列 (誤差または定義) に影響を及ぼします。

下の 2 つの式ボックスには、影響を受ける列の新しい名前と値を、一致条件によって指定します。 一致したフィールドの既存の値を参照するには、`$$` を使用します。 左側の式ボックスには名前を定義し、右側の式ボックスには値を定義します。

![列パターン](media/data-flow/columnpattern2.png "列パターン")

上の列パターンでは、double 型のすべての列と照合して、一致ごとに 1 つの集計列を作成します。 新しい列の名前は、一致した列の名前を '_total' と連結したものになります。 新しい列の値は、既存の double 値を丸めて集計した合計です。

一致条件が正しいことを確認するには、 **[検査]** タブ内にある定義列の出力スキーマを検証するか、または **[データのプレビュー]** タブ内にあるデータのスナップショットを取得できます。 

![列パターン](media/data-flow/columnpattern3.png "列パターン")

## <a name="rule-based-mapping-in-select-and-sink"></a>選択とシンクにおけるルールベースのマッピング

ソース変換および選択変換の中で列をマッピングする場合、固定マッピングまたはルールベースのマッピングのどちらかを追加できます。 列の `name`、`type`、`stream`、および `position` に基づいて照合されます。 フィールドとルールベースの両方のマッピングを任意に組み合わせることもできます。 既定では、50 列を超えるすべてのプロジェクションは、既定ではルールベースのマッピングになり、すべての列に対して照合され、入力された名前が出力されます。 

ルールベースのマッピングを追加するには、 **[マッピングの追加]** をクリックし、 **[ルールベースのマッピング]** を選択します。

![ルールベースのマッピング](media/data-flow/rule2.png "ルールベースのマッピング")

各ルールベースのマッピングには、2 つの入力が必要となります。照合の基準となる条件、およびマップされた各列に付ける名前です。 どちらの値も[式ビルダー](concepts-data-flow-expression-builder.md)を使用して入力ます。 左側の式ボックスに、ブール値の一致条件を入力します。 右側の式ボックスに、一致した列のマップ先を指定します。

![ルールベースのマッピング](media/data-flow/rule-based-mapping.png "ルールベースのマッピング")

一致した列の入力名を参照するには、`$$` 構文を使用します。 上の図を例として使用します。ユーザーは、名前が 6 文字より短いすべての文字列型の列に対して照合したいとします。 ある入力列に `test` という名前が付けられていた場合、式 `$$ + '_short'` によりその列の名前が `test_short` に変更されます。 これが唯一のマッピングの場合、条件を満たしていないすべての列が、出力されるデータから削除されます。

パターンにより、誤差の列と定義された列の両方が照合されます。 どの定義された列がルールによってマップされたかを確認するには、ルールの横にある眼鏡アイコンをクリックします。 データ プレビューを使用して出力を確認します。

### <a name="regex-mapping"></a>正規表現マッピング

下向きのシェブロン アイコンをクリックすると、正規表現のマッピング条件を指定できます。 正規表現のマッピング条件により、指定された正規表現の条件に一致するすべての列名が照合されます。 これは、標準のルールベースのマッピングと組み合わせて使用できます。

![ルールベースのマッピング](media/data-flow/regex-matching.png "ルールベースのマッピング")

上記の例では、正規表現パターン `(r)`、つまり小文字の r を含むすべての列名と照合されます。 標準のルールベースのマッピングと同様に、一致したすべての列は、`$$` 構文を使用した右側の条件によって変更されます。

### <a name="rule-based-hierarchies"></a>ルールベースの階層

定義されたプロジェクションに階層がある場合は、ルールベースのマッピングを使用して、階層のサブ列をマップできます。 一致条件と、マップ対象のサブ列が含まれる複合列を指定します。 一致したすべてのサブ列は、右側に指定された [Name as]\(付ける名前\) ルールを使用して出力されます。

![ルールベースのマッピング](media/data-flow/rule-based-hierarchy.png "ルールベースのマッピング")

上記の例では、複合列 `a` のすべてのサブ列に対して照合されます。 `a` には 2 つのサブ列 `b` と `c` が含まれています。 [Name as]\(付ける名前\) 条件が `$$` であるため、出力スキーマには 2 つの列 `b` と `c` が含まれす。

## <a name="pattern-matching-expression-values"></a>パターン マッチングの式の値。

* `$$` は、実行時に各一致の名前または値に変換されます。
* `name` は、受信した各列の名前を表します
* `type` は、受信した各列のデータ型を表します
* `stream` は、フロー内の各ストリームまたは変換に関連付けられた名前を表します
* `position` は、データ フロー内の列の序数位置です

## <a name="next-steps"></a>次のステップ
* データ変換におけるマッピング データ フローの[式言語](data-flow-expression-functions.md)に関する詳細を確認する
* [シンク変換](data-flow-sink.md)と[選択変換](data-flow-select.md)の中でルールベースのマッピングと共に列パターンを使用する
