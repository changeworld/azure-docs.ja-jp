---
title: マッピング データ フローの参照変換
description: Azure Data Factory のマッピング データ フローの参照変換
author: kromerm
ms.author: makromer
ms.service: data-factory
ms.topic: conceptual
ms.custom: seo-lt-2019
ms.date: 02/26/2020
ms.openlocfilehash: 2216e1bf058eef486dbfefba24d52bdc6bdb232f
ms.sourcegitcommit: 1f738a94b16f61e5dad0b29c98a6d355f724a2c7
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 02/28/2020
ms.locfileid: "78164680"
---
# <a name="azure-data-factory-mapping-data-flow-lookup-transformation"></a>Azure Data Factory のマッピング データ フローの参照変換

参照を使用して、別のソースの参照データをデータ フローに追加します。 参照変換では、参照テーブルをポイントし、キー フィールドが一致する定義済みのソースが必要です。

![参照変換](media/data-flow/lookup1.png "参照")

受信するストリームのフィールドと参照元のフィールドの間で一致させるキー フィールドを選択します。 データ フロー デザイン キャンバスで、参照の右側として使用する新しいソースを先に作成しておく必要があります。

一致が見つかると、参照元から結果の行と列がデータ フローに追加されます。 データ フローの最後でシンクに書き込む、関心のあるフィールドを選択できます。 または、参照の後に選択変換を使用して、保持する必要がある両方のストリームのフィールドのみが残るようにフィールド リストからフィールドを取り除きます。

参照変換では、左外部結合と同等の操作が実行されます。 したがって、左側のソースのすべての行が、右側の一致と結合されていることがわかります。 参照に一致する値が複数ある場合、または参照式をカスタマイズする場合は、結合変換に切り替えてクロス結合を使用することをお勧めします。 これにより、実行時に発生する可能性のあるデカルト積エラーを回避できます。

## <a name="match--no-match"></a>一致 / 一致なし

参照変換の後に後続の変換を使用して一致する各行の結果を検査します。これには式の関数`isMatch()`を使用して、参照により行と一致したかどうかに基づいて、ロジック内で選択を行えるようにします。

![参照パターン](media/data-flow/lookup111.png "参照パターン")

参照変換を使用した後、```isMatch()``` 関数上で分割を行う条件分割変換を追加できます。 上記の例では、一致する行が上のストリームを進み、一致しない行は ```NoMatch``` ストリームを進みます。

## <a name="first-or-last-value"></a>最初または最後の値

参照変換は、左外部結合として実装されます。 参照から複数の一致が見つかった場合は、最初に一致した行、、最後の一致、またはランダムな行を選択して、一致する複数の行を減らすことができます。

### <a name="option-1"></a>方法 1

![単一行参照](media/data-flow/singlerowlookup.png "単一行参照")

* 複数の行の一致:単一行の一致を返すには、空白のままにします
* 一致日:最初、最後、または任意の一致を選択します
* 並べ替え条件:最初または最後を選択した場合、 ADF では、最初と最後の背後にロジックがあるようにデータを順序付ける必要があります

> [!NOTE]
> 参照から返される値をコントロールする必要がある場合は、単一行セレクターで最初または最後のオプションのみを使用してください。 「任意」または複数行の参照を使用すると、より高速に実行できます。

### <a name="option-2"></a>方法 2

また、参照後に、集計変換を使用してこれを行うことができます。 この場合、```PickFirst``` という集計変換を使用して、参照の一致から最初の値を選択します。

![参照の集計](media/data-flow/lookup333.png "参照の集計")

![最初の参照](media/data-flow/lookup444.png "最初の参照")

## <a name="optimizations"></a>最適化

Data Factory では、データ フローがスケールアウト Spark 環境で実行されます。 データセットがワーカー ノードのメモリ領域に収まる場合、参照のパフォーマンスを最適化することができます。

![ブロードキャスト結合](media/data-flow/broadcast.png "ブロードキャスト結合")

### <a name="broadcast-join"></a>ブロードキャスト結合

参照リレーションシップの左側または右側からデータセット全体をメモリにプッシュするよう ADF に要求するには、左側または右側のブロードキャスト結合を選択します。 データセットが小さい場合は、これによって参照のパフォーマンスを大幅に向上させることができます。

### <a name="data-partitioning"></a>データのパーティション分割

参照変換の [最適化] タブの [Set Partitioning]\(パーティションの設定\) を選択し、データのパーティション分割を指定することで、ワーカーごとにメモリに収めることができるデータのまとまりを作成することもできます。

## <a name="next-steps"></a>次のステップ

* [結合](data-flow-join.md)変換と[存在](data-flow-exists.md)変換は、ADF マッピング データ フローで同様のタスクを実行します。 引き続き、これらの変換について見ていきましょう。
* ```isMatch()``` と共に[条件分割](data-flow-conditional-split.md)を使用して、一致する値と一致しない値に行を分割します
