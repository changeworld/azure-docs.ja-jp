---
title: Azure CDN ルール エンジンのリファレンス | Microsoft Docs
description: Azure CDN ルール エンジンの一致条件と機能に関するリファレンス ドキュメント。
services: cdn
author: asudbring
ms.service: azure-cdn
ms.topic: article
ms.date: 05/26/2020
ms.author: allensu
ms.openlocfilehash: 75633521474ec3bcbc35cea49ea7a2da6a271e01
ms.sourcegitcommit: 64fc70f6c145e14d605db0c2a0f407b72401f5eb
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 05/27/2020
ms.locfileid: "83872499"
---
# <a name="azure-cdn-from-verizon-premium-rules-engine-reference"></a>Azure CDN from Verizon Premium ルール エンジンのリファレンス

この記事では、Azure Content Delivery Network (CDN) [ルール エンジン](cdn-verizon-premium-rules-engine.md)で使用できる一致条件と機能について詳しく説明します。

ルール エンジンは、特定の種類の要求が CDN によって処理される方法について、最終的な決定を下すように設計されています。

**一般的な使用法**:

- カスタムのキャッシュ ポリシーをオーバーライドまたは定義します。
- 機密性の高いコンテンツに対する要求をセキュリティで保護するか拒否します。
- 要求をリダイレクトします。
- カスタム ログ データを保存します。
## <a name="key-concepts"></a>主要な概念
以下では、ルール エンジンの設定に関する主要な概念について説明します。
### <a name="draft"></a>ドラフト
ポリシーのドラフトは、要求とそれに適用される一連のアクションを識別するための 1 つまたは複数のルールで構成されます。 ドラフトとは、サイトのトラフィックに影響を与えることなく頻繁に構成を更新できるようにする、進行中の作業のことです。 ドラフトを完成させる準備ができたら、読み取り専用ポリシーに変換する必要があります。

### <a name="rule"></a>ルール
ルールでは、1 つまたは複数の種類の要求と、それらに適用される一連のアクションが示されます。

構成は次のとおりです。 

- 要求が識別されるロジックを定義する一連の条件式。
- 要求を識別するために使用される条件を定義する一連の一致条件。
- CDN による上記の要求の処理方法を定義する一連の機能。
次の図では、これらの要素が示されています。

![ポリシーのデプロイのワークフロー](./media/cdn-verizon-premium-rules-engine-reference/verizon-rules-engine-reference.png)

### <a name="policy"></a>ポリシー
一連の読み取り専用ルールで構成されるポリシーでは、以下のことのための手段が提供されます。

- ルールの複数のバリエーションを作成、保存、管理する。
- 以前にデプロイしたバージョンにロールバックする。
- イベント固有のルールを事前に準備する (たとえば、顧客が開始したメンテナンスの結果としてトラフィックをリダイレクトするルール)。

> [!NOTE]
> 環境ごとに許可されるポリシーは 1 つだけですが、必要に応じてポリシーをデプロイできます。

### <a name="deploy-request"></a>デプロイ要求
デプロイ要求では、ステージング環境または運用環境にポリシーを迅速に適用できる、簡単で合理化された手順が提供されます。 これらの環境に適用された変更の追跡を容易にするため、デプロイ要求の履歴が提供されています。

> [!NOTE]
> 自動検証およびエラー検出システムを通過しない要求についてのみ、手動による確認と承認が必要になります。

### <a name="rule-precedence"></a>ルールの優先順位
ポリシーに含まれるルールは、通常、一覧の順序 (つまり、上から下) で処理されます。 要求が競合する複数のルールと一致した場合は、最後に処理されるルールが優先されます。

### <a name="policy-deployment-workflow"></a>ポリシーのデプロイのワークフロー
次の図では、運用環境またはステージング環境にポリシーを適用するワークフローを示します。

![ポリシーのデプロイのワークフロー](./media/cdn-verizon-premium-rules-engine-reference/policy-deployment-workflow.png)

|手順 |説明 |
|---------|---------|
|[ドラフトを作成する](https://docs.vdms.com/cdn/index.html#HRE/AdministeringDraftsandRules.htm#Create)    |    ドラフトは、コンテンツの要求を CDN で処理する方法が定義されている一連のルールで構成されます。     |
|ドラフトをロックする   |     ドラフトが完成したら、ロックし、読み取り専用ポリシーに変換する必要があります。    |
|[デプロイ要求を送信する](https://docs.vdms.com/cdn/index.html#HRE/DeployRequest.htm)   |   <br> デプロイ要求を使って、ポリシーをテスト トラフィックまたは運用トラフィックに適用できます。</br> <br>ステージング環境または運用環境のいずれかにデプロイ要求を送信します。</br>     |
|デプロイ要求のレビュー   |    <br>デプロイ要求の自動検証とエラー検出が行われます。</br><br>デプロイ要求の大部分は自動的に承認されますが、より複雑なポリシーの場合は手動で確認する必要があります。</br>   |
|ポリシーのデプロイ ([ステージング](https://docs.vdms.com/cdn/index.html#HRE/Environment.htm#Staging))   |  <br> ステージング環境へのデプロイ要求が承認されたら、ステージング環境にポリシーが適用されます。 この環境では、モック サイト トラフィックに対してポリシーをテストできます。</br><br>ポリシーをライブ サイト トラフィックに適用する準備ができたら、運用環境に対する新しいデプロイ要求を送信する必要があります。</br>      |
|ポリシーのデプロイ ([運用](https://docs.vdms.com/cdn/index.html#HRE/Environment.htm#Producti))   |  運用環境へのデプロイ要求が承認されたら、運用環境にポリシーが適用されます。 この環境では、ポリシーは、CDN がライブ トラフィックを処理する方法を決定するための最後の証明機関として機能することができます。     |
## <a name="syntax"></a>構文

特殊文字が扱われる方法は、一致条件または機能でテキスト値を処理する方法によって異なります。 一致条件または機能は、次のいずれかのようにテキストを解釈する場合があります。

- [**リテラル値**](#literal-values)
- [**ワイルドカード値**](#wildcard-values)
- [**正規表現**](#regular-expressions)

### <a name="literal-values"></a>リテラル値

リテラル値として解釈されるテキストでは、"%" 記号を除くすべての特殊文字が、一致する必要のある値の一部として扱われます。 つまり、`\'*'\` に設定されたリテラルの一致条件は、完全に一致する値 (つまり、`\'*'\`) が見つかった場合にのみ満たされます。

パーセント記号は、URL エンコードを示すために使用されます (例: `%20`)。

### <a name="wildcard-values"></a>ワイルドカード値

ワイルドカード値として解釈されるテキストでは、特殊文字に付加的な意味が割り当てられます。 次の表は、以下の一連の文字がどのように解釈されるのかを示しています。

文字 | 説明
----------|------------
\ | バックスラッシュは、このテーブルで指定されているすべて文字からのエスケープに使用されます。 エスケープする特殊文字の直前にバックスラッシュを指定する必要があります。<br/>たとえば、次の構文では、アスタリスクをエスケープします。`\*`
% | パーセント記号は、URL エンコードを示すために使用されます (例: `%20`)。
\* | アスタリスクは、1 つまたは複数の文字を表すワイルドカードです。
Space | 空白文字は、指定した値またはパターンのいずれかで一致条件を満たすことができることを示します。
'値' | 一重引用符には、特別な意味はありません。 ただし、一連の一重引用符することで、値はリテラル値として扱われることを示します。 次のように使用できます。<br><br/>- 指定した値が比較対象値の任意の部分と一致するたびに、一致条件を満たすようにします。  たとえば、`'ma'` は、次の文字列のいずれかと一致します。 <br/><br/>/business/**ma**rathon/asset.htm<br/>**ma**p.gif<br/>/business/template.**ma**p<br /><br />- 特殊文字をリテラル文字として指定できます。 たとえば、空白文字を一重引用符で囲むことで、リテラルの空白文字を指定できます (つまり、`' '` または `'sample value'`)。<br/>- 空白の値を指定できます。 一重引用符のセット ('') を指定することで、空白の値を指定します。<br /><br/>**重要:**<br/>- 指定した値にワイルドカードが含まれていない場合は、自動的にリテラル値と見なされるので、一重引用符のセットを指定する必要はありません。<br/>- バックスラッシュがこの表の別の文字をエスケープしない場合は、一重引用符のセット内に指定すると無視されます。<br/>- 特殊文字をリテラル文字として指定するもう 1 つの方法は、バックスラッシュ (`\`) を使用してエスケープすることです。

### <a name="regular-expressions"></a>正規表現

正規表現では、テキスト値内で検索するパターンを定義します。 正規表現の表記は、さまざまなシンボルに特定の意味を定義します。 次のテーブルでは、特殊文字が一致条件や正規表現をサポートする機能によってどのように扱われるかが示されます。

特殊文字 | 説明
------------------|------------
\ | バックスラッシュは、その後の文字をエスケープします。これにより、その文字は、正規表現の意味としてではなく、リテラル値として扱われます。 たとえば、次の構文では、アスタリスクをエスケープします。`\*`
% | パーセント記号の意味は、その使用法によって異なります。<br/><br/> `%{HTTPVariable}`:この構文では、HTTP 変数を識別します。<br/>`%{HTTPVariable%Pattern}`:この構文では、区切り記号として、また HTTP 変数を識別するために、パーセント記号を使用します。<br />`\%`:パーセント記号をエスケープすると、リテラル値として使用したり、URL エンコードを示したりすることができます (例: `\%20`)。
\* | アスタリスクでは、直前の文字を 0 回以上一致すことができます。
Space | 空白文字は一般的にリテラル文字として扱われます。
'値' | 一重引用符は、リテラル文字として扱われます。 一重引用符のセットには、特別な意味はありません。

正規表現をサポートする一致条件と機能は、Perl Compatible Regular Expressions (PCRE) で定義されているパターンを受け入れます。



## <a name="next-steps"></a>次のステップ

- [ルール エンジンの一致条件](cdn-verizon-premium-rules-engine-reference-match-conditions.md)
- [ルール エンジンの条件式](cdn-verizon-premium-rules-engine-reference-conditional-expressions.md)
- [ルール エンジンの機能](cdn-verizon-premium-rules-engine-reference-features.md)
- [ルール エンジンを使用して HTTP 動作をオーバーライドする](cdn-verizon-premium-rules-engine.md)
- [Azure CDN の概要](cdn-overview.md)
