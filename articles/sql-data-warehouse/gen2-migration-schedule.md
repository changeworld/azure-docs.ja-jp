---
title: Gen2 への既存の Azure SQL Data Warehouse の移行 | Microsoft Docs
description: 既存のデータ ウェアハウスを Gen2 に移行するための手順およびリージョン別の移行スケジュール。
services: sql-data-warehouse
author: mlee3gsd
ms.author: anumjs
ms.reviewer: jrasnick
manager: craigg
ms.assetid: 04b05dea-c066-44a0-9751-0774eb84c689
ms.service: sql-data-warehouse
ms.topic: article
ms.date: 04/03/2019
ms.openlocfilehash: 3141f3a1d6a9f09261dee4113276af72168e35e8
ms.sourcegitcommit: f56b267b11f23ac8f6284bb662b38c7a8336e99b
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 06/28/2019
ms.locfileid: "67444704"
---
# <a name="upgrade-your-data-warehouse-to-gen2"></a>Gen2 へのデータ ウェアハウスのアップグレード

Microsoft では、データ ウェアハウス運営するための初期段階の費用を下げるお手伝いをします。  要求水準の高いクエリの処理が可能な下位のコンピューティング レベルが、Azure SQL Data Warehouse で利用できるようになりました。 「[Lower compute tier support for Gen2](https://azure.microsoft.com/blog/azure-sql-data-warehouse-gen2-now-supports-lower-compute-tiers/)」の告知の全文をお読みください。 この新しいオファリングは、下記の表に記載されたリージョンで利用することができます。 サポート対象のリージョンでは、次のいずれかの方法で、既存の Gen1 データ ウェアハウスを Gen2 にアップグレードできます。

- **自動アップグレード プロセス:** 自動アップグレードは、リージョンでサービスが使用できるようになってもすぐには開始されません。  特定のリージョンで自動アップグレードが開始されると、選択したメンテナンス スケジュール中に個々の DW アップグレードが実行されます。
- [**Gen2 へのセルフアップグレード:** ](#self-upgrade-to-gen2)Gen2 へのセルフアップグレードを実行することで、アップグレードのタイミングを制御することができます。 お住まいのリージョンがまだサポート対象でない場合は、サポートされているリージョンで復元ポイントから直接 Gen2 インスタンスに復元することができます。

## <a name="automated-schedule-and-region-availability-table"></a>自動スケジュールと利用可能なリージョンの表

次の表では、下位 Gen2 コンピューティング レベルがいつ利用可能になるか、および自動アップグレードがいつ開始されるかを、リージョン別にまとめています。 日付は変更されることがあります。 お客様のリージョンがいつ利用可能になるかを再度ご確認ください。

\* は、リージョンに対して特定のスケジュールが現時点で利用不可であることを示します。

| **[リージョン]** | **下位の Gen2 が利用可能** | **自動アップグレードの開始** |
|:--- |:--- |:--- |
| オーストラリア東部 |使用可能 |2019 年 6 月 1 日 |
| オーストラリア南東部 |使用可能 |2019 年 5 月 1 日 |
| ブラジル南部 |使用可能 |2019 年 6 月 1 日 |
| カナダ中部 |使用可能 |2019 年 6 月 1 日 |
| カナダ東部 |\* |\* |
| 米国中部 |使用可能 |2019 年 6 月 1 日 |
| 中国 (東部) |\* |\* |
| 中国東部 2 |\* |Gen2 のみ |
| 中国 (北部) |\* |\* |
| 中国北部 2 |使用可能 |Gen2 のみ |
| 東アジア |使用可能 |2019 年 6 月 1 日 |
| East US |使用可能 |2019 年 6 月 1 日 |
| 米国東部 2 |使用可能 |2019 年 6 月 1 日 |
| フランス中部 |\* |2019 年 6 月 1 日 |
| ドイツ中部 |\* |\* |
| ドイツ中西部 |2019 年 9 月 1 日|2020 年 1 月 2 日 |
| インド中部 |使用可能 |2019 年 6 月 1 日 |
| インド南部 |使用可能 |2019 年 6 月 1 日 |
| 東日本 |使用可能 |2019 年 6 月 1 日 |
| 西日本 |使用可能 |2019 年 5 月 1 日 |
| 韓国中部 |使用可能 |2019 年 6 月 1 日 |
| 韓国南部 |使用可能 |2019 年 5 月 1 日 |
| 米国中北部 |使用可能 |2019 年 5 月 1 日 |
| 北ヨーロッパ |使用可能 |2019 年 6 月 1 日 |
| 米国中南部 |使用可能 |2019 年 6 月 1 日 |
| 東南アジア |使用可能 |2019 年 6 月 1 日 |
| 英国南部 |使用可能 (2019 年) |2019 年 6 月 1 日 |
| 英国西部 |\*|\* |
| 米国中西部 |2019 年 9 月 2 日 |2020 年 1 月 2 日|
| 西ヨーロッパ |使用可能 |2019 年 6 月 1 日 |
| 米国西部 |使用可能 |2019 年 6 月 1 日 |
| 米国西部 2 |使用可能 |2019 年 6 月 1 日 |

## <a name="automatic-upgrade-process"></a>自動アップグレード プロセス

Microsoft では、上記の利用可能表に基づいて、Gen1 インスタンスの自動アップグレードのスケジュールを設定します。 データ ウェアハウスが予期せず使用できなくなるのを回避するために、自動アップグレードは、お客様のメンテナンス スケジュール中にスケジュールされます。 Gen2 への自動アップグレードが実行されるリージョンでは、新しい Gen1 インスタンスを作成する機能が無効になります。 自動アップグレードが完了した後、Gen1 は非推奨となります。 スケジュールの詳細については、「[メンテナンス スケジュールを表示する](viewing-maintenance-schedule.md)」を参照してください。

アップグレード プロセスでは、データ ウェアハウスを再起動する際に接続が短時間 (約 5 分) 切断されます。  データ ウェアハウスは、再起動後に完全に使用できるようになります。 ただし、アップグレード プロセスによりバックグラウンドでデータ ファイルがアップグレードされている間にパフォーマンスの低下が発生する場合があります。 パフォーマンス低下の合計時間は、ご使用のデータ ファイルのサイズによって異なります。

また、再起動後に、より大きい SLO およびリソース クラスを使用して、すべてのプライマリ列ストア テーブルに対して [Alter Index rebuild](sql-data-warehouse-tables-index.md) を実行することで、データ ファイルのアップグレード プロセスを高速化できます。

> [!NOTE]
> Alter Index rebuild はオフライン操作であり、再構築が完了するまでテーブルは使用できなくなります。

## <a name="self-upgrade-to-gen2"></a>Gen2 へのセルフアップグレード

既存の Gen1 データ ウェアハウスで次の手順を実行することにより、セルフアップグレードを選択できます。 セルフアップグレードを選択した場合は、お客様のリージョンで自動アップグレード プロセスが開始される前にセルフアップグレードを完了する必要があります。 そうすることで、自動アップグレードが原因で競合が発生するリスクを回避できます。

セルフアップグレードを実行する場合、2 つのオプションがあります。  現在のデータ ウェアハウスをインプレース アップグレードすることも、Gen1 データ ウェアハウスを Gen2 インスタンスに復元することもできます。

- [インプレース アップグレード](upgrade-to-latest-generation.md) - このオプションでは、既存の Gen1 データ ウェアハウスが Gen2 にアップグレードされます。 アップグレード プロセスでは、データ ウェアハウスを再起動する際に接続が短時間 (約 5 分) 切断されます。  データ ウェアハウスは、再起動後に完全に使用できるようになります。 アップグレード中に問題が発生した場合は、[サポート リクエスト](https://docs.microsoft.com/azure/sql-data-warehouse/sql-data-warehouse-get-started-create-support-ticket)を作成し、考えられる原因として "Gen2 アップグレード" と記載してください。
- [復元ポイントからのアップグレード](sql-data-warehouse-restore.md) - 現在の Gen1 データ ウェアハウスに対してユーザー定義の復元ポイントを作成し、その後、Gen2 インスタンスに直接復元します。 既存の Gen1 データ ウェアハウスはそのまま残ります。 復元が完了すると、Gen2 データ ウェアハウスは完全に使用できるようになります。  復元された Gen2 インスタンスに対してテストおよび検証プロセスをすべて実行した後、元の Gen1 インスタンスは削除してかまいません。

   - 手順 1:Azure portal から、[ユーザー定義の復元ポイントを作成](sql-data-warehouse-restore.md#create-a-user-defined-restore-point-using-the-azure-portal)します。
   - 手順 2:ユーザー定義の復元ポイントから復元する場合、"パフォーマンス レベル" は優先する Gen2 レベルに設定します。

アップグレード プロセスがバックグラウンドでデータ ファイルをアップグレードしている間にパフォーマンスの低下の期間が発生する場合があります。 パフォーマンス低下の合計時間は、ご使用のデータ ファイルのサイズによって異なります。

データ移行のバックグラウンド プロセスの時間を短縮するために、大規模な SLO とリソース クラスにあるクエリ対象のすべてのプライマリ列ストア テーブルに対して [Alter Index rebuild](sql-data-warehouse-tables-index.md) を実行して、データ移動を即時に強制実行できます。

> [!NOTE]
> Alter Index rebuild はオフライン操作であり、再構築が完了するまでテーブルは使用できなくなります。

データ ウェアハウスで問題が発生した場合は、[サポート リクエスト](sql-data-warehouse-get-started-create-support-ticket.md)を作成し、考えられる原因を "Gen2 アップグレード" としてください。

詳細については、[Gen2 へのアップグレード](upgrade-to-latest-generation.md)に関するページを参照してください。

## <a name="migration-frequently-asked-questions"></a>移行についてよく寄せられる質問

**Q:Gen2 のコストは Gen1 と同じですか?**

- A:はい。

**Q:アップグレードは自動スクリプトにどのように影響しますか?**

- A:サービス レベル目標を参照する自動スクリプトは、Gen2 の同等のものに対応するように変更する必要があります。  詳細については、[こちら](upgrade-to-latest-generation.md#sign-in-to-the-azure-portal)を参照してください。

**Q:通常、セルフアップグレードはどのくらいの時間がかかりますか?**

- A:インプレース アップグレードを行うことも、復元ポイントからアップグレードを行うこともできます。  
   - インプレース アップグレードでは、データ ウェアハウスが一時的に停止し、再開されます。  データ ウェアハウスがオンラインの間、バックグラウンド プロセスが続行されます。  
   - 復元ポイントを介してアップグレードする場合、アップグレードが完全な復元プロセスを経るため、より長い時間がかかります。

**Q:自動アップグレードはどのくらいの時間がかかりますか?**

- A:アップグレードの実際のダウンタイムは、サービスの一時停止と再開にかかる時間のみで、5 分から 10 分です。 短時間のダウンタイムの後、バックグラウンド プロセスによってストレージの移行が行われます。 バックグラウンド プロセスの時間の長さは、ご使用のデータ ウェアハウスのサイズによって異なります。

**Q:この自動アップグレードはいつ実行されますか?**

- A:メンテナンス スケジュール中です。 選択したメンテナンス スケジュールを活用することで、ビジネスの中断を最小限に抑えることができます。

**Q:バックグラウンドのアップグレード プロセスが停止していると思われる場合はどうすればよいでしょうか?**

 - A:列ストア テーブルのインデックスの再作成を開始してください。 この操作中、テーブルのインデックスの再作成はオフラインとなるので注意してください。

**Q:Gen2 に、Gen1 で使用していたサービス レベル目標がない場合はどのようにしますか?**
- A:Gen1 で DW600 または DW1200 を実行している場合、それぞれ DW500c または DW1000c を使用することをお勧めします。これは、Gen2 が、Gen1 よりも多くのメモリ、リソース、およびより高いパフォーマンスを提供するためです。

**Q:geo バックアップは無効にできますか?**
- A:いいえ。 geo バックアップは、リージョンが使用不可になった場合にデータ ウェアハウスの可用性を維持するためのエンタープライズ機能です。 さらに懸案事項がある場合は、[サポート リクエスト](sql-data-warehouse-get-started-create-support-ticket.md)をオープンしてください。

**Q:Gen1 と Gen2 の間に T-SQL 構文の違いはありますか?**

- A:Gen1 と Gen2 の T-SQL 言語構文に変更はありません。

**Q:Gen2 はメンテナンス期間をサポートしていますか?**

- A:はい。

**Q:私のリージョンがアップグレードされた後に新しい Gen1 インスタンスを作成できますか?**

- A:いいえ。 リージョンがアップグレードされると、Gen1 の新しいインスタンスの作成は無効になります。

## <a name="next-steps"></a>次の手順

- [アップグレードの手順](upgrade-to-latest-generation.md)
- [メンテナンス期間](maintenance-scheduling.md)
- [リソース正常性の監視](https://docs.microsoft.com/azure/service-health/resource-health-overview)
- [移行開始前の確認](upgrade-to-latest-generation.md#before-you-begin)
- [インプレース アップグレードと復元ポイントからのアップグレード](upgrade-to-latest-generation.md)
- [ユーザー定義の復元ポイントの作成](sql-data-warehouse-restore.md#restore-through-the-azure-portal)
- [Gen2 に復元する方法](sql-data-warehouse-restore.md#restore-an-active-or-paused-database-using-the-azure-portal)
- [SQL Data Warehouse サポート リクエストのオープン](https://go.microsoft.com/fwlink/?linkid=857950)
