---
title: Azure Cosmos DB のスループットのプロビジョニング
description: Azure Cosmos DB のコンテナーとデータベースにプロビジョニング済みスループットを設定する方法について説明します。
author: aliuy
ms.service: cosmos-db
ms.topic: conceptual
ms.date: 10/25/2018
ms.author: andrl
ms.openlocfilehash: 24b6beec8ecda993667464be5c74dab50fd93201
ms.sourcegitcommit: ba4570d778187a975645a45920d1d631139ac36e
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/08/2018
ms.locfileid: "51278890"
---
# <a name="provision-throughput-for-cosmos-db-containers-and-databases"></a>Cosmos DB のコンテナーとデータベースのスループットのプロビジョニング

Cosmos データベースは、一連のコンテナーの管理の単位です。 データベースは、スキーマに依存しない一連のコンテナーで構成されます。 Cosmos コンテナーは、スループットとストレージの両方のスケーラビリティの単位です。 コンテナーは、Azure リージョン内の一連のマシン全体で水平方向にパーティション分割され、Cosmos アカウントに関連付けられているすべての Azure リージョンに分散されます。

Azure Cosmos DB により、**Cosmos コンテナー**と **Cosmos データベース**の 2 つの粒度でスループットを構成できます。

# <a name="setting-throughput-on-a-cosmos-container"></a>Cosmos コンテナーのスループットの設定  

Cosmos コンテナーに対してプロビジョニングされたスループットは、そのコンテナー専用に予約されます。 コンテナーは、常にプロビジョニング済みスループットを受け取ります。 コンテナーのプロビジョニング済みスループットは、SLA によって料金が保証されます。 コンテナーのスループットを構成するには、[Cosmos コンテナーのスループットをプロビジョニングする方法](how-to-provision-container-throughput.md)に関するページをご覧ください。

コンテナーへのプロビジョニング済みスループットの設定は、幅広く使用されているオプションです。 任意の量のスループット (RU) をプロビジョニングすることにより、コンテナーのスループットを柔軟にスケールできますが、論理パーティションのスループットを選択して指定することはできません。 論理パーティションで実行されているワークロードによって、特定の論理パーティションに割り当てられたスループットより多く消費されている場合、ユーザーの操作のレートが制限されます。 レートの制限が発生した場合は、コンテナー全体のスループットを増加するか、または操作を再試行できます。 パーティション分割の詳細については、[論理パーティション](partition-data.md)に関するページをご覧ください。

コンテナーのパフォーマンスを確保する必要がある場合は、コンテナー粒度でスループットを構成することをお勧めします。

Cosmos コンテナーにプロビジョニングされたスループットは、コンテナーのすべての論理パーティションに一様に分散されます。 コンテナーの 1 つ以上の論理パーティションがリソース パーティションによってホストされているため、物理パーティションは、コンテナーにのみ属し、コンテナーにプロビジョニングされたスループットをサポートします。 次のイメージは、リソース パーティションによって、コンテナーの 1 つ以上の論理パーティションをホストする方法を示しています。

![リソース パーティション](./media/set-throughput/resource-partition.png)

# <a name="setting-throughput-on-a-cosmos-database"></a>Cosmos データベースのスループットの設定

Cosmos データベースのスループットをプロビジョニングする場合、特定のコンテナーに対してプロビジョニング済みスループットを指定していない限り、スループットはデータベースのすべてのコンテナーで共有されます。 データベースのコンテナー間でスループットを共有することは、マシンのクラスターでデータベースをホストすることに似ています。 データベース内のすべてのコンテナーで、コンピューターで使用可能なリソースが共有されるため、必然的に特定のコンテナーで予想どおりのパフォーマンスが得られません。 データベースのスループットを構成するには、[Cosmos データベースでプロビジョニング済みスループットを構成する方法](how-to-provision-database-throughput.md)に関するページをご覧ください。

Cosmos データベースにスループットを設定することで、常にプロビジョニング済みスループットを受け取ることが保証されます。 データベース内のすべてのコンテナーでプロビジョニング済みスループットが共有されるため、Cosmos DB データベースでは、そのデータベース内の特定のコンテナーに対して、予測可能なスループット保証を行いません。 特定のコンテナーが受け取ることができるスループットの部分は、次に依存します。

* コンテナーの数
* さまざまなコンテナーのパーティション キーの選択
* コンテナーのさまざまな論理パーティション間のワークロードの分散。 

複数のコンテナーでスループットを共有するが、スループットを特定のコンテナー専用にしない場合、データベースのスループットを構成することをお勧めします。 次に、データベース レベルでスループットをプロビジョニングすることが望ましい例を示します。

* データベースのプロビジョニング済みスループットを一連のコンテナーで共有することは、マルチテナント アプリケーションに便利です。 各ユーザーを、個別の Cosmos コンテナーによって表すことができます。

* 一連のコンテナーでデータベースのプロビジョニング済みスループットを共有することは、ホストされている NoSQL データベース (MongoDB、Cassandra など) を、VM のクラスターやオンプレミスの物理サーバーから、Cosmos DB へ移行する場合に便利です。 Cosmos データベースに構成されているプロビジョニング済みスループットは、MongoDB や Cassandra クラスターの計算容量と論理的に同等である (ただしコスト効率や柔軟性が高い) と考えることができます。  

特定の時点で、データベース内のコンテナーに割り当てられているスループットは、そのコンテナーのすべての論理パーティションに分散されます。 データベースにプロビジョニング済みスループットを共有するコンテナーがある場合は、特定のコンテナーや論理パーティションにスループットを選択して適用できません。 論理パーティションのワークロードによって、特定の論理パーティションに割り当てられているスループットより多く消費されている場合、ユーザーの操作のレートが制限されます。 レートの制限が発生した場合は、コンテナー全体のスループットを増加するか、または操作を再試行できます。 パーティション分割の詳細については、[論理パーティション](partition-data.md)に関するページをご覧ください。

1 つのデータベースにプロビジョニングされたスループットを共有している複数の論理パーティションは、1 つのリソース パーティションでホストできます。 コンテナーの 1 つの論理パーティションは、常にリソース パーティション内で範囲指定されますが、データベースのプロビジョニング済みスループットを共有する 'C' コンテナーにわたる 'L' 論理パーティションを 'R' 物理パーティションにマッピングし、ホストできます。 次のイメージに、リソース パーティションで、データベース内のさまざまなコンテナーに属する 1 つ以上の論理パーティションをホストできる方法を示します。

![リソース パーティション](./media/set-throughput/resource-partition2.png)

## <a name="setting-throughput-on-a-cosmos-database-and-a-container"></a>Cosmos データベースとコンテナーへのスループットの設定

2 つのモデルを組み合わせることができ、データベースとコンテナーの両方でスループットをプロビジョニングできます。 次の例に、Cosmos データベースとコンテナーでスループットをプロビジョニングする方法を示します。

* 'K' RU のプロビジョニング済みスループットで、'Z' という名前の Cosmos データベースを作成できます。 
* 次に、データベース内に A、B、C、D、E という名前の 5 つのコンテナーを作成します。
* コンテナー 'B' に 'P' RU のプロビジョニング済みスループットを明示的に構成できます。
* 'K' RU スループットは、A、C、D、E の 4 つのコンテナーで共有されます。A、C、D、E に使用可能なスループットの正確な量はさまざまに異なり、個々のコンテナーのスループットに対する SLA はありません。
* コンテナー 'B' は常に 'P' RU スループットが得られることが保証され、SLA によって保証されています。

## <a name="comparison-of-models"></a>モデルの比較

|**[クォータ]**  |**データベースにプロビジョニングされたスループット**  |**コンテナーにプロビジョニングされたスループット**|
|---------|---------|---------|
|スケーラビリティの単位|コンテナー|コンテナー|
|最小 RU |400 |400|
|コンテナーあたりの最小 RU|100|400|
|1 GB のストレージを使用するために必要な最小の RU|40|40|
|最大 RU|無制限、データベース上|無制限、コンテナー上|
|特定のコンテナーに割り当て済み/使用可能な RU|保証はありません。 特定のコンテナーに割り当てられる RU は、スループットを共有するコンテナーのパーティション キーの選択、ワークロードの分散、コンテナーの数などのプロパティによって異なります。 |コンテナー上に構成されるすべての RU は、そのコンテナー専用に予約されます。|
|コンテナーの最大ストレージ|無制限|無制限|
|コンテナーの論理パーティションあたりの最大スループット|10,000 RU|10,000 RU|
|コンテナーの論理パーティションあたりの最大ストレージ (データ + インデックス)|10 GB|10 GB|

## <a name="next-steps"></a>次の手順

* [論理パーティション](partition-data.md)の詳細を確認する
* [Cosmos コンテナーのスループットをプロビジョニングする方法](how-to-provision-container-throughput.md)について学習する
* [Cosmos データベースのスループットをプロビジョニングする方法](how-to-provision-database-throughput.md)を確認する

