---
title: 接続アーキテクチャ - Azure Database for MySQL
description: Azure Database for MySQL サーバーの接続アーキテクチャについて説明します。
author: mksuni
ms.author: sumuth
ms.service: mysql
ms.topic: conceptual
ms.date: 03/16/2020
ms.openlocfilehash: 2a557bb436b3bc10cf83beb450761465b43f621f
ms.sourcegitcommit: ad677fdb81f1a2a83ce72fa4f8a3a871f712599f
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 12/17/2020
ms.locfileid: "97655358"
---
# <a name="connectivity-architecture-in-azure-database-for-mysql"></a>Azure Database for MySQL の接続アーキテクチャ
この記事では、Azure Database for MySQL 接続アーキテクチャと、Azure 内外の両方のクライアントからトラフィックがどのように Azure Database for MySQL インスタンスに転送されるかについて説明します。

## <a name="connectivity-architecture"></a>接続のアーキテクチャ
Azure Database for MySQL への接続は、受信接続をクラスター内のサーバーの物理的な場所にルーティングする役割を果たすゲートウェイ経由で確立されます。 次の図に、そのトラフィック フローを示します。

:::image type="content" source="./media/concepts-connectivity-architecture/connectivity-architecture-overview-proxy.png" alt-text="接続アーキテクチャの概要":::

クライアントがデータベースに接続すると、サーバーへの接続文字列がゲートウェイ IP アドレスに解決されます。 ゲートウェイは、ポート 3306 で、この IP アドレスでリッスンします。 データベース クラスター内では、トラフィックは適切な Azure Database for MySQL に転送されます。 そのため、企業ネットワークなどからサーバーに接続するには、**クライアント側のファイアウォールを開いて送信トラフィックがゲートウェイに到達できるようにする** 必要があります。 リージョンごとに Microsoft のゲートウェイで使用されている IP アドレスの完全な一覧を次に示します。

## <a name="azure-database-for-mysql-gateway-ip-addresses"></a>Azure Database for MySQL ゲートウェイの IP アドレス

ゲートウェイ サービスは、IP アドレスの背後にあるステートレス計算ノードのグループでホストされます。クライアントでは Azure Database for MySQL サーバーに接続しようとするときに、最初にこれにアクセスします。 

進行中のサービス メンテナンスの一環として、セキュリティとパフォーマンスが最も高いエクスペリエンスを提供できるように、Microsoft では、ゲートウェイがホストされているコンピューティング ハードウェアを定期的に更新しています。 ゲートウェイのハードウェアが更新されると、最初に計算ノードの新しいリングが構築されます。 この新しいリングは、新しく作成されたすべての Azure Database for MySQL サーバーのトラフィックを処理し、トラフィックを区別するために、同じリージョン内の以前のゲートウェイ リングとは異なる IP アドレスを持ちます。 新しいリングが完全に機能すると、既存のサーバーに対応している古いゲートウェイ ハードウェアでは使用停止が計画されます。 ゲートウェイ ハードウェアを使用停止にする前に、サーバーを実行し、以前のゲートウェイ リングに接続しているお客様に、使用停止の 3 か月前に電子メールと Azure portal で通知が行われます。 次の場合、ゲートウェイの使用停止により、サーバーへの接続に影響が生じる可能性があります。 

* ゲートウェイの IP アドレスをアプリケーションの接続文字列にハードコーディングしている。 これは **推奨されません**。 アプリケーションの接続文字列で、サーバーの完全修飾ドメイン名 (FQDN) を <servername>mysql.database.azure.com の形式で使用する必要があります。 
* 送信トラフィックが新しいゲートウェイ リングに到着できるようにクライアント側のファイアウォールで新しいゲートウェイ IP アドレスを更新していない。

次の表は、すべてのデータ リージョンの Azure Database for MySQL ゲートウェイのゲートウェイ IP アドレスを一覧にまとめたものです。 各リージョンのゲートウェイ IP アドレスの最新情報は、次の表に保持されています。 次の表で、列は以下を表しています。

* **ゲートウェイ IP アドレス:** この列には、最新世代のハードウェアでホストされているゲートウェイの現在の IP アドレスが一覧表示されます。 新しいサーバーをプロビジョニングする場合は、クライアント側のファイアウォールを開いて、この列に一覧表示されている IP アドレスの送信トラフィックを許可することをお勧めします。
* **ゲートウェイ IP アドレス (使用停止予定):** この列には、現在使用停止が予定されている古い世代のハードウェアでホストされているゲートウェイの IP アドレスが一覧表示されます。 新しいサーバーをプロビジョニングする場合は、これらの IP アドレスは無視してかまいません。 既存のサーバーがある場合は、まだ使用停止が完了していないので、これらの IP アドレスに対するファイアウォールのアウトバウンド規則を引き続き保持してください。 これらの IP アドレスに対するファイアウォール規則を削除すると、接続エラーが発生する可能性があります。 代わりに、使用停止の通知を受信したらすぐに、[ゲートウェイ IP アドレス] 列に一覧表示されている新しい IP アドレスを送信ファイアウォール規則に事前に追加する必要があります。 これにより、サーバーが最新のゲートウェイ ハードウェアに移行されるときに、サーバーへの接続が中断されることはなくなります。
* **ゲートウェイ IP アドレス (使用停止済み):** この列には、使用停止になって、もう使用されなくなったゲートウェイ リングの IP アドレスが一覧表示されます。 これらの IP アドレスは、送信ファイアウォール規則から安全に削除できます。 


| **リージョン名** | **ゲートウェイ IP アドレス** |**ゲートウェイ IP アドレス (使用停止予定)** | **ゲートウェイ IP アドレス (使用停止済み)** |
|:----------------|:-------------------------|:-------------------------------------------|:------------------------------------------|
| オーストラリア中部| 20.36.105.0  | | |
| オーストラリア中部 2     | 20.36.113.0  | | |
| オーストラリア東部 | 13.75.149.87、40.79.161.1     |  | |
| オーストラリア東南部 |191.239.192.109、13.73.109.251   |  | |
| ブラジル南部 |191.233.201.8、191.233.200.16    |  | 104.41.11.5|
| カナダ中部 |40.85.224.249  | | |
| カナダ東部 | 40.86.226.166    | | |
| 米国中部 | 23.99.160.139、13.67.215.62、52.182.136.37、52.182.136.38 | | |
| 中国東部 | 139.219.130.35    | | |
| 中国東部 2 | 40.73.82.1  | | |
| 中国北部 | 139.219.15.17    | | |
| 中国北部 2 | 40.73.50.0     | | |
| 東アジア | 191.234.2.139、52.175.33.150、13.75.33.20、13.75.33.21     | | |
| 米国東部 |40.71.8.203、40.71.83.113 |40.121.158.30|191.238.6.43 |
| 米国東部 2 |40.79.84.180、191.239.224.107、52.177.185.181、40.70.144.38、52.167.105.38  | | |
| フランス中部 | 40.79.137.0、40.79.129.1  | | |
| フランス南部 | 40.79.177.0     | | |
| ドイツ中部 | 51.4.144.100     | | |
| ドイツ北東部 | 51.5.144.179  | | |
| インド中部 | 104.211.96.159     | | |
| インド南部 | 104.211.224.146  | | |
| インド西部 | 104.211.160.80    | | |
| 東日本 | 13.78.61.196、191.237.240.43、40.79.192.23 | | |
| 西日本 | 104.214.148.156、191.238.68.11、40.74.96.6、40.74.96.7    | | |
| 韓国中部 | 52.231.32.42   | | |
| 韓国南部 | 52.231.200.86    | | |
| 米国中北部 | 23.96.178.199、23.98.55.75、52.162.104.35、52.162.104.36    | | |
| 北ヨーロッパ | 52.138.224.6、52.138.224.7  |40.113.93.91 |191.235.193.75 |
| 南アフリカ北部  | 102.133.152.0    | | |
| 南アフリカ西部 | 102.133.24.0   | | |
| 米国中南部 |104.214.16.39、20.45.120.0  |13.66.62.124  |23.98.162.75 |
| 東南アジア | 104.43.15.0、23.100.117.95、40.78.233.2、23.98.80.12     | | |
| アラブ首長国連邦中部 | 20.37.72.64  | | |
| アラブ首長国連邦北部 | 65.52.248.0    | | |
| 英国南部 | 51.140.184.11   | | |
| 英国西部 | 51.141.8.11  | | |
| 米国中西部 | 13.78.145.25     | | |
| 西ヨーロッパ |13.69.105.208、104.40.169.187 |40.68.37.158 | 191.237.232.75|
| 米国西部 |13.86.216.212、13.86.217.212 |104.42.238.205  | 23.99.34.75|
| 米国西部 2 | 13.66.226.202  | | |
||||

## <a name="connection-redirection"></a>接続のリダイレクト

Azure Database for MySQL を使うと、クライアント アプリケーションと MySQL サーバーの間のネットワーク待機時間の短縮に役立つ、**リダイレクト** という追加接続ポリシーがサポートされます。 この機能を使うと、Azure Database for MySQL サーバーに対する最初の TCP セッションが確立された後、MySQL サーバーがホストされているノードのバックエンド アドレスが、サーバーからクライアントに返されます。 その後、後続のパケットはすべて、ゲートウェイをバイパスして、サーバーに直接送信されます。 パケットがサーバーに直接送信されるため、待機時間とスループットのパフォーマンスが改善されます。

この機能は、エンジンのバージョンが 5.6、5.7、8.0 の Azure Database for MySQL サーバーでサポートされています。

リダイレクトのサポートは、Microsoft によって開発され、[PECL](https://pecl.php.net/package/mysqlnd_azure) から入手できる、PHP [mysqlnd_azure](https://github.com/microsoft/mysqlnd_azure) 拡張機能で利用できます。 アプリケーションでリダイレクトを使用する方法について詳しくは、[リダイレクトの構成](./howto-redirection.md)に関する記事をご覧ください。

> [!IMPORTANT]
> PHP [mysqlnd_azure](https://github.com/microsoft/mysqlnd_azure) 拡張機能でのリダイレクトのサポートは、現在プレビュー段階です。

## <a name="next-steps"></a>次のステップ

* [Azure Portal を使用した Azure Database for MySQL ファイアウォール規則の作成と管理](./howto-manage-firewall-using-portal.md)
* [Azure CLI を使用した Azure Database for MySQL ファイアウォール規則の作成と管理](./howto-manage-firewall-using-cli.md)
* [Azure Database for MySQL のリダイレクトを構成する](./howto-redirection.md)
