---
title: 高可用性 - Azure Database for MySQL
description: この記事では、Azure Database for MySQL での高可用性について情報を提供します
author: savjani
ms.author: pariks
ms.service: mysql
ms.topic: conceptual
ms.date: 7/7/2020
ms.openlocfilehash: 74d6981c0465a1960e920313c1f960f0d781692b
ms.sourcegitcommit: 97c48e630ec22edc12a0f8e4e592d1676323d7b0
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 02/18/2021
ms.locfileid: "101092956"
---
# <a name="high-availability-in-azure-database-for-mysql"></a>Azure Database for MySQL での高可用性
Azure Database for MySQL サービスでは、[99.99%](https://azure.microsoft.com/support/legal/sla/mysql) のアップタイムという財務的な裏付けのあるサービス レベル アグリーメント (SLA) で、高レベルの可用性が保証されています。 Azure Database for MySQL では、ユーザーが開始したコンピューティングのスケーリング操作などの計画的なイベント中や、基になるハードウェア、ソフトウェア、ネットワークの障害などの計画外のイベントが発生したときに高可用性が提供されます。 Azure Database for MySQL は、ほとんどの重大な状況から迅速に復旧でき、このサービスを使用するとアプリケーションのダウンタイムが事実上なくなります。

Azure Database for MySQL は、高いアップタイムを必要とするミッション クリティカルなデータベースの実行に適しています。 このサービスは、Azure アーキテクチャに基づいて構築されているので、計画的な停止や計画外の停止によるデータベースのダウンタイムを軽減するための高可用性、冗長性、回復性の各機能が最初から備わっており、追加のコンポーネントを構成する必要がありません。 

## <a name="components-in-azure-database-for-mysql"></a>Azure Database for MySQL のコンポーネント

| **コンポーネント** | **説明**|
| ------------ | ----------- |
| <b>MySQL データベース サーバー | Azure Database for MySQL には、データベース サーバーに対して、セキュリティ、分離、リソース保護、および迅速な再起動機能が用意されています。 これらの機能により、スケーリングなどの操作が容易になり、データベースのトランザクション アクティビティに応じて、障害の発生後 60 ～ 120 秒でデータベース サーバーの復旧操作を行えます。 <br/> データベース サーバーでのデータ変更は、通常、データベース トランザクションのコンテキストで行われます。 データベースのすべての変更は、データベース サーバーに接続されている Azure Storage に、先書きログ (ib_log) の形式で同期的に記録されます。 データベース [チェックポイント](https://dev.mysql.com/doc/refman/5.7/en/innodb-checkpoints.html) 処理中に、データベース サーバー メモリのデータ ページもストレージにフラッシュされます。 |
| <b>リモート ストレージ | すべての MySQL 物理データ ファイルとログ ファイルはて、データの冗長性、可用性、信頼性を確保するためにリージョン内にデータの 3 つのコピーを格納するように設計されている Azure Storage に格納されます。 また、このストレージ レイヤーはデータベース サーバーから独立しています。 60 秒以内に、障害が発生したデータベース サーバーからデタッチして、新しいデータベース サーバーに再アタッチすることができます。 また、Azure Storage は、ストレージの障害を継続的に監視します。 ブロックの破損が検出されると、新しいストレージ コピーをインスタンス化することによって自動的に修正されます。 |
| <b>ゲートウェイ | ゲートウェイはデータベース プロキシとして機能し、すべてのクライアント接続をデータベース サーバーにルーティングします。 |

## <a name="planned-downtime-mitigation"></a>計画的なダウンタイムの軽減
Azure Database for MySQL は、計画的なダウンタイム操作中に高可用性をもたらすように設計されています。 

:::image type="content" source="./media/concepts-high-availability/elastic-scaling-mysql-server.png" alt-text="Azure MySQL でのエラスティック スケーリングのビュー":::

次に、計画的なメンテナンス シナリオをいくつか示します。

| **シナリオ** | **説明**|
| ------------ | ----------- |
| <b>コンピューティングのスケールアップ/スケールダウン | ユーザーがコンピューティングのスケールアップ/ダウン操作を実行すると、スケーリングされたコンピューティング構成を使用して新しいデータベース サーバーがプロビジョニングされます。 古いデータベース サーバーでは、アクティブなチェックポイントを完了でき、クライアント接続がドレインされ、コミットされていないトランザクションが取り消され、サーバー自体がシャットダウンされます。 続いてストレージが古いデータベース サーバーからデタッチされ、新しいデータベース サーバーに接続されます。 クライアント アプリケーションが接続を再試行するか、または新しい接続を確立しようとすると、ゲートウェイはその接続要求を新しいデータベース サーバーに転送します。|
| <b>ストレージのスケール アップ | ストレージのスケール アップはオンライン操作であるため、データベース サーバーは中断されません。|
| <b>新しいソフトウェアのデプロイ (Azure) | 新機能のロールアウトやバグ修正プログラムは、サービスの計画的なメンテナンスの一環として自動的に行われます。 詳細については、[ドキュメント](concepts-monitoring.md#planned-maintenance-notification)を参照し、自身の[ポータル](https://aka.ms/servicehealthpm)を確認してください。|
| <b>マイナー バージョンのアップグレード | Azure Database for MySQL では、Azure によって決定されたマイナー バージョンへの修正プログラムが自動的にデータベース サーバーに適用されます。 これは、サービスの計画的なメンテナンスの一環として行われます。 計画メンテナンス中にデータベース サーバーの再起動またはフェールオーバーが発生する可能性があり、これにより、エンドユーザーがデータベース サーバーを短時間利用できなくなる場合があります。 Azure Database for MySQL サーバーはコンテナー内で実行されているため、データベース サーバーの再起動は、通常は迅速に行われ、60 秒から 120 秒で完了することが想定されています。 各サーバーの再起動を含む計画メンテナンス イベント全体が、エンジニアリング チームによって注意深く監視されます。 サーバーのフェールオーバー時間はデータベースの復旧時間に依存します。このため、フェールオーバー時にサーバーで処理されているトランザクションの量が多い場合は、データベースがオンラインになるまで時間がかかる可能性があります。 再起動時間が長くなるのを避けるために、計画メンテナンス イベント中は実行時間の長いトランザクション (一括読み込み) を行わないようにすることをお勧めします。 詳細については、[ドキュメント](concepts-monitoring.md#planned-maintenance-notification)を参照し、自身の[ポータル](https://aka.ms/servicehealthpm)を確認してください。|


##  <a name="unplanned-downtime-mitigation"></a>計画外のダウンタイムの軽減

計画外のダウンタイムは、基になるハードウェアの障害、ネットワークの問題、ソフトウェアのバグなど、予期しない障害の結果として発生する可能性があります。 データベース サーバーが予期せず停止した場合は、新しいデータベース サーバーが 60 ～ 120 秒で自動的にプロビジョニングされます。 リモート ストレージは、新しいデータベース サーバーに自動的に接続されます。 MySQL エンジンによって、WAL およびデータベース ファイルを使用して復旧操作が実行され、データベース サーバーが開かれてクライアントからの接続が可能になります。 コミットされていないトランザクションは失われ、アプリケーションが再試行する必要があります。 計画外のダウンタイムは回避できませんが、Azure Database for MySQL では、データベース サーバーとストレージ レイヤーの両方で、ユーザーの介入を必要とすることなく自動的に復旧操作を実行することでダウンタイムが軽減されます。 


:::image type="content" source="./media/concepts-high-availability/availability-for-mysql-server.png" alt-text="Azure MySQL での高可用性のビュー":::

### <a name="unplanned-downtime-failure-scenarios-and-service-recovery"></a>計画外のダウンタイム: 障害シナリオとサービス復旧
いくつかの障害シナリオと、Azure Database for MySQL が自動的に復旧されるしくみを次に示します。

| **シナリオ** | **自動復旧** |
| ---------- | ---------- |
| <B>データベース サーバーの障害 | 基になるハードウェアの障害が原因でデータベース サーバーが停止した場合、アクティブな接続は切断され、処理中のすべてのトランザクションは中止されます。 新しいデータベース サーバーが自動的にデプロイされ、リモート データ ストレージが新しいデータベース サーバーに接続されます。 データベースの復旧が完了すると、クライアントはゲートウェイ経由で新しいデータベース サーバーに接続できるようになります。 <br /> <br /> MySQL データベースを使用するアプリケーションによって、切断された接続や失敗したトランザクションが検出され、再試行するように構築されている必要があります。  アプリケーションが再試行すると、ゲートウェイは、新しく作成されたデータベース サーバーへの接続を透過的にリダイレクトします。 |
| <B>ストレージの障害 | アプリケーションは、ディスク障害や物理ブロックの破損など、ストレージ関連の問題の影響を一切認識しません。 データが 3 つのコピーに格納されるので、データのコピーは存続しているストレージから提供されます。 ブロックの破損は自動的に修正されます。 データのコピーが失われると、データの新しいコピーが自動的に作成されます。 |

次に、復旧にユーザーの操作が必要な障害シナリオをいくつか示します。

| **シナリオ** | **復旧計画** |
| ---------- | ---------- |
| <b>リージョンの障害 | リージョンの障害は、まれにしか発生しないイベントです。 ただし、リージョンの障害から保護する必要がある場合は、ディザスター リカバリー (DR) 用に他のリージョンで 1 つ以上の読み取りレプリカを構成できます。 (詳細については、読み取りレプリカの作成と管理に関する[この記事](howto-read-replicas-portal.md)をご覧ください)。 リージョン レベルの障害が発生した場合は、運用データベースサーバーとして他のリージョンで構成されている読み取りレプリカを手動で昇格できます。 |
| <b> 論理/ユーザー エラー | 誤って破棄されたテーブルや間違って更新されたデータなどのユーザーエラーからの復旧には、エラーが発生する直前の時間までデータを復元および復旧することによる、[特定の時点への復旧](concepts-backup.md) (PITR) の実行が含まれます。<br> <br>  データベース サーバー内のすべてのデータベースではなく、データベースまたは特定のテーブルのサブセットのみを復元する場合は、新しいインスタンスでデータベース サーバーを復元し、[mysqldump](concepts-migrate-dump-restore.md) を使用してテーブルをエクスポートし、[restore](concepts-migrate-dump-restore.md#restore-your-mysql-database-using-command-line-or-mysql-workbench) を使用してそれらのテーブルをデータベースに復元することができます。 |



## <a name="summary"></a>まとめ

Azure Database for MySQL には、データベース サーバー高速再起動機能、冗長ストレージ、ゲートウェイからの効率的なルーティングが用意されています。 データの保護を強化するために、geo レプリケートするようにバックアップを構成したり、他のリージョンに 1 つ以上の読み取りレプリカをデプロイしたりすることもできます。 Azure Database for MySQL には、高可用性機能が内在されているため、最も一般的な障害からデータベースが保護され、財務に裏付けられた業界最高レベルの [99.99% のアップタイム SLA](https://azure.microsoft.com/support/legal/sla/mysql) が保証されます。 このような可用性と信頼性の機能すべてによって、Azure はミッションクリティカルなアプリケーションを実行するための理想的なプラットフォームになることができています。

## <a name="next-steps"></a>次のステップ
- [Azure リージョン](../availability-zones/az-overview.md)について学習する
- [一時的な接続エラーへの対処](concepts-connectivity.md)について学習する
- [読み取りレプリカを使用してデータをレプリケートする](howto-read-replicas-portal.md)方法を学習する
