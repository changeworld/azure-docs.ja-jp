---
title: Azure Database for MySQL フレキシブル サーバーでのバックアップと復元
description: Azure Database for MySQL フレキシブル サーバーでのバックアップと復元の概念について説明します
author: mksuni
ms.author: sumuth
ms.service: mysql
ms.topic: conceptual
ms.date: 09/21/2020
ms.openlocfilehash: 2d69427f9f11a47cedeccb4b1da38b770952f029
ms.sourcegitcommit: f28ebb95ae9aaaff3f87d8388a09b41e0b3445b5
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/29/2021
ms.locfileid: "93240768"
---
# <a name="backup-and-restore-in-azure-database-for-mysql-flexible-server-preview"></a>Azure Database for MySQL フレキシブル サーバー (プレビュー) でのバックアップと復元

> [!IMPORTANT] 
> Azure Database for MySQL - フレキシブル サーバーは現在、パブリック プレビュー段階にあります。

Azure Database for MySQL フレキシブル サーバーを使用すると、サーバーのバックアップが自動的に作成されて、リージョン内のローカル冗長ストレージに安全に格納されます。 バックアップを使用すると、サーバーを特定の時点に復元できます。 不慮の破損または削除からデータを保護するバックアップと復元は、ビジネス継続性戦略の最も重要な部分です。

## <a name="backup-overview"></a>Backup の概要

フレキシブル サーバーを使用すると、データ ファイルのスナップショット バックアップが取得されて、ローカル冗長ストレージに格納されます。 また、サーバーによりトランザクション ログのバックアップも実行され、それもローカル冗長ストレージに格納されます。 これらのバックアップを使用すると、サーバーを、バックアップの構成済みリテンション期間内の任意の時点に復元できます。 バックアップの既定のリテンション期間は 7 日です。 必要に応じて、1 から 35 日の範囲でデータベース バックアップを構成できます。 すべてのバックアップの保存データは、AES 256 ビット暗号化を使用して暗号化されます。

これらのバックアップ ファイルをエクスポートすることはできません。 バックアップは、フレキシブル サーバーでの復元操作にのみ使用できます。 MySQL クライアントから [mysqldump](../concepts-migrate-dump-restore.md#dump-and-restore-using-mysqldump-utility) を使用してデータベースをコピーすることもできます。

## <a name="backup-frequency"></a>バックアップ頻度

フレキシブル サーバーでのバックアップはスナップショット ベースです。 初回の完全スナップショット バックアップは、サーバーの作成直後にスケジュールされます。 最初の完全スナップショット バックアップは、サーバーのベース バックアップとして保持されます。 以降のスナップショット バックアップでは、差分バックアップのみが行われます。

差分スナップショット バックアップは、少なくとも 1 日実行されます。 差分スナップショット バックアップは、固定のスケジュールでは実行されません。 差分スナップショット バックアップは 24 時間ごとに実行されます。ただし、前回の差分バックアップ以降、MySQL のバイナリ ログが 50 GB を超える場合は除きます。 1 日に最大 6 個の差分スナップショットを生成できます。 トランザクション ログ バックアップは 5 分ごとに実行されます。

## <a name="backup-retention"></a>バックアップ保有期間

データベースのバックアップはローカル冗長ストレージ (LRS) に格納されて、リージョン内の 3 つのコピーに格納されます。 バックアップは、サーバーのバックアップ保有期間の設定に基づいて保持されます。 保有期間は 1 から 35 日の範囲で選択でき、既定の保有期間は 7 日です。 Azure portal を使用してバックアップ構成を更新することで、サーバーの作成中またはその後で保有期間を設定することができます。

ポイントインタイム リストアは使用可能なバックアップに基づいているため、その操作を現在からどのくらい遡って実行できるかは、バックアップの保有期間によって管理されます。 バックアップの保有期間は、復元の観点から回復期間として扱うこともできます。 バックアップ保有期間内の特定の時点に復旧するために必要なすべてのバックアップは、バックアップ ストレージに保持されます。 たとえば、バックアップの保有期間が 7 日に設定されている場合、回復期間は過去 7 日間と見なされます。 このシナリオでは、過去 7 日間のサーバーを復元するために必要なすべてのバックアップが保持されます。 バックアップ保有期間が 7 日の場合、データベース スナップショットとトランザクション ログ バックアップは、過去 8 日間 (期間の 1 日前まで) について格納されます。

## <a name="backup-storage-cost"></a>バックアップ ストレージのコスト

フレキシブル サーバーを使用すると、プロビジョニングされているサーバー ストレージの最大 100% までが、バックアップ ストレージとして追加コストなしで提供されます。 バックアップ ストレージを追加で使用した場合は、1 か月ごとに GB 単位で請求されます。 たとえば、サーバーに 250 GB のストレージをプロビジョニングした場合は、250 GB のストレージを追加料金なしでサーバーのバックアップに利用できます。 毎日のバックアップ使用量が 25 GB の場合は、無料バックアップ ストレージを最大 10 日間使用できます。 250 GB を超えてバックアップに使用されているストレージについては、[価格モデル](https://azure.microsoft.com/pricing/details/mysql/)に従って請求されます。

Azure portal で使用可能な Azure Monitor の[使用されたバックアップ ストレージ](../concepts-monitoring.md) メトリックを使用して、サーバーによって使用されるバックアップ ストレージを監視できます。 使用済み **バックアップ ストレージ** メトリックは、サーバーに設定されているバックアップ保有期間に基づいて保持されるすべてのデータベース バックアップとログ バックアップによって使用されたストレージの合計を表します。 サーバーで大量のトランザクション アクティビティが発生すると、データベースの合計サイズに関係なく、バックアップ ストレージの使用量が増加する可能性があります。

バックアップ ストレージ コストを制御する主な方法は、適切なバックアップ保有期間を設定することです。 保有期間は 1 日から 35 日の範囲で選択できます。

> [!IMPORTANT]
> ゾーン冗長高可用性構成で構成されたデータベース サーバーからのバックアップは、スナップショット バックアップでのオーバーヘッドが最小限に抑えられるため、プライマリ データベース サーバーから行われます。

> [!IMPORTANT]
> 現在、geo 冗長バックアップは、フレキシブル サーバーではサポートされていません。

## <a name="point-in-time-restore"></a>ポイントインタイム リストア

Azure Database for MySQL フレキシブル サーバーでは、ポイントインタイム リストアを実行すると、ソース サーバーと同じリージョンに、フレキシブル サーバーのバックアップから新しいサーバーが作成されます。 コンピューティング レベル、仮想コア数、ストレージ サイズ、バックアップ保有期間、バックアップ冗長オプションについては、元のサーバーの構成で作成されます。 また、仮想ネットワークやファイアウォールなどのタグと設定は、ソース サーバーから継承されます。 復元されたサーバーのコンピューティング レベルとストレージ レベル、構成、セキュリティの設定は、復元が完了した後で変更できます。

> [!NOTE]
> 復元操作の後で既定値にリセットされる (そして、プライマリ サーバーからコピーで上書きされない) サーバー パラメーターが 2 つあります
> *   time_zone - この値は、既定値 SYSTEM に設定されます
> *   event_scheduler - 復元されたサーバーでは event_scheduler は OFF に設定されます

ポイントインタイム リストアは複数のシナリオで役に立ちます。 一般的なユース ケースとしては、次のようなものがあります。
-   ユーザーがデータベース内のデータを誤って削除した場合
-   ユーザーが重要なテーブルまたはデータベースを削除する
-   ユーザー アプリケーションの欠陥のため、正しいデータが不適切なデータで誤って上書きされる。

[Azure portal](how-to-restore-server-portal.md) を使用して、最新の復元ポイントとカスタム復元ポイントのどちらかを選択できます。

-   **最新の復元ポイント**: 最新の復元ポイントは、ソース サーバーで実行された最後のバックアップにサーバーを復元するのに役立ちます。 復元のタイムスタンプもポータルに表示されます。 このオプションは、サーバーを最も更新された状態にすばやく復元するのに役立ちます。
-   **カスタム復元ポイント**: これを使用すると、このフレキシブル サーバーに定義されている保有期間内の特定の時点を選択できます。 このオプションは、ユーザー エラーから復旧するために、サーバーを正確な時点まで復元する場合に便利です。

復旧にかかる推定時間は、データベースのサイズ、トランザクション ログのバックアップ サイズ、SKU のコンピューティング サイズ、復元の時刻など、いくつかの要因によって異なります。 トランザクション ログの復旧は、復元プロセスの中で最も時間がかかる部分です。 完全バックアップまたは差分スナップショット バックアップのスケジュールに近い復元時刻を選択すると、トランザクション ログの適用が最小限になるため、復元の速度が速くなります。 サーバーの復旧時間を正確に見積もるには、環境に固有の変数が多いため、環境内でテストすることを強くお勧めします。

> [!IMPORTANT]
> ゾーン冗長の高可用性を使用して構成されたフレキシブル サーバーを復元する場合、復元されたサーバーは、プライマリ サーバーと同じリージョンおよびゾーン内に構成され、非 HA モードで単一のフレキシブル サーバーとしてデプロイされます。 フレキシブル サーバーに対する[ゾーン冗長高可用性](concepts-high-availability.md)に関するページを参照してください。

> [!IMPORTANT]
> 削除したサーバーは、復元 **できません**。 サーバーを削除すると、そのサーバーに属するデータベースもすべて削除され、復元できなくなります。 管理者は、デプロイ後の誤削除や予期せぬ変更からサーバーのリソースを保護するために、[管理ロック](../../azure-resource-manager/management/lock-resources.md)を利用できます。

## <a name="perform-post-restore-tasks"></a>復元後のタスクの実行

**最新の復元ポイント** または **カスタム復元ポイント** のいずれかの復旧メカニズムで復元した後、ユーザーとアプリケーションを元に戻して実行するには、次のタスクを実行する必要があります。

-   元のサーバーを新しいサーバーで置き換える場合は、クライアントとクライアント アプリケーションを新しいサーバーにリダイレクトします。
-   ユーザーが接続できるように、サーバー レベルの適切なファイアウォール規則と仮想ネットワーク規則が適用されていることを確認します。
-   適切なログインとデータベース レベルのアクセス許可が指定されていることを確認します。
-   必要に応じて、アラートを構成する。

## <a name="next-steps"></a>次のステップ

-   [ビジネス継続性](./concepts-business-continuity.md)について確認する
-   [ゾーン冗長による高可用性](./concepts-high-availability.md)について確認する
-   [バックアップと復旧](./concepts-backup-restore.md)について確認する
