---
title: Azure IoT Central で新しい IoT デバイスの種類を定義する | Microsoft Docs
description: このチュートリアルでは、ビルダーとして、Azure IoT Central アプリケーションで新しい Azure IoT デバイス テンプレートを作成する方法を示します。 種類に対して、テレメトリ、状態、プロパティ、コマンドを定義します。
author: rangv
ms.author: rangv
ms.date: 10/22/2019
ms.topic: tutorial
ms.service: iot-central
services: iot-central
ms.custom: mvc
manager: peterpr
ms.openlocfilehash: 177caaa5400c10ed8de80b04a3305dce7cae77d6
ms.sourcegitcommit: dd0304e3a17ab36e02cf9148d5fe22deaac18118
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/22/2019
ms.locfileid: "74407018"
---
# <a name="tutorial-define-a-new-iot-device-type-in-your-azure-iot-central-application-preview-features"></a>チュートリアル:Azure IoT Central アプリケーションで新しい IoT デバイスの種類を定義する (プレビュー機能)

[!INCLUDE [iot-central-pnp-original](../../../includes/iot-central-pnp-original-note.md)]

デバイス テンプレートは、Azure IoT Central アプリケーションに接続するデバイスの種類の、特性と動作を定義するブループリントです。

たとえばビルダーでは、次の機能を持つ、接続されたファン用のデバイス テンプレートを作成できます。

- 温度テレメトリを送信する
- 場所プロパティを送信する
- ファン モーター エラー イベントを送信する
- ファンの動作状態を送信する
- 書き込み可能なファン速度プロパティを提供する
- デバイスを再起動するコマンドを提供する
- ダッシュボードを介してデバイスの全体的なビューを提供する

オペレーターはこのデバイス テンプレートから、実際のファン デバイスを作成して接続できます。 これらのすべてのファンには、オペレーターがそれらを監視および管理するために使用する測定値、プロパティ、およびコマンドがあります。 オペレーターは、デバイスのダッシュボードとフォームを使用して、ファン デバイスと対話します。

> [!NOTE]
> デバイス テンプレートの作成、編集、および削除が可能なのは、ビルダーと管理者のみです。 すべてのユーザーは、 **[Device]\(デバイス\)** ページで既存のデバイス テンプレートからデバイスを作成できます。

[IoT プラグ アンド プレイ](../../iot-pnp/overview-iot-plug-and-play.md)を使用すれば、埋め込みデバイス コードを記述せずに、IoT Central でデバイスを統合できます。 IoT プラグ アンド プレイの中核となるのは、デバイスの機能を記述するデバイス機能モデル スキーマです。 IoT Central プレビュー アプリケーション内のデバイス テンプレートでは、これらの IoT プラグ アンド プレイ デバイス機能モデルが使用されます。

ビルダーは、デバイス テンプレートを作成する場合、次に示すいくつかのオプションを利用できます。

- IoT Central でデバイス テンプレートを設計してから、そのデバイス機能モデルをデバイス コードに実装します。
- [Azure Certified for IoT デバイス カタログ](https://aka.ms/iotdevcat)からデバイス機能モデルをインポートします。 その後、IoT Central アプリケーションが必要とするクラウド プロパティ、カスタマイズ、およびダッシュボードを追加します。
- Visual Studio Code を使用してデバイス機能モデルを作成します。 ご利用のデバイス コードをモデルから実装します。 ご利用の IoT Central アプリケーションにデバイス機能モデルを手動でインポートしてから、IoT Central アプリケーションに必要なクラウド プロパティ、カスタマイズ、およびダッシュボードを追加します。
- Visual Studio Code を使用してデバイス機能モデルを作成します。 モデルからデバイス コードを実装し、デバイス優先接続を使用して実際のデバイスを IoT Central アプリケーションに接続します。 IoT Central は、パブリック リポジトリからデバイス機能モデルを検索してインポートします。 その後、IoT Central アプリケーションが必要とするクラウド プロパティ、カスタマイズ、およびダッシュボードをデバイス テンプレートに追加できます。

## <a name="prerequisites"></a>前提条件

このチュートリアルを完了するには、[Azure IoT Central アプリケーションを作成する](quick-deploy-iot-central.md)必要があります。

## <a name="create-a-device-template-from-the-device-catalog"></a>デバイス カタログからデバイス テンプレートを作成する

ビルダーは、IoT プラグ アンド プレイ認定デバイスを使用してソリューションの構築をすぐに開始できます。 [Azure IoT デバイス カタログ](https://catalog.azureiotsolutions.com/alldevices)で一覧を参照してください。 IoT Central はデバイス カタログと統合されているため、これらのどの IoT プラグ アンド プレイ認定デバイスからでもデバイス機能モデルをインポートすることができます。 IoT Central でこれらのデバイスのいずれかからデバイス テンプレートを作成するには、次の手順を実行します。

1. IoT Central アプリケーションの **[Device Templates]\(デバイス テンプレート\)** ページに移動します。
1. **[+ New]\(+ 新規\)** を選択し、カタログから任意の IoT プラグ アンド プレイ認定デバイスを選択します。 IoT Central は、このデバイス機能モデルに基づいてデバイス テンプレートを作成します。
1. クラウド プロパティ、カスタマイズ、またはビューをデバイス テンプレートに追加します。
1. **[Publish]\(発行\)** を選択して、オペレーターがテンプレートを使用してデバイスを表示および接続できるようにします。

## <a name="create-a-device-template-from-scratch"></a>デバイス テンプレートを最初から作成する

デバイス テンプレートには次のものが含まれています。

- デバイスが実装するテレメトリ、プロパティ、およびコマンドを指定する_デバイス機能モデル_。 これらの機能は、1 つ以上のインターフェイスに編成されています。
- IoT Central アプリケーションがデバイスについて格納する情報を定義する_クラウド プロパティ_。 たとえば、クラウド プロパティでは、デバイスが最後に点検されたデータを記録できます。 この情報は、デバイスと共有されることはありません。
- _カスタマイズ_を使用すると、ビルダーはデバイス機能モデルの定義の一部をオーバーライドできます。 たとえば、ビルダーはデバイス プロパティの名前をオーバーライドできます。 プロパティ名は IoT Central のダッシュボードとフォームに表示されます。
- _ダッシュボードとフォーム_を使用すると、ビルダーは、アプリケーションに接続されているデバイスをオペレーターが監視および管理できるようにする UI を作成できます。

IoT Central でデバイス テンプレートを作成するには、次の手順を実行します。

1. IoT Central アプリケーションの **[Device Templates]\(デバイス テンプレート\)** ページに移動します。
1. **[+ New]\(+ 新規\)**  >  **[Custom]\(カスタム\)** の順に選択します。
1. 「**Environmental Sensor**」など、テンプレートの名前を入力します。
1. **Enter** キーを押します。 IoT Central により、空のデバイス テンプレートが作成されます。

## <a name="manage-a-device-template"></a>デバイス テンプレートを管理する

テンプレートのホーム ページから、テンプレートの名前変更や削除を行えます。

デバイス機能モデルをテンプレートに追加したら、発行できます。 テンプレートを発行するまでは、このテンプレートに基づいてデバイスを接続し、オペレーターがそれを **[Devices]\(デバイス\)** ページで表示することはできません。

## <a name="create-a-capability-model"></a>機能モデルを作成する

次の操作により、デバイス機能モデルを作成できます。

- IoT Central を使用して、最初からカスタム モデルを作成する。
- JSON ファイルからモデルをインポートする。 デバイス ビルダーが Visual Studio Code を使用して、アプリケーションのデバイス機能モデルを作成している場合があります。
- デバイス カタログからいずれかのデバイスを選択する。 このオプションでは、製造元がこのデバイスのために発行したデバイス機能モデルをインポートします。 このようにインポートされたデバイス機能モデルは、自動的に発行されます。

## <a name="manage-a-capability-model"></a>機能モデルを管理する

デバイス機能モデルを作成したら、次の操作を実行できます。

- モデルにインターフェイスを追加する。 モデルには、少なくとも 1 つのインターフェイスが必要です。
- モデルのメタデータ (ID、名前空間、名前など) を編集する。
- モデルを削除する。

## <a name="create-an-interface"></a>インターフェイスを作成する

デバイス機能には、少なくとも 1 つのインターフェイスが必要です。 インターフェイスは、再利用可能な機能のコレクションです。

インターフェイスを作成するには、次の手順を実行します。

1. デバイス機能モデルにアクセスし、 **[+ Add Interface]\(+ インターフェイスの追加\)** を選択します。

1. **[Select an Interface]\(インターフェイスの選択\)** ページで、次を実行できます。

    - カスタム インターフェイスを最初から作成する。
    - ファイルから既存のインターフェイスをインポートする。 デバイス ビルダーが Visual Studio Code を使用して、デバイスのインターフェイスを作成している場合があります。
    - **[Device Information]\(デバイス情報\)** インターフェイスなど、いずれかの標準インターフェイスを選択します。 標準インターフェイスでは、多くのデバイスに共通する機能が指定されます。 これらの標準インターフェイスは Azure IoT によって発行され、バージョン管理や編集はできません。

1. インターフェイスを作成したら、 **[Edit Identity]\(ID の編集\)** を選択して、インターフェイスの表示名を変更します。

1. カスタム インターフェイスを最初から作成することを選択した場合は、デバイスの機能を追加できます。 デバイスの機能は、テレメトリ、プロパティ、およびコマンドです。

### <a name="telemetry"></a>テレメトリ

テレメトリは、デバイスから (通常はセンサーから) 送信される値のストリームです。 たとえば、センサーから気温が報告される場合があります。

テレメトリ機能の構成設定を次の表に示します。

| フィールド | 説明 |
| ----- | ----------- |
| 表示名 | ダッシュボードとフォームで使用されるテレメトリ値の表示名。 |
| 名前 | テレメトリ メッセージ内のフィールドの名前。 IoT Central によって表示名からこのフィールドの値が生成されますが、必要に応じて独自の値を選択できます。 |
| 機能の種類 | テレメトリ。 |
| セマンティックの種類 | テレメトリのセマンティックの種類 (温度、状態、イベントなど)。 セマンティックの種類の選択によって、次のどのフィールドを使用できるかが決まります。 |
| スキーマ | テレメトリのデータ型 (double、string、vector など)。 使用できる選択肢は、セマンティックの種類によって決まります。 スキーマは、イベントおよび状態のセマンティックの種類には使用できません。 |
| 重大度 | イベントのセマンティックの種類にのみ使用できます。 重大度は、**エラー**、**情報**、または**警告**です。 |
| 状態の値 | 状態のセマンティックの種類にのみ使用できます。 考えられる状態の値を定義します。それぞれに表示名、名前、列挙型、および値があります。 |
| 単位 | テレメトリ値の単位 (**mph**、 **%** 、または **&deg;C** など)。 |
| 表示単位 | ダッシュボードとフォームで使用する表示単位。 |
| Comment (コメント) | テレメトリ機能に関するコメント。 |
| 説明 | テレメトリ機能の説明。 |

### <a name="properties"></a>properties

プロパティは、特定の時点の値を表します。 たとえば、デバイスはプロパティを使用して、到達しようとしているターゲット温度を報告できます。 IoT Central から、書き込み可能なプロパティを設定できます。

プロパティ機能の構成設定を次の表に示します。

| フィールド | 説明 |
| ----- | ----------- |
| 表示名 | ダッシュボードとフォームで使用されるプロパティ値の表示名。 |
| 名前 | プロパティの名前。 IoT Central によって表示名からこのフィールドの値が生成されますが、必要に応じて独自の値を選択できます。 |
| 機能の種類 | プロパティ。 |
| セマンティックの種類 | テレメトリのセマンティックの種類 (温度、状態、イベントなど)。 セマンティックの種類の選択によって、次のどのフィールドを使用できるかが決まります。 |
| スキーマ | プロパティのデータ型 (double、string、vector など)。 使用できる選択肢は、セマンティックの種類によって決まります。 スキーマは、イベントおよび状態のセマンティックの種類には使用できません。 |
| 書き込み可能 | プロパティが書き込み可能でない場合、デバイスはプロパティ値を IoT Central に報告できます。 プロパティが書き込み可能な場合、デバイスはプロパティ値を IoT Central に報告し、IoT Central がプロパティの更新をデバイスに送信できます。
| 重大度 | イベントのセマンティックの種類にのみ使用できます。 重大度は、**エラー**、**情報**、または**警告**です。 |
| 状態の値 | 状態のセマンティックの種類にのみ使用できます。 考えられる状態の値を定義します。それぞれに表示名、名前、列挙型、および値があります。 |
| 単位 | プロパティ値の単位 (**mph**、 **%** 、または **&deg;C** など)。 |
| 表示単位 | ダッシュボードとフォームで使用する表示単位。 |
| Comment (コメント) | プロパティ機能に関するコメント。 |
| 説明 | プロパティ機能の説明。 |

### <a name="commands"></a>command

IoT Central からデバイス コマンドを呼び出すことができます。 コマンドは、必要に応じて、デバイスにパラメーターを渡し、デバイスから応答を受け取ります。 たとえば、10 秒でデバイスを再起動するコマンドを呼び出すことができます。

コマンド機能の構成設定を次の表に示します。

| フィールド | 説明 |
| ----- | ----------- |
| 表示名 | ダッシュボードとフォームで使用されるコマンドの表示名。 |
| 名前 | コマンドの名前。 IoT Central によって表示名からこのフィールドの値が生成されますが、必要に応じて独自の値を選択できます。 |
| 機能の種類 | コマンド。 |
| command | `SynchronousExecutionType` |
| Comment (コメント) | コマンド機能に関するコメント。 |
| 説明 | コマンド機能の説明。 |
| Request | 有効になっている場合、名前、表示名、スキーマ、単位、および表示単位を含む要求パラメーターの定義。 |
| Response | 有効になっている場合、名前、表示名、スキーマ、単位、および表示単位を含むコマンド応答の定義。 |

## <a name="manage-an-interface"></a>インターフェイスを管理する

インターフェイスを発行していない場合は、インターフェイスによって定義されている機能を編集できます。 インターフェイスを発行した後、変更を行う場合は、デバイス テンプレートの新しいバージョンを作成し、インターフェイスのバージョンを管理する必要があります。 バージョン管理を必要としない変更 (表示名や単位など) は、 **[Customize]\(カスタマイズ\)** セクションで行うことができます。

別の機能モデルで再利用する場合は、インターフェイスを JSON ファイルとしてエクスポートすることもできます。

## <a name="add-cloud-properties"></a>クラウド プロパティを追加する

クラウド プロパティを使用して、デバイスに関する情報を IoT Central に格納します。 クラウド プロパティがデバイスに送信されることはありません。 たとえば、クラウド プロパティを使用して、デバイスをインストールした顧客の名前、またはデバイスの前回の点検日を格納できます。

クラウド プロパティの構成設定を次の表に示します。

| フィールド | 説明 |
| ----- | ----------- |
| 表示名 | ダッシュボードとフォームで使用されるクラウド プロパティ値の表示名。 |
| 名前 | クラウド プロパティの名前。 IoT Central によって表示名からこのフィールドの値が生成されますが、必要に応じて独自の値を選択できます。 |
| セマンティックの種類 | テレメトリのセマンティックの種類 (温度、状態、イベントなど)。 セマンティックの種類の選択によって、次のどのフィールドを使用できるかが決まります。 |
| スキーマ | クラウド プロパティのデータ型 (double、string、vector など)。 使用できる選択肢は、セマンティックの種類によって決まります。 |

## <a name="add-customizations"></a>カスタマイズを追加する

インポートしたインターフェイスを変更したり、機能に IoT Central 固有の機能を追加したりする必要がある場合は、カスタマイズを利用します。 カスタマイズできるのは、インターフェイスの互換性を損なうことのないフィールドのみです。 たとえば、次のようなことができます。

- 機能の表示名や単位をカスタマイズする。
- グラフに値が表示されるときに使用する既定の色を追加する。
- プロパティの初期値、最小値、最大値を指定する。

機能名や機能の種類をカスタマイズすることはできません。 **[Customize]\(カスタマイズ\)** セクションで変更できない変更がある場合は、デバイス テンプレートとインターフェイスのバージョンを管理して機能を変更する必要があります。

### <a name="generate-default-views"></a>既定のビューを生成する

既定のビューを生成すると、重要なデバイス情報をすばやく視覚化することができます。 デバイス テンプレートに対して生成される既定のビューは、最大で 3 つです。

- **[Commands]\(コマンド\)** はデバイス コマンドを含むビューを提供し、オペレーターがデバイスにコマンドをディスパッチできるようにします。
- **[Overview]\(概要\)** は、デバイス テレメトリを含むビューを提供し、グラフとメトリックを表示します。
- **[About]\(詳細情報\)** は、デバイス情報を含むビューを提供し、デバイス プロパティを表示します。

**[Generate default views]\(既定のビューの生成\)** を選択した後、デバイス テンプレートの **[Views]\(ビュー\)** セクションにそれらが自動的に追加されているのを確認できます。

## <a name="add-dashboards"></a>ダッシュボードを追加する

ダッシュボードをデバイス テンプレートに追加して、オペレーターがグラフとメトリックを使ってデバイスを視覚化できるようにします。 1 つのデバイス テンプレートに対して複数のダッシュボードを持つことができます。

デバイス テンプレートにダッシュボードを追加するには、次の手順を実行します。

1. デバイス テンプレートにアクセスし、 **[Views]\(ビュー\)** を選択します。
1. **[Visualizing the Device]\(デバイスの視覚化\)** を選択します。
1. **[Dashboard Name]\(ダッシュボード名\)** にダッシュボードの名前を入力します。
1. 静的、プロパティ、クラウド プロパティ、テレメトリ、およびコマンドのタイルの一覧から、ダッシュボードにタイルを追加します。 ダッシュボードに追加するタイルをドラッグ アンド ドロップします。
1. 1 つのグラフ タイルに複数のテレメトリ値をプロットするには、テレメトリ値を選択してから、 **[Combine]\(結合\)** を選択します。
1. 追加する各タイルを構成して、データの表示方法をカスタマイズします。 これを行うには、歯車アイコンを選択するか、グラフ タイルで **[Change configuration]\(構成の変更\)** を選択します。
1. ダッシュボードにタイルを配置し、サイズを変更します。
1. 変更を保存します。

### <a name="configure-preview-device-to-view-dashboard"></a>ダッシュボードを表示するようにプレビュー デバイスを構成する

ダッシュボードを表示してテストするには、 **[Configure preview device]\(プレビュー デバイスの構成\)** を選択します。 これにより、発行後にオペレーターに対して表示されるダッシュボードを確認できます。 このオプションは、ビューに正しいデータが表示されているかどうかを検証するために使用します。 次の中から選択できます。

- プレビュー デバイスなし。
- デバイス テンプレート用に構成した実際のテスト デバイス。
- デバイス ID を使用した、アプリケーション内の既存のデバイス。

## <a name="add-forms"></a>フォームを追加する

デバイス テンプレートにフォームを追加して、オペレーターがプロパティを表示および設定することによってデバイスを管理できるようにします。 オペレーターが編集できるのは、クラウド プロパティと書き込み可能なデバイス プロパティのみです。 1 つのデバイス テンプレートに対して複数のフォームを持つことができます。

デバイス テンプレートにフォームを追加するには、次の手順を実行します。

1. デバイス テンプレートにアクセスし、 **[Views]\(ビュー\)** を選択します。
1. **[Editing Device and Cloud data]\(デバイスとクラウドのデータの編集\)** を選択します。
1. **[Form Name]\(フォーム名\)** にフォームの名前を入力します。
1. フォームのレイアウトに使用する列の数を選択します。
1. フォームの既存のセクションにプロパティを追加するか、プロパティを選択して、 **[Add Section]\(セクションの追加\)** を選択します。 セクションを使用して、フォーム上でプロパティをグループ化します。 セクションにタイトルを追加できます。
1. フォームの各プロパティを構成して、動作をカスタマイズします。
1. フォームでプロパティを調整します。
1. 変更を保存します。

## <a name="publish-a-device-template"></a>デバイス テンプレートを発行する

デバイス機能モデルを実装するデバイスを接続する前に、デバイス テンプレートを発行する必要があります。

デバイス テンプレートを発行した後は、デバイス機能モデルに対して限られた変更のみを行うことができます。 インターフェイスを変更するには、[新しいバージョンを作成して発行する](./howto-version-device-template.md)必要があります。

デバイス テンプレートを発行するには、デバイス テンプレートにアクセスし、 **[Publish]\(発行\)** を選択します。

デバイス テンプレートを発行すると、オペレーターは **[Devices]\(デバイス\)** ページに移動して、デバイス テンプレートを使用する実際のデバイスまたはシミュレートされたデバイスを追加できます。 変更を行っている間は、引き続きデバイス テンプレートを変更して保存できます。 これらの変更をオペレーターにプッシュして、 **[Devices]\(デバイス\)** ページで表示する場合は、毎回、 **[Publish]\(発行\)** を選択する必要があります。

## <a name="define-a-new-iot-gateway-device-type-preview-features"></a>新しい IoT ゲートウェイ デバイスの種類を定義する (プレビュー機能)

[!INCLUDE [iot-central-pnp-original](../../../includes/iot-central-pnp-original-note.md)]

このチュートリアルでは、ビルダーとして、IoT Central アプリケーションでゲートウェイ デバイス テンプレートを使用して IoT デバイスの新しい種類を定義する方法を示します。 

このセクションでは、**スマート ビルディング** デバイス テンプレートを作成します。 スマート ビルディング ゲートウェイ デバイスは、次のことを行います。

* 温度や混雑状況などのテレメトリを送信する。
* クラウドで更新されたときに、テレメトリの送信間隔などの書き込み可能なプロパティに応答する。
* 温度のリセットなどのコマンドに応答する。
* 他のデバイス機能モデルへのリレーションシップを許可する。

### <a name="create-iot-device-templates"></a>IoT デバイス テンプレートを作成する

IoT デバイス テンプレートを作成する方法を次に示します。 

1. 左側のナビゲーションで、 **[Device Templates]\(デバイス テンプレート\)** を選択します。 次に、 **[+ New]\(+ 新規\)** を選択し、**IoT デバイス** タイルと混雑状況センサー タイルを選択します。 **[次へ:カスタマイズ]** を選択します。

   ![デバイス テンプレートのページとオプションのスクリーンショット](./media/tutorial-define-iot-device-type/gateway-downstream-new.png)

1. **[Review]\(レビュー\)** ページで、 **[Create]\(作成\)** を選択します。 

   ![レビュー ページのスクリーンショット](./media/tutorial-define-iot-device-type/gateway-downstream-review.png)

1. 新しいデバイス テンプレートが作成されます。 

   ![新しいデバイス テンプレートのスクリーンショット](./media/tutorial-define-iot-device-type/occupancy-sensor.png)

S1 センサー用のデバイス テンプレートを作成する方法を次に示します。

1. 左側のナビゲーションで、 **[Device Templates]\(デバイス テンプレート\)** を選択します。 次に、 **[+ New]\(+ 新規\)** を選択し、**IoT デバイス** タイルを選択し、混雑状況センサー タイルを選択します。 **[次へ:カスタマイズ]** を選択します。

   ![デバイス テンプレートのページとオプションのスクリーンショット](./media/tutorial-define-iot-device-type/s1-sensor.png)

1. **[Review]\(レビュー\)** ページで、 **[Create]\(作成\)** を選択します。 

   ![レビュー ページのスクリーンショット](./media/tutorial-define-iot-device-type/s1-review.png)

1. 新しいデバイス テンプレートが作成されます。 

   ![新しいデバイス テンプレートのスクリーンショット](./media/tutorial-define-iot-device-type/s1-template.png)

## <a name="create-an-iot-gateway-device-template"></a>IoT ゲートウェイ デバイス テンプレートを作成する

IoT ゲートウェイ デバイス テンプレートを作成することを選択できます。 ゲートウェイ デバイスには、そのゲートウェイ デバイス経由で IoT Central に接続するダウンストリーム デバイスとのリレーションシップがあります。 

### <a name="downstream-device-relationships-with-gateway-device"></a>ダウンストリーム デバイスとゲートウェイ デバイスとのリレーションシップ

IoT デバイスは IoT ゲートウェイ デバイスに接続できます。

![ゲートウェイ デバイスとダウンストリーム デバイスのリレーションシップの図](./media/tutorial-define-iot-device-type/gatewaypattern.png)

ビルダーは、アプリケーションで IoT ゲートウェイ デバイス テンプレートを作成して編集できます。 デバイス テンプレートを公開した後は、デバイス テンプレートを実装する実デバイスを接続できます。

### <a name="select-a-device-template-type"></a>デバイス テンプレートの種類を選択する 

新しいデバイス テンプレートをアプリケーションに追加するには、次のようにします。

1. 左側のペインから、 **[デバイス テンプレート]** タブを選択します。

   ![デバイス テンプレートのページのスクリーンショット](./media/tutorial-define-iot-device-type/devicetemplate.png)

1. **[+ 新規]** を選択して、新しいデバイス テンプレートの作成を開始します。

   ![[新規] が強調表示された [デバイス テンプレート] ページのスクリーンショット](./media/tutorial-define-iot-device-type/devicetemplatenew.png)

   ![[デバイスのカスタマイズ] ページのスクリーンショット](./media/tutorial-define-iot-device-type/gateway-review.png)

1. **[Select template type]\(テンプレートの種類の選択\)** ページで **[Azure IoT]** を選択し、 **[次へ:カスタマイズ]** を選択します。

   ![[Select template type]\(テンプレートの種類の選択\) ページのスクリーンショット](./media/tutorial-define-iot-device-type/gateway-customize.png)

1. [ゲートウェイ] チェック ボックスを選択し、 **[作成]** を選択します。

   ![ゲートウェイが強調表示された [デバイスのカスタマイズ] ページのスクリーンショット](./media/tutorial-define-iot-device-type/gateway-review.png)

1. [Review]\(レビュー\) ページで、 **[Create]\(作成\)** を選択します。 

1. ゲートウェイ テンプレート名として「**Smart Building Gateway Template**」と入力します。 **[Custom]\(カスタム\)** タイルを選択します。

1. 標準インターフェイスの**デバイス情報**を追加します。

### <a name="add-relationships"></a>リレーションシップの追加

ゲートウェイ デバイスに接続するデバイスのデバイス機能モデルへのダウンストリーム リレーションシップを追加できます。

ダウンストリーム デバイス機能モデルへのリレーションシップを作成します。 **[保存]** を選択します。

![さまざまなオプションが強調表示された Smart Building Gateway Template のスクリーンショット](./media/tutorial-define-iot-device-type/gateway-occupancy-s1-rel.png)

### <a name="add-cloud-properties"></a>クラウド プロパティを追加する

デバイス テンプレートにはクラウド プロパティを含めることができます。 クラウド プロパティは IoT Central アプリケーション内のみに存在しており、デバイスとの間で送受信されることはありません。

1. **[クラウド プロパティ]**  >  **[+ クラウド プロパティの追加]** の順に選択します。 下表の情報に従って、デバイス テンプレートにクラウド プロパティを追加します。

    | Display name      | セマンティックの種類 | スキーマ |
    | ----------------- | ------------- | ------ |
    | Last Service Date | なし          | Date   |
    | お客様名     | なし          | string |

2. **[保存]** を選択します。

### <a name="add-customizations"></a>カスタマイズを追加する

インターフェイスを変更する場合や、デバイス機能モデルのバージョン管理が不要な機能に IoT Central 固有の機能を追加する場合は、カスタマイズを利用します。 機能モデルがドラフト状態か公開済み状態であるときに、フィールドをカスタマイズできます。 カスタマイズできるのは、インターフェイスの互換性を損なうことのないフィールドのみです。 たとえば、次のようなことができます。

- 機能の表示名や単位をカスタマイズする。
- グラフに値が表示されるときに使用する既定の色を追加する。
- プロパティの初期値、最小値、最大値を指定する。

機能名や機能の種類をカスタマイズすることはできません。

カスタマイズが完了したら、 **[保存]** をクリックします。

### <a name="create-views"></a>ビューの作成

作成者は、環境センサー デバイスの関連情報がオペレーターに表示されるよう、アプリケーションをカスタマイズできます。 カスタマイズを行うことで、オペレーターがアプリケーションに接続された環境センサー デバイスを管理できるようになります。 オペレーター向けのデバイス操作用のビューを 2 種類作成できます。

* デバイス プロパティとクラウド プロパティを表示および編集するためのフォーム。
* デバイスを視覚化するためのダッシュボード。

### <a name="generate-default-views"></a>既定のビューを生成する

**[Generate default views]\(既定のビューの生成\)** を選択すると、 **[Overview]\(概要\)** と **[About]\(詳細情報\)** のダッシュボードを生成できます。 

## <a name="publish-a-device-template"></a>デバイス テンプレートを発行する

シミュレートされた環境センサーの作成や、実物の環境センサーの接続を行うには、デバイス テンプレートを公開する必要があります。

デバイス テンプレートを公開するには:

1. **[デバイス テンプレート]** ページで、作成したデバイス テンプレートに移動します。

2. **[発行]** を選択します。

3. **[Publish a Device Template]\(デバイス テンプレートの発行\)** ダイアログで、 **[Publish]\(発行\)** を選択します。

デバイス テンプレートを公開すると、 **[デバイス]** ページに表示され、オペレーターが確認できるようになります。 公開済みのデバイス テンプレートで、新しいバージョンを作成せずにデバイス機能モデルを編集することはできません。 ただし、発行されたデバイス テンプレートで、クラウド プロパティ、カスタマイズ、およびビューを更新することができます。 これらの更新によって新しいバージョンが作成されることはありません。 変更完了後に **[公開]** を選択すると、変更内容がオペレーターにプッシュされます。

## <a name="create-a-gateway-simulated-device"></a>ゲートウェイのシミュレートされたデバイスを作成する

デバイス エクスプローラーから、シミュレートされたスマート ビルディング ゲートウェイを作成します。 

![[新しいデバイスの作成] ダイアログ ボックスのスクリーンショット](./media/tutorial-define-iot-device-type/smartbuildingdevice.png)

## <a name="create-downstream-simulated-devices"></a>ダウンストリームのシミュレートされたデバイスを作成する

デバイス エクスプローラーから、シミュレートされた混雑状況センサーを作成します。 

![[新しいデバイスの作成] ダイアログ ボックスのスクリーンショット](./media/tutorial-define-iot-device-type/occupancydevice.png)

デバイス エクスプローラーから、シミュレートされた S1 センサーを作成します。 

![[新しいデバイスの作成] ダイアログ ボックスのスクリーンショット](./media/tutorial-define-iot-device-type/s1device.png)

## <a name="add-downstream-devices-relationships-to-a-gateway-device"></a>ゲートウェイ デバイスへのダウンストリーム デバイス リレーションシップを追加する

S1 センサーと混雑状況センサーを選択し、 **[Connect to gateway]\(ゲートウェイへの接続\)** を選択します。 

![[Connect to gateway]\(ゲートウェイへの接続\) が強調表示された混雑状況センサーのスクリーンショット](./media/tutorial-define-iot-device-type/connecttogateway.png)

ゲートウェイ デバイス テンプレート、ゲートウェイ デバイス インスタンスを選択し、 **[Join]\(結合\)** を選択します。

## <a name="next-steps"></a>次の手順

このチュートリアルでは、以下の内容を学習しました。

* デバイス テンプレートとしての新しい IoT ゲートウェイの作成。
* クラウド プロパティの作成。
* カスタマイズの作成。
* デバイス テレメトリの視覚化の定義。
* リレーションシップの追加。
* デバイス テンプレートの公開。

次に、以下を実行できます。

> [!div class="nextstepaction"]
> [デバイスを接続する](tutorial-connect-pnp-device.md)
