---
title: Azure IoT Central のテンプレートとは | Microsoft Docs
description: Azure IoT Central のデバイス テンプレートを使用すると、アプリケーションに接続されているデバイスの動作を指定できます。
author: dominicbetts
ms.author: dobett
ms.date: 05/21/2020
ms.topic: conceptual
ms.service: iot-central
services: iot-central
ms.custom: device-developer
ms.openlocfilehash: cdc85029ec004060abf69b111d8a0ebca42147a4
ms.sourcegitcommit: 43558caf1f3917f0c535ae0bf7ce7fe4723391f9
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 09/11/2020
ms.locfileid: "90015094"
---
# <a name="what-are-device-templates"></a>デバイス テンプレートとは

"_この記事は、デバイス開発者およびソリューション ビルダーを対象としています。_ "

Azure IoT Central のデバイス テンプレートは、アプリケーションに接続する種類のデバイスの特性と動作を定義するブループリントです。 たとえば、デバイス テンプレートによって、IoT Central が、適切なユニットとデータの種類を使用して視覚化を作成できるように、デバイスが送信するテレメトリが定義されます。

ソリューション ビルダーは、デバイス テンプレートを IoT Central アプリケーションに追加します。 デバイス開発者は、デバイス テンプレートで定義された動作を実装するデバイス コードを作成します。

デバイス テンプレートは、次のセクションで構成されます。

- "_デバイス機能モデル (DCM)_ "。 デバイス テンプレートのこの部分では、デバイスがアプリケーションと対話する方法を定義します。 デバイス開発者は、DCM で定義された動作を実装します。
- "_クラウド プロパティ_"。 デバイス テンプレートのこの部分では、ソリューション開発者が、格納するデバイス メタデータを指定します。 クラウド プロパティがデバイスと同期されることはなく、アプリケーション内にのみ存在します。 クラウド プロパティは、DCM を実装するためにデバイス開発者が作成するコードには影響しません。
- "_カスタマイズ_"。 デバイス テンプレートのこの部分では、ソリューション開発者が、DCM 内の一部の定義をオーバーライドします。 カスタマイズは、ソリューション開発者が、アプリケーションにより値が処理される方法を設定し直す必要がある場合に役立ちます。たとえば、プロパティの表示名の変更、テレメトリ値を表示するために使用する色の変更などがあります。 カスタマイズは、DCM を実装するためにデバイス開発者が作成するコードには影響しません。
- "_ビュー_"。 デバイス テンプレートのこの部分では、ソリューション開発者が、デバイスからのデータを表示する視覚化と、デバイスの管理や制御を行うフォームを定義します。 ビューでは、DCM、クラウド プロパティ、カスタマイズが使用されます。 ビューは、DCM を実装するためにデバイス開発者が作成するコードには影響しません。

> [!NOTE]
> [IoT プラグ アンド プレイのパブリック プレビュー更新リリース](../../iot-pnp/overview-iot-plug-and-play.md) は、GA の開始前に IoT プラグ アンド プレイの認定を受けることができるデバイスの構築を開始するデバイス開発者と OEM を対象としています。

## <a name="device-capability-models"></a>デバイス機能モデル

DCM では、デバイスが IoT Central アプリケーションと対話する方法を定義します。 デバイス開発者は、IoT Central でデバイスを監視および管理できるように、DCM で定義された動作がデバイスに実装されていることを確認する必要があります。 DCM は、1 つ以上の "_インターフェイス_" で構成され、各インターフェイスでは、"_テレメトリ_" の種類、"_デバイス プロパティ_"、"_コマンド_" を定義できます。 ソリューション開発者は、DCM を定義する JSON ファイルをデバイス テンプレートにインポートするか、IoT Central の Web UI を使用して DCM を作成または編集することができます。 Web UI を使用して作成された DCM を変更するには、[デバイス テンプレートのバージョン管理する](./howto-version-device-template.md)必要があります。

ソリューション開発者は、DCM を含む JSON ファイルをエクスポートすることもできます。 デバイス開発者は、この JSON ドキュメントを使用して、デバイスが IoT Central アプリケーションと通信する方法を理解することができます。

DCM を定義する JSON ファイルでは、[デジタル ツイン定義言語 (DTDL) V1](https://github.com/Azure/IoTPlugandPlay/tree/master/DTDL)を使用します。 IoT Central では、JSON ファイルに、個別のファイルではなく、インラインで定義されたインターフェイスがある DCM が含まれていると想定しています。

一般的な IoT デバイスは次のように構成されています。

- カスタム パーツ。デバイスを一意にするパーツです。
- 標準パーツ。すべてのデバイスに共通するパーツです。

DCM では、これらのパーツは "_インターフェイス_" と呼ばれます。 インターフェイスは、デバイスが実装する各パーツの詳細を定義します。 インターフェイスは、DCM 間で再利用できます。

次の例は、2 つのインターフェイスを使用する環境センサー デバイスのデバイス機能モデルの概要を示しています。

```json
{
  "@id": "urn:contoso:sensor_device:1",
  "@type": "CapabilityModel",
  "displayName": "Environment Sensor Capability Model",
  "implements": [
    {
      "@type": "InterfaceInstance",
      "name": "deviceinfo",
      "schema": {
        "@id": "urn:azureiot:DeviceManagement:DeviceInformation:1",
        "@type": "Interface",
        "displayName": "Device Information",
        "@context": "http://azureiot.com/v1/contexts/IoTModel.json",
        "contents": [
          ...
        ]
      }
    },
    {
      "@type": "InterfaceInstance",
      "name": "sensor",
      "schema": {
        "@id": "urn:contoso:EnvironmentalSensor:1",
        "@type": "Interface",
        "displayName": "Environmental Sensor",
        "@context": "http://azureiot.com/v1/contexts/IoTModel.json",
        "contents": [
          ...
        ]
      }
    }
  ],
  "@context": "http://azureiot.com/v1/contexts/IoTModel.json"
}
```

機能モデルには、いくつかの必須フィールドがあります。

- `@id`: 単純な Uniform Resource Name 形式の一意の ID。
- `@type`: このオブジェクトが機能モデルであることを宣言します。
- `@context`: 機能モデルに使用される DTDL バージョンを指定します。
- `implements`: デバイスが実装するインターフェイスが一覧表示されます。

implements セクションのインターフェイス一覧の各エントリには、次のフィールドがあります。

- `name`: インターフェイスのプログラミング名。
- `schema`: 機能モデルが実装するインターフェイス。

インターフェイスには、いくつかの必須フィールドがあります。

- `@id`: 単純な Uniform Resource Name 形式の一意の ID。
- `@type`: このオブジェクトがインターフェイスであることを宣言します。
- `@context`: インターフェイスに使用される DTDL バージョンを指定します。
- `contents`: デバイスを構成するプロパティ、テレメトリ、およびコマンドが一覧表示されます。

他にも表示名や説明など、機能モデルに詳細を追加するために使用できるオプションのフィールドがいくつかあります。

### <a name="interface"></a>インターフェイス

DTDL を使用すると、デバイスの機能を記述することができます。 関連する機能は、インターフェイスにグループ化されます。 インターフェイスでは、プロパティ、テレメトリ、コマンドをデバイスの実装の一部として記述します。

- `Properties`. プロパティは、デバイスの状態を表すデータ フィールドです。 プロパティは、冷却ポンプのオンオフ状態など、デバイスの持続的な状態を表すために使用します。 また、プロパティはデバイスのファームウェア バージョンなど、デバイスの基本的なプロパティも表すことができます。 プロパティは、読み取り専用または書き込み可能として宣言できます。
- `Telemetry`. テレメトリ フィールドは、センサーの測定値を表します。 デバイスがセンサーの測定値を取得するたびに、センサー データを含むテレメトリ イベントを送信する必要があります。
- `Commands`. コマンドは、デバイスのユーザーがデバイスで実行できるメソッドを表します。 たとえば、リセット コマンドや、ファンのオンとオフを切り替えるコマンドなどです。

次の例は、環境センサー インターフェイスの定義を示しています。

```json
{
  "@type": "Property",
  "displayName": "Device State",
  "description": "The state of the device. Two states online/offline are available.",
  "name": "state",
  "schema": "boolean"
},
{
  "@type": "Property",
  "displayName": "Customer Name",
  "description": "The name of the customer currently operating the device.",
  "name": "name",
  "schema": "string",
  "writable": true
},
{
  "@type": [
    "Telemetry",
    "SemanticType/Temperature"
  ],
  "description": "Current temperature on the device",
  "displayName": "Temperature",
  "name": "temp",
  "schema": "double",
  "unit": "Units/Temperature/fahrenheit"
},
{
  "@type": "Command",
  "name": "turnon",
  "comment": "This Commands will turn-on the LED light on the device.",
  "commandType": "synchronous"
},
{
  "@type": "Command",
  "name": "turnoff",
  "comment": "This Commands will turn-off the LED light on the device.",
  "commandType": "synchronous"
}
```

この例は、2 つのプロパティ、テレメトリの種類、2 つのコマンドを示します。 最小限記述するフィールドは、次の通りです。

- 機能の種類 (`Telemetry`、`Property`、または`Command`) を指定する `@type`。  種類に、IoT Central で値の処理方法を想定できるセマンティックの種類が含まれる場合があります。
- テレメトリ値の `name`。
- テレメトリまたはプロパティのデータ型を指定する `schema`。 この値は、double、integer、boolean、string などのプリミティブ型にすることができます。 複合オブジェクト型、配列、およびマップもサポートされています。
- コマンドの処理方法を指定する `commandType`。

表示名や説明などのオプション フィールドを使用すると、インターフェイスや機能に詳細を追加できます。

### <a name="properties"></a>Properties

既定では、プロパティは読み取り専用です。 読み取り専用のプロパティは、デバイスがプロパティ値の更新を IoT Central アプリケーションに報告することを意味します。 IoT Central アプリケーションでは、読み取り専用のプロパティの値を設定することはできません。

インターフェイスでは、プロパティを書き込み可能としてマークすることもできます。 デバイスは、IoT Central アプリケーションから書き込み可能なプロパティに対する更新を受信できるだけでなく、アプリケーションに対するプロパティ値の更新を報告することもできます。

プロパティ値を設定するためにデバイスを接続する必要はありません。 更新された値は、デバイスが次にアプリケーションに接続したときに転送されます。 この動作は、読み取り専用プロパティと書き込み可能なプロパティの両方に適用されます。

デバイスからテレメトリを送信するために、プロパティを使用しないでください。 たとえば、`temperatureSetting=80` などの読み取り専用プロパティは、デバイスの温度が 80 度に設定されており、デバイスがこの温度に達しようとしている、またはこの温度を維持しようとしていることを意味します。

書き込み可能なプロパティの場合、デバイス アプリケーションは、必要な状態の状態コード、バージョン、および説明を返して、プロパティ値を受け取って適用したかどうかを示します。

### <a name="telemetry"></a>テレメトリ

IoT Central を使用すると、テレメトリをダッシュボードおよびグラフに表示し、ルールを使用して、しきい値に達したときにアクションをトリガーできます。 IoT Central では、データ型、ユニット、表示名などの DCM 内の情報を使用して、テレメトリ値の表示方法が決定されます。

IoT Central のデータ エクスポート機能を使用して、ストレージや Event Hubs などの他の保存先にテレメトリをストリーミングすることができます。

### <a name="commands"></a>コマンド

コマンドは、同期または非同期のいずれかです。 同期コマンドは、既定で 30 秒以内に実行する必要があり、コマンドが到着したときにデバイスを接続する必要があります。 デバイスが時間内に応答しない場合、またはデバイスが接続されていない場合、コマンドは失敗します。

実行時間の長い操作には、非同期コマンドを使用してください。 デバイスは、テレメトリ メッセージを使用して進行状況情報を送信します。 それらの進行状況情報には次のヘッダー プロパティがあります。

- `iothub-command-name`: コマンド名 (`UpdateFirmware` など)。
- `iothub-command-request-id`: サーバー側で生成され、最初の呼び出しでデバイスに送信される要求 ID。
- `iothub-interface-id`:このコマンドが定義されているインターフェイスの ID (`urn:example:AssetTracker:1` など)。
 `iothub-interface-name`: このインターフェイスのインスタンス名 (`myAssetTracker` など)。
- `iothub-command-statuscode`: デバイスから返された状態コード (`202` など)。

## <a name="cloud-properties"></a>クラウド プロパティ

クラウド プロパティはデバイス テンプレートの一部ですが、DCM の一部ではありません。 クラウド プロパティでは、ソリューション開発者が、IoT Central アプリケーションに格納するデバイス メタデータを指定します。 クラウド プロパティは、DCM を実装するためにデバイス開発者が作成するコードには影響しません。

ソリューション開発者は、デバイス プロパティと共にクラウド プロパティをダッシュボードおよびビューに追加して、オペレーターがアプリケーションに接続されているデバイスを管理できるようにすることができます。 さらに、ソリューション開発者は、クラウド プロパティをルール定義の一部として使用して、オペレーターがしきい値を編集できるようにすることもできます。

## <a name="customizations"></a>カスタマイズ

カスタマイズはデバイス テンプレートの一部ですが、DCM の一部ではありません。 カスタマイズでは、ソリューション開発者が、DCM 内の一部の定義を強化またはオーバーライドします。 たとえば、ソリューション開発者は、テレメトリの種類またはプロパティの表示名を変更できます。 ソリューション開発者は、カスタマイズを使用して、文字列のデバイス プロパティの最小または最大の長さなどの視覚化を追加できます。

カスタマイズは、DCM を実装するためにデバイス開発者が作成するコードに影響する場合があります。 たとえば、カスタマイズでは、文字列の最大および最小の長さや、テレメトリの数値の最大および最小値を設定できます。

## <a name="views"></a>ビュー

ソリューション開発者は、オペレーターが接続されたデバイスを監視および管理できるビューを作成します。 ビューはデバイス テンプレートの一部であるため、特定のデバイスの種類に関連付けられます。 ビューには、次のものを含めることができます。

- テレメトリをプロットするグラフ。
- 読み取り専用デバイスのプロパティを表示するタイル。
- オペレーターが書き込み可能なデバイス プロパティを編集できるようにするタイル。
- オペレーターがクラウド プロパティを編集できるようにするタイル。
- オペレーターが、ペイロードを想定するコマンドなどのコマンドを呼び出すために使用するタイル。
- ラベル、画像、またはマークダウン テキストを表示するタイル。

ビューに追加できるテレメトリ、プロパティ、コマンドは、DCM と、デバイス テンプレート内のクラウド プロパティおよびカスタマイズによって決定されます。

## <a name="next-steps"></a>次のステップ

デバイス開発者としてデバイス テンプレートについて学習したので、推奨される次の手順は、[テレメトリ、プロパティ、およびコマンド ペイロード](./concepts-telemetry-properties-commands.md)を読み取り、デバイスが IoT Central とやり取りするデータの詳細について学ぶことです。

ソリューション開発者として、次のステップでは、「[Azure IoT Central アプリケーションで新しい IoT デバイスの種類を定義する](./howto-set-up-template.md)」を読み、デバイス テンプレートを作成する方法の詳細を把握することをお勧めします。
