---
title: Azure IoT Central アプリのデバイス テンプレートのバージョン管理について | Microsoft Docs
description: 新しいバージョンを作成することで、ライブ接続されたデバイスに影響を与えずにデバイス テンプレートを反復処理します
author: sarahhubbard
ms.author: sahubbar
ms.date: 04/24/2020
ms.topic: how-to
ms.service: iot-central
services: iot-central
manager: peterpr
ms.openlocfilehash: 772521a8d3181721270d7fe4dbd11b7807c8d90e
ms.sourcegitcommit: b9d4b8ace55818fcb8e3aa58d193c03c7f6aa4f1
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/29/2020
ms.locfileid: "82583657"
---
# <a name="create-a-new-device-template-version"></a>デバイス テンプレートの新しいバージョンを作成する

"*この記事は、ソリューション ビルダーおよびデバイス開発者を対象としています。* "

デバイス テンプレートには、デバイスが IoT Central とどのようにやり取りするかを記述するスキーマが含まれています。 これらのやり取りには、テレメトリ、プロパティ、コマンドが含まれます。 デバイスと IoT Central アプリケーションは両方とも、このスキーマの解釈を共有することよって情報を交換します。 コントラクトを破棄しなければ、スキーマに対して限定的な変更しかできません。そのため、ほとんどのスキーマ変更には新しいバージョンのデバイス テンプレートが必要になります。 デバイス テンプレートのバージョン管理により、古いデバイスは、理解しているスキーマのバージョンを引き続き使用できるようになります。一方、新しいデバイスや更新されたデバイスでは、より新しいバージョンのスキーマが使用できます。

デバイス テンプレートのスキーマは、デバイス機能モデル (DCM) とそのインターフェイスで定義されています。 デバイス テンプレートには、クラウドのプロパティ、表示のカスタマイズ、ビューなどの他の情報が含まれています。 デバイスが IoT Central とデータを交換する方法が定義されていないデバイス テンプレートの部分を変更した場合は、テンプレートのバージョンを作成する必要はありません。

オペレーターが使用できるようにするには、バージョンの更新が必要かどうかにかかわらず、デバイス テンプレートの変更を公開する必要があります。 IoT Central は、テンプレートのバージョン管理を行わずに、デバイス テンプレートに重大な変更を公開できないようにします。

> [!NOTE]
> デバイス テンプレートを作成する方法について詳しくは、[デバイス テンプレートの設定と管理](howto-set-up-template.md)に関する記事をご覧ください

## <a name="versioning-rules"></a>バージョン管理ルール

このセクションでは、デバイス テンプレートに適用されるバージョン管理ルールの概要を示します。 DCM とインターフェイスの両方にバージョン番号があります。 次のスニペットは、環境センサー デバイスの DCM を示しています。 DCM には、次の 2 つのインターフェイスがあります。**DeviceInformation** と **EnvironmentalSensor** です。 `@id` フィールドの末尾にバージョン番号が表示されます。 IoT Central UI でこの情報を表示するには、デバイス テンプレート エディターで **[ID の表示]** を選択します。

```json
{
  "@id": "urn:contoso:sample_device:1",
  "@type": "CapabilityModel",
  "implements": [
    {
      "@id": "urn:contoso:sample_device:deviceinfo:1",
      "@type": "InterfaceInstance",
      "name": "deviceinfo",
      "schema": {
        "@id": "urn:azureiot:DeviceManagement:DeviceInformation:1",
        "@type": "Interface",
        "displayName": {
          "en": "Device Information"
        },
        "contents": [...
        ]
      }
    },
    {
      "@id": "urn:contoso:sample_device:sensor:1",
      "@type": "InterfaceInstance",
      "name": "sensor",
      "schema": {
        "@id": "urn:contoso:EnvironmentalSensor:2",
        "@type": "Interface",
        "displayName": {
          "en": "Environmental Sensor"
        },
        "contents": [...
        ]
      }
    }
  ],
  "displayName": {
    "en": "Environment Sensor Capability Model"
  },
  "@context": [
    "http://azureiot.com/v1/contexts/IoTModel.json"
  ]
}
```

* DCM が公開された後は、新しいバージョンのデバイス テンプレートであっても、インターフェイスを削除することはできません。
* DCM が公開された後は、新しいバージョンのデバイス テンプレートを作成すればインターフェイスを追加できます。
* DCM が公開された後、新しいバージョンのデバイス テンプレートを作成すればインターフェイスを新しいバージョンに置き換えることができます。 たとえば、sensor v1 のデバイス テンプレートで、EnvironmentalSensor v1 インターフェイスが使用されている場合は、EnvironmentalSensor v2 インターフェイスを使用する sensor v2 デバイス テンプレートを作成できます。
* DCM が公開された後は、新しいバージョンのデバイス テンプレートであっても、インターフェイスのコンテンツを削除することはできません。
* インターフェイスを公開した後、インターフェイスとデバイス テンプレートの新しいバージョンを作成すると、インターフェイスのコンテンツに項目を追加できます。 インターフェイスに追加できる項目には、テレメトリ、プロパティ、コマンドなどがあります。
* インターフェイスを公開した後、インターフェイスとデバイス テンプレートの新しいバージョンを作成すると、インターフェイスの既存コンテンツに非スキーマの変更を加えられます。 インターフェイス項目の非スキーマ部分には、表示名とセマンティック型が含まれます。 変更できないインターフェイス項目のスキーマ部分には、名前、機能の種類、およびスキーマがあります。

以下のセクションでは、IoT Central でデバイス テンプレートを変更する例をいくつか紹介します。

## <a name="customize-the-device-template-without-versioning"></a>バージョン更新を行わずにデバイス テンプレートをカスタマイズする

デバイス機能の一部の要素については、デバイス テンプレートやインターフェイスのバージョンを更新することなく編集できます。 こうしたフィールドの例としては、表示名、セマンティックの種類、最小値、最大値、小数点以下桁数、色、単位、表示単位、コメント、説明などがあります。 これらのカスタマイズのいずれかを追加するには、次の手順に従います。

1. **[デバイス テンプレート]** ページに移動します。
1. カスタマイズするデバイス テンプレートを選択します。
1. **[カスタマイズ]** タブを選択します。
1. ここには、デバイス機能モデルで定義されているすべての機能の一覧が表示されています。 デバイス テンプレートのバージョンを更新することなく、これらのフィールドのすべてを編集、保存、および使用することができます。 読み取り専用のフィールドを編集する場合は、変更にあたって新しいバージョンのデバイス テンプレートを作成する必要があります。 編集するフィールドを選択して、新しい値を入力します。
1. **[保存]** をクリックします。 デバイス テンプレートにもともと保存されていた値が、これらの値でオーバーライドされます。以後は、新しい値がアプリケーション全体で使用されるようになります。

## <a name="version-a-device-template"></a>デバイス テンプレートのバージョンを更新する

デバイス テンプレートの新しいバージョンを作成すると、テンプレートのドラフト バージョンが作成されます。このバージョンで、デバイス機能モデルを編集できます。 公開済みのインターフェイスは、個別に新バージョンが作成されるまで公開済みのままになります。 公開されたインターフェイスを変更するには、まず新しいデバイス テンプレートのバージョンを作成する必要があります。

デバイス テンプレートのバージョン更新は、デバイス機能モデルの要素のうち、[カスタマイズ] セクションでは編集不可能なものを編集する場合にのみ、行うようにしてください。

デバイス テンプレートのバージョンを更新するには次を行います。

1. **[デバイス テンプレート]** ページに移動します。
1. バージョンを更新するデバイス テンプレートを選択します。
1. ページ上部にある **[バージョン]** ボタンをクリックして、テンプレートに新しい名前を付けます。 IoT Central が新しい名前を提案します。この名前は編集できます。
1. **Create** をクリックしてください。
1. これで、デバイス テンプレートがドラフト モードになります。 インターフェイスがまだロックされていることを確認できます。 変更するインターフェイスをバージョン更新します。

## <a name="version-an-interface"></a>インターフェイスのバージョンを更新する

インターフェイスのバージョンを更新すると、作成済みのインターフェイス内にある機能を追加、更新、削除できます。

インターフェイスのバージョンを更新するには次を行います。

1. **[デバイス テンプレート]** ページに移動します。
1. ドラフト モードになっているデバイス テンプレートを選択します。
1. バージョンを更新して編集する、公開済みモードのインターフェイスを選択します。
1. インターフェイス ページの上部にある **[バージョン]** ボタンをクリックします。
1. **Create** をクリックしてください。
1. これで、インターフェイスがドラフト モードになります。 既存のカスタマイズやビューを損なうことなく、インターフェイスの機能を追加および編集できます。

## <a name="migrate-a-device-across-versions"></a>デバイスを複数のバージョンに移行する

複数のバージョンのデバイス テンプレートを作成できます。 時間の経過と共に、接続された複数のデバイスがこれらのデバイス テンプレートを使用するようになります。 デバイス テンプレートの 1 つのバージョンから、別のバージョンに、デバイスを移行できます。 次の手順では、デバイスを移行する方法について説明します。

1. **デバイス エクスプローラー** ページに移動します。
1. 別のバージョンに移行する必要があるデバイスを選択します。
1. **[移行]** を選択します。
1. デバイスの移行先のバージョン番号が設定されているデバイス テンプレートを選択して、 **[移行]** を選択します。

![デバイスを移行する方法](media/howto-version-device-template/pick-version.png)

## <a name="next-steps"></a>次のステップ

オペレーターまたはソリューション ビルダーの場合は、次の手順として、[デバイスを管理する方法](./howto-manage-devices.md)を学習することをお勧めします。

デバイス開発者にお勧めする次の手順は、[Azure IoT Edge デバイスと Azure IoT Central](./concepts-iot-edge.md) に関する記事を読むことです。
