---
title: Azure IoT Central で新しい種類のゲートウェイ デバイスを定義する | Microsoft Docs
description: このチュートリアルでは、ビルダーとして Azure IoT Central アプリケーションで新しい種類の IoT ゲートウェイ デバイスを定義する方法について説明します。
author: rangv
ms.author: rangv
ms.date: 10/22/2019
ms.topic: tutorial
ms.service: iot-central
services: iot-central
ms.custom: mvc
manager: peterpr
ms.openlocfilehash: 04f9a067e0b7df1f90d181d42bc4dd562aca56b0
ms.sourcegitcommit: 21e33a0f3fda25c91e7670666c601ae3d422fb9c
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 02/05/2020
ms.locfileid: "77026335"
---
# <a name="define-a-new-iot-gateway-device-type-in-your-azure-iot-central-application"></a>Azure IoT Central アプリケーションで新しい種類の IoT ゲートウェイ デバイスを定義する

このチュートリアルでは、ビルダーとして IoT Central アプリケーションでゲートウェイ デバイス テンプレートを使用してゲートウェイ デバイスを定義する方法について説明します。 次に、ゲートウェイ デバイスを介して IoT Central アプリケーションに接続するいくつかのダウンストリーム デバイスを構成します。 

このチュートリアルでは、**スマート ビルディング** ゲートウェイ デバイス テンプレートを作成します。 **スマート ビルディング** ゲートウェイデバイスは、他のダウンストリーム デバイスとリレーションシップがあります。

![ゲートウェイ デバイスとダウンストリーム デバイスのリレーションシップの図](./media/tutorial-define-gateway-device-type/gatewaypattern.png)

ゲートウェイ デバイスは、ダウンストリーム デバイスが IoT Central アプリケーションと通信できるようにするだけでなく、次のことも実行できます。

* 自身のテレメトリ (温度など) を送信する。
* オペレーターによって行われた書き込み可能なプロパティの更新に応答する (たとえば、オペレーターはテレメトリの送信間隔を変更できます)。
* コマンド (デバイスの再起動など) に応答する。

## <a name="prerequisites"></a>前提条件

このチュートリアルを完了するには、[Azure IoT Central アプリケーションを作成する](./quick-deploy-iot-central.md)必要があります。

## <a name="create-downstream-device-templates"></a>ダウンストリーム デバイス テンプレートを作成する

このチュートリアルでは、シミュレートされたダウンストリーム デバイスを生成するために、**S1 センサー** デバイスおよび **RS40 混雑状況センサー** デバイス用のデバイス テンプレートを使用します。

**S1 センサー** デバイスのデバイス テンプレートを作成するには、次の手順を実行します。

1. 左側のナビゲーションで、 **[Device Templates]\(デバイス テンプレート\)** を選択します。 次に、 **+** を選択して、テンプレートの追加を開始します。

1. **S1 センサー** デバイスのタイルが表示されるまで、下にスクロールします。 タイルを選択し、 **[次のステップ: カスタマイズ]** を選択します。

1. **[Review]\(確認\)** ページで **[作成]** を選択して、アプリケーションにデバイス テンプレートを追加します。 

***RS40 混雑状況センサー** デバイスのデバイス テンプレートを作成するには、次の手順を実行します。

1. 左側のナビゲーションで、 **[Device Templates]\(デバイス テンプレート\)** を選択します。 次に、 **+** を選択して、テンプレートの追加を開始します。

1. **RS40 混雑状況センサー** デバイスのタイルが表示されるまで、下にスクロールします。 タイルを選択し、 **[次のステップ: カスタマイズ]** を選択します。

1. **[Review]\(確認\)** ページで **[作成]** を選択して、アプリケーションにデバイス テンプレートを追加します。 

これで、次のように 2 種類のダウンストリーム デバイスのデバイス テンプレートが作成されました。

![ダウンストリーム デバイスのデバイス テンプレート](./media/tutorial-define-gateway-device-type/downstream-device-types.png)


## <a name="create-a-gateway-device-template"></a>ゲートウェイ デバイス テンプレートを作成する

このチュートリアルでは、ゲートウェイ デバイスのデバイス テンプレートもゼロから作成します。 このテンプレートは、シミュレートされたゲートウェイ デバイスをアプリケーション内に作成するために後で使用します。

新しいゲートウェイ デバイス テンプレートをアプリケーションに追加するには、次の手順を実行します。

1. 左側のナビゲーションで、 **[Device Templates]\(デバイス テンプレート\)** を選択します。 次に、 **+** を選択して、テンプレートの追加を開始します。

1. **[テンプレートの種類の選択]** ページで **[IoT デバイス]** タイルを選択し、 **[次へ: カスタマイズ]** を選択します。

1. **[デバイスのカスタマイズ]** ページで、 **[ゲートウェイ デバイス]** チェック ボックスをオンにします。

1. **[Review]\(レビュー\)** ページで、 **[Create]\(作成\)** を選択します。 

1. テンプレート名として「**スマート ビルディング ゲートウェイ デバイス**」と入力します。

1. **[機能モデルの作成]** ページで、 **[カスタム]** タイルを選択します。

1. **+** を選択して、インターフェイスを追加します。  **[デバイス情報]** 標準インターフェイスを選択します。

### <a name="add-relationships"></a>リレーションシップの追加

次に、ダウンストリーム デバイス テンプレートにリレーションシップを追加します。

1. **[スマート ビルディング ゲートウェイ デバイス]** テンプレートで、 **[リレーションシップ]** を選択します。

1. **[+ リレーションシップの追加]** を選択します。 表示名として「**環境センサー**」と入力し、ターゲットとして **[S1 センサー]** を選択します。

1. 再度、 **[+ リレーションシップの追加]** を選択します。 表示名として「**混雑状況センサー**」と入力し、ターゲットとして **[RS40 混雑状況センサー]** を選択します。

1. **[保存]** を選択します。

![リレーションシップが表示されている [スマート ビルディング ゲートウェイ デバイス] テンプレート](./media/tutorial-define-gateway-device-type/relationships.png)

### <a name="add-cloud-properties"></a>クラウド プロパティを追加する

ゲートウェイ デバイス テンプレートにはクラウド プロパティを含めることができます。 クラウド プロパティは IoT Central アプリケーション内のみに存在しており、デバイスとの間で送受信されることはありません。

クラウド プロパティを**スマート ビルディング ゲートウェイ デバイス** テンプレートに追加するには、次の手順を実行します。

1. **[スマート ビルディング ゲートウェイ デバイス]** テンプレートで、 **[クラウドのプロパティ]** を選択します。

1.  下表の情報に従って、ゲートウェイ デバイス テンプレートに 2 つのクラウド プロパティを追加します。

    | Display name      | セマンティックの種類 | スキーマ |
    | ----------------- | ------------- | ------ |
    | Last Service Date | なし          | Date   |
    | Customer Name     | なし          | String |

2. **[保存]** を選択します。

### <a name="create-views"></a>ビューの作成

作成者は、環境センサー デバイスの関連情報がオペレーターに表示されるよう、アプリケーションをカスタマイズできます。 カスタマイズを行うことで、オペレーターがアプリケーションに接続された環境センサー デバイスを管理できるようになります。 オペレーター向けのデバイス操作用のビューを 2 種類作成できます。

* デバイス プロパティとクラウド プロパティを表示および編集するためのフォーム。
* デバイスを視覚化するためのダッシュボード。

**スマート ビルディング ゲートウェイ デバイス** テンプレートの既定のビューを生成するには、次の手順を実行します。

1. **[スマート ビルディング ゲートウェイ デバイス]** テンプレートで、 **[ビュー]** を選択します。

1. **[既定のビューの生成]** タイルを選択し、すべてのオプションが選択されていることを確認します。

1. **[Generate default dashboard view]\(既定のダッシュボード ビューの生成\)** を選択します。

## <a name="publish-the-device-template"></a>デバイス テンプレートを公開する

シミュレートされたゲートウェイ デバイスを作成したり、実物のゲートウェイ デバイスを接続したりする前に、デバイス テンプレートを発行する必要があります。

ゲートウェイ デバイス テンプレートを発行するには、次の手順を実行します。

1. **[デバイス テンプレート]** ページで **[スマート ビルディング ゲートウェイ デバイス]** テンプレートを選択します。

2. **[発行]** を選択します。

3. **[Publish a Device Template]\(デバイス テンプレートの発行\)** ダイアログで、 **[発行]** を選択します。

デバイス テンプレートを公開すると、 **[デバイス]** ページに表示され、オペレーターが確認できるようになります。 公開済みのデバイス テンプレートで、新しいバージョンを作成せずにデバイス機能モデルを編集することはできません。 ただし、発行されたデバイス テンプレートで、クラウド プロパティ、カスタマイズ、およびビューを更新できます。 これらの更新によって新しいバージョンが作成されることはありません。 変更完了後に **[公開]** を選択すると、変更内容がオペレーターにプッシュされます。

## <a name="create-the-simulated-devices"></a>シミュレートされたデバイスを作成する

このチュートリアルでは、シミュレートされたダウンストリーム デバイスとシミュレートされたゲートウェイ デバイスを使用します。

シミュレートされたゲートウェイ デバイスを作成するには、次の手順を実行します。

1. **[デバイス]** ページのデバイス テンプレートの一覧で、 **[スマート ビルディング ゲートウェイ デバイス]** を選択します。

1. **+** を選択して、新しいデバイスの追加を開始します。

1. 生成された**デバイス ID** と**デバイス名**を保持します。 **[シミュレート済み]** スイッチが **[オン]** になっていることを確認します。 **作成** を選択します。

シミュレートされたダウンストリーム デバイスを作成するには、次の手順を実行します。

1. **[デバイス]** ページのデバイス テンプレートの一覧で、 **[RS40 混雑状況センサー]** を選択します。

1. **+** を選択して、新しいデバイスの追加を開始します。

1. 生成された**デバイス ID** と**デバイス名**を保持します。 **[シミュレート済み]** スイッチが **[オン]** になっていることを確認します。 **作成** を選択します。

1. **[デバイス]** ページのデバイス テンプレートの一覧で、 **[S1 センサー]** を選択します。

1. **+** を選択して、新しいデバイスの追加を開始します。

1. 生成された**デバイス ID** と**デバイス名**を保持します。 **[シミュレート済み]** スイッチが **[オン]** になっていることを確認します。 **作成** を選択します。

![アプリケーションのシミュレートされたデバイス](./media/tutorial-define-gateway-device-type/simulated-devices.png)

### <a name="add-downstream-device-relationships-to-a-gateway-device"></a>ダウンストリーム デバイスのリレーションシップをゲートウェイ デバイスに追加する

シミュレートされたデバイスをアプリケーションに作成したので、ダウンストリーム デバイスとゲートウェイ デバイスの間にリレーションシップを作成できます。

1. **[デバイス]** ページのデバイス テンプレートの一覧で **[S1 センサー]** を選択し、シミュレートされた **[S1 センサー]** デバイスを選択します。

1. **[Connect to gateway]\(ゲートウェイへの接続\)** を選択します。

1. **[ゲートウェイへの接続]** ダイアログで、 **[スマート ビルディング ゲートウェイ デバイス]** テンプレートを選択してから、前に作成したシミュレートされたインスタンスを選択します。

1. **[参加]** を選択します。

1. **[デバイス]** ページのデバイス テンプレートの一覧で **[RS40 混雑状況センサー]** を選択してから、シミュレートされた **[RS40 混雑状況センサー]** デバイスを選択します。

1. **[Connect to gateway]\(ゲートウェイへの接続\)** を選択します。

1. **[ゲートウェイへの接続]** ダイアログで、 **[スマート ビルディング ゲートウェイ デバイス]** テンプレートを選択してから、前に作成したシミュレートされたインスタンスを選択します。

1. **[参加]** を選択します。

これで、両方のシミュレートされたダウンストリーム デバイスが、シミュレートされたゲートウェイ デバイスに接続されました。 ゲートウェイ デバイスの **[Downstream Devices]\(ダウンストリーム デバイス\)** ビューに移動すると、関連するダウンストリーム デバイスを確認できます。

![ダウンストリーム デバイス ビュー](./media/tutorial-define-gateway-device-type/downstream-device-view.png)

ゲートウェイ デバイス テンプレート、ゲートウェイ デバイス インスタンスを選択し、 **[Join]\(結合\)** を選択します。

## <a name="next-steps"></a>次のステップ

このチュートリアルでは、以下の内容を学習しました。

* デバイス テンプレートとしての新しい IoT ゲートウェイの作成。
* クラウド プロパティの作成。
* カスタマイズの作成。
* デバイス テレメトリの視覚化の定義。
* リレーションシップの追加。
* デバイス テンプレートの公開。

次に、以下を実行できます。

> [!div class="nextstepaction"]
> [デバイスを接続する](tutorial-connect-pnp-device.md)
