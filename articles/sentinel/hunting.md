---
title: Azure Sentinel の検出機能 | Microsoft Docs
description: この記事では、Azure Sentinel 検出機能の使用方法について説明します。
services: sentinel
documentationcenter: na
author: yelevin
manager: rkarlin
editor: ''
ms.assetid: 6aa9dd27-6506-49c5-8e97-cc1aebecee87
ms.service: azure-sentinel
ms.subservice: azure-sentinel
ms.devlang: na
ms.topic: conceptual
ms.custom: mvc
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 09/10/2019
ms.author: yelevin
ms.openlocfilehash: 54ddf6818b95a4037188ab222501ddfa69b28149
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/28/2020
ms.locfileid: "77587900"
---
# <a name="hunt-for-threats-with-azure-sentinel"></a>Azure Sentinel で脅威を検出する

セキュリティ上の脅威を事前に探索しようとしている調査担当者である場合、Azure Sentinel の強力な検出用検索およびクエリ ツールは、組織のデータ ソース全体からセキュリティ上の脅威を検出します。 ただし、システムとセキュリティ アプライアンスから山のようなデータが生成されますが、これらを解析したり、意味のあるイベントにフィルター処理したりすることが難しい場合があります。 セキュリティ アプリで検出されなかった新しい異常をセキュリティ アナリストが事前に探すときに役立つように、Azure Sentinel には検出クエリが組み込まれており、これを通じて、ネットワーク上で既に保有しているデータ内の問題を見つけるために適切な質問を行うことができます。 

たとえば、ある組み込みクエリは、インフラストラクチャ上で実行される最も目立つプロセスに関するデータを提供します。それらが実行されるたびに警告を受ける必要がないことも、それらがまったく無害である可能性もありますが、時々クエリを調べて、異常なことがないか確認できます。 



Azure Sentinel 検出機能では、次の機能を利用できます。

- 組み込みクエリ:まず初めに、開始ページには事前に読み込まれたクエリ例が用意されており、初めて使用するときや、テーブルとクエリ言語に不慣れなときに役立ちます。 これらの組み込み検出クエリは、Microsoft セキュリティ研究員が新しいクエリを追加し、既存のクエリを修正しながら継続的に開発しているもので、新しく発見された驚異を探し、新しい攻撃のきざしの検出を開始する場所を把握するためのエントリ ポイントになっています。 

- IntelliSense での強力なクエリ言語:柔軟性をもたらすクエリ言語に基づいて、検出を次のレベルに進める必要があります。

- 独自のブックマークの作成:検出プロセスでは、一致した結果や、異常または不審に見える所見、ダッシュボード、アクティビティが見つかることがあります。 後からこれらの項目に戻れるようにマークするには、ブックマーク機能を使用します。 ブックマークを使用すれば、後で調査するインシデントを作成するために使用できるように項目を保存できます。 ブックマークの詳細については、[検出でのブックマークの使用](hunting.md)に関するページを参照してください。
- ノートブックを使用した調査の自動化:ノートブックは、調査および検出の手順を進めるために構築できる段階的なプレイブックのようなものです。  ノートブックは、組織の他のユーザーと共有できる再利用可能なプレイブックにすべての検出手順をカプセル化します。 
- 格納されたデータのクエリ:クエリを実行するために、データはテーブルとしてアクセスできます。 たとえば、プロセス作成、DNS イベント、他の多くのイベントの種類に対してクエリを実行できます。

- コミュニティへのリンク:より大きなコミュニティの力を活用して、追加のクエリやデータ ソースを見つけます。
 
## <a name="get-started-hunting"></a>検出を開始する

1. Azure Sentinel ポータルで、 **[Hunting]** (検出) をクリックします。
  ![Azure Sentinel が検出を開始する](media/tutorial-hunting/hunting-start.png)

2. **[Hunting]** (検出) ページを開くと、すべての検出クエリが単一のテーブルに表示されます。 テーブルには、Microsoft のセキュリティ アナリスト チームが作成したすべてのクエリのほか、自身が作成または変更した追加クエリが一覧表示されます。 各クエリには、検出の対象と、クエリを実行するデータの種類に関する説明が示されます。 これらのテンプレートは、さまざまな攻撃方法ごとにグループ化されています。右側のアイコンは、初期アクセス、永続性、窃盗などの脅威の種類を分類します。 いずれかのフィールドを使用してこれらの検出クエリ テンプレートをフィルター処理できます。 任意のクエリをお気に入りに保存できます。 お気に入りにクエリを保存することによって、 **[Hunting]** (検出) ページにアクセスするごとに、クエリは自動的に実行します。 独自の検出クエリまたは複製を作成し、既存の検出クエリ テンプレートをカスタマイズできます。 
 
2. 検出クエリ詳細ページで **[クエリの実行]** をクリックして、検出ページを離れることなく任意のクエリを実行します。  一致件数がテーブル内に表示されます。 検出クエリとその一致結果の一覧を確認します。 一致結果がキル チェーンのどの段階に関連付けられているかを調べます。

3. クエリ詳細ウィンドウの基になるクエリをさっと確認するか、 **[クエリ結果の表示]** をクリックして Log Analytics でクエリを開きます。 下部で、クエリの一致結果を確認します。

4.  行をクリックし、 **[ブックマークの追加]** を選択して、調査対象の行を追加します。疑わしく見えるものすべてに対してこれを行えます。 

5. 続いて、メインの **[Hunting]** (検出) ページに戻り、 **[ブックマーク]** タブをクリックして、疑わしいアクティビティをすべて確認します。 

6. ブックマークを選択し、続いて **[調査]** をクリックして調査エクスペリエンスを開きます。 ブックマークをフィルター処理できます。 たとえば、キャンペーンを調査している場合は、キャンペーンのタグを作成し、キャンペーンに基づくすべてのブックマークをフィルター処理できます。

1. 可能性のある攻撃についてどの検出クエリが重要な分析情報をもたらすかを把握した後、クエリに基づいてカスタム検出ルールを作成し、セキュリティ インシデント レスポンダーへのアラートとしてこれらの分析情報を示すことができます。

 

## <a name="query-language"></a>クエリ言語 

Azure Sentinel の検出機能は Kusto クエリ言語に基づきます。 クエリ言語とサポートされている演算子の詳細については、[クエリ言語リファレンス](https://docs.loganalytics.io/docs/Language-Reference/)に関するページを参照してください。

## <a name="public-hunting-query-github-repository"></a>パブリック検出クエリの GitHub リポジトリ

[検出クエリリポジトリ](https://github.com/Azure/Orion)に関するページを調べてください。 顧客の間で共有されているクエリ例を提供し、使用します。

 

## <a name="sample-query"></a>サンプル クエリ

一般的なクエリではテーブル名を最初に記述し、その後に一連の演算子を \| で区切って続けます。

上記の例では、テーブル名 SecurityEvent を最初に記述し、必要に応じてパイプでつないで要素を追加します。

1. 時間のフィルターを定義して、直近の 7 日間のレコードだけを確認するようにします。

2. イベント ID 4688 のみを表示するようにクエリにフィルターを追加します。

3. cscript.exe のインスタンスのみを含めるように、コマンドラインでクエリにフィルターを追加します。

4. 探索に関心がある列だけを見積もり、結果を 1,000 に制限して、 **[クエリの実行]** をクリックします。
5. 緑の三角形をクリックして、クエリを実行します。 クエリをテストし、クエリを実行して異常な動作を調べられます。

## <a name="useful-operators"></a>便利な演算子

クエリ言語は強力で、使用可能な演算子が多数あり、便利な演算子の一部をここに一覧表示します。

**where** - テーブルにフィルターが適用され、述語を満たす行のサブセットに絞り込まれます。

**summarize** - 入力テーブルの内容を集計したテーブルを生成します。

**join** - 各テーブルの指定の列で値を照合することで、2 つのテーブルの行を結合し、新しいテーブルを形成します。

**count** - 入力レコード セットに含まれるレコード数を返します。

**top** - 指定の列で並べ替えられたレコードが先頭から N 個まで返されます。

**limit** - 最大で指定の行数まで返されます。

**project** - 含める列、名前を変更する列、または削除する列を選択し、新しい計算列を挿入します。

**extend** - 計算列を作成し、それらを結果セットに追加します。

**makeset** - グループ内である式により受け取られる個別値セットを dynamic (JSON) 配列で返します

**find** - テーブルのセットで述語が一致する行を検索します。

## <a name="save-a-query"></a>クエリを保存する

クエリを作成または変更し、独自のクエリとして保存するか、同じテナントに属しているユーザーと共有できます。

   ![クエリを保存する](./media/tutorial-hunting/save-query.png)

新しい検出クエリの作成:

1. **[新しいクエリ]** をクリックし、 **[保存]** を選択します。
2. すべての空フィールドに入力し、 **[保存]** を選択します。

   ![[新しいクエリ]](./media/tutorial-hunting/new-query.png)

既存の検出クエリの複製および変更:

1. 変更するテーブル内の検出クエリを選択します。
2. 変更するクエリの行で省略記号 (...) を選択し、 **[クエリの複製]** を選択します。

   ![クエリの複製](./media/tutorial-hunting/clone-query.png)
 

3. クエリを変更し、 **[作成]** を選択します。

   ![カスタム クエリ](./media/tutorial-hunting/custom-query.png)

## <a name="next-steps"></a>次のステップ
この記事では、Azure Sentinel で検出調査を実行する方法を学習しました。 Azure Sentinel の詳細については、次の記事をご覧ください。


- [ノートブックを使用して自動化された検出キャンペーンを実行する](notebooks.md)
- [ブックマークを使用して検出中に関心のある情報を保存する](bookmarks.md)
