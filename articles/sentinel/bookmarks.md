---
title: Azure Sentinel でのデータの調査にハンティング ブックマークを使用する
description: この記事では、Azure Sentinel 検出ブックマークを使用してデータを追跡する方法について説明します。
author: yelevin
ms.author: yelevin
manager: rkarlin
ms.assetid: 320ccdad-8767-41f3-b083-0bc48f1eeb37
ms.service: azure-sentinel
ms.subservice: azure-sentinel
ms.topic: conceptual
ms.custom: mvc
ms.date: 10/24/2019
ms.openlocfilehash: eacc104bf7157732f91507f631bcda2cd166bfb3
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/28/2020
ms.locfileid: "77588690"
---
# <a name="keep-track-of-data-during-hunting-with-azure-sentinel"></a>Azure Sentinel でハンティング中にデータを追跡する

脅威検出では、通常、山のようなログ データを調べて、悪意のある動作の証拠を探す必要があります。 このプロセス中に調査担当者は、可能性のある仮説の実証と、侵害の詳細の把握の一環として、記憶し、再考し、分析する必要のあるイベントを探します。

この操作では、**Azure Sentinel - Logs** で実行したクエリが、関連すると思われるクエリ結果と共に保持される、Azure Sentinel のハンティング ブックマークが役立ちます。 また、メモやタグを追加することにより、コンテキストに関する所見を記録し、調査結果を参照することもできます。 ブックマークが設定されたデータは、自身とチームメイトが見ることができコラボレーションを簡単に行えるようにしています。

**[ハンティング]** ウィンドウの **[ブックマーク]** タブで、ブックマークが設定されたデータにいつでも再訪できます。 フィルタリングおよび検索オプションを使用して、現在の調査の特定のデータをすばやく見つけられます。 または、ブックマークが設定されたデータを、Log Analytics ワークスペースの **[HuntingBookmark]\(ハンティング ブックマーク\)** テーブルで直接確認できます。 次に例を示します。

> [!div class="mx-imgBorder"]
> ![HuntingBookmark テーブルを表示する](./media/bookmarks/bookmark-table.png)

テーブルでブックマークを表示すると、ブックマークが設定されたデータをフィルター処理、要約、および他のデータ ソースと結合でき、裏付けとなる証拠を簡単に見つけられます。

現在プレビューの段階ですが、ログのハンティング中に緊急に対処する必要があるものが見つかった場合、数回のクリックでブックマークを作成してインシデントにレベルを上げたり、既存のインシデントにブックマークを追加したりできます。 インシデントの詳細については、「チュートリアル: [Azure Sentinel でインシデントを調査する](tutorial-investigate-cases.md)」を参照してください。 

こちらもプレビュー段階ですが、ブックマークの詳細から **[調査]** をクリックすると、ブックマークが設定されたデータを視覚化できます。 これにより、対話型のエンティティ-グラフ ダイアグラムおよびタイムラインを使用して、調査結果を表示、調査、および視覚的に伝達できる調査エクスペリエンスが開始します。

## <a name="add-a-bookmark"></a>ブックマークを追加する

1. Azure portal で、 **[Sentinel]**  >  **[脅威の管理]**  >  **[ハンティング]** の順に移動して、不審な動作や異常な動作についてクエリを実行します。

2. ハンティング クエリの 1 つを選択し、右側のハンティング クエリの詳細で **[クエリの実行]** を選択します。 

3. **[View query results]\(クエリ結果の表示\)** を選択します。 次に例を示します。
    
    > [!div class="mx-imgBorder"]
    > ![Azure Sentinel のハンティングからクエリ結果を表示する](./media/bookmarks/new-processes-observed-example.png)
    
    このアクションにより、 **[ログ]** ウィンドウにクエリ結果が表示されます。

4. ログ クエリ結果の一覧でチェック ボックスを使用して、興味のある情報が含まれている 1 つまたは複数の行を選択します。

5. **[ブックマークの追加]** を選択します。
    
    > [!div class="mx-imgBorder"]
    > ![ハンティング ブックマークをクエリに追加する](./media/bookmarks/add-hunting-bookmark.png)

6. 右側の **[ブックマークの追加]** ウィンドウで、必要に応じてブックマーク名を更新し、タグを追加し、項目に関して興味深かったことを識別するために役立つメモを追加します。

7. **[クエリ情報]** セクションで、ドロップダウン ボックスを使用して **[アカウント]** 、 **[ホスト]** 、および **[IP アドレス]** のエンティティ型のクエリ結果の情報を抽出します。 このアクションにより、選択したエンティティ型がクエリ結果の特定の列にマップされます。 次に例を示します。
    
    > [!div class="mx-imgBorder"]
    > ![ハンティング ブックマークのエンティティ型をマップする](./media/bookmarks/map-entity-types-bookmark.png)
    
    調査グラフでブックマークを表示する (現在プレビュー段階) には、少なくとも 1 つのエンティティ型 ( **[アカウント]** 、 **[ホスト]** 、または **[IP アドレス]** のいずれか) をマップする必要があります。 

5. **[保存]** をクリックして変更をコミットし、ブックマークを追加します。 ブックマークが設定されたすべてのデータは他の調査担当者と共有され、共同の調査エクスペリエンスに向けた最初の手順になります。

 
> [!NOTE]
> このウィンドウが Azure Sentinel から開くたびに、ログクエリの結果にブックマークが設定されます。 たとえば、ナビゲーション バーから **[全般]**  >  **[ログ]** を選択したり、調査グラフでイベント リンクを選択したり、インシデントの完全な詳細からアラート ID を選択したり (現在プレビュー段階) する場合です。 Azure Monitor から直接など、他の場所から **[ログ]** ウィンドウを開く場合、ブックマークを作成することはできません。

## <a name="view-and-update-bookmarks"></a>ブックマークを表示および更新する 

1. Azure portal で、 **[Sentinel]**  >  **[脅威の管理]**  >  **[ハンティング]** の順に移動します。 

2. ブックマークの一覧を表示するには、 **[ブックマーク]** タブを選択します。

3. 特定のブックマークを検索するには、検索ボックスやフィルター オプションを使用します。

4. 個々のブックマークを選択して、右側の詳細ウィンドウでブックマークの詳細を表示します。

5. 必要に応じて変更を行います。これは、自動的に保存されます。

## <a name="exploring-bookmarks-in-the-investigation-graph"></a>調査グラフでのブックマークの探索

> [!IMPORTANT]
> 調査グラフのブックマークと調査グラフ自体の探索は、現在パブリック プレビュー段階にあります。
> これらの機能はサービス レベル アグリーメントなしで提供されています。運用環境のワークロードに使用することはお勧めできません。
> 詳しくは、[Microsoft Azure プレビューの追加使用条件](https://azure.microsoft.com/support/legal/preview-supplemental-terms/)に関するページをご覧ください。

1. Azure portal で、 **[Sentinel]**  >  **[脅威の管理]**  >  **[ハンティング]**  >  **[ブックマーク]** タブの順に移動して、調査するブックマーク (複数可) を選択します。

2. ブックマークの詳細で、少なくとも 1 つのエンティティが確実にマップされているようにします。 たとえば、 **[ENTITIES]** の場合、 **[IP]** 、 **[マシン]** 、または **[アカウント]** のエントリが表示されます。

3. 調査グラフのブックマークを表示するには、 **[調査]** をクリックします。

調査グラフを使用する手順については、「[調査グラフを使用して詳細を確認する](tutorial-investigate-cases.md#use-the-investigation-graph-to-deep-dive)」を参照してください。

## <a name="add-bookmarks-to-a-new-or-existing-incident"></a>新規または既存のインシデントにブックマークを追加する

> [!IMPORTANT]
> 新規または既存のインシデントへのブックマークの追加は、現在パブリック プレビュー段階にあります。
> この機能はサービス レベル アグリーメントなしで提供されています。運用環境のワークロードに使用することはお勧めできません。
> 詳しくは、[Microsoft Azure プレビューの追加使用条件](https://azure.microsoft.com/support/legal/preview-supplemental-terms/)に関するページをご覧ください。

1. Azure portal で、 **[Sentinel]**  >  **[脅威の管理]**  >  **[ハンティング]**  >  **[ブックマーク]** タブの順に移動して、インシデントに追加するブックマーク (複数可) を選択します。

2. コマンド バーから **[インシデント アクション (プレビュー)]**  を選択します。
    
    > [!div class="mx-imgBorder"]
    > ![インシデントにブックマークを追加する](./media/bookmarks/incident-actions.png)

3. 必要に応じて、 **[新しいインシデントを作成する]** または **[既存のインシデントに追加]** のどちらかを選択します。 その後、以下を実行します。
    
    - 新しいインシデントの場合: 必要に応じて、インシデントの詳細を更新し、 **[作成]** を選択します。
    - 既存のインシデントにブックマークを追加する場合: インシデントを 1 つ選択し、 **[追加]** を選択します。 

インシデント内のブックマークを表示する場合: **[Sentinel]**  >  **[脅威の管理]**  >  **[インシデント]** の順に移動し、ブックマークが設定されたインシデントを選択します。 **[View full details]\(完全な詳細の表示\)** を選択し、 **[ブックマーク]** タブを選択します。

> [!TIP]
> コマンド バーの **[インシデント アクション (プレビュー)]** オプションの代替手段として、1 つまたは複数のブックマークのコンテキスト メニュー ( **[...]** ) を使用して、 **[新しいインシデントを作成する]** 、 **[既存のインシデントに追加]** 、および **[インシデントから削除する]** オプションを選択できます。 

## <a name="view-bookmarked-data-in-logs"></a>ログでブックマークが設定されたデータを表示する

ブックマークが設定されたクエリ、結果、または履歴を表示するには、 **[ハンティング]**  >  **[ブックマーク]** タブでブックマークを選択し、詳細ウィンドウで表示されるリンクを使用します。 

- **[ソース クエリの表示]** では、 **[ログ]** ウィンドウにソース クエリが表示されます。

- **[View bookmark log]\(ブックマーク ログの表示\)** では、更新を行ったユーザー、更新された値、更新が行われた時刻など、すべてのブックマーク メタデータが表示されます。

また、 **[ハンティング]**  >  **[ブックマーク]** タブのコマンド バーで **[Bookmark Logs]\(ブックマーク ログ\)** を選択して、すべてのブックマークの生のブックマーク データを表示することもできます。

> [!div class="mx-imgBorder"]
> ![ブックマーク ログ](./media/bookmarks/bookmark-logs.png)

このビューには、メタデータが関連付けられているすべてのブックマークが表示されます。 [キーワード クエリ言語](https://docs.microsoft.com/sharepoint/dev/general-development/keyword-query-language-kql-syntax-reference) (KQL) クエリを使用して、検索している特定のブックマークの最新版に絞り込むことができます。

> [!NOTE]
> ブックマークの作成時から、それが **[ブックマーク]** タブに表示されるまでの間に、著しい遅れ (分単位) が発生することがあります。

## <a name="delete-a-bookmark"></a>ブックマークを削除する
 
1.  Azure portal で、 **[Sentinel]**  >  **[脅威の管理]**  >  **[ハンティング]**  >  **[ブックマーク]** タブの順に移動して、削除するブックマーク (複数可) を選択します。 

2. 選択したものを右クリックし、1 つまたは複数のブックマークを削除するオプションを選択します。 たとえば、1 つだけのブックマークを選択した場合は **[ブックマークを削除]** を選択し、2 つのブックマークを選択した場合は、 **[2 つのブックマークを削除]** を選択します。
    
ブックマークを削除すると、 **[ブックマーク]** タブの一覧からブックマークが除かれます。Log Analytics ワークスペースの **[HuntingBookmark]** (検出ブックマーク) テーブルには、以前のブックマーク エントリが含まれたままですが、最新のエントリでは **[SoftDelete]** 値が true に変更されるため、古いブックマークを簡単に除外できます。 ブックマークを削除しても、他のブックマークやアラートに関連付けられている調査エクスペリエンスからはどのエンティティも削除されません。 


## <a name="next-steps"></a>次のステップ

この記事では、Azure Sentinel でブックマークを使用して検出調査を実行する方法を学習しました。 Azure Sentinel の詳細については、次の記事をご覧ください。


- [脅威を事前に検出する](hunting.md)
- [ノートブックを使用して自動化された検出キャンペーンを実行する](notebooks.md)
