---
title: Azure Sentinel に Windows セキュリティ イベント データを接続する | Microsoft Docs
description: セキュリティ イベント コネクタを使用して、Windows システムから Azure Sentinel ワークスペースにあらゆるセキュリティ イベントをストリーム配信する方法について説明します。
services: sentinel
documentationcenter: na
author: yelevin
manager: rkarlin
editor: ''
ms.assetid: d51d2e09-a073-41c8-b396-91d60b057e6a
ms.service: azure-sentinel
ms.subservice: azure-sentinel
ms.devlang: na
ms.topic: conceptual
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 09/16/2020
ms.author: yelevin
ms.openlocfilehash: bc75ee64174957ad6486146b4da6f8a66a2120e5
ms.sourcegitcommit: f28ebb95ae9aaaff3f87d8388a09b41e0b3445b5
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/29/2021
ms.locfileid: "100570553"
---
# <a name="connect-windows-security-events"></a>Windows セキュリティ イベントの接続 

セキュリティ イベント コネクタを使用すると、Windows システム (サーバーとワークステーション、物理と仮想) から Azure Sentinel ワークスペースにあらゆるセキュリティ イベントをストリーム配信することができます。 Windows のセキュリティ イベントをダッシュボードに表示できるほか、それらをカスタム アラートの作成に使用したり、調査に役立てたりしながら、組織のネットワークについての分析情報を手に入れ、セキュリティ運用機能を拡張することができます。 ストリーム配信するイベントは、次のセットから選ぶことができます。<a name="event-sets"></a>

- **すべてのイベント** - すべての Windows セキュリティ イベントおよび AppLocker イベント。
- **一般** - 監査の目的で使用する標準的なイベント セット。 このセットには、完全なユーザー監査証跡が含まれます。 たとえば、ユーザー サインインとユーザー サインアウトの両方のイベント (イベント ID 4624、4634) が含まれています。 また、セキュリティ グループの変更などの監査アクションや、ドメイン コントローラーの主要な Kerberos 操作、確立されているベスト プラクティスに沿った各種のイベントもあります。

    **一般** のイベント セットには、あまり一般的ではない種類のイベントも一部含まれている場合があります。  完全な監査証跡機能を保ちながらも、より扱いやすいレベルにまでイベントの量を減らすことが、**一般** セットの重要なポイントであるためです。

- **最小** - 潜在的な脅威を示す可能性がある小さいイベント セット。 このセットには、完全な監査証跡は含まれません。 侵害が成功したことを示す可能性があるイベントなど、発生率がきわめて低い重要イベントのみが対象となります。 たとえば、ユーザーの成功したログオンと失敗したログオン (イベント ID 4624、4625) が含まれますが、監査には重要であっても侵害の検出には重要ではない、比較的ボリュームの大きいサインアウト情報 (4634) は含まれません。 このセットのデータ量のほとんどは、サインイン イベントとプロセス作成イベント (イベント ID 4688) から成ります。

- **なし** - セキュリティ イベントまたは AppLocker イベントをストリーミングしない。 (この設定は、コネクタを無効にする目的で使用されます。)

    次の一覧は、各セットのすべてのセキュリティ イベント ID と AppLocker イベント ID を示します。

    | イベント セット | 収集されるイベント ID |
    | --- | --- |
    | **最小** | 1102、4624、4625、4657、4663、4688、4700、4702、4719、4720、4722、4723、4724、4727、4728、4732、4735、4737、4739、4740、4754、4755、4756、4767、4799、4825、4946、4948、4956、5024、5033、8001、8002、8003、8004、8005、8006、8007、8222 |
    | **共通** | 1、299、300、324、340、403、404、410、411、412、413、431、500、501、1100、1102、1107、1108、4608、4610、4611、4614、4622、4624、4625、4634、4647、4648、4649、4657、4661、4662、4663、4665、4666、4667、4688、4670、4672、4673、4674、4675、4689、4697、4700、4702、4704、4705、4716、4717、4718、4719、4720、4722、4723、4724、4725、4726、4727、4728、4729、4733、4732、4735、4737、4738、4739、4740、4742、4744、4745、4746、4750、4751、4752、4754、4755、4756、4757、4760、4761、4762、4764、4767、4768、4771、4774、4778、4779、4781、4793、4797、4798、4799、4800、4801、4802、4803、4825、4826、4870、4886、4887、4888、4893、4898、4902、4904、4905、4907、4931、4932、4933、4946、4948、4956、4985、5024、5033、5059、5136、5137、5140、5145、5632、6144、6145、6272、6273、6278、6416、6423、6424、8001、8002、8003、8004、8005、8006、8007、8222、26401、30004 |

> [!NOTE]
> 単一ワークスペースのコンテキスト内でのセキュリティ イベントの収集は、Azure Security Center と Azure Sentinel のどちらか一方からのみ構成できます。両方からは不可能です。 既に Azure Security Center から Azure Defender アラートを取得しており、なおかつセキュリティ イベントを収集するように設定されているワークスペースに Azure Sentinel をオンボーディングする場合、次の 2 つの選択肢があります。
> - Azure Security Center でのセキュリティ イベントの収集をそのまま使用する。 それらのイベントは、Azure Security Center だけでなく Azure Defender でも照会、分析できるようになります。 ただし、Azure Sentinel でコネクタの接続状態を監視したり、その構成を変更したりすることはできません。 この点が問題となる場合は、2 つ目の選択肢を検討してください。
>
> - Azure Security Center での[セキュリティ イベントの収集を無効](../security-center/security-center-enable-data-collection.md)にした後、Azure Sentinel でセキュリティ イベント コネクタを追加する。 1 つ目の選択肢と同様、イベントの照会と分析は、Azure Sentinel と Azure Defender/ASC の両方で行えますが、コネクタの接続状態を監視したりその構成を変更したりする作業は、Azure Sentinel でしか行えません。

## <a name="set-up-the-windows-security-events-connector"></a>Windows セキュリティ イベントのコネクタを設定する

Windows セキュリティ イベントを Azure Sentinel で収集するには、次の手順に従います。

1. Azure Sentinel のナビゲーション メニューから、 **[Data connectors]\(データ コネクタ\)** を選択します。 コネクタの一覧で **[セキュリティ イベント]** をクリックし、右下にある **[Open connector page]\(コネクタ ページを開く\)** ボタンをクリックします。 その後、 **[Instructions]\(手順\)** タブで画面の指示に従い、このセクションの残りの作業を行います。

1. コネクタ ページの **[前提条件]** セクションに記載された適切なアクセス許可があることを確認します。

1. Azure Sentinel にストリーム配信するセキュリティ イベントの発生元となるマシンに、[Log Analytics エージェント](../azure-monitor/agents/log-analytics-agent.md) (旧称 Microsoft Monitoring Agent または MMA) をダウンロードしてインストールします。

    Azure Virtual Machines の場合:
    
    1. **[Azure Windows 仮想マシンにエージェントをインストールする]** をクリックし、下に表示されるリンクをクリックします。
    1. 接続する各仮想マシンについて、その名前を右側に表示されるリストでクリックし、 **[接続]** をクリックします。

    Azure 以外の Windows マシンの場合 (物理マシン、オンプレミスの仮想マシン、別のクラウドの仮想マシン):

    1. **[Azure 以外の Windows マシンにエージェントをインストールする]** をクリックし、下に表示されるリンクをクリックします。
    1. 右側の **[Windows コンピューター]** に表示される適切なダウンロード リンクをクリックします。
    1. ダウンロードした実行可能ファイルを使用して、目的の Windows システムにエージェントをインストールし、前述のダウンロード リンクの下に表示される **[ワークスペース ID とキー]** を使用してその構成を行います。

    > [!NOTE]
    >
    > 必要なインターネット接続を備えていない Windows システムでも、Azure Sentinel にイベントをストリーム配信できるようにしたい場合は、プロキシとして機能する **OMS ゲートウェイ** を、右下のリンクから個々のマシンにダウンロードしてインストールしてください。  その場合でも、イベントを収集する個々の Windows システムに Log Analytics エージェントをインストールする必要があります。
    >
    > このシナリオの詳細については、[**Log Analytics ゲートウェイ** のドキュメント](../azure-monitor/agents/gateway.md)を参照してください。

    その他のインストール オプションとさらに詳しい情報については、[**Log Analytics エージェント** のドキュメント](../azure-monitor/agents/agent-windows.md)を参照してください。

1. ストリーム配信するイベント セット ([すべて、一般、最小](#event-sets)) を選択します。

1. **[Update]** をクリックします。

1. Windows セキュリティ イベントに Log Analytics 内の関連スキーマを使用するには、クエリ ウィンドウで「`SecurityEvent`」と入力します。

## <a name="validate-connectivity"></a>接続の検証

ログが Log Analytics に表示され始めるまで、約 20 分かかる場合があります。 

### <a name="configure-the-security-events-connector-for-anomalous-rdp-login-detection"></a>異常な RDP ログイン検出用にセキュリティ イベント コネクタを構成する

> [!IMPORTANT]
> 異常な RDP ログイン検出は現在、パブリック プレビュー段階です。
> この機能はサービス レベル アグリーメントなしで提供されています。運用環境のワークロードに使用することはお勧めできません。
> 詳しくは、[Microsoft Azure プレビューの追加使用条件](https://azure.microsoft.com/support/legal/preview-supplemental-terms/)に関するページをご覧ください。

Azure Sentinel はセキュリティ イベント データに機械学習 (ML) を適用して、異常なリモート デスクトップ プロトコル (RDP) ログイン アクティビティを識別できます。 シナリオには以下が含まれます。

- **通常とは異なる IP** - その IP アドレスが過去 30 日間にほとんどまたはまったく確認されていない

- **通常とは異なる地理的な場所** - IP アドレス、市区町村、国、および ASN が過去 30 日間にほとんどまたはまったく確認されていない

- **新しいユーザー** - 新しいユーザーが、過去 30 日間のデータに基づいて予期されないか確認されていない (またはその両方の) IP アドレスおよび地理的な場所からログインしている。

**構成の手順**

1. **セキュリティ イベント** データ コネクタを使用して、RDP ログイン データ (イベント ID 4624) を収集している必要があります。 Azure Sentinel にストリーミングするために、[なし] 以外の[イベント セット](#event-sets)を選択したことを確認してください。

1. Azure Sentinel ポータルから、 **[Analytics]\(分析\)** をクリックし、 **[Rule templates]\(規則のテンプレート\)** タブをクリックします。 **[(Preview) Anomalous RDP Login Detection]\((プレビュー) 異常な RDP ログイン検出\)** 規則を選択し、 **[状態]** スライダーを **[有効]** に移動します。

    > [!NOTE]
    > 機械学習アルゴリズムでは、ユーザー動作のベースライン プロファイルを作成するために 30 日間分のデータが必要であるため、インシデントを検出する前に、30 日間のセキュリティ イベント データの収集を許可する必要があります。

## <a name="next-steps"></a>次のステップ
このドキュメントでは、Windows セキュリティ イベントを Azure Sentinel に接続する方法について学習しました。 Azure Sentinel の詳細については、次の記事をご覧ください。
- [データと潜在的な脅威を可視化](quickstart-get-visibility.md)する方法についての説明。
- [組み込み](tutorial-detect-threats-built-in.md)または[カスタム](tutorial-detect-threats-custom.md)のルールを使用して、Azure Sentinel で脅威の検出を開始する。

