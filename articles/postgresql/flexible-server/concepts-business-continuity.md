---
title: Azure Database for PostgreSQL - フレキシブル サーバーでのビジネス継続性の概要
description: Azure Database for PostgreSQL - フレキシブル サーバーでのビジネス継続性の概念について説明します
author: sr-msft
ms.author: srranga
ms.service: postgresql
ms.topic: conceptual
ms.date: 09/22/2020
ms.openlocfilehash: 341d3c6f0a2d84c2b7b725959db9f7e5dd80d3ff
ms.sourcegitcommit: f28ebb95ae9aaaff3f87d8388a09b41e0b3445b5
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/29/2021
ms.locfileid: "92542966"
---
# <a name="overview-of-business-continuity-with-azure-database-for-postgresql---flexible-server"></a>Azure Database for PostgreSQL - フレキシブル サーバーでのビジネス継続性の概要

> [!IMPORTANT]
> Azure Database for PostgreSQL - フレキシブル サーバーはプレビュー段階です

Azure Database for PostgreSQL - フレキシブル サーバーでの **ビジネス継続性** とは、中断 (特にそのコンピューティング インフラストラクチャに対する) が発生した場合でもビジネス活動を続けることができるようにするメカニズム、ポリシー、手順を指します。 ほとんどの場合、クラウド環境で発生する可能性がある破壊的なイベントはフレキシブル サーバーによって処理されて、アプリケーションとビジネス プロセスの実行が維持されます。 ただし、次のようなイベントは自動的に処理できません。

- ユーザーが誤ってテーブルの行を削除または更新した。
- 地震によって停電が発生し、一時的にデータセンターまたは可用性ゾーンが使用できなくなった。
- バグまたはセキュリティの問題を修正するために、データベースの修正プログラムを適用する必要がある。

フレキシブル サーバーでは、計画的および予定外のダウンタイム イベントが発生した場合に、データを保護し、ミッション クリティカルなデータベースのダウンタイムを軽減する機能が提供されています。 堅牢な回復性と可用性が既に提供されている Azure インフラストラクチャの上に構築されたフレキシブル サーバーは、障害からの保護を強化し、復旧時間要件に対処し、データ損失の発生を減らす、ビジネス継続性機能を備えています。 アプリケーションを設計するときは、ダウンタイムの許容範囲 (目標復旧時間 (RTO)) とデータ損失の発生 (目標復旧時点 (RPO)) を考慮する必要があります。 たとえば、ビジネス クリティカルなデータベースでは、テスト データベースと比較して、はるかに厳しいアップタイム要件が必要になります。  

> [!IMPORTANT]
> プレビュー期間中は、アップタイム % のサービス レベル アグリーメント (SLA) は提供されません。 

次の表では、フレキシブル サーバーによって提供される機能を示します。


| **機能** | **説明** | **考慮事項** |
| ---------- | ----------- | ------------ |
| **自動バックアップ** | フレキシブル サーバーでは、データベース ファイルの毎日のバックアップが自動的に実行され、トランザクション ログが継続的にバックアップされます。 バックアップは 7 日から最大 35 日まで保持できます。 データベース サーバーは、バックアップの保持期間内の任意の時点に復元できます。 RTO は、復元するデータのサイズとログ復旧を実行する時間によって異なります。 数分から最大で 12 時間かかる可能性があります。 詳細については、[バックアップと復元の概念](./concepts-backup-restore.md)に関するページを参照してください。 |バックアップ データは、リージョン内に保持されます。 |
| **ゾーン冗長の高可用性** | フレキシブル サーバーは、リージョン内の 2 つの異なる可用性ゾーンにプライマリ サーバーとスタンバイ サーバーがデプロイされる、ゾーン冗長高可用性 (HA) 構成でデプロイできます。 この HA 構成を使用すると、データベースがゾーンレベルの障害から保護され、計画的および計画外のダウンタイム イベントの発生時にアプリケーションのダウンタイムを減らすことができます。 プライマリ サーバーからのデータは、同期モードでスタンバイ レプリカにレプリケートされます。 プライマリ サーバーで何らかの障害が発生した場合、サーバーは自動的にスタンバイ レプリカにフェールオーバーされます。 ほとんどの場合、RTO は、60 秒から 120 秒の範囲内であると想定されます。 RPO はゼロ (データ損失なし) であると想定されます。 詳細については、[高可用性の概念](./concepts-high-availability.md)に関するページを参照してください。 | General Purpose と Memory Optimized のコンピューティング レベルでサポートされます。 複数のゾーンが使用可能なリージョンでのみ利用できます。 |
| **Premium マネージド ディスク** | データベース ファイルは、耐久性と信頼性に優れた Premium マネージド ストレージに格納されます。 これにより、自動データ復旧機能を備えた可用性ゾーン内に格納されるレプリカの 3 つのコピーを使用してデータの冗長性が提供されます。 詳細については、[マネージド ディスクのドキュメント](../../virtual-machines/managed-disks-overview.md)を参照してください。 | 可用性ゾーン内に格納されるデータ。 |
| **ゾーン冗長バックアップ** | フレキシブル サーバーのバックアップは、リージョン内のゾーン冗長ストレージに自動的かつ安全に格納されます。 サーバーがプロビジョニングされているゾーンレベルの障害では、サーバーにゾーン冗長が構成されていない場合でも、別のゾーンの最新の復元ポイントを使用してデータベースを復元できます。 詳細については、[バックアップと復元の概念](./concepts-backup-restore.md)に関するページを参照してください。| 複数のゾーンが使用可能なリージョンにのみ適用されます。|


## <a name="planned-downtime-events"></a>計画的なダウンタイム イベント
以下では、計画メンテナンスのシナリオをいくつか示します。 これらのイベントでは、通常、最大で数分間のダウンタイムが発生し、データ損失は発生しません。

| **シナリオ** | **Process**|
| ------------------- | ----------- | 
| <b>コンピューティングのスケーリング (ユーザーによる開始)| コンピューティングのスケーリング操作の間は、アクティブなチェックポイントの完了が許可され、クライアント接続がドレインされ、コミットされていないトランザクションが取り消され、ストレージがデタッチされてから、サーバー自体がシャットダウンされます。 同じデータベース サーバー名を持つ新しいフレキシブル サーバーが、スケーリングされたコンピューティング構成を使用してプロビジョニングされます。 その後、ストレージが新しいサーバーにアタッチされて、データベースが起動され、クライアント接続を受け入れる前に、必要に応じて復旧が実行されます。 |
| <b>ストレージのスケールアップ (ユーザーによる開始) | ストレージのスケールアップ操作が開始されると、アクティブなチェックポイントの完了が許可され、クライアント接続がドレインされ、コミットされていないトランザクションが取り消されてから、シャットダウンされます。 ストレージは、目的のサイズにスケーリングされた後、新しいサーバーにアタッチされます。 必要な場合は、クライアント接続を受け入れる前に、復旧が実行されます。 ストレージ サイズのスケールダウンはサポートされていないことに注意してください。 |
| <b>新しいソフトウェアのデプロイ (Azure による開始) | 新機能のロールアウトやバグの修正は、サービスの計画メンテナンスの一環として自動的に行われ、ユーザーはそれらのアクティビティがいつ発生するかをスケジュールできます。 詳細については、[ポータル](https://aka.ms/servicehealthpm)を確認してください。 | 
| <b>マイナー バージョンのアップグレード (Azure による開始) | Azure Database for PostgreSQL では、Azure によって決定されたマイナー バージョンへの修正プログラムが自動的にデータベース サーバーに適用されます。 これは、サービスの計画的なメンテナンスの一環として行われます。 データベース サーバーは、新しいマイナー バージョンで自動的に再起動されます。 詳細については、[こちらのドキュメント](../concepts-monitoring.md#planned-maintenance-notification)を参照してください。 [ポータル](https://aka.ms/servicehealthpm)でも確認できます。| 

 フレキシブル サーバーが **ゾーン冗長の高可用性** で構成されている場合、フレキシブル サーバーにより最初にスタンバイ サーバーでスケーリングとメンテナンスの操作が実行されます。 詳細については、[高可用性の概念](./concepts-high-availability.md)に関するページを参照してください。

##  <a name="unplanned-downtime-mitigation"></a>計画外のダウンタイムの軽減

計画外のダウンタイムは、基になるハードウェアの障害、ネットワークの問題、ソフトウェアのバグなど、予期しない中断の結果として発生する可能性があります。 高可用性が構成されているデータベース サーバーが予期せず停止した場合は、スタンバイ レプリカがアクティブ化され、クライアントは操作を再開できます。 高可用性 (HA) が構成されていない場合は、再起動の試みが失敗すると、新しいデータベース サーバーが自動的にプロビジョニングされます。 計画外のダウンタイムは回避できませんが、フレキシブル サーバーを使用すると、ユーザーの介入を必要とすることなく自動的に復旧操作を実行することでダウンタイムが軽減されます。 
   
### <a name="unplanned-downtime-failure-scenarios-and-service-recovery"></a>計画外のダウンタイム: 障害シナリオとサービス復旧
計画外の障害シナリオと復旧プロセスを次に示します。 

| **シナリオ** | **復旧プロセス [非 HA]** | **復旧プロセス [HA]** |
| ---------- | ---------- | ------- |
| <B>データベース サーバーの障害 | データベース サーバーがダウンした場合、Azure によってデータベース サーバーの再起動が試みられます。 それが失敗した場合、データベース サーバーは別の物理ノードで再起動されます。  <br /> <br /> 復旧時間 (RTO) は、大規模なトランザクションや、データベース サーバーの起動プロセス中に実行される復旧の量など、障害発生時のアクティビティを含め、さまざまな要因によって異なります。 <br /> <br /> PostgreSQL データベースを使用するアプリケーションは、切断された接続や失敗したトランザクションを検出し、再試行するように構築されている必要があります。 | データベース サーバーの障害が検出されると、サーバーはスタンバイ サーバーにフェールオーバーされるため、ダウンタイムが短縮されます。 詳細については、[高可用性の概念に関するページ](./concepts-high-availability.md)を参照してください。 RTO は 60 秒から 120 秒で、データ損失はないものと予想されます。 |
| <B>ストレージの障害 | アプリケーションは、ディスク障害や物理ブロックの破損など、ストレージ関連の問題の影響を一切認識しません。 データが 3 つのコピーに格納されるので、データのコピーは存続しているストレージから提供されます。 破損したデータ ブロックは自動的に修復され、データの新しいコピーが自動的に作成されます。 | ストレージ全体にアクセスできなくなるような、まれに発生する復旧不可能なエラーの場合は、ダウンタイムを短縮するため、フレキシブル サーバーがスタンバイ レプリカにフェールオーバーされます。 詳細については、[高可用性の概念に関するページ](./concepts-high-availability.md)を参照してください。 |
| <b> 論理/ユーザー エラー | テーブルの偶発的な削除や、データの誤った更新などの、ユーザー エラーから復旧するには、[ポイントインタイム リストア](../concepts-backup.md) (PITR) を実行する必要があります。 復元操作の実行中に、カスタム復元ポイントとして、エラーが発生した直前の時刻を指定します。<br> <br>  データベース サーバー内のすべてのデータベースではなく、データベースまたは特定のテーブルのサブセットのみを復元する場合は、新しいインスタンスでデータベース サーバーを復元し、[pg_dump](https://www.postgresql.org/docs/11/app-pgdump.html) を使用してテーブルをエクスポートし、[pg_restore](https://www.postgresql.org/docs/11/app-pgrestore.html) を使用してそれらのテーブルをデータベースに復元することができます。 | すべての変更はスタンバイ レプリカに同期的にレプリケートされるため、これらのユーザー エラーは高可用性では保護されません。 このようなエラーから復旧するには、ポイントインタイム リストアを実行する必要があります。 |
| <b>可用性ゾーンの障害 | ゾーンレベルの障害から復旧するには、バックアップを使用し、復元する最新時刻でカスタム復元ポイントを選択してポイントインタイム リストアを実行し、最新のデータを復元することができます。 影響を受けていない別のゾーンに、新しいフレキシブル サーバーがデプロイされます。 復元にかかる時間は、前回のバックアップと、復旧するトランザクション ログの量によって異なります。 | フレキシブル サーバーは、60 秒から 120 秒以内にデータ損失なしでスタンバイ サーバーに自動的にフェールオーバーされます。 詳細については、[高可用性の概念に関するページ](./concepts-high-availability.md)を参照してください。 | 
| <b>リージョンの障害 | リージョン間の読み取りレプリカおよびバックアップの geo リストア機能は、プレビューではまだサポートされていません。 | |


> [!IMPORTANT]
> 削除したサーバーは、復元 **できません**。 サーバーを削除すると、そのサーバーに属するデータベースもすべて削除され、復元できなくなります。 [Azure リソース ロック](../../azure-resource-manager/management/lock-resources.md)を使用すると、サーバーが誤って削除されるのを防ぐことができます。


## <a name="next-steps"></a>次のステップ

-   [ゾーン冗長による高可用性](./concepts-high-availability.md)について確認する
-   [バックアップと復旧](./concepts-backup-restore.md)について確認する