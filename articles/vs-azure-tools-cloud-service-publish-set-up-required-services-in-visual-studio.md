<properties 
   pageTitle="Visual Studio からのクラウド サービスの発行に必要なサービスの設定"
	description="クラウド サービスとストレージ アカウント サービスを設定し、Azure アプリケーションを構成する手順を説明します。"
	services="visual-studio-online"
	documentationCenter="na"
	authors="kempb"
	manager="douge"
	editor="tglee"/>
<tags 
   ms.service="multiple"
	ms.devlang="dotnet"
	ms.topic="article"
	ms.tgt_pltfrm="na"
	ms.workload="multiple"
	ms.date="08/13/2015"
	ms.author="kempb"/>

# Visual Studio からのクラウド サービスの発行に必要なサービスの設定

##概要

クラウド サービス プロジェクトを発行可能にするには、次のサービスを設定する必要があります。

- Azure 環境でロールを実行する**クラウド サービス**

- BLOB サービス、Queue サービス、および Table サービスへのアクセスを提供する**ストレージ アカウント**

これらのサービスを設定し、アプリケーションを構成するには、次の手順を使用します。


## クラウド サービスを作成する

Azure にクラウド サービスを発行するには、まず、Azure 環境でロールを実行するクラウド サービスを作成する必要があります。Azure 管理ポータルでクラウド サービスを作成するには、[ここ](#to-create-a-cloud-service-by-using-the-azure-management-portal)の説明に従います。発行ウィザードを使用する場合は、Visual Studio でクラウド サービスを作成することもできます。

### Visual Studio を使用してクラウド サービスを作成するには

1. Azure プロジェクトのショートカット メニューを開き、**[発行]** をクリックします。

    ![VST\_PublishMenu](./media/vs-azure-tools-cloud-service-publish-set-up-required-services-in-visual-studio/vst-publish-menu.png)

1. サインインしていない場合は、Azure サブスクリプションに関連付けられている Microsoft アカウントまたは組織アカウントのユーザー名とパスワードを使用してサインインします。

1. **[次へ]** をクリックし、**[設定]** ページに進みます。

    ![Publishing Wizard Common Settings](./media/vs-azure-tools-cloud-service-publish-set-up-required-services-in-visual-studio/publish-settings-page.png)

1. **[クラウド サービス]** 一覧で、**[新規作成]** をクリックします。**[Azure サービスの作成]** ダイアログが表示されます。

1. クラウド サービスの名前を入力します。この名前はサービスの URL の一部として使用されるため、グローバルに一意であることが必要です。この名前では、大文字小文字が区別されません。

### Azure 管理ポータルを使用してクラウド サービスを作成するには

1. Microsoft Web サイトの [Azure 管理ポータル](http://go.microsoft.com/fwlink/?LinkId=253103)にサインインします。

1. (省略可能) 既に作成したクラウド サービスの一覧を表示するには、ページの左側にある [Cloud Services] リンクを選択します。

1. 左下隅にある **[+]** アイコンを選択し、表示されるメニューで **[クラウド サービス]** を選択します。**[簡易作成]** と **[カスタム作成]** という 2 つのオプションがある別の画面が表示されます。**[簡易作成]** を選択した場合、URL と物理的にホストするリージョンを指定するだけで、クラウド サービスを作成できます。**[カスタム作成]** を選択した場合、パッケージ (.cspkg ファイル)、構成 (.cscfg) ファイルと証明書を指定することで、クラウド サービスをすぐに発行できます。Azure プロジェクトの **[発行]** コマンドを使用してクラウド サービスを発行する場合、[カスタム作成] は必須ではありません。**[発行]** コマンドは、Azure プロジェクトのショートカット メニューで使用できます。

1. Visual Studio を使用してクラウド サービスを後で発行する場合は、**[簡易作成]** を選択します。

1. クラウド サービスの名前を指定します。名前の隣に完全な URL が表示されます。

1. 一覧で、ユーザーが主に配置されているリージョンを選択します。

1. ウィンドウの下部にある **[クラウド サービスの作成]** リンクを選択します。

## ストレージ アカウントの作成

ストレージ アカウントを使用すると、BLOB サービス、Queue サービス、および Table サービスにアクセスできます。ストレージ アカウントは、Visual Studio または [Azure プラットフォームの管理ポータル](http://go.microsoft.com/fwlink/?LinkId=253103) を使用して作成できます。

### Visual Studio を使用して、ストレージ アカウントを作成するには

1. ソリューション エクスプローラーで **[ストレージ]** ノードのショートカット メニューを開き、**[ストレージ アカウントの作成]** を選択します。

    ![Create a new Azure storage account](./media/vs-azure-tools-cloud-service-publish-set-up-required-services-in-visual-studio/IC744166.png)

1. **[ストレージ アカウントの作成]** ダイアログ ボックスで、新しいストレージ アカウントの次の情報を選択または入力します。
    - ストレージ アカウントに追加する Azure のサブスクリプション。
    - 新しいストレージ アカウントで使用する名前。
    - リージョンまたはアフィニティ グループ (米国西部や東アジアなど)。
    - geo 冗長など、ストレージ アカウントで使用するレプリケーションの種類。

1. 終了したら **[作成]** を選択します。[サーバー エクスプローラー] の **[ストレージ]** 一覧に新しいストレージ アカウントが表示されます。

### Azure 管理ポータルを使用して、ストレージ アカウントを作成するには

1. Microsoft Web サイトの [Azure プラットフォームの管理ポータル](http://go.microsoft.com/fwlink/?LinkId=253103)にサインインします。

1. (省略可能) ストレージ アカウントを表示するには、ページの左側のパネルで **[Storage]** リンクを選択します。

1. ページの左下隅にある **[+]** アイコンを選択します。

1. 表示されるメニューで、**[ストレージ]** を選択し、クリックして **[簡易作成]** を選択します。

1. ストレージ アカウントに一意の URL となる名前を付けます。

1. クラウド サービスに名前を付けます。名前の隣に完全な URL が表示されます。

1. リージョンの一覧で、ユーザーが主に配置されているリージョンを選択します。

1. geo レプリケーションを有効にするかどうかを指定します。geo レプリケーションを有効にした場合は、データは複数の物理的な場所に保存され、損失の可能性が低減します。この機能ではストレージは高価になりますが、機能を後で追加するのではなく、ストレージのアカウントを作成するときに geo ロケーションを有効にすると、コストを削減することができます。詳細については、[geo レプリケーション](http://go.microsoft.com/fwlink/?LinkId=253108)に関するページを参照してください。

1. ウィンドウの下部にある **[ストレージ アカウントの作成]** リンクを選択します。

ストレージ アカウントを作成したら、各 Azure ストレージ サービスのリソースにアクセスするために使用できる URL が表示されます。また、アカウントのプライマリ アクセス キーとセカンダリ アクセス キーも表示されます。これらのキーは、ストレージ サービスに対する要求を認証するために使用します。

>[AZURE.NOTE]セカンダリ アクセス キーは、プライマリ アクセス キーと同じようにストレージ アカウントにアクセスでき、プライマリ アクセス キーが侵害された場合の予備として生成されます。また、定期的にアクセスのキーを再生成することをお勧めします。プライマリ キーの再生成時にセカンダリ キーを使用するように接続文字列の設定を変更した後で、セカンダリ キーの再生成時に再生成したプライマリ キーを使用するように接続文字列の設定を変更できます。

## ストレージ アカウントによって提供されるサービスを使用するようアプリケーションを構成する

作成した Azure ストレージ サービスを使用するには、ストレージ サービスにアクセスするロールを構成する必要があります。これを行うために、Azure プロジェクトの複数のサービス構成を使用できます。既定では、Azure プロジェクトに 2 つのサービス構成が作成されます。複数のサービス構成を使用すると、コード内では同じ接続文字列を使用しつつ、各サービス構成で定めた接続文字列に別の値を適用することができます。たとえば、Azure ストレージ エミュレーターを使用してアプリケーションをローカルで実行およびデバッグするサービス構成と、Azure にアプリケーションを発行する別のサービス構成を使用できます。サービス構成ファイルの詳細については、「[Azure プロジェクトの構成](https://msdn.microsoft.com/library/azure/ee405486.aspx)」を参照してください。

### ストレージ アカウントが提供するサービスを使用するようアプリケーションを構成するには

1. Visual Studio で Azure ソリューションを開きます。ソリューション エクスプローラーで、ストレージ サービスにアクセスする Azure プロジェクトの各ロールのショートカット メニューを開き、**[プロパティ]** をクリックします。ロールの名前のページが、Visual Studio エディターに表示されます。ページには、**[構成]** タブのフィールドが表示されます。

1. ロールのプロパティ ページで **[設定]** を選択します。

1. **[サービス構成]** ボックスの一覧で、編集するサービス構成の名前を選択します。このロールのすべてのサービス構成を変更する場合は、**[すべての構成]** を選択できます。サービス構成を更新する方法の詳細については、「[ストレージ アカウント用の接続文字列の管理](https://msdn.microsoft.com/library/azure/8cda8963-ef0e-4f64-8d29-5eac467e5f53#ConnectionStrings)」を参照してください。

1. 接続文字列の設定を変更するには、設定の隣にある **[...]** ボタンをクリックします。**[ストレージ接続文字列の作成]** ダイアログ ボックスが表示されます。

1. **[接続方法]** で **[サブスクリプション]** オプションをクリックします。

1. **[サブスクリプション]** 一覧で、目的のサブスクリプションを選択します。目的のサブスクリプションが一覧に含まれていない場合は、**[発行設定のダウンロード]** リンクを選択します。

1. **[アカウント名]** 一覧で、ストレージ アカウント名を選択します。Azure Tools は .publishsettings ファイルを使用して、自動的にストレージ アカウントの資格情報を取得します。ストレージ アカウントの資格情報を手動で指定するには、**[手動で入力された資格情報]** オプションを選択し、この手順を続行します。[管理ポータル](http://go.microsoft.com/fwlink/p/?LinkID=213885)で、ストレージ アカウント名とプライマリ キーを取得できます。ストレージ アカウントの設定を手動で指定しない場合は、**[OK]** をクリックし、ダイアログ ボックスを閉じます。

1. **[ストレージ アカウントの資格情報の入力]** リンクを選択します。

1. ストレージ アカウントの名前を **[アカウント名]** に入力します。

    >[AZURE.NOTE]管理ポータルにログインし、**[Storage]** ボタンをクリックします。ポータルでは、ストレージ アカウントの一覧が表示されます。アカウントを選択すると、アカウント用のページが開きます。このページからストレージ アカウントの名前をコピーできます。以前のバージョンの管理ポータルを使用している場合は、ストレージ アカウントの名前が管理ポータルの **[ストレージ アカウント]** ビューに表示されます。この名前をコピーするには、このビューの **[プロパティ]** ウィンドウで強調表示し、Ctrl キーを押しながら C キーを押します。Visual Studio に名前を貼り付けるには、**[アカウント名]** ボックスを選択し、Ctrl キーを押しながら V キーを押します。

1. **[アカウント キー]** ボックスで、プライマリ キーを入力するか、または[管理ポータル](http://go.microsoft.com/fwlink/?LinkID=213885)からコピーして貼り付けます。管理ポータルからこのキーをコピーするには:

    1. 該当するストレージ アカウントのページの下部で、**[キーの管理]** をクリックします。

    1. **[キーのアクセスを管理]** ページで、プライマリ アクセス キーのテキストを選択し、Ctrl キーを押しながら C キーを押します。

    1. Azure Tools で、**[アカウント キー]** ボックスにキーを貼り付けます。

    1. サービスがストレージ アカウントにアクセスする方法を決定するには、次のオプションのいずれかを選択する必要があります。
        - **[HTTP の使用]**。これは、標準的なオプションです。たとえば、「`http://<account name>.blob.core.windows.net`」のように入力します。
        - **[HTTPS の使用]**。これは、セキュリティで保護された接続に使用します。たとえば、「`https://<accountname>.blob.core.windows.net`」のように入力します。
        - **[カスタム エンドポイントの指定]**。これは、3 つのサービスそれぞれに対してエンドポイントを指定するときに使用します。このオプションを選択すると、特定のサービスのフィールドにエンドポイントを入力できます。 

        >[AZURE.NOTE]カスタム エンドポイントを作成する場合は、より複雑な接続文字列を作成できます。この文字列形式を使用する場合は、ストレージ アカウント用に BLOB サービスに登録したカスタム ドメイン名を含むストレージ サービス　エンドポイントを指定できます。また、共有アクセス署名を介して単一コンテナーの BLOB リソースにのみアクセスを許可できます。カスタム エンドポイントの作成方法の詳細については、「[Azure Storage の接続文字列を構成する](https://azure.microsoft.com/documentation/articles/storage-configure-connection-string/)」を参照してください。

1. これらの接続文字列の変更を保存するには、**[OK]** をクリックし、ツール バーの **[保存]** ボタンをクリックします。これらの変更を保存すると、[GetConfigurationSettingValue](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleenvironment.getconfigurationsettingvalue.aspx) を使用して、コード内のこの接続文字列の値を取得できます。Azure にアプリケーションを発行するときに、接続文字列用の Azure ストレージ アカウントを含むサービス構成を選択します。アプリケーションを発行した後、アプリケーションが Azure ストレージ サービスに対して期待どおりに動作することを確認します。

## その他のリソース

[Visual Studio から Azure クラウド サービスへの発行](https://msdn.microsoft.com/library/azure/ee460772.aspx)

<!---HONumber=August15_HO9-->