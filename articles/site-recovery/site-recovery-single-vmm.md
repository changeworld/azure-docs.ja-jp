
<properties
	pageTitle="Azure Site Recovery: HYPER-V 仮想マシンのレプリケート (単一 VMM サーバー)"
	description="Azure Site Recovery は、オンプレミスの VMM クラウドに配置された仮想マシンのセカンダリ VMM クラウドへのレプリケーション、フェールオーバー、および復旧を調整します。"
	services="site-recovery"
	documentationCenter=""
	authors="rayne-wiselman"
	manager="jwhit"
	editor=""/>

<tags
	ms.service="site-recovery"
	ms.devlang="na"
	ms.topic="article"
	ms.tgt_pltfrm="na"
	ms.workload="backup-recovery"
	ms.date="12/01/2015"
	ms.author="raynew"/>

#  Azure Site Recovery: HYPER-V 仮想マシンのレプリケート (単一 VMM サーバー)

Site Recovery サービスは、Azure またはオンプレミスのセカンダリ データセンターへのレプリケーションを調整および自動化することにより、オンプレミスの物理サーバーおよび仮想マシンを保護する、堅牢なビジネス継続性と障害復旧 (BCDR) ソリューションを構築するのに役立ちます。この記事では、デプロイに単一 VMM サーバーしかない場合に、Site Recovery をデプロイして VMM クラウドに格納されている Hyper-V 仮想マシンを保護する方法について説明します。この記事の内容について質問がある場合は、[Azure Recovery Services フォーラム](https://social.msdn.microsoft.com/forums/azure/home?forum=hypervrecovmgr)に投稿してください。

## 概要

Hyper-V 仮想マシンを次のいくつかの方法でレプリケートできます。

- Hyper-V ホスト上にあって、VMM クラウドには存在しない Hyper-V 仮想マシンを Azure にレプリケートする
- VMM クラウドの Hyper-V ホスト上にある Hyper-V 仮想マシンを Azure にレプリケートする
- VMM クラウドの Hyper-V ホスト上にある Hyper-V 仮想マシンを Azure にレプリケートする

しかし、VMM を使用したいのに、インフラストラクチャには単一の VMM サーバーしかない場合はどうでしょうか。

この場合には次の 2 つのオプションがあります。

- VMM クラウドの Hyper-V 仮想マシンを Azure にレプリケートするこのシナリオについて詳細は[こちら](site-recovery-vmm-to-azure.md)をご覧ください。
- 単一の VMM サーバー上のクラウド間でレプリケートする

1 番目のオプションをお勧めするのは、2 番目のオプションではフェールオーバーや復旧がシームレスではなく、またいくつもの手動による手順が必要となるからです。


### 単一スタンドアロンの VMM サーバーでのサイト間レプリケート

このシナリオでは、プライマリ サイトに仮想マシンとして単一スタンドアロンの VMM サーバーをデプロイし、Site Recovery と Hyper-V レプリカを使用して、セカンダリ サイトにこの仮想マシンをレプリケートします。これを行うには、次の手順を実行します。

1. HYPER-V 仮想マシン上の VMM を設定します。VMM によって使用される SQL Server インスタンスを同じ VM 上に併置することを検討してください。1 つの VM をインスタンス化するだけでよいので時間節約になります。リモート インスタンスを使用しようとして、システム停止が起こった場合、VMM を復旧する前にインスタンスを復旧させる必要があります。
2. VMM サーバーには少なくとも 2 つのクラウドを構成するようにしてください。一方のクラウドにはレプリケートを行う VM が含まれ、もう一方のクラウドはセカンダリのロケーションとして機能します。保護する VM を含むクラウドには、各ホスト グループに 1 つまたは複数の Hyper-V ホストサーバーが存在する 1 つまたは複数の VMM ホスト グループ、そして各ホストサーバーに少なくとも 1 つの Hyper-V 仮想マシンが必要です。
2. Site Recovery コンテナーの作成、コンテナー登録キーの生成およびダウンロード、コンテナーへの VMM サーバー登録を行ってください。
2. VMM VM 上に 1 つまたは複数のクラウドを設定し、保護する VM を含む Hyper-V ホストをそれらのクラウドに追加します。
3. Azure Site Recovery でクラウドのための保護設定を構成します。ソースの場所とターゲットの場所で、単一の VMM サーバーの名前を指定します。ネットワーク マッピングを構成する場合、保護する VM を含むクラウドの VM ネットワークを、レプリケート先のクラウドの VM ネットワークにマップします。
4. 両方のクラウドが同じサーバーにあるので、レプリケーションの方法として**ネットワーク経由**を使用して、保護する VM のレプリケーションを有効にします。
4. Hyper-V マネージャー コンソールで、VMM VM を含む Hyper-V ホスト上での Hyper-V レプリカを有効にし、それから VM 上のレプリケーションを有効にします。Site Recovery で保護されているクラウドに対して VMM 仮想マシンを追加しないようにしてください。これは、Hyper-V レプリカの設定が Site Recovery によってオーバーライドされないようにするためです。
5. 復旧計画を作成する場合は、同じ VMM サーバーをソースとターゲットに指定します。 

障害が発生したら、次のようにして Hyper-V VM 上のワークロードを回復します。

1. Hyper-V マネージャーを使用して、計画されたフェールオーバーとして、手動でレプリカ VMM VM をセカンダリ サイトにフェールオーバーさせます。
2. VMM VM が復旧後、セカンダリ サイトから Hyper-V Recovery Manager にログインし、VM の計画外フェールオーバーをプライマリ サイトからセカンダリ サイトに行います。
3. 計画外のフェールオーバーが完了すると、ユーザーはプライマリ サイトにあるすべてのリソースにアクセスできます。

ワークロードをフェールオーバーするには、VMM VM を手動でセカンダリ サイトにフェールオーバーする必要があります。

![スタンドアロンの仮想 VMM サーバー](./media/site-recovery-single-vmm/single-vmm-standalone.png)

### ストレッチ クラスターの単一 VMM サーバーでのサイト間レプリケート

スタンドアロン VMM サーバーを仮想マシンとしてデプロイしセカンダリ サイトにレプリケートするのではなく、Windows のフェールオーバー クラスターで VM としてデプロイすることで VMM の可用性を高め、それによりワークロードの回復力とハードウェアの障害に対する保護が提供されます。Site Recovery でデプロイするため、VMM は地理的に離れたサイトにまたがるストレッチ クラスターでデプロイする必要があります。これを行うには、次の手順を実行します。

1. Windows フェールオーバー クラスターの仮想マシン上に VMM をインストールし、セットアップ中にサーバーを可用性が高い状態で実行するオプションを選択します。
2. VMM によって使用される SQL Server インスタンスは SQL Server AlwaysOn 可用性グループでレプリケートする必要があります。それにより、セカンダリ サイト内にデータベースのレプリカができます。 

障害が発生すると、VMM サーバーと対応する SQL Server データベースがフェールオーバーされ、セカンダリ サイトからアクセスすることができます。

![クラスター化された仮想 VMM サーバー](./media/site-recovery-single-vmm/single-vmm-cluster.png)




 

<!---HONumber=AcomDC_1203_2015-->