---
title: "Site Recovery を使用した、セカンダリ データ センターにレプリケートされた Hyper-V VM のフェールオーバーとフェールバック | Microsoft Docs"
description: "Azure Site Recovery を使用して、Hyper-V VM をセカンダリ オンプレミス サイトにフェールオーバーし、プライマリ サイトにフェールバックする方法を説明します。"
services: site-recovery
documentationcenter: 
author: rayne-wiselman
manager: carmonm
editor: 
ms.assetid: 44a662fa-2e7a-4996-86df-fdd6d6f5dedf
ms.service: site-recovery
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: storage-backup-recovery
ms.date: 09/16/2017
ms.author: raynew
ms.translationtype: HT
ms.sourcegitcommit: c3a2462b4ce4e1410a670624bcbcec26fd51b811
ms.openlocfilehash: 8f139070de99c4249207d048d445e86dd41e9060
ms.contentlocale: ja-jp
ms.lasthandoff: 09/25/2017

---

# <a name="fail-over-and-fail-back-hyper-v-vms-replicated-to-your-secondary-on-premises-site"></a>セカンダリ オンプレミス サイトにレプリケートされた Hyper-V VM のフェールオーバーとフェールバック

[Azure Site Recovery](site-recovery-overview.md) サービスは、オンプレミスのマシンおよび Azure の仮想マシン (VM) のレプリケーション、フェールオーバー、およびフェールバックを管理し、調整します。

このチュートリアルでは、System Center Virtual Machine Manager (VMM) クラウドで管理されている Hyper-V VM を、セカンダリ VMM サイトにフェールオーバーする方法について説明します。 フェールオーバー後は、可能なときにオンプレミス サイトにフェールバックします。 このチュートリアルで学習する内容は次のとおりです。

> [!div class="checklist"]
> * Hyper-V VM をプライマリ VMM クラウドからセカンダリ VMM クラウドにフェールオーバーする
> * セカンダリ サイトからプライマリ サイトに再保護し、フェールバックする
> * 必要に応じてプライマリからセカンダリへのレプリケーションを再度開始する

## <a name="overview"></a>概要

フェールオーバーとフェールバックには 3 つの段階があります。

1. **セカンダリ サイトへのフェールオーバー**: マシンをプライマリ サイトからセカンダリ サイトにフェールオーバーします。
2. **セカンダリ サイトからのフェールバック**: VM をセカンダリからプライマリにレプリケートし、計画されたフェールオーバーを実行してフェールバックします。
3. 計画されたフェールオーバーの後、必要に応じてプライマリからセカンダリへのレプリケーションを再度開始します。


## <a name="fail-over-to-a-secondary-site"></a>セカンダリ サイトへのフェールオーバー

### <a name="failover-prerequisites"></a>フェールオーバーの前提条件

すべてが正しく動作することを確認するための[ディザスター リカバリーのテスト](tutorial-dr-drill-secondary.md)が完了している必要があります。


### <a name="run-a-failover-from-primary-to-secondary"></a>プライマリからセカンダリへのフェールオーバーを実行する

Hyper-V VM の通常のフェールオーバーまたは計画されたフェールオーバーを実行できます。

- 通常のフェールオーバーは、予期しない停電時に使用します。 このフェールオーバーを実行すると、Site Recovery はセカンダリ サイトに VM を作成し、電源を投入します。 特定の復旧ポイントに対してフェールオーバーを実行します。 使用する復旧ポイントによってはデータの損失が発生する場合があります。
- 計画されたフェールオーバーは、メンテナンスや想定されている停電の間に使用できます。 このオプションではデータの損失は発生しません。 計画されたフェールオーバーがトリガーされると、ソース VM はシャット ダウンされます。 同期されていないデータが同期されてから、フェールオーバーがトリガーされます。 
- 
この手順では、通常のフェールオーバーを実行する方法について説明します。


1. **[設定]**  >  **[レプリケートされたアイテム]** で、[VM] > **[フェールオーバー]** の順にクリックします。
2. **[フェールオーバー]** で、フェールオーバーする**復旧ポイント**を選択します。 次のいずれかのオプションを使うことができます。
    - **[最新]** (既定値): 最初に、Site Recovery に送信されるすべてのデータを処理します。 フェールオーバー後に作成されたレプリカ VM は、フェールオーバーがトリガーされた時点で Site Recovery にレプリケートされたすべてのデータを保持しているため、RPO (目標復旧時点) を最も低くすることができます。
    - **[Latest processed]\(最新の処理\)**: Site Recovery で処理された最新の復旧ポイントに VM をフェールオーバーします。 このオプションを使用すると、未処理のデータの処理に時間がかからないため、RTO (目標復旧時間) を低くできます。
    - **[最新のアプリ整合性]**: Site Recovery によって処理されたアプリ整合性の最新の復旧ポイントに VM をフェールオーバーします。 
3. 暗号化キーはこのシナリオには関係ありません。
4. Site Recovery でフェールオーバーをトリガーする前にそのソース VM をシャットダウンする場合は、**[フェールオーバーを開始する前にマシンをシャットダウンします]** を選択します。 Site Recovery はフェールオーバーをトリガーする前に、セカンダリ サイトに送信されていないオンプレミス データの同期を試行します。 シャットダウンが失敗したとしても、フェールオーバーは続行されることに注意してください。 フェールオーバーの進行状況は **[ジョブ]** ページで確認できます。
5. ここで、セカンダリ VMM クラウド内の VM を確認できます。
6. VM を確認したら、フェールオーバーを**コミット**します。 これにより、利用可能なすべての復旧ポイントが削除されます。

> [!WARNING]
> **進行中のフェールオーバーを取り消さないでください**。フェールオーバーが開始する前に VM のレプリケーションが停止します。 進行中のフェールオーバーを取り消すと、フェールオーバーは停止しますが、VM は二度とレプリケートされません。  


## <a name="reprotect-and-fail-back-from-secondary-to-primary"></a>セカンダリからプライマリへの再保護とフェールバック

### <a name="prerequisites-for-failback"></a>フェールバックの前提条件

フェールバックを完了するには、プライマリとセカンダリ VMM サーバーが Site Recovery に接続されている必要があります。


### <a name="reprotect-and-fail-back"></a>再保護とフェールバック

プライマリ サイトからセカンダリ サイトへのレプリケートを開始し、プライマリ サイトにフェールバックします。 プライマリ サイトで VM が再度実行された後で、セカンダリ サイトにもう一度レプリケートできます。  

1. **[設定]**  >  **[レプリケートされたアイテム]** で VM をクリックし、**[レプリケーションの反転]** を有効にします。 VM はプライマリ サイトにレプリケートを開始します。
2. [VM] > **[計画されたフェールオーバー]** の順にクリックします。
3. **[計画されたフェールオーバーの確認]** で、フェールオーバーの方向 (セカンダリ VMM クラウドから) を確認し、ソースとターゲットの場所を選択します。 
4. **[データの同期]** で、同期の方法を指定します。
    - **[フェールオーバーの前にデータを同期する (差分変更のみを同期する)]** - VM をシャットダウンせずに同期するため、VM のダウンタイムが最小限に抑えられます。 これは次のように動作します。
        - レプリカ VM のスナップショットを取得し、プライマリ Hyper-V ホストにコピーします。 レプリカ VM は稼働し続けます。
        - 新しい変更が行われないように、レプリカ VM をシャットダウンします。 差分変更の最終的なセットがプライマリ サイトに転送され、プライマリ サイトの VM が開始されます。
    - **[フェールオーバー中にのみデータを同期する (すべてダウンロードする)]**- セカンダリ サイトの実行期間が長い場合にこのオプションを使用します。 ディスクの複数の変更を想定してチェックサムの計算に時間を費やさないようにしているため、このオプションを選択すると高速になります。 このオプションでは、ディスク ダウンロードを実行します。 これはプライマリ VM が削除された場合にも便利です。
5. 暗号化キーはこのシナリオには関係ありません。
6. フェールオーバーを開始します。 フェールオーバーの進行状況は、 **[ジョブ]** タブで確認できます。
7. フェールオーバー前のデータ同期を選択した場合、初回のデータ同期が完了し、セカンダリ サイトのレプリカ VM をシャットダウンする準備ができた時点で、**[ジョブ]** > [planned failover job name]\(計画されたフェールオーバーのジョブ名\) > **[フェールオーバーの実行]** の順にクリックします。 これにより、セカンダリ VM がシャット ダウンされ、最新の変更がプライマリ サイトに転送され、プライマリ VM が開始されます。
8. プライマリ VMM クラウドで、VM が使用可能であることを確認します。
9. プライマリ VM は、この時点ではコミット保留中の状態です。 **[コミット]** をクリックして、フェールオーバーをコミットします。
10. プライマリ VM をセカンダリ サイトに再度レプリケーションする場合は、**[レプリケーションの反転]** を有効にします。


> [!NOTE]
> レプリケーションの反転では、レプリカ VM が停止してから発生した変更のみがレプリケートされ、差分変更のみが送信されます。


