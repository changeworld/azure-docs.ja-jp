---
title: FTP サーバーに接続する
description: Azure Logic Apps を使用して、FTP サーバーのファイルを作成、監視、管理するタスクおよびワークフローを自動化する
services: logic-apps
ms.suite: integration
ms.reviewer: klam, logicappspm
ms.topic: conceptual
ms.date: 12/15/2019
tags: connectors
ms.openlocfilehash: 94ca609d9dc070e6e2b4dc878ecd8dfaf9331ede
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/28/2020
ms.locfileid: "77648174"
---
# <a name="create-monitor-and-manage-ftp-files-by-using-azure-logic-apps"></a>Azure Logic Apps を使用して FTP ファイルを作成、監視、および管理する

Azure Logic Apps と FTP コネクタを使用すると、FTP サーバー上のアカウント経由でファイルを作成、監視、送信、および受信する自動化されたタスクやワークフローを作成できます。その他、次のようなアクションを実行できます。

* ファイルの追加または変更を監視します。
* ファイルの取得、作成、コピー、更新、一覧、および削除を行います。
* ファイルの内容とメタデータを取得します。
* アーカイブをフォルダーに抽出します。

FTP サーバーからの応答を取得するトリガーを使用し、その出力を他のアクションから使用可能にすることができます。 ロジック アプリから実行アクションを使用して、FTP サーバー上のファイルを管理できます。 また、FTP アクションからの出力を他のアクションで使用するようにもできます。 たとえば、FTP サーバーから定期的にファイルを取得する場合は、Office 365 Outlook コネクタまたは Outlook.com コネクタを使用して、これらのファイルとその内容に関する電子メールを送信できます。 ロジック アプリを初めて使用する場合は、「[Azure Logic Apps とは](../logic-apps/logic-apps-overview.md)」を参照してください。

## <a name="limitations"></a>制限事項

* FTP コネクタは明示的 FTP over SSL (FTPS) のみをサポートし、暗黙的 FTPS とは互換性がありません。

* 既定では、FTP アクションは *50 MB 以下*のファイルの読み取りまたは書き込みが可能です。 50 MB を超えるファイルを処理するために、FTP アクションでは、[メッセージのチャンク](../logic-apps/logic-apps-handle-large-messages.md)がサポートされています。 **ファイルのコンテンツの取得**アクションでは、暗黙的にチャンクが使用されます。

* FTP トリガーではチャンクはサポートされていません。 ファイルのコンテンツを要求すると、トリガーによって 50 MB 以下のファイルのみが選択されます。 50 MB より大きいファイルを取得するには、次のパターンに従います。

  * **[When a file is added or modified (properties only)]\(ファイルの追加または変更時 (プロパティのみ)\)** などのファイルのプロパティが返される FTP トリガーを使用します。

  * FTP トリガーの **ファイルのコンテンツの取得**アクションに従います。これにより、暗黙的にチャンクを使用してファイル全体が読み取られます。

* オンプレミスの FTP サーバーがある場合は、オンプレミスのデータ ゲートウェイを使用せずにオンプレミスのデータ ソースにアクセスできるようにするために、[統合サービス環境 (ISE)](../logic-apps/connect-virtual-network-vnet-isolated-environment-overview.md) を作成するか、または [Azure App Service ハイブリッド接続](../app-service/app-service-hybrid-connections.md)を使用することを検討してください。

## <a name="how-ftp-triggers-work"></a>FTP トリガーの動作

FTP トリガーは、FTP ファイル システムをポーリングし、前回のポーリング以降に変更されたファイルを探すことによって動作します。 一部のツールでは、ファイルが変更されたときにタイムスタンプを保持できます。 これらの場合は、トリガーが動作できるように、この機能を無効にする必要があります。 一般的な設定をいくつか次に示します。

| SFTP クライアント | アクション |
|-------------|--------|
| Winscp | **[オプション]**  >  **[ユーザー設定]**  >  **[転送]**  >  **[編集]**  >  **[Preserve timestamp] (タイムスタンプを保持する)**  >  **[無効]** に移動する |
| FileZilla | **[転送]**  >  **[Preserve timestamps of transferred files] (転送されたファイルのタイムスタンプを保持する)**  >  **[無効]** に移動する |
|||

トリガーによって新しいファイルが検出されると、トリガーはその新しいファイルが完了していて、すべて書き込まれていることを確認します。 たとえば、トリガーがファイル サーバーを確認している際に、ファイルの進行状態が変化する場合があります。 部分的に書き込まれたファイルが返されることなないように、トリガーは最新の変更を含むファイルのタイムスタンプをメモしますが、すぐにそのファイルを返すことはありません。 トリガーは、もう一度サーバーをポーリングしてファイルを返します。 場合によっては、この動作によって、最大でトリガーのポーリング間隔が 2 倍となる遅延が生じる場合があります。

## <a name="prerequisites"></a>前提条件

* Azure サブスクリプション。 Azure サブスクリプションがない場合は、[無料の Azure アカウントにサインアップ](https://azure.microsoft.com/free/)してください。

* FTP ホスト サーバー アドレスとアカウントの資格情報

  FTP コネクタでは、FTP サーバーがインターネットからアクセス可能であり、かつ*パッシブ* モードで動作するように設定されている必要があります。 資格情報があることで、ロジック アプリは接続を作成し、FTP アカウントにアクセスすることができます。

* [ロジック アプリの作成方法](../logic-apps/quickstart-create-first-logic-app-workflow.md)に関する基本的な知識

* FTP アカウントにアクセスするためのロジック アプリ。 FTP トリガーから開始するには、[空のロジック アプリを作成します](../logic-apps/quickstart-create-first-logic-app-workflow.md)。 FTP アクションを使用するには、 **[繰り返し]** トリガーなどの別のトリガーでロジック アプリを起動します。

## <a name="connect-to-ftp"></a>FTP に接続する

[!INCLUDE [Create connection general intro](../../includes/connectors-create-connection-general-intro.md)]

1. [Azure portal](https://portal.azure.com) にサインインし、ロジック アプリ デザイナーでお客様のロジック アプリを開きます。

1. 空のロジック アプリの場合は、検索ボックスに、フィルターとして「`ftp`」と入力します。 **[トリガー]** 一覧から、使用するトリガーを選択します。

   または

   既存のロジック アプリの場合は、アクションを追加する最後のステップの下で **[新しいステップ]** を選択してから、 **[アクションを追加する]** を選択します。 検索ボックスに、フィルターとして「`ftp`」と入力します。 **[アクション]** 一覧から、目的のアクションを選択します。

   ステップの間にアクションを追加するには、ステップ間の矢印の上にポインターを移動します。 表示されるプラス記号 ( **+** ) を選択してから、 **[アクションの追加]** を選択します。

1. 接続情報を入力し、 **[作成]** を選択します。

1. 選択したトリガーまたはアクションのための情報を指定し、ロジック アプリのワークフローの構築を続けます。

## <a name="examples"></a>例

<a name="file-added-modified"></a>

### <a name="add-ftp-trigger"></a>FTP トリガーを追加する

**[ファイルが追加または変更されたとき (プロパティのみ)]** トリガーでは、FTP サーバーでファイルが追加または変更されたことが検出されると、ロジック アプリ ワークフローが開始されます。 たとえば、ファイルのコンテンツをチェックし、内容が特定の条件を満たしているかどうかに基づいてその内容を取得するかどうかを決定する条件を追加できます。 最後に、ファイルのコンテンツを取得するアクションを追加し、その内容を SFTP サーバー上の異なるフォルダーに格納できます。

たとえば、このトリガーを使用して、FTP フォルダーに顧客からの注文を表す新しいファイルがあるかどうかを監視できます。 次に、 **[ファイルのメタデータの取得]** などの FTP アクションを使用して、その新しいファイルのプロパティを取得してから、 **[ファイルのコンテンツの取得]** を使用して、さらに処理を行うためにそのファイルのコンテンツを取得し、その注文を注文データベースに格納することができます。

**[ファイルが追加または変更されたとき (プロパティのみ)]** トリガーの使用方法を示す例を次に示します。

1. [Azure portal](https://portal.azure.com) にサインインし、ロジック アプリ デザイナーでロジック アプリを開きます (まだ開いていない場合)。

1. 空のロジック アプリの場合は、検索ボックスに、フィルターとして「`ftp`」と入力します。 トリガーの一覧で次のトリガーを選択します:**ファイルが追加または変更されたとき (プロパティのみ)**

   ![FTP トリガーを見つけて選択する](./media/connectors-create-api-ftp/select-ftp-trigger-logic-app.png)

1. 接続で必要な詳細を指定し、 **[作成]** を選択します。

   既定では、このコネクタからファイルがテキスト形式で転送されます。 エンコードが使用されている状況など、バイナリ形式でファイルを転送する場合は、 **[バイナリ転送]** を選択してください。

   ![FTP サーバーへの接続を作成する](./media/connectors-create-api-ftp/create-ftp-connection-trigger.png)

1. **[フォルダー]** ボックスでフォルダー アイコンを選択すると、一覧が表示されます。 新しいファイルまたは編集されたファイルを監視するフォルダーを見つけるには、右向き矢印 ( **>** ) を選択し、そのフォルダーを参照して選択します。

   ![監視するフォルダーを見つけて選択する](./media/connectors-create-api-ftp/select-folder-ftp-trigger.png)

   選択されたフォルダーが **[フォルダー]** ボックスに表示されます。

   ![選択されたフォルダーが [フォルダー] プロパティに表示される](./media/connectors-create-api-ftp/selected-folder-ftp-trigger.png)

1. ロジック アプリを保存します。 デザイナーのツール バーで、 **[保存]** を選択します。

これで、ロジック アプリにトリガーが設定されたので、ロジック アプリが新しいファイルまたは編集されたファイルを見つけたときに実行するアクションを追加します。 この例の場合は、新しい内容または更新された内容を取得する FTP アクションを追加できます。

<a name="get-content"></a>

### <a name="add-ftp-action"></a>FTP アクションを追加する

**[ファイルのメタデータの取得]** アクションでは、FTP サーバー上のファイルのプロパティが取得されます。また、 **[ファイルのコンテンツの取得]** アクションでは、FTP サーバー上のファイルに関する情報に基づいてそのファイルのコンテンツが取得されます。 たとえば、前の例のトリガーとこれらのアクションを追加して、ファイルが追加または編集された後にそのファイルのコンテンツを取得できます。

1. トリガーまたはその他の任意のアクションで、 **[新しいステップ]** を選択します。

1. 検索ボックスに、フィルターとして「`ftp`」と入力します。 アクションの一覧で、アクション **ファイルのメタデータを取得する**

   ![[ファイルのメタデータの取得] アクションを選択する](./media/connectors-create-api-ftp/select-get-file-metadata-ftp-action.png)

1. 既に FTP サーバーへの接続とアカウントがある場合は、次の手順に進みます。 それ以外の場合は、その接続に必要な詳細を指定し、 **[作成]** を選択します。

   ![FTP サーバーの接続を作成する](./media/connectors-create-api-ftp/create-ftp-connection-action.png)

1. **[ファイルのメタデータの取得]** アクションが表示されたら、 **[ファイル]** ボックスの内部をクリックして動的なコンテンツの一覧を表示します。 これで、前の手順の出力のプロパティを選択できるようになります。 動的なコンテンツの一覧で、 **[ファイルのメタデータの取得]** の下にある **[List of Files Id]\(ファイル ID の一覧\)** プロパティを選択します。このプロパティでは、ファイルが追加または更新されたコレクションが参照されます。

   ![[List of Files Id]\(ファイル ID の一覧\) プロパティを探して選択する](./media/connectors-create-api-ftp/select-list-of-files-id-output.png)

   **[List of Files Id]\(ファイル ID の一覧\)** プロパティが **[ファイル]** ボックスに表示されるようになりました。

   ![選択された [List of Files Id]\(ファイル ID の一覧\) プロパティ](./media/connectors-create-api-ftp/selected-list-file-ids-ftp-action.png)

1. ここで、次の FTP アクションを追加します。**ファイルの内容を取得する**

   ![[ファイルのコンテンツの取得] アクションを探して選択する](./media/connectors-create-api-ftp/select-get-file-content-ftp-action.png)

1. **[ファイルのコンテンツの取得]** アクションが表示されたら、 **[ファイル]** ボックスの内部をクリックして動的なコンテンツの一覧を表示します。 これで、前の手順の出力のプロパティを選択できるようになります。 動的なコンテンツの一覧で、 **[ファイルのメタデータの取得]** の下にある **[ID]** プロパティを選択します。このプロパティは、追加または更新されたファイルを参照します。

   ![[ID] プロパティを探して選択する](./media/connectors-create-api-ftp/get-file-content-id-output.png)

   **[ID]** プロパティが **[ファイル]** ボックスに表示されるようになりました。

   ![選択された [ID] プロパティ](./media/connectors-create-api-ftp/selected-get-file-content-id-ftp-action.png)

1. ロジック アプリを保存します。

## <a name="test-your-logic-app"></a>ロジック アプリをテストする

想定されるコンテンツがワークフローから返されることを確認するには、アップロードまたは更新されたファイルからコンテンツを送信する別のアクションを追加します。

1. **[ファイルのコンテンツの取得]** アクションで、ファイルのコンテンツを送信するためのアクションを追加します。 この例では、Office 365 Outlook の **[メールの送信]** アクションを追加します。

   ![メールを送信するアクションを追加する](./media/connectors-create-api-ftp/select-send-email-action.png)

1. アクションが表示されたら、情報を入力し、テスト対象のプロパティを含めます。 たとえば、 **[ファイルのコンテンツ]** プロパティを含めます。このプロパティは、 **[ファイルのコンテンツの取得]** セクションで **[表示数を増やす]** を選択すると、動的なコンテンツの一覧に表示されます。

   ![メール アクションに関する情報を指定する](./media/connectors-create-api-ftp/selected-send-email-action.png)

1. ロジック アプリを保存します。 ロジック アプリを実行およびトリガーするには、ツールバーの **[実行]** を選択し、ロジック アプリで監視する FTP フォルダーにファイルを追加します。

## <a name="connector-reference"></a>コネクタのレファレンス

コネクタの Swagger ファイルに記述される、トリガー、アクション、制限などのこのコネクタの技術的詳細については、[コネクタの参照ページ](https://docs.microsoft.com/connectors/ftpconnector/)を参照してください。

> [!NOTE]
> [統合サービス環境 (ISE)](../logic-apps/connect-virtual-network-vnet-isolated-environment-overview.md) のロジック アプリの場合、このコネクタの ISE のラベルが付いたバージョンでは、代わりに [ISE メッセージ制限](../logic-apps/logic-apps-limits-and-config.md#message-size-limits)が使用されます。

## <a name="next-steps"></a>次のステップ

* 他の[Logic Apps コネクタ](../connectors/apis-list.md)を確認します。
