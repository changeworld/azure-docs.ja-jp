---
title: Azure IoT Hub Device Provisioning Service からデバイスの登録を抹消する
description: Azure IoT Hub Device Provisioning Service (DPS) でデバイスの登録を抹消してプロビジョニングを防ぐ方法
author: wesmc7777
ms.author: wesmc
ms.date: 04/05/2018
ms.topic: conceptual
ms.service: iot-dps
services: iot-dps
manager: timlt
ms.openlocfilehash: af883da67f4e1bc819514e88ff480526e16124db
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/27/2020
ms.locfileid: "74974923"
---
# <a name="how-to-disenroll-a-device-from-azure-iot-hub-device-provisioning-service"></a>Azure IoT Hub Device Provisioning サービスからデバイスの登録を抹消する方法

IoT ソリューションなどの重要なシステムでは、デバイスの資格情報を適切に管理することが極めて重要です。 このようなシステムでは、デバイスの資格情報 (Shared Access Aignatures (SAS) トークンと X.509 証明書のいずれでも) が侵害された場合にデバイスのアクセスを取り消す方法について明確なプランを立てることが最善の方法です。 

デバイス プロビジョニング サービスに登録すると、デバイスを[自動プロビジョニング](concepts-auto-provisioning.md)できます。 プロビジョニングされたデバイスは、IoT Hub で登録されているデバイスで、最初の[デバイス ツイン](~/articles/iot-hub/iot-hub-devguide-device-twins.md)状態を受け取り、利用統計情報の報告を開始できます。 この記事では、プロビジョニング サービス インスタンスからデバイスの登録を抹消して、今後プロビジョニングが行われないようにする方法について説明します。

> [!NOTE] 
> アクセスを取り消すデバイスの再試行ポリシーに注意してください。 たとえば、無限に再試行するポリシーを持つデバイスでは、プロビジョニング サービスへの登録が継続的に試行される場合があります。 その状況では、サービス リソースが消費され、パフォーマンスに影響を及ぼす可能性があります。

## <a name="blacklist-devices-by-using-an-individual-enrollment-entry"></a>個別登録エントリを使用してデバイスをブラックリストに追加する

個別登録は、単一のデバイスに適用され、(実際の TPM または仮想 TPM 内の) X.509 証明書や SAS トークンを構成証明メカニズムとして使用できます (SAS トークンを構成証明メカニズムとして使用するデバイスは、個別登録でのみプロビジョニングできます)。個別登録を持つデバイスをブラックリストに追加するには、デバイスの登録エントリを無効にするか削除します。 

デバイスをブラックリストに一時的に追加するには、デバイスの登録エントリを無効にします。 

1. Azure Portal にログインし、左側のメニューにある **[すべてのリソース]** を選択します。
2. リソースの一覧から、デバイスをブラックリストに追加するプロビジョニング サービスを選択します。
3. 目的のプロビジョニング サービスで、 **[登録の管理]** を選択し、 **[個々の登録]** タブを選択します。
4. ブラックリストに追加するデバイスの登録エントリを選択します。 

    ![個々の登録を選択する](./media/how-to-revoke-device-access-portal/select-individual-enrollment.png)

5. 登録ページで下方にスクロールして、 **[エントリの有効化]** スイッチで **[無効にする]** を選択し、 **[保存]** を選択します。  

   ![ポータルで個別登録エントリを無効にする](./media/how-to-revoke-device-access-portal/disable-individual-enrollment.png)

デバイスをブラックリストに永続的に追加するには、デバイスの登録エントリを削除します。

1. Azure Portal にログインし、左側のメニューにある **[すべてのリソース]** を選択します。
2. リソースの一覧から、デバイスをブラックリストに追加するプロビジョニング サービスを選択します。
3. 目的のプロビジョニング サービスで、 **[登録の管理]** を選択し、 **[個々の登録]** タブを選択します。
4. ブラックリストに追加するデバイスの登録エントリの隣にあるチェック ボックスをオンにします。 
5. ウィンドウの上部の **[削除]** を選択した後 **[はい]** を選択して登録の削除を確定します。 

   ![ポータルで個別登録エントリを削除する](./media/how-to-revoke-device-access-portal/delete-individual-enrollment.png)


手順を終了すると、個別登録の一覧からエントリが削除されたことがわかります。  

## <a name="blacklist-an-x509-intermediate-or-root-ca-certificate-by-using-an-enrollment-group"></a>登録グループを使用して、X.509 中間証明書またはルート CA 証明書をブラックリストに追加する

X.509 証明書は通常、信頼する証明書チェーンに配置されます。 チェーンのいずれかの段階で証明書が侵害されると、信頼関係が消失します。 その証明書を含むチェーンのダウンストリームでの Device Provisioning Service によるデバイスのプロビジョニングを防ぐために、その証明書をブラックリストに追加する必要があります。 X.509 証明書の詳細情報と、プロビジョニング サービスでの X.509 証明書の使用方法については、「[X.509 証明書](./concepts-security.md#x509-certificates)」をご覧ください。 

登録グループは、同じ中間 CA またはルート CA によって署名された X.509 証明書の構成証明メカニズムを共有するデバイスのエントリです。 登録グループのエントリは、中間またはルート CA に関連付けられた X.509 証明書を使用して構成されます。 さらに、エントリは、証明書チェーン内のその証明書を持つデバイスで共有される構成値 (ツイン状態や IoT ハブ接続など) を使用して構成されます。 証明書をブラックリストに追加するには、証明書の登録グループを無効にするか削除します。

証明書をブラックリストに一時的に追加するには、証明書の登録グループを無効にします。 

1. Azure Portal にログインし、左側のメニューにある **[すべてのリソース]** を選択します。
2. リソースの一覧から、署名証明書をブラックリストに追加するプロビジョニング サービスをクリックします。
3. 目的のプロビジョニング サービスで、 **[登録の管理]** を選択し、 **[登録グループ]** タブを選択します。
4. ブラックリストに追加する証明書を使用して登録グループを選択します。
5. **[エントリの有効化]** スイッチを **[無効にする]** を選択し、 **[保存]** を選択します。  

   ![ポータルで登録グループ エントリを無効にする](./media/how-to-revoke-device-access-portal/disable-enrollment-group.png)

    
証明書をブラックリストに永続的に追加するには、証明書の登録グループを削除します。

1. Azure Portal にログインし、左側のメニューにある **[すべてのリソース]** を選択します。
2. リソースの一覧から、デバイスをブラックリストに追加するプロビジョニング サービスを選択します。
3. 目的のプロビジョニング サービスで、 **[登録の管理]** を選択し、 **[登録グループ]** タブを選択します。
4. ブラックリストに追加する証明書の登録グループの隣にあるチェックボックスをオンにします。 
5. ウィンドウの上部の **[削除]** を選択した後 **[はい]** を選択して登録グループの削除を確定します。 

   ![ポータルで登録グループ エントリを削除する](./media/how-to-revoke-device-access-portal/delete-enrollment-group.png)

手順を終了すると、登録グループの一覧からエントリが削除されたことがわかります。  

> [!NOTE]
> 証明書の登録グループを削除しても、証明書チェーンの上位のルート証明書や別の中間証明書に有効な登録グループが存在する場合、証明書チェーン内にその証明書を持つデバイスでは引き続き登録が可能です。

## <a name="blacklist-specific-devices-in-an-enrollment-group"></a>登録グループ内の特定のデバイスをブラックリストに追加する

X.509 構成証明メカニズムを実装するデバイスでは、デバイスの証明書チェーンと秘密キーを使用して認証を行います。 デバイスが接続され、Device Provisioning Service によって認証されるとき、サービスは、まず、デバイスの資格情報と一致する個々の登録を検索します。 次に、サービスは、登録グループを検索して、デバイスをプロビジョニングできるかどうかを決定します。 デバイスの無効になっている個々の登録が検出された場合、サービスはデバイスの接続を阻止します。 サービスは、デバイスの証明書チェーンに中間またはルート CA の有効な登録グループが存在する場合でも、接続を阻止します。 

登録グループの個別のデバイスをブラックリストに追加するには、次の手順を実行します。

1. Azure Portal にログインし、左側のメニューにある **[すべてのリソース]** を選択します。
2. リソースの一覧から、ブラックリストに追加するデバイスの登録グループを含むプロビジョニング サービスを選択します。
3. 目的のプロビジョニング サービスで、 **[登録の管理]** を選択し、 **[個々の登録]** タブを選択します。
4. 上部にある **[個別登録の追加]** ボタンをクリックします。 
5. **[登録の追加]** ページで、デバイスの構成証明**メカニズム**として **X.509** を選択します。

    デバイス証明書をアップロードし、ブラックリストに追加するデバイスの ID を入力します。 証明書として、デバイスにインストールされている署名付きのエンド エンティティ証明書を使用します。 デバイスでは、署名付きのエンド エンティティ証明書を使用して認証が行われます。

    ![ブラックリストにあるデバイスのプロパティを設定します。](./media/how-to-revoke-device-access-portal/disable-individual-enrollment-in-enrollment-group-1.png)

6. **[登録の追加]** ページで下方にスクロールして、 **[エントリの有効化]** スイッチで **[無効にする]** を選択し、 **[保存]** を選択します。 

    [![ポータルで無効にした個々の登録エントリを使用して、グループ登録のデバイスを無効にする](./media/how-to-revoke-device-access-portal/disable-individual-enrollment-in-enrollment-group.png)](./media/how-to-revoke-device-access-portal/disable-individual-enrollment-in-enrollment-group.png#lightbox)

登録の作成に成功すると、 **[個々の登録]** タブに無効になっているデバイス登録が表示されます。 

## <a name="next-steps"></a>次のステップ

登録解除も広範なプロビジョニング解除プロセスの一部です。 デバイスのプロビジョニング解除には、プロビジョニング サービスの登録抹消と IoT hub からの登録解除の両方が含まれます。 このプロセスの詳細については、「[自動プロビジョニングされた以前のデバイスのプロビジョニングを解除する方法](how-to-unprovision-devices.md)」を参照してください。 

