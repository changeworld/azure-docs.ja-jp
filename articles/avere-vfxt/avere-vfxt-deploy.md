---
title: Avere vFXT for Azure をデプロイする
description: Azure で Avere vFXT クラスターをデプロイする手順
author: ekpgh
ms.service: avere-vfxt
ms.topic: conceptual
ms.date: 01/13/2020
ms.author: rohogue
ms.openlocfilehash: e70d1dfebcf25ee8f4e90a062cee6dd72a663e02
ms.sourcegitcommit: 87781a4207c25c4831421c7309c03fce5fb5793f
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 01/23/2020
ms.locfileid: "76547525"
---
# <a name="deploy-the-vfxt-cluster"></a>vFXT クラスターのデプロイ

この手順では、Azure Marketplace から利用できるデプロイ ウィザードの使い方について説明します。 ウィザードを使うと、Azure Resource Manager テンプレートを使用してクラスターが自動的にデプロイされます。 フォームにパラメーターを入力して **[作成]** をクリックすると、Azure によって自動的に次のタスクが実行されます。

* クラスター コントローラーを作成します。これは、クラスターをデプロイして管理するために必要なソフトウェアを含んだ基本的な VM です。
* リソース グループと仮想ネットワーク インフラストラクチャを設定します。これには新しい要素の作成も含まれます。
* クラスター ノード VM を作成し、それらを Avere クラスターとして構成します。
* 要求された場合は、新しい Azure BLOB コンテナーを作成し、それをクラスター コア ファイラーとして構成します。

このドキュメントの指示に従うことで、以下の図に示されているように、仮想ネットワーク、サブネット、クラスター コントローラー、vFXT クラスターを準備することができます。 この図で示す Azure BLOB コア ファイラーには、(非表示の新しいストレージ アカウント内の) 新しい BLOB ストレージ コンテナーと、サブネット内にある Microsoft ストレージ用のサービス エンドポイントが含まれています。

![Avere クラスター コンポーネントを含む 3 つの同心四角形を示す図。 'リソース グループ' というラベルの付いた外側の四角形には、'Blob Storage (オプション)' というラベルの付いた六角形が含まれています。 次の四角形には '仮想ネットワーク: 10.0.0.0/16' というラベルが付けられています。固有のコンポーネントは含まれません。 'サブネット:10.0.0.0/24' というラベルの付いた最も内側の四角形には、'クラスター コントローラー' というラベルの付いた VM、'vFXT ノード (vFXT クラスター)' というラベルの付いた 3 つの積み重ねられた VM、'サービス エンドポイント' というラベルの付いた 6 角形が含まれています。 サービス エンドポイント (サブネット内にある) と Blob ストレージ (サブネットおよび vnet の外側、かつリソース グループの内側にある) を接続する矢印があります。 矢印はサブネットの境界および仮想ネットワークの境界を通っています。](media/avere-vfxt-deployment.png)

作成テンプレートを使用する前に、以下の前提条件への対応が済んでいることを確認します。  

* [新しいサブスクリプション](avere-vfxt-prereqs.md#create-a-new-subscription)
* [サブスクリプション所有者のアクセス許可](avere-vfxt-prereqs.md#configure-subscription-owner-permissions)
* [vFXT クラスターのクォータ](avere-vfxt-prereqs.md#quota-for-the-vfxt-cluster)
* [ストレージ サービス エンドポイント (必要な場合)](avere-vfxt-prereqs.md#create-a-storage-service-endpoint-in-your-virtual-network-if-needed) - 既存の仮想ネットワークを使用し、Blob Storage を作成するデプロイで必要

クラスターのデプロイ手順と計画の詳細については、「[Avere vFXT システムの計画](avere-vfxt-deploy-plan.md)」と、[デプロイの概要](avere-vfxt-deploy-overview.md)に関するページを参照してください。

## <a name="create-the-avere-vfxt-for-azure"></a>Avere vFXT for Azure の作成

Azure portal にある作成テンプレートにアクセスします。「Avere」を検索し、"Avere vFXT for Azure ARM Template" を選択してください。

![階層リンク [新規] > [Marketplace] > [すべて] がある Azure Portal を表示するブラウザー ウィンドウ。 [すべて] ページでは、検索フィールドに "avere"という語があり、2 番目の結果である "Avere vFXT for Azure ARM Template" は赤枠で囲まれて強調表示されます。](media/avere-vfxt-template-choose.png)

[Avere vFXT for Azure ARM Template] ページで詳細を確認した後、 **[作成]** をクリックして開始します。

![Azure Marketplace (デプロイ テンプレートの先頭ページを表示したところ)](media/avere-vfxt-deploy-first.png)

テンプレートは、4 つの手順に分かれています。情報収集のための 2 つのページに加え、確認と確定の手順があります。

* 1 ページ目では、クラスター コントローラー VM の設定を収集します。
* 2 ページ目では、クラスターと追加リソース (サブネットやストレージなど) を作成するためのパラメーターを収集します。
* 3 ページ目では、選択内容の概要が示され、構成が検証されます。
* 4 ページ目では、ソフトウェアの利用規約が説明されます。また、クラスターの作成プロセスを開始できます。

## <a name="page-one-parameters---cluster-controller-information"></a>1 ページ目のパラメーター - クラスター コントローラーの情報

デプロイ テンプレートの 1 ページ目では、クラスター コントローラーに焦点を合わせています。

![デプロイ テンプレートの 1 ページ目](media/avere-vfxt-deploy-1.png)

次の情報を入力します。

* **[Cluster controller name]\(クラスター コントローラー名\)** - クラスター コントローラー VM の名前を設定します。

* **[Controller username]\(コントローラーのユーザー名\)** - クラスター コントローラー VM のルート ユーザー名を設定します。

* **[認証の種類]** - コントローラーへの接続に関して、パスワードまたは SSH 公開キーの認証を選択します。 SSH 公開キー方式が推奨されます。ヘルプが必要な場合は、[SSH キーを作成して使用する方法](https://docs.microsoft.com/azure/virtual-machines/linux/ssh-from-windows)に関するページを参照してください。

* **[パスワード]** または **[SSH 公開キー]** - お客様が選択した認証の種類に応じて、後続のフィールドで RSA 公開キーまたはパスワードを指定する必要があります。 この資格情報は、先ほど指定したユーザー名と組み合わせて使用されます。

* **[サブスクリプション]** - Avere vFXT のサブスクリプションを選択します。

* **[リソース グループ]** - Avere vFXT クラスターの既存の空のリソース グループを選択するか、[新規作成] をクリックして新しいリソース グループ名を入力します。

* **[場所]** - お客様のクラスターとリソースに使用する Azure の場所を選択します。

完了したら、 **[OK]** をクリックします。

> [!NOTE]
> クラスター コントローラーに公開 IP アドレスを割り当てたい場合は、既存のネットワークを選択するのではなく、クラスター用に新しい仮想ネットワークを作成してください。 この設定は 2 ページ目にあります。

## <a name="page-two-parameters---vfxt-cluster-information"></a>2 ページ目のパラメーター - vFXT クラスターの情報

デプロイ テンプレートの 2 ページ目では、主にクラスターのサイズ、ノードの種類、キャッシュ サイズ、ストレージのパラメーターを設定できます。

![デプロイ テンプレートの 2 ページ目](media/avere-vfxt-deploy-2.png)

* **[Avere vFXT cluster node count]\(Avere vFXT クラスターのノード数\)** - クラスターのノード数を選択します。 最小で 3 ノード、最大で 12 ノードです。

* **[Cluster administration password]\(クラスター管理パスワード\)** - クラスターを管理するためのパスワードを作成します。 このパスワードは、クラスターのコントロール パネルにサインインする際に、ユーザー名 ```admin``` と共に使用されます。コントロール パネルでは、クラスターを監視したり、クラスターの設定を構成したりできます。

* **[Avere vFXT cluster name]\(Avere vFXT クラスターの名前\)** - クラスターに一意の名前を付けます。

* **[サイズ]** - このセクションには、クラスター ノードに使用される VM の種類が表示されます。 推奨されるオプションは 1 つだけですが、 **[サイズの変更]** リンクをクリックすると、このインスタンスの種類の詳細と料金計算ツールへのリンクを含むテーブルが開きます。

* **[Cache size per node]\(ノードごとのキャッシュ サイズ\)** - クラスターのキャッシュはクラスター ノード全体にわたるため、Avere vFXT クラスターの合計キャッシュ サイズは、このサイズにノード数を掛けた値になります。

  推奨構成: Standard_E32s_v3 ノードの場合、ノードあたり 4 TB を使用します。

* **[仮想ネットワーク]** - クラスターを収容する新しい仮想ネットワークを定義するか、「[Avere vFXT システムの計画](avere-vfxt-deploy-plan.md#subscription-resource-group-and-network-infrastructure)」に記載されている前提条件を満たす既存のネットワークを選択します。

  > [!NOTE]
  > 新しい仮想ネットワークを作成すると、新しいプライベート ネットワークにアクセスできるように、クラスター コントローラーにパブリック IP アドレスが割り当てられます。 既存の仮想ネットワークを選択すると、パブリック IP アドレスなしでクラスター コントローラーが構成されます。
  >
  > 公開された IP アドレスをクラスター コントローラーに使用すると、vFXT クラスターへのアクセスは容易になりますが、わずかにセキュリティ リスクが生じます。
  >* クラスター コントローラーのパブリック IP アドレスは、プライベート サブネット外から Avere vFXT クラスターに接続するジャンプ ホストとして使用できます。
  >* コントローラーのパブリック IP アドレスがない場合は、クラスターにアクセスするために別のジャンプ ホスト、VPN 接続、または ExpressRoute が必要です。 たとえば、VPN 接続が既に構成されている既存の仮想ネットワークを使用します。
  >* パブリック IP アドレスを使ってコントローラーを作成する場合、ネットワーク セキュリティ グループでコントローラー VM を保護する必要があります。 既定では、Avere vFXT for Azure のデプロイによって、ネットワーク セキュリティ グループが作成され、パブリック IP アドレスを持つコントローラーのポート 22 のみにインバウンド アクセスが制限されます。 さらに、IP ソース アドレスの範囲にアクセスをロック ダウン (つまり、クラスター アクセスに使用するつもりのマシンからの接続のみを許可) することで、システムを保護できます。

  Azure Blob Storage のストレージ サービス エンドポイントと、クラスター サブネットの IP のみを許可するようにロックされたネットワーク アクセス制御を使用して、新しい仮想ネットワークも構成されます。

* **[サブネット]** -サブネットを選択するか、新しいサブネットを作成します。

* **[Create and use blob storage]\(Blob Storage を作成して使用する\)** - 新しい Azure BLOB コンテナーを作成して、それを新しい Avere vFXT クラスターのバックエンド ストレージとして構成する場合は **true** を選択します。 また、このオプションでは、クラスターのリソース グループに新しいストレージ アカウントが作成され、クラスター サブネット内に Microsoft ストレージ サービス エンドポイントが作成されます。
  
  既存の仮想ネットワークを指定した場合、クラスターを作成するには、事前にその仮想ネットワークにストレージ サービス エンドポイントが含まれている必要があります (詳細については、「[Avere vFXT システムの計画](avere-vfxt-deploy-plan.md)」をご覧ください)。

  新しいコンテナーを作成したくない場合は、このフィールドを **[false]** に設定してください。 この場合、クラスターの作成後にストレージを接続して構成する必要があります。 手順については、[ストレージの構成](avere-vfxt-add-storage.md)に関するページを参照してください。

* **(新規) [ストレージ アカウント]** - 新しい Azure BLOB コンテナーを作成する場合、新しいストレージ アカウントの名前を入力します。

## <a name="validation-and-purchase"></a>確認と購入

3 ページ目では、構成の概要が示されているので、パラメーターを確認します。 検証が成功したら、概要を確認し、 **[OK]** をクリックします。

> [!TIP]
> **[OK]** の横の **[テンプレートとパラメーターのダウンロード]** リンクをクリックすることで、このクラスターの作成設定を保存できます。 この情報は、後で同様のクラスターを作成する必要がある場合 (ディザスター リカバリーのシナリオで代替クラスターを作成する場合など) に役立ちます (詳細については、[ディザスター リカバリー ガイダンス](disaster-recovery.md)をご覧ください)。

![デプロイ テンプレートの 3 ページ目 - 確認](media/avere-vfxt-deploy-3.png)

4 ページ目には、使用条件と、プライバシーおよび価格情報へのリンクが表示されます。

不足している連絡先情報を入力した後、 **[作成]** をクリックして条件に同意し、Avere vFXT for Azure クラスターを作成します。

![デプロイ テンプレートの 4 ページ目 - 利用規約、[作成] ボタン](media/avere-vfxt-deploy-4.png)

クラスターのデプロイには 15 分から 20 分かかります。

## <a name="gather-template-output"></a>テンプレートの出力の収集

Avere vFXT テンプレートは、クラスターの作成が完了すると、新しいクラスターに関する重要な情報を出力します。

> [!TIP]
> テンプレートの出力から得られた**管理 IP アドレス**を必ずコピーしてください。 クラスターを管理するためには、このアドレスが必要です。

この情報を見つけるには、次の手順に従います。

1. クラスター コントローラー用のリソース グループに移動します。

1. 左側にある **[デプロイ]** をクリックしてから、**microsoft-avere.vfxt-template** をクリックします。

   ![左側で [デプロイ] が選択され、デプロイ名の下の表に microsoft-avere.vfxt-template が示されているリソース グループ ポータル ページ](media/avere-vfxt-outputs-deployments.png)

1. 左側にある **[出力]** をクリックします。 各フィールドの値をコピーします。

   ![SSHSTRING、RESOURCE_GROUP、LOCATION、NETWORK_RESOURCE_GROUP、NETWORK、SUBNET、SUBNET_ID、VSERVER_IPs、MGMT_IP の値がラベルの右側のフィールドに表示されている出力ページ](media/avere-vfxt-outputs-values.png)

## <a name="next-steps"></a>次のステップ

これでクラスターが実行され、その管理 IP アドレスがわかったので、[クラスター構成ツールに接続](avere-vfxt-cluster-gui.md)します。

構成インターフェイスを使用して、次のセットアップ タスクを含め、クラスターをカスタマイズします。

* [サポートの有効化](avere-vfxt-enable-support.md)
* [ストレージの追加](avere-vfxt-add-storage.md) (必要な場合)
