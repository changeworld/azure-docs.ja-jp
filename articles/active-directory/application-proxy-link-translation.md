---
title: "リンクと URL の Azure AD アプリ プロキシの変換 | Microsoft Docs"
description: "Azure AD アプリケーション プロキシ コネクタの基本について説明します。"
services: active-directory
documentationcenter: 
author: kgremban
manager: femila
ms.assetid: 
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 08/10/2017
ms.author: kgremban
ms.reviewer: harshja
ms.custom: it-pro
ms.openlocfilehash: 57218346d236b376d2227e0ffaea6c6dd5ebe855
ms.sourcegitcommit: 6699c77dcbd5f8a1a2f21fba3d0a0005ac9ed6b7
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 10/11/2017
---
# <a name="redirect-hardcoded-links-for-apps-published-with-azure-ad-application-proxy"></a>Azure AD アプリケーション プロキシで公開されているアプリのハードコードされたリンクをリダイレクトする

Azure AD アプリケーション プロキシを使うと、リモートのユーザーまたは自分のデバイスを使っているユーザーがオンプレミスのアプリを使用できるようになります。 ただし、一部のアプリは、HTML に埋め込まれたローカル リンクと共に開発されました。 現時点では、アプリをリモートで使用しているときには、それらのリンクは正常に機能しません。 お互いをポイントするオンプレミス アプリケーションが複数ある場合、お客様のユーザーは、オフィスにいないときにそのリンクが機能し続けることを期待します。 

お客様の企業ネットワークの内でも外でも、リンクを同じように機能させるのに最適な方法は、アプリの外部 URL をその内部 URL と一致するように構成することです。 外部 URL に、規定値のアプリケーション プロキシ ドメインではなく、お客様の企業ドメイン名が含まれるように構成するには、[カスタム ドメイン](active-directory-application-proxy-custom-domains.md)を使用します。

お使いのテナントでカスタム ドメインを使用していない場合は、アプリケーション プロキシのリンク変換機能によって、お客様のユーザーの居場所にかかわらずリンクは機能し続けます。 内部エンドポイントまたはポートを直接ポイントするアプリがある場合は、公開されている外部アプリケーション プロキシ URL にこれらの内部 URL をマップできます。 リンク変換が有効になっている場合、アプリケーション プロキシは HTML、CSS、およびいくつかの限定された JavaScript タグを検索して、公開された内部リンクを探します。 次に、アプリケーション プロキシ サービスがそれらを変換することで、お客様のユーザーが利用を妨げられるような状況に陥らないようにします。

>[!NOTE]
>リンク変換機能はテナント用です。いかなる理由であっても、カスタム ドメインのアプリに同じ内部および外部 URL を含めることはできません。 この機能を有効にする前に、[Azure AD アプリケーション プロキシでカスタム ドメイン](active-directory-application-proxy-custom-domains.md)が機能するかどうかをご確認ください。
>
>または、リンク変換を構成したいアプリケーションが SharePoint の場合は、「[SharePoint 2013 の代替アクセス マッピングを構成する](https://technet.microsoft.com/library/cc263208.aspx)」で、リンクをマッピングするための別の方法をご覧ください。

## <a name="how-link-translation-works"></a>リンク変換の仕組み

認証後に、プロキシ サーバーがユーザーにアプリケーション データを渡すと、アプリケーション プロキシがハードコードされたリンクをアプリケーションでスキャンし、それぞれ公開されている外部 URL で置換します。

アプリケーション プロキシでは、アプリケーションが UTF-8 でエンコードされていることを前提としています。 そうなっていない場合は、http 応答ヘッダーでエンコードの種類を `Content-Type:text/html;charset=utf-8` のように指定してください。

### <a name="which-links-are-affected"></a>影響を受けるリンク

リンク変換機能は、アプリの本文のコード タグ内にあるリンクだけを検索します。 アプリケーション プロキシには、ヘッダー内の cookie や URL を変換するための別の機能があります。 

オンプレミスのアプリケーションの内部リンクには 2 つの一般的な種類があります。

- `/claims/claims.html` のようなローカル ファイル構造の共有リソースをポイントする**相対内部リンク**。 これらのリンクは、アプリケーション プロキシ経由で公開されるアプリで自動的に動作し、リンク変換の有無にかかわらず機能し続けます。 
- `http://expenses` のような他のオンプレミスのアプリまたは `http://expenses/logo.jpg` のような公開されたファイルへの**ハードコードされた内部リンク**。 リンク変換機能は、ハードコードされた内部リンクで機能し、リモート ユーザーが経由する必要がある外部 URL をポイントするように変更します。

### <a name="how-do-apps-link-to-each-other"></a>アプリが相互にリンクする方法

リンク変換は、アプリケーションごとに有効化されるため、アプリ レベルでユーザー エクスペリエンスを制御できます。 変換するアプリ "*への*" リンクではなく、そのアプリ "*から*" のリンクが必要な場合に、アプリのリンク変換をオンにします。 

たとえば、すべてが相互にリンクする、アプリケーション プロキシ経由で公開された 3 つのアプリケーション (福利厚生、経費、出張) があるとします。 アプリケーション プロキシ経由で公開されていないフィードバックという 4 番目のアプリがあります。

福利厚生アプリのリンク変換を有効にすると、経費と出張へのリンクは、それらのアプリの外部 URL にリダイレクトされますが、フィードバックへのリンクは外部 URL がないためリダイレクトされません。 経費と出張のアプリに対してはリンク変換が有効になっていないため、この 2 つのアプリから福利厚生へのリンクは機能しません。

![リンク変換が有効になっている場合の福利厚生から他のアプリへのリンク](./media/application-proxy-link-translation/one_app.png)

### <a name="which-links-arent-translated"></a>変換されないリンク

パフォーマンスとセキュリティを向上させるために、一部のリンクは変換されません。

- コード タグ内にないリンク。 
- HTML、CSS、または JavaScript 以外の中にあるリンク。 
- 他のプログラムから開かれた内部リンク。 電子メールまたはインスタント メッセージで送信されたか、他のドキュメントに含まれているリンクは変換されません。 ユーザーは、外部 URL に移動するために知っておく必要があります。

この 2 つのシナリオのいずれかをサポートする必要がある場合は、リンク変換ではなく同じ内部および外部 URL を使用します。  

## <a name="enable-link-translation"></a>リンク変換の有効化

リンク変換の使用開始は、ボタンをクリックするのと同じくらい簡単です。

1. [Azure Portal](https://portal.azure.com) に管理者としてサインインします。
2. **[Azure Active Directory]** > **[エンタープライズ アプリケーション]** > **[すべてのアプリケーション]** に移動し、管理するアプリを選び、**[アプリケーション プロキシ]** を選択します。
3. **[Translate URLs in application body]\(アプリケーション本文の URL を変換する\)** を **[はい]** にします。

   ![[はい] を選択してアプリケーション本文の URL を変換する](./media/application-proxy-link-translation/select_yes.png)に関するページを参照してください。
4. **[保存]** を選択して変更を保存します。

これで、ユーザーがこのアプリケーションにアクセスすると、テナントのアプリケーション プロキシ経由で公開されている内部 URL がプロキシによって自動的にスキャンされます。

## <a name="send-feedback"></a>フィードバックの送信

この機能がすべてのアプリで動作するようにするためにご協力ください。 HTML と CSS で 30 を超えるタグを検索し、サポートする JavaScript ケースを検討しています。 変換されていないリンクが生成された例がある場合は、コード スニペットを[アプリケーション プロキシのフィードバック](mailto:aadapfeedback@microsoft.com)に送信してください。 

## <a name="next-steps"></a>次のステップ
[Azure AD アプリケーション プロキシとともにカスタム ドメインを使用](active-directory-application-proxy-custom-domains.md)して、同じ内部および外部 URL を含める

[SharePoint 2013 の代替アクセス マッピングを構成する](https://technet.microsoft.com/library/cc263208.aspx)
