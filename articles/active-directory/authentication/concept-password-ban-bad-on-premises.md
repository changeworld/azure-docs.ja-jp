---
title: Azure AD パスワード保護 - Azure Active Directory
description: Azure AD パスワード保護を使用してオンプレミスの Active Directory Domain Services で脆弱なパスワードを禁止する
services: active-directory
ms.service: active-directory
ms.subservice: authentication
ms.topic: conceptual
ms.date: 07/17/2020
ms.author: justinha
author: justinha
manager: daveba
ms.reviewer: jsimmons
ms.collection: M365-identity-device-management
ms.openlocfilehash: 8f5df1cb158821fb0cd85d90f9ba3b79d80adf45
ms.sourcegitcommit: f28ebb95ae9aaaff3f87d8388a09b41e0b3445b5
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/29/2021
ms.locfileid: "96743923"
---
# <a name="enforce-on-premises-azure-ad-password-protection-for-active-directory-domain-services"></a>Active Directory Domain Services にオンプレミスの Azure AD パスワード保護を適用する

Azure AD パスワード保護では、既知の脆弱なパスワードやそのバリエーションを検出してブロックします。また、組織に固有のその他の脆弱な用語をブロックすることもできます。 Azure AD パスワード保護のオンプレミス展開では、Azure AD に格納されているものと同じグローバルとカスタムの禁止パスワード リストが使用され、Azure AD がクラウドベースで実行するのと同じパスワード変更チェックがオンプレミスで実行されます。 これらのチェックは、パスワードの変更時とパスワードのリセット イベント発生時にオンプレミスの Active Directory Domain Services (AD DS) ドメイン コントローラーに対して実行されます。

## <a name="design-principles"></a>設計原則

Azure AD パスワード保護は、次の原則を考慮して設計されています。

* ドメイン コントローラー (DC) はインターネットと直接通信する必要がありません。
* DC で新しいネットワーク ポートが開かれません。
* AD DS スキーマの変更は必要ありません。 このソフトウェアは、既存の AD DS *コンテナー* および *serviceConnectionPoint* スキーマ オブジェクトを使用します。
* 最小限の AD DS ドメインまたはフォレスト機能レベル (DFL\FFL) は必要ありません。
* このソフトウェアは、保護する AD DS ドメイン内にアカウントを作成せず、要求もしません。
* ユーザーのクリア テキスト パスワードは、パスワード検証操作のときも、他のどのようなときでも、ドメイン コントローラーの外部に出ることはありません。
* このソフトウェアは、他の Azure AD 機能に依存しません。 たとえば、Azure AD のパスワード ハッシュ同期 (PHS) は Azure AD パスワード保護に関連しておらず、必要ありません。
* 増分デプロイはサポートされていますが、ドメイン コントローラー エージェント (DC エージェント) がインストールされている場合にのみパスワード ポリシーが適用されます。

## <a name="incremental-deployment"></a>増分デプロイ

Azure AD パスワード保護では、AD DS ドメイン内の DC 全体への増分デプロイがサポートされています。 これが何を意味するのか、何がトレードオフであるのかを理解することが重要です。

Azure AD パスワード保護 DC エージェント ソフトウェアがパスワードを検証できるのは、それが DC にインストールされるときと、その DC に送信されるパスワード変更に対してのみです。 ユーザー パスワードの変更を処理するために Windows クライアント マシンによって選択される DC を制御することはできません。 一貫性のある動作と世界共通の Azure AD パスワード保護のセキュリティを確実に適用するには、ドメイン内のすべての DC に DC エージェント ソフトウェアをインストールする必要があります。

多くの組織では、完全なデプロイを行う前に、DC のサブセットで Azure AD パスワード保護を慎重にテストする必要があります。 このシナリオをサポートするため、Azure AD パスワード保護では一部のデプロイがサポートされています。 特定の DC 上にある DC エージェント ソフトウェアでは、ドメイン内の他の DC に DC エージェント ソフトウェアがインストールされていない場合でも積極的にパスワードを検証します。 このような一部のデプロイは安全ではないため、テスト目的以外にはお勧めしません。

## <a name="architectural-diagram"></a>アーキテクチャ図

オンプレミスの AD DS 環境で Azure AD パスワード保護をデプロイする前に、基になる設計と機能の概念を理解することが重要です。 次の図は、Azure AD パスワード保護のコンポーネントの連携のしくみを示しています。

![Azure AD パスワード保護コンポーネントの連携方法](./media/concept-password-ban-bad-on-premises/azure-ad-password-protection.png)

* Azure AD パスワード保護プロキシ サービスは、現在の AD DS フォレスト内のドメインに参加しているすべてのマシン上で実行されています。 このサービスの主な目的は、パスワード ポリシーのダウンロード要求を DC から Azure AD に転送し、Azure AD から DC に応答を返すことです。
* DC エージェントのパスワード フィルター DLL は、オペレーティング システムからユーザーのパスワード検証要求を受け取り、 このフィルターは、DC でローカルで実行されている DC エージェント サービスにそれらを転送します。
* Azure AD パスワード保護の DC エージェント サービスは、DC エージェントのパスワード フィルター DLL からパスワード検証要求を受け取ります。 DC エージェント サービスは、現在の (ローカルで使用できる) パスワード ポリシーを使用してそれらを処理し、結果 (*合格* または *失敗*) を返します。

## <a name="how-azure-ad-password-protection-works"></a>Azure AD パスワード保護のしくみ

オンプレミスの Azure AD パスワード保護コンポーネントの動作は次のとおりです。

1. 各 Azure AD パスワード保護プロキシ サービス インスタンスは、Active Directory に *serviceConnectionPoint* オブジェクトを作成することによって、それ自体をフォレスト内の DC にアドバタイズします。

    Azure AD パスワード保護用の各 DC エージェント サービスは、Active Directory に *serviceConnectionPoint* オブジェクトも作成します。 このオブジェクトは、主にレポートと診断に使用されます。

1. DC エージェント サービスは、Azure AD からの新しいパスワード ポリシーのダウンロードの開始を担当します。 最初の手順は、フォレストで、プロキシ *serviceConnectionPoint* オブジェクトをクエリすることによって、Azure AD パスワード保護プロキシ サービスを見つけることです。

1. 使用可能なプロキシ サービスが見つかると、DC エージェント サービスがプロキシ サービスにパスワード ポリシー ダウンロード要求を送信します。 さらに、プロキシ サービスが Azure AD に要求を送信し、DC エージェント サービスに応答を返します。

1. DC エージェント サービスが Azure AD から新しいパスワード ポリシーを受信すると、サービスはそのドメイン *sysvol* フォルダー共有のルートにある専用フォルダーにポリシーを格納します。 さらに、DC エージェント サービスは、ドメイン内の他の DC エージェント サービスから新しいポリシーがレプリケートされた場合にこのフォルダーを監視します。

1. DC エージェント サービスは、サービスの起動時に常に新しいポリシーを要求します。 DC エージェント サービスの起動後、1 時間ごとに現在のローカルで使用可能なポリシーの有効期間が確認されます。 ポリシーが 1 時間よりも古い場合、DC エージェントは上記のように Azure AD にプロキシ サービスを介して新しいポリシーを要求します。 現在のポリシーが 1 時間よりも古くない場合、DC エージェントはそのポリシーを使用し続けます。

1. DC がパスワード変更イベントを受信すると、キャッシュされたポリシーを使用して、新しいパスワードを受け入るか拒否するかが決定されます。

### <a name="key-considerations-and-features"></a>主な考慮事項と機能

* Azure AD パスワード保護のパスワード ポリシーがダウンロードされたときは常に、そのポリシーがテナントに固有になります。 つまり、パスワード ポリシーは常に、Microsoft のグローバルな禁止パスワード リストとテナントごとのカスタムの禁止パスワード リストの組み合わせになります。
* DC エージェントは、TCP を介した RPC を使用してプロキシ サービスと通信します。 プロキシ サービスは、構成に従って、動的または静的 RPC ポートでこれらの呼び出しをリッスンします。
* DC エージェントはネットワークで使用可能なポートでリッスンしません。
* プロキシ サービスは、DC エージェント サービスを呼び出すことはありません。
* プロキシ サービスはステートレスです。 Azure からダウンロードされたポリシーやその他の状態をキャッシュしません。
* DC エージェント サービスは、常に最新のローカルで使用可能なパスワード ポリシーを使用して、ユーザーのパスワードを評価します。 ローカル DC に使用可能なパスワード ポリシーがない場合、パスワードは自動的に承認されます。 その場合、イベント ログ メッセージが記録され、管理者に警告されます。
* Azure AD パスワード保護は、リアルタイム ポリシー アプリケーション エンジンではありません。 パスワード ポリシー構成の変更が Azure AD で行われてから、その変更がすべての DC に到達して適用されるまでに、遅延が生じることがあります。
* Azure AD のパスワード保護は、既存の AD DS パスワード ポリシーを補完するものであり、代わりにはなりません。 これには、インストールされる可能性がある他の任意のサード パーティ製パスワード フィルター dll が含まれます。 AD DS では、常に、すべてのパスワード検証コンポーネントがパスワードの受け入れ前に同調している必要があります。

## <a name="forest--tenant-binding-for-azure-ad-password-protection"></a>Azure AD パスワード保護のフォレスト/テナント バインディング

AD DS フォレスト内の Azure AD パスワード保護のデプロイには、そのフォレストの Azure AD への登録が必要です。 デプロイ済みの各プロキシ サービスも、Azure AD に登録する必要があります。 このようなフォレストとプロキシの登録は、登録時に使用される資格情報によって暗黙的に識別される、特定の Azure AD テナントと関連付けられます。

AD DS フォレストと、フォレスト内にデプロイ済みのすべてのプロキシ サービスは、同じテナントに登録する必要があります。 AD DS フォレストまたはそのフォレスト内のプロキシ サービスを別の Azure AD に登録することは、サポートされていません。 このような誤って構成されたデプロイの症状として、パスワード ポリシーをダウンロードできないことがあります。

> [!NOTE]
> したがって、複数の Azure AD テナントを持つお客様は、Azure AD パスワード保護の目的で、各フォレストを登録するための 1 つの識別されたテナントを選択する必要があります。

## <a name="download"></a>ダウンロード

Azure AD パスワード保護のために必要な 2 つのエージェント インストーラーは、[Microsoft ダウンロード センター](https://www.microsoft.com/download/details.aspx?id=57071)から入手できます。

## <a name="next-steps"></a>次の手順

オンプレミスの Azure AD パスワード保護の使用を開始するには、次のハウツー記事をご覧ください。

> [!div class="nextstepaction"]
> [オンプレミスの Azure AD パスワード保護のデプロイ](howto-password-ban-bad-on-premises-deploy.md)
