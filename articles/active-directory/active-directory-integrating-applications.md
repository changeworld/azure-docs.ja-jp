<properties
   pageTitle="Azure Active Directory とアプリケーションの統合 | Microsoft Azure"
   description="Azure Active Directory (Azure AD) でアプリケーションを追加、更新、削除する方法について詳しく説明します。"
   services="active-directory"
   documentationCenter=""
   authors="msmbaldwin"
   manager="mbaldwin"
   editor="mbaldwin" />
<tags
   ms.service="active-directory"
   ms.devlang="na"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="identity"
   ms.date="08/25/2015"
   ms.author="mbaldwin" />

# Azure Active Directory とアプリケーションの統合

[AZURE.INCLUDE [active-directory-devguide](../../includes/active-directory-devguide.md)]

エンタープライズ開発者と SaaS (サービスとしてのソフトウェア) プロバイダーは、自社のサービスのセキュリティで保護されたサインインと承認を実現するために、Azure Active Directory (Azure AD) と統合できる商用クラウド サービスまたは基幹業務アプリケーションを開発できます。アプリケーションまたはサービスを Azure AD と統合するには、Microsoft Azure 管理ポータルを使用して、アプリケーションに関する詳細情報を Azure AD に登録しておく必要があります。

この記事では、Azure AD でアプリケーションを追加、更新、削除する方法を説明します。また、Azure AD と統合できるさまざまな種類のアプリケーション、Web API などの他のリソースにアクセスするようにアプリケーションを構成する方法などについても説明します。

アプリのプロパティの詳細については、「[アプリケーション オブジェクトおよびサービス プリンシパル オブジェクト](active-directory-application-objects.md)」をご覧ください。Azure Active Directory でアプリケーションを開発するときに使用するブランド化ガイドラインについては、「[アプリケーションのブランド化ガイドライン](active-directory-branding-guidelines.md)」をご覧ください。アプリケーション マニフェストについては、「[Azure Active Directory のアプリケーション マニフェストについて](active-directory-application-manifest.md)」で説明されています。

## アプリケーションの追加

Azure AD の機能を使用するアプリケーションは、まずディレクトリに登録する必要があります。この登録プロセスでは、アプリケーションが配置されている URL、ユーザーの認証後の応答の送信先となる URL、アプリケーションを識別する URI など、アプリケーションの詳細を Azure AD に提供します。

Azure AD でのユーザーのサインオンだけを必要とする Web アプリケーションを構築する場合は、次の手順に従うだけでかまいません。アプリケーションが Web API にアクセスする必要がある場合、Web API にアクセスする必要があるネイティブ アプリケーションを構築する場合、またはアプリケーションをマルチテナントにする場合は、「[アプリケーションの更新](#updating-an-application)」を参照して、アプリケーションを引き続き構成する必要があります。

アプリケーションを他の組織で使用できるようにする場合は、アプリケーションを追加した後で外部アクセスを有効にすることも必要となります。

### Microsoft Azure 管理ポータルでアプリケーションを登録するには

1. Microsoft Azure 管理ポータルにサインインします。

1. 左側のメニューの [Active Directory] アイコンをクリックし、目的のディレクトリをクリックします。

1. 上部のメニューで、[アプリケーション] をクリックします。ディレクトリに追加されているアプリケーションがない場合、このページには [アプリケーションの追加] リンクだけが表示されます。このリンクをクリックします。または、コマンド バーの [追加] をクリックすることもできます。

1. [実行する作業を選択してください] ページで、[組織で開発中のアプリケーションを追加] リンクをクリックします。

1. [アプリケーション情報の指定] ページでは、アプリケーションの名前と、Azure AD に登録するアプリケーションの種類を指定する必要があります。[Web アプリケーションや Web API] (既定) または [ネイティブ クライアント アプリケーション] (スマートフォンやコンピューターなどのデバイスにインストールされるアプリケーション) を選択できます。完了したら、ページの右下にある矢印アイコンをクリックします。

1. [アプリケーションのプロパティ] ページで、Web アプリケーションの [サインオン URL] と [アプリケーション ID/URI] (ネイティブ クライアント アプリケーションの場合は [リダイレクト URI] のみ) を指定し、ページの右下にあるチェック ボックスをクリックします。

1. アプリケーションが追加されると、アプリケーションのクイック スタート ページが表示されます。アプリケーションが Web アプリケーションとネイティブ アプリケーションのどちらであるかに応じて、アプリケーションに機能を追加する方法のさまざまなオプションが表示されます。アプリケーションが追加されたら、ユーザーによるサインインの有効化、他のアプリケーションの Web API へのアクセスの提供、(他の組織がアプリケーションにアクセスできるようにするための) マルチテナント アプリケーションの構成などを目的に、アプリケーションを更新できるようになります。

>[AZURE.NOTE]既定では、新しく作成されたアプリケーションの登録は、ディレクトリのユーザーがアプリケーションにサインインできるように構成されます。

## アプリケーションの更新

アプリケーションを Azure AD に登録したら、Web API にアクセスできるようにしたり、他の組織で使用できるようにしたりするために、アプリケーションを更新することが必要な場合があります。ここでは、アプリケーションをさらに構成する方法について説明します。Azure AD での認証のしくみの詳細については、「[Azure AD の認証シナリオ](active-directory-authentication-scenarios.md)」をご覧ください。

### 同意フレームワークの概要

Azure AD の新しい同意フレームワークにより、Azure AD によって保護された Web API にアクセスする必要がある Web アプリケーションやネイティブ アプリケーションの開発が容易になります。これらの Web API には、独自の Web API だけでなく、Graph API、Office 365、その他の Microsoft サービスも含まれます。このフレームワークは、ディレクトリ データへのアクセスを必要とする場合があるアプリケーションをディレクトリに登録することに対する、ユーザーまたは管理者の同意に基づいています。たとえば、Web アプリケーションで Office 365 の Web API を呼び出して、ユーザーに関するカレンダー情報を読み取る必要がある場合、そのユーザーはそのアプリケーションに同意する必要があります。ユーザーが同意すると、Web アプリケーションはユーザーに代わって Office 365 Web API を呼び出し、必要に応じてカレンダー情報を使用できるようになります。

同意フレームワークは、OAuth 2.0 と、パブリック クライアントまたは秘密のクライアントを使用した各種フロー (認証コードの付与やクライアント資格情報の付与など) を基盤としています。Azure AD は、OAuth 2.0 を使用することで、スマートフォン、タブレット、サーバーなどで実行されるさまざまな種類のクライアント アプリケーションや Web アプリケーションを構築し、必要なリソースにアクセスすることを可能にします。

同意フレームワークの詳細については、「[Azure AD での OAuth 2.0](https://msdn.microsoft.com/library/azure/dn645545.aspx)」、「[Azure AD の認証シナリオ](active-directory-authentication-scenarios.md)」、および Office 365 の、共通の同意フレームワークを使用した認証と承認に関するトピック (https://msdn.microsoft.com/library/office/dn605895(v=office.15).aspx)) をご覧ください。

#### 同意エクスペリエンスの例

次の手順は、アプリケーション開発者とユーザーに対して、同意エクスペリエンスがどのように機能するかを示しています。

1. Microsoft Azure 管理ポータルのアプリケーションの構成ページで、[他のアプリケーションに対するアクセス許可] コントロールのドロップダウン メニューを使用して、アプリケーションに必要なアクセス許可を設定します。

    ![他のアプリケーションに対するアクセス許可](./media/active-directory-integrating-applications/permissions.png)

1. たとえば、アプリケーションのアクセス許可の更新後、アプリケーションが実行され、ユーザーがアプリケーションを初めて使用しようとしているとします。アプリケーションがアクセス トークンも更新トークンもまだ取得していない場合、アプリケーションは Azure AD の承認エンドポイントにアクセスして、新しいアクセス トークンと更新トークンを取得する際に使用できる認証コードを取得する必要があります。

1. ユーザーがまだ認証されていない場合、Azure AD にサインインするよう求められます。

    ![ユーザーまたは管理者による Azure AD へのサインイン](./media/active-directory-integrating-applications/useradminsignin.png)

1. ユーザーがサインインすると、ユーザーに同意ページを表示する必要があるかどうかが判断されます。この判断は、ユーザー (または組織の管理者) がアプリケーションに既に同意しているかどうかに基づいています。まだ同意していない場合、ユーザーに同意を求めるメッセージが表示され、アプリケーションが機能するために必要なアクセス許可が表示されます。同意ダイアログに表示される一連のアクセス許可は、Microsoft Azure 管理ポータルの [他のアプリケーションに対するアクセス許可] コントロールで選択したアクセス許可と同じです。

    ![ユーザーの同意エクスペリエンス](./media/active-directory-integrating-applications/userconsent.png)

1. ユーザーが同意すると、アプリケーションに認証コードが返されます。この認証コードを使用して、アクセス トークンと更新トークンを取得できます。このフローの詳細については、「[Azure AD の認証シナリオ](active-directory-authentication-scenarios.md)」の「[Web アプリケーション対 Web API](active-directory-authentication-scenarios.md#web-application-to-web-api)」をご覧ください。

### 他のアプリケーションの Web API へのアクセス

前述の同意フレームワークを使用することで、ディレクトリ内の Web API によって公開されているデータにアクセスするためのアクセス許可を要求するようにアプリケーションを構成できます。既定では、すべてのアプリケーションが Azure Active Directory (Graph API) と Azure サービス管理 API のアクセス許可を選択できます。Azure AD の "サインオンを有効にし、ユーザーのプロファイルを読み取る" アクセス許可は、既定で既に選択されています。ディレクトリに Office 365 のサブスクリプションもある場合は、Web APIと、SharePoint および Exchange Online のアクセス許可も選択できます。目的の Web API の横にあるドロップダウン メニューでは、次の 2 種類のアクセス許可から選択できます。

- アプリケーションのアクセス許可: アプリケーションは、(ユーザー コンテキストなしで) アプリケーションとして Web API に直接アクセスする必要があります。この種類のアクセス許可には管理者の同意が必要であり、ネイティブ クライアント アプリケーションでは使用できません。

- 委任されたアクセス許可: アプリケーションは、サインインしているユーザーとして Web API にアクセスする必要がありますが、選択したアクセス許可によってアクセスが制限されます。この種類のアクセス許可は、管理者の同意を要求するように構成されていない限り、ユーザーが付与できます。

#### 他のアプリケーションの Web API へのアクセスを追加するには

1. Microsoft Azure 管理ポータルにサインインします。

1. 左側のメニューの [Active Directory] アイコンをクリックし、目的のディレクトリをクリックします。

1. 上部のメニューで [アプリケーション] をクリックし、構成するアプリケーションをクリックします。クイック スタート ページが開き、シングル サインオンと他の構成情報が表示されます。

1. クイック スタートの [他のアプリケーションの Web API へのアクセス] を展開し、[アクセス許可の選択] セクションの [今すぐ構成] リンクをクリックします。アプリケーションのプロパティ ページが表示されます。

1. [他のアプリケーションに対するアクセス許可] セクションまで下にスクロールします。1 列目では、ディレクトリ内の、Web API を公開している利用可能なアプリケーションの中から選択できます。アプリケーションを選択したら、Web API が公開しているアプリケーションのアクセス許可と委任されたアクセス許可を選択できます。

1. 選択が完了したら、コマンド バーの [保存] をクリックします。

>[AZURE.NOTE][保存] をクリックすると、構成済みの [他のアプリケーションに対するアクセス許可] に基づいて、ディレクトリ内のアプリケーションのアクセス許可も自動的に設定されます。これらのアプリケーションのアクセス許可は、アプリケーションの [プロパティ] タブで確認できます。

### 他のアプリケーションへの Web API の公開

Web API を開発し、他の組織が使用できるようにするには、アクセス許可スコープを他のアプリケーション開発者に公開します。適切に構成された Web API は、Graph API や Office 365 API など、他の Microsoft Web API と同様に使用できます。Web API は、[アプリケーション マニフェスト](active-directory-application-manifest.md)を構成することで使用できるようになります。アプリケーション マニフェストは、アプリケーションの ID 構成を示す JSON ファイルです。アクセス許可スコープを公開するには、Microsoft Azure 管理ポータルでアプリケーションに移動し、コマンド バーの [アプリケーション マニフェスト] をクリックします。詳細については、「[Azure Active Directory のアプリケーション マニフェストについて](active-directory-application-manifest.md)」をご覧ください。

#### 他のアプリケーションに Web API を公開するには

1. Microsoft Azure 管理ポータルにサインインします。

1. 左側のメニューの [Active Directory] アイコンをクリックし、目的のディレクトリをクリックします。

1. 上部のメニューで [アプリケーション] をクリックし、構成するアプリケーションをクリックします。クイック スタート ページが開き、シングル サインオンと他の構成情報が表示されます。

1. コマンド バーの [マニフェストの管理] をクリックし、[マニフェストのダウンロード] を選択します。

1. JSON アプリケーション マニフェスト ファイルを開き、"oauth2Permissions" ノードを次の JSON スニペットに置き換えます。このスニペットの例は、ユーザーの偽装と呼ばれるアクセス許可スコープを公開する方法を示しています。実際のアプリケーションに合わせてテキストと値を変更してください。

		"oauth2Permissions": [
		{
			"adminConsentDescription": "Allow the application full access to the Todo List service on behalf of the signed-in 	user",
			"adminConsentDisplayName": "Have full access to the Todo List service",
			"id": "b69ee3c9-c40d-4f2a-ac80-961cd1534e40",
			"isEnabled": true,
			“origin”: “Application”
			"type": "User",
			"userConsentDescription": "Allow the application full access to the todo service on your behalf",
			"userConsentDisplayName": "Have full access to the todo service",
			"value": "user_impersonation"
			}
		],

    id 値は、GUID 生成ツールまたはプログラムを使用して作成した新しい GUID である必要があります。GUID は、Web API によって公開されているアクセス許可の一意の識別子です。Web API へのアクセスを要求するように適切に構成されているクライアントは、Web API を呼び出すと、スコープ (scp) 要求が上記の値 (この例では user\_impersonation) に設定された OAuth 2.0 JWT トークンを提示します。

	>[AZURE.NOTE]必要に応じて、他のアクセス許可スコープを後で公開することもできます。たとえば、Web API が、さまざまな機能に関連付けられた複数のアクセス許可を公開しているとします。この場合、受け取った OAuth 2.0 JWT トークンのスコープ (scp) 要求を使用して、Web API へのアクセスを制御できるようになります。

1. 更新された JSON ファイルを保存したら、コマンド バーの [マニフェストの管理] をクリックし、[マニフェストのアップロード] を選択します。更新されたマニフェスト ファイルを参照して選択し、ファイルをアップロードします。アップロードが完了すると、ディレクトリ内の他のアプリケーションが使用できるように Web API が構成されます。

#### ディレクトリ内の他のアプリケーションに Web API が公開されていることを確認するには

1. 上部のメニューで [アプリケーション] をクリックし、Web API へのアクセスを構成する、目的のアプリケーションを選択して、[構成] をクリックします。

1. [他のアプリケーションに対するアクセス許可] セクションまで下にスクロールします。[アプリケーションの選択] ドロップダウン メニューをクリックすると、先ほどアクセス許可を公開した Web API を選択できます。[委任されたアクセス許可] ドロップダウン メニューから、新しいアクセス許可を選択します。

![Todo リストのアクセス許可の表示](./media/active-directory-integrating-applications/listpermissions.png)

#### アプリケーション マニフェスト JSON ファイルの AppPermissions スキーマ

次の表に、アプリケーション マニフェスト JSON ファイルの oauth2Permissions の部分に使用できる値を示します。

|要素|説明|
|---|---|
|adminConsentDescription|管理者の同意ダイアログと同意されたアプリケーションのプロパティ ページで、マウス ポインターを置いたときに表示されるヘルプの説明。|
|adminConsentDisplayName|アプリケーションのアクセス許可スコープと委任されたアクセス許可スコープのドロップダウンに表示されるアクセス許可のフレンドリ名。同意中に管理者に表示され、アプリケーションのプロパティ ページにも表示されます。|
|id|アクセス許可スコープの一意の内部識別子を表します。アプリケーションのすべてのアクセス許可の中で一意である必要があります。また、GUID を指定する必要があります。|
|isEnabled|OAuth2 アクセス許可を作成または更新するときは、この値を常に true に設定します。アクセス許可を削除する場合は、まずこの値を false に設定し、マニフェストをアップロードする必要があります。アップロードしたら、マニフェストの次のアップロードでアクセス許可を削除できます。|
|origin|将来の使用に備えて予約されています。常に "application" に設定します。|
|type|"User" または "Admin" を指定できます。"User" を指定すると、エンド ユーザーが同意することができます。"Admin" を指定すると、会社の管理者が同意する必要があります。|
|userConsentDescription|ユーザーの同意ダイアログで、マウス ポインターを置いたときに表示されるヘルプの説明。|
|userConsentDisplayName|同意中にエンドユーザーに表示されるアクセス許可のフレンドリ名。アプリケーション アクセス パネルのアプリケーションのプロパティ ページにも表示されます。|
|値|ユーザーがアクセス許可に同意した場合、OAuth 2.0 アクセス トークンの scp 要求にこの値が設定されます。Web API では、この値を使用して、アプリケーションがユーザーを偽装するときに適用されるアクセス レベルのスコープを設定できます。この値に空白を含めることはできません。また、アプリケーションのすべてのアクセス許可の中で一意である必要があります。|

### Graph API へのアクセス

ここでは、Graph API にアクセスするようにアプリケーションを更新する方法について説明します。Graph API は、[他のアプリケーションに対するアクセス許可] の一覧に [Azure Active Directory] と表示されます。Graph API は、Azure AD に登録されたすべてのアプリケーションが既定で使用できます。Graph API では、次のアクセス許可の中から選択できます。

|アクセス許可名|説明|型|
|---|---|---|
|サインオンを有効にして、ユーザーのプロファイルを読み取る|ユーザーが組織のアカウントを使用してアプリケーションにサインインできるようにし、サインインしているユーザーのプロファイル (電子メール アドレスや連絡先情報など) をアプリケーションが読み取ることを許可します。|委任されたアクセス許可のみ。ユーザーが同意できます。|
|組織のディレクトリにアクセスする|サインインしているユーザーに代わって、アプリケーションが組織のディレクトリにアクセスすることを許可します。|委任されたアクセス許可のみ。ネイティブ クライアントのユーザーと、Web アプリケーションの管理者だけが同意できます。|
|ディレクトリ データの読み取り|ユーザー、グループ、アプリケーションなど、組織のディレクトリ内のデータをアプリケーションが読み取ることを許可します。|委任されたアクセス許可とアプリケーションのアクセス許可。管理者が同意する必要があります。|
|ディレクトリ データの読み取りと書き込み|ユーザー、グループなど、組織のディレクトリ内のデータの読み取りと書き込みをアプリケーションが行うことを許可します。|委任されたアクセス許可とアプリケーションのアクセス許可。管理者が同意する必要があります。|

Microsoft Azure 管理ポータルの既存のユーザーの場合、新しい [他のアプリケーションに対するアクセス許可] コントロールを使用した、アプリケーションの "ディレクトリ データの読み取り" アクセス許可と "ディレクトリ データの読み取りと書き込み" アクセス許可の設定は、以前のアクセスの管理ウィザードに相当します。Office 365 で公開されているアクセス許可スコープを確認する場合は、[共通の同意フレームワークを使用した認証と承認](https://msdn.microsoft.com/office/office365/howto/common-app-authentication-tasks)に関するトピックをご覧ください。

>[AZURE.NOTE]現在の制限により、ネイティブ クライアント アプリケーションは、"組織のディレクトリにアクセスする" アクセス許可を使用する場合に、Azure AD Graph API しか呼び出すことはできません。この制限は、Web アプリケーションには適用されません。

### マルチテナント アプリケーションの構成

Azure AD にアプリケーションを追加するときに、組織のユーザーだけがアプリケーションにアクセスできるようにする場合があります。また、外部組織のユーザーがアプリケーションにアクセスできるようにする場合もあります。前者をシングル テナント アプリケーション、後者をマルチテナント アプリケーションと呼びます。このセクションで後述するように、シングル テナント アプリケーションの構成を変更して、マルチテナント アプリケーションにすることができます。

シングル テナント アプリケーションとマルチテナント アプリケーションの違いに注意することが重要です。シングル テナント アプリケーションは、1 つの組織で使用することを目的としています。通常、これらのアプリケーションは、エンタープライズ開発者によって作成された基幹業務 (LOB) アプリケーションです。シングル テナント アプリケーションには、1 つのディレクトリ内のユーザーだけがアクセスできればよいため、1 つのディレクトリにプロビジョニングするだけで済みます。マルチテナント アプリケーションは、多数の組織で使用することを目的としています。通常、これらのアプリケーションは、独立系ソフトウェア ベンダー (ISV) によって作成された SaaS (サービスとしてのソフトウェア) アプリケーションです。マルチテナント アプリケーションは、アプリケーションが使用される各ディレクトリにプロビジョニングする必要があります。アプリケーションを登録するには、ユーザーまたは管理者の同意が必要です。

#### 外部ユーザーのアクセスの有効化

組織の外部の顧客やパートナーが使用できるアプリケーションを作成する場合、Microsoft Azure 管理ポータルでアプリケーションの定義を更新する必要があります。

>[AZURE.NOTE]外部アクセスを有効にするときは、アプリケーションのアプリケーション ID URI が検証済みドメインに属していることを確認する必要があります。また、戻り先 URL が https:// で始まる必要があります。詳細については、「[アプリケーション オブジェクトおよびサービス プリンシパル オブジェクト](active-directory-application-objects.md)」をご覧ください。

##### アプリケーションへの外部ユーザーのアクセスを有効にするには

1. Microsoft Azure 管理ポータルにサインインします。

1. 左側のメニューの [Active Directory] アイコンをクリックし、目的のディレクトリをクリックします。

1. 上部のメニューで [アプリケーション] をクリックし、構成するアプリケーションをクリックします。クイック スタート ページが開き、シングル サインオンと他の構成情報が表示されます。

1. クイック スタートの [マルチテナント アプリケーションの構成] セクションを展開し、[アクセスの有効化] セクションの [今すぐ構成] リンクをクリックします。アプリケーションのプロパティ ページが表示されます。

1. [アプリケーションはマルチテナントです] の横の [はい] をクリックし、コマンド バーの [保存] をクリックします。

上記の変更を完了すると、他の組織のユーザーと管理者は、アプリケーションにディレクトリや他のデータへのアクセスを許可することができるようになります。

### 同意フレームワークを使用したアクセスの許可

同意フレームワークを使用してアクセスを許可するには、クライアント アプリケーションが OAuth 2.0 を使用して承認を要求する必要があります。Web アプリケーション、ネイティブ アプリケーション、またはサーバー/デーモン アプリケーションが、認証コードとアクセス トークンを要求して Web API を呼び出す方法を示す[コード サンプル](https://github.com/AzureADSamples)が用意されています。

Web アプリケーションでは、ユーザーにサインアップ エクスペリエンスを提供できます。サインアップ エクスペリエンスを提供する場合、ユーザーがサインアップ (またはサインイン ボタン) をクリックしたときに、Azure AD OAuth2.0 承認エンドポイントまたは OpenID Connect ユーザー情報エンドポイントにブラウザーをリダイレクトすることが求められます。これらのエンドポイントでは、アプリケーションが id\_token を調べて、新しいユーザーに関する情報を取得できます。

また、Web アプリケーションでは、管理者が "自社をサインアップ" できるエクスペリエンスを提供することもできます。このエクスペリエンスでも、ユーザーを Azure AD OAuth 2.0 承認エンドポイントにリダイレクトします。この場合、prompt=admin\_consent パラメーターを渡して、管理者が組織に代わって同意する、管理者の同意エクスペリエンスをトリガーすることもできます同意に成功すると、応答に admin\_consent=true が含まれます。アクセス トークンを使用したときに、アプリケーションにサインアップした組織や管理者に関する情報を提供する id\_token も受け取ります。

#### シングル ページ アプリケーションでの OAuth 2.0 Implicit Grant の有効化

通常、シングル ページ アプリケーション (SPA) は、ブラウザで実行される JavaScript ヘビーなフロント エンドで構成されており、このフロント エンドがアプリケーションの Web API バックエンドを呼び出してビジネス ロジックを実行します。Azure AD でホストされている SPA では、Azure AD でのユーザーの認証と、アプリケーションの JavaScript クライアントからバックエンド Web API への呼び出しを保護するために使用できるトークンの取得に OAuth 2.0 Implicit Grant を使用します。ユーザーの同意後、この同じ認証プロトコルを使用して、クライアントと、アプリケーション用に構成された他の Web API リソースとの間での呼び出しを保護するトークンを取得できます。既定では、OAuth 2.0 Implicit Grant はアプリケーションに対して無効化されています。[アプリケーション マニフェスト](active-directory-application-manifest.md)で `oauth2AllowImplicitFlow` の値を設定することにより、アプリケーションに対して OAuth 2.0 Implicit Grant を有効化できます。アプリケーション マニフェストは、アプリケーションの ID 構成を示す JSON ファイルです。

##### OAuth 2.0 Implicit Grant を有効化するには

1. Microsoft Azure 管理ポータルにサインインします。
1. 左側のメニューの **[Active Directory]** アイコンをクリックし、目的のディレクトリをクリックします。
1. 上部のメニューで **[アプリケーション]** をクリックし、構成するアプリケーションをクリックします。クイック スタート ページが開き、シングル サインオンと他の構成情報が表示されます。
1. コマンド バーの **[マニフェストの管理]** をクリックし、**[マニフェストのダウンロード]** を選択します。JSON アプリケーション マニフェスト ファイルを開き、"oauth2AllowImplicitFlow" 値を "true" に設定します。既定では、"false" になっています。

       "oauth2AllowImplicitFlow": true

1. 更新された JSON ファイルを保存したら、コマンド バーの **[マニフェストの管理]** をクリックし、**[マニフェストのアップロード]** を選択します。次に、更新されたマニフェスト ファイルを参照して選択し、ファイルをアップロードします。アップロードが完了すると、Web API でユーザー認証に OAuth 2.0 Implicit Grant が使用されるように構成されます。


### アクセスを許可する際の従来のエクスペリエンス

ここでは、2014 年 3 月 12 日より前の、従来の同意エクスペリエンスについて説明します。以下で説明するこのエクスペリエンスは、引き続きサポートされています。新機能の前には、次のアクセス許可だけを付与することができました。

- 組織のユーザーをサインオンする

- ユーザーをサインオンし、組織のディレクトリ データを読み取る (アプリケーションとしてのみ)

- ユーザーをサインオンし、組織のディレクトリ データの読み取りと書き込みを行う (アプリケーションとしてのみ)

「[Azure AD でのマルチテナント Web アプリケーションの開発](https://msdn.microsoft.com/library/azure/dn151789.aspx)」の手順に従って、Azure AD に登録された新しいアプリケーションにアクセスを許可することができます。新しい同意フレームワークでは、さらに強力なアプリケーションを許可し、管理者だけでなく、ユーザーもこれらのアプリケーションに同意できるようになったことに注意してください。

#### 外部ユーザーのアクセスを許可するリンクの作成 (旧)

外部ユーザーが組織のアカウントを使用してアプリケーションにサインアップするには、ユーザーがアクセスを許可できる Azure AD のページにリンクするボタンを表示するようにアプリケーションを更新する必要があります。このサインアップ ボタンのブランド化のガイダンスについては、「[アプリケーションのブランド化ガイドライン](active-directory-branding-guidelines.md)」をご覧ください。ユーザーがアクセスを許可または拒否すると、応答でブラウザーが Azure AD のアクセスの許可ページからアプリケーションにリダイレクトされます。アプリケーションのプロパティの詳細については、「[アプリケーション オブジェクトおよびサービス プリンシパル オブジェクト](active-directory-application-objects.md)」をご覧ください。

アクセスの許可ページは Azure AD によって作成されます。このページへのリンクは、管理ポータルのアプリケーションの [構成] ページに表示されます。[構成] ページにアクセスするには、Azure AD テナントの上部のメニューで [アプリケーション] リンクをクリックし、構成するアプリケーションをクリックして、クイック スタート ページの上部のメニューの [構成] をクリックします。

アプリケーションのリンクは、`http://account.activedirectory.windowsazure.com/Consent.aspx?ClientID=058eb9b2-4f49-4850-9b78-469e3176e247&RequestedPermissions=DirectoryReaders&ConsentReturnURL=https%3A%2F%2Fadatum.com%2FExpenseReport.aspx%3FContextId%3D123456` のようになります。次の表に、このリンクの各部分の説明を示します。

|パラメーター|説明|
|---|---|
|ClientId|必須。アプリケーションの追加操作の一環として取得したクライアント ID。|
|RequestedPermissions|省略可能。アプリケーションが要求するアクセス レベル。アプリケーションにアクセスを許可するユーザーに表示されます。このパラメーターを指定しない場合、要求するアクセス レベルは既定でシングル サインオンのみに設定されます。他のオプションとして、DirectoryReaders と DirectoryWriters があります。これらのアクセス レベルの詳細については、アプリケーションのアクセス レベルに関するページをご覧ください。|
|ConsentReturnUrl|省略可能。アクセスの許可の応答が返される URL。この値は URL エンコードする必要があり、アプリケーションの定義で構成した応答 URL と同じドメインに属する必要があります。このパラメーターを指定しない場合、アクセスの許可の応答は、構成済みの応答 URL にリダイレクトされます。|

応答 URL とは別に ConsentReturnUrl を指定すると、アプリケーションは (通常はサインオンの SAML トークンを処理する) 応答 URL とは異なる URL で応答を処理できる別のロジックを実装することが可能になります。また、ConsentReturnURL にエンコードされた URL に追加のパラメーターを指定することもできます。これらのパラメーターは、リダイレクト時にクエリ文字列パラメーターとしてアプリケーションに渡されます。このメカニズムを使用して、追加情報を保持したり、アプリケーションによるアクセスの許可要求を Azure AD からの応答に関連付けたりすることができます。

#### アクセスの許可のユーザー エクスペリエンスと応答 (旧)

アプリケーションがアクセスの許可リンクにリダイレクトすると、次のような画面がユーザーに表示されます。

ユーザーがまだサインインしていない場合は、サインインを求められます。

![AAD へのサインイン](./media/active-directory-integrating-applications/signintoaad.png)

ユーザーは、認証されると、アクセスの許可ページにリダイレクトされます。

![アクセスの許可](./media/active-directory-integrating-applications/grantaccess.png)

>[AZURE.NOTE]外部組織の会社の管理者だけが、アプリケーションにアクセスを許可できます。ユーザーが会社の管理者ではない場合は、このアプリケーションにアクセスを許可するよう依頼するメールを会社の管理者に送ることができます。

顧客が [アクセスの許可] をクリックしてアプリケーションにアクセスを許可した後、または [取り消し] をクリックしてアクセスを拒否した場合、Azure AD は ConsentReturnUrl または構成済みの応答 URL に応答を送信します。この応答には次のパラメーターが含まれます。

|パラメーター|説明|
|---|---|
|TenantId|アプリケーションにアクセスを許可した Azure AD 内の組織の一意の ID。このパラメーターは、顧客がアクセスを許可した場合にのみ指定されます。|
|同意|アプリケーションにアクセスを許可した場合、この値は Granted に設定され、要求が拒否された場合は Denied に設定されます。|

ConsentReturnUrl にエンコードされた URL の一部として、追加のパラメーターが指定されていた場合、それらのパラメーターがアプリケーションに返されます。次の例は、アプリケーションが承認されたことを示す、アクセスの許可要求への応答を示しています。この応答には、アクセスの許可要求で指定されていた ContextID が含まれています。`https://adatum.com/ExpenseReport.aspx?ContextID=123456&Consent=Granted&TenantId=f03dcba3-d693-47ad-9983-011650e64134`

>[AZURE.NOTE]アクセスの許可の応答に、ユーザーのセキュリティ トークンは含まれません。アプリケーションは、ユーザーを別途サインインさせる必要があります。

次の例は、拒否されたアクセスの許可要求への応答を示しています。`https://adatum.com/ExpenseReport.aspx?ContextID=123456&Consent=Denied`

#### Graph API へのアクセスが中断されないようにするためのアプリケーション キーのローリング (旧)

アプリケーションの有効期間中に、Azure AD にアクセスして Graph API を呼び出すアクセス トークンを取得するときに使用するキーを変更することが必要な場合があります。通常、キーの変更は、キーが侵害された場合の緊急ロールオーバーと、現在のキーが間もなく期限切れになるときのロールオーバーの 2 つのカテゴリに分類されます。(主に 2 番目のケースで) キーを更新する間、アプリケーションへのアクセスが中断されないようにするには、次の手順に従う必要があります。

1. Azure 管理ポータルで、ディレクトリ テナントをクリックし、上部のメニューで [アプリケーション] をクリックして、構成するアプリケーションをクリックします。クイック スタート ページが開き、シングル サインオンと他の構成情報が表示されます。

1. 上部のメニューで [構成] をクリックすると、アプリケーションのプロパティの一覧と、キーの一覧が表示されます。

1. [キー] の [時間の選択] というドロップダウンをクリックし、1 年または 2 年を選択して、コマンド バーの [保存] をクリックします。これにより、アプリケーションの新しいパスワード キーが生成されます。この新しいパスワード キーをコピーします。この時点では、アプリケーションは Azure AD からアクセス トークンを取得する際に、既存のキーと新しいキーのどちらも使用できます。

1. アプリケーションに戻り、新しいパスワード キーを使用するように構成を更新します。この更新を行う必要がある状況の例については、「[Graph API を使用した Azure AD のクエリ](https://msdn.microsoft.com/library/azure/dn151791.aspx)」をご覧ください。

1. この変更は、運用環境全体に展開する必要があります。まず 1 つのサービス ノードで検証してから、残りのノードに展開してください。

1. 運用環境デプロイメント全体にわたって更新が完了したら、Microsoft Azure 管理ポータルに戻り、古いキーを削除できます。

#### アクセス有効化後のアプリケーションのプロパティの変更 (旧)

アプリケーションへの外部ユーザーのアクセスを有効にしたら、Microsoft Azure 管理ポータルで引き続きアプリケーションのプロパティを変更することもできます。ただし、アプリケーションに変更を加える前に、既にアプリケーションにアクセスを許可していた顧客は、Microsoft Azure 管理ポータルでアプリケーションに関する詳細情報を表示したときに、変更内容は反映されません。顧客がアプリケーションを既に使用できる場合は、変更を加えるときに十分に注意する必要があります。たとえば、アプリケーション ID URI を更新した場合、この変更前にアクセスを許可していた既存の顧客は、会社または学校のアカウントを使用して、アプリケーションにログインできなくなります。

より高いアクセス レベルを要求するように RequestedPermissions を変更した場合、その高いアクセス レベルを使用して新しい API 呼び出しを利用するようになったアプリケーションの機能を使用する既存の顧客には、Graph API からアクセスの拒否の応答が返される可能性があります。アプリケーションは、このような状況に対応し、高いアクセス レベルの要求があるアプリケーションにアクセスを許可するよう顧客に求める必要があります。

## アプリケーションの削除

ここでは、シングル テナント アプリケーションとマルチテナントの両方について、ディレクトリからアプリケーションを削除する方法について説明します。

### ディレクトリからシングル テナント アプリケーションを削除するには

1. Microsoft Azure 管理ポータルにサインインします。

1. 左側のメニューの [Active Directory] アイコンをクリックし、目的のディレクトリをクリックします。

1. 上部のメニューで [アプリケーション] をクリックし、構成するアプリケーションをクリックします。クイック スタート ページが開き、シングル サインオンと他の構成情報が表示されます。

1. コマンド バーの [削除] をクリックします。

1. 確認メッセージが表示されたら、[はい] をクリックします。

### ディレクトリからマルチテナント アプリケーションを削除するには

1. Microsoft Azure 管理ポータルにサインインします。

1. 左側のメニューの [Active Directory] アイコンをクリックし、目的のディレクトリをクリックします。

1. 上部のメニューで [アプリケーション] をクリックし、構成するアプリケーションをクリックします。クイック スタート ページが開き、シングル サインオンと他の構成情報が表示されます。

1. [アプリケーションはマルチテナントです] セクションで [いいえ] をクリックします。これでアプリケーションはシングル テナントに変換されますが、アプリケーションは既に同意している組織に引き続き残されます。

1. コマンド バーの [削除] をクリックします。

1. 確認メッセージが表示されたら、[はい] をクリックします。

会社の管理者が (同意後に) ディレクトリへのアプリケーションのアクセス権を削除するには、Microsoft Azure 管理ポータルからアクセス権を削除するための Azure サブスクリプションが必要です。または、会社の管理者が、[Azure AD PowerShell コマンドレット](http://go.microsoft.com/fwlink/?LinkId=294151)を使用してアクセス権を削除することもできます。

## 次のステップ

- [統合アプリケーションのブランド化に関するガイドライン](active-directory-branding-guidelines.md)を参照する

- [アプリケーション オブジェクトとサービス プリンシパル オブジェクト](active-directory-application-objects.md)について学ぶ

- [Azure Active Directory のアプリケーション マニフェスト](active-directory-application-manifest.md)について理解する

- [Active Directory 開発者ガイド](active-directory-developer's guide.md) を参照する

<!---HONumber=Sept15_HO3-->