---
title: "アプリケーション プロキシ アプリケーション使用時に企業アプリケーションにアクセスできないエラー | Microsoft Docs"
description: "Azure AD アプリケーション プロキシ アプリケーションのアクセスに関する一般的な問題の解決方法。"
services: active-directory
documentationcenter: 
author: ajamess
manager: femila
ms.assetid: 
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/11/2017
ms.author: asteen
ms.openlocfilehash: 78ff8763a461162cbcfa04c6a86123973271928a
ms.sourcegitcommit: 6699c77dcbd5f8a1a2f21fba3d0a0005ac9ed6b7
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 10/11/2017
---
# <a name="cant-access-this-corporate-application-error-when-using-an-application-proxy-application"></a>アプリケーション プロキシ アプリケーション使用時の "この企業アプリケーションにアクセスできない" というエラー

この記事では、Azure AD アプリケーション プロキシ アプリケーションで "この企業アプリにアクセスできない" というエラーが表示される一般的な問題をトラブルシューティングする方法について説明します。

## <a name="overview"></a>概要
このエラーが表示された場合、ページでは状態コードも共有されます。 そのコードは、次のいずれかになる可能性があります。

-   **ゲートウェイ タイムアウト**: アプリケーション プロキシ サービスがコネクタに到達できません。 これは通常、コネクタの割り当て、コネクタ自体、またはコネクタ周りのネットワーク規則に関する問題を示しています。

-   **無効なゲートウェイ**: コネクタがバックエンド アプリケーションに到達できません。 これは、アプリケーションの誤った構成を示している可能性があります。

-   **許可されていません**: ユーザーがアプリケーションへのアクセスを許可されていません。 これは、ユーザーが Azure Active Directory 内のアプリケーションに割り当てられていない場合、またはバックエンドでユーザーにアプリケーション アクセスのためのアクセス許可がない場合のどちらかで発生することがあります。

このコードを見つけるには、エラー メッセージの左下にあるテキストの [状態コード] フィールドを調べます。 また、ページの一番下にその他のヒントを含む注記事項がないかどうかも探します。

   ![ゲートウェイ タイムアウト エラー](./media/application-proxy/connection-problem.png)

これらのエラーの原因をトラブルシューティングする方法の詳細、および推奨される解決策の詳細については、以下の対応するセクションを参照してください。

## <a name="gateway-timeout-errors"></a>ゲートウェイ タイムアウト エラー

ゲートウェイ タイムアウトは、サービスがコネクタに到達しようとしたが、タイムアウト ウィンドウ内に到達できない場合に発生します。 これは通常、動作するコネクタがないコネクタ グループ、またはコネクタに必要な一部のポートが開いていないコネクタ グループに割り当てられたアプリケーションで発生します。


## <a name="bad-gateway-errors"></a>無効なゲートウェイのエラー

無効なゲートウェイのエラーは、コネクタがバックエンド アプリケーションに到達できないことを示します。 正しいアプリケーションを発行していることを確認します。 このエラーの原因となる一般的な間違い:

-   内部 URL への入力ミスまたは間違い

-   アプリケーションのルートが発行されていない。 たとえば、<http://expenses/reimbursement> を発行しているが、<http://expenses> にアクセスしようとしている

-   Kerberos の制約付き委任 (KCD) の構成に関する問題

-   バックエンド アプリケーションに関する問題

## <a name="forbidden-errors"></a>許可されていないというエラー

許可されていないというエラーが表示された場合は、ユーザーがアプリケーションに割り当てられていません。 これは、Azure Active Directory またはバックエンド アプリケーションのどちらかで発生することがあります。

ユーザーを Azure 内のアプリケーションに割り当てる方法については、[構成ドキュメント](https://docs.microsoft.com/azure/active-directory/application-proxy-publish-azure-portal#add-a-test-user)を参照してください。

ユーザーが Azure 内のアプリケーションに割り当てられていることを確認する場合は、バックエンド アプリケーションでユーザー構成をチェックします。 Kerberos の制約付き委任/統合 Windows 認証を使用している場合は、[KCD トラブルシューティング] ページにいくつかのガイドラインが表示されます。

## <a name="check-the-applications-internal-url"></a>アプリケーションの内部 URL を確認する

最初のクイック ステップとして、**[エンタープライズ アプリケーション]** からアプリケーションを開き、次に **[アプリケーション プロキシ]** メニューを選択することにより、内部 URL を二重にチェックして修正します。 これが正しい内部 URL、つまりアプリケーションにアクセスするためにオンプレミス ネットワークから使用される URL であることを確認します。

## <a name="check-the-application-is-assigned-to-a-working-connector-group"></a>アプリケーションが動作するコネクタ グループに割り当てられていることを確認する

アプリケーションが動作するコネクタ グループに割り当てられていることを確認するには、次の手順に従います。

1.  **Azure Active Directory** に移動し、**[エンタープライズ アプリケーション]**、次に **[すべてのアプリケーション]** をクリックして、ポータルでアプリケーションを開きます。 アプリケーションを開き、左側のメニューから **[アプリケーション プロキシ]** を選択します。

2.  [コネクタ グループ] フィールドを調べます。 グループ内にアクティブなコネクタがない場合は、警告が表示されます。 警告が表示されない場合は、[verify all required ports are whitelisted] \(必要なすべてのポートがホワイトリストに登録されていることを確認する) に移動します。

3.  これが間違ったコネクタ グループである場合は、ドロップダウンを使用して正しいグループを選択し、警告が表示されなくなったことを確認します。 これが目的のコネクタ グループである場合は、警告メッセージをクリックして、コネクタ管理のページを開きます。

4.  ここから、さらに詳細に調べるための方法がいくつかあります。

  * アクティブなコネクタをグループに移動する: このグループに属し、ターゲットのバックエンド アプリケーションにアクセスできるアクティブなコネクタがある場合は、そのコネクタを割り当てられたグループに移動できます。 それを行うには、コネクタをクリックします。 [コネクタ グループ] フィールドで、ドロップダウンを使用して正しいグループを選択し、[保存] をクリックします。

  * そのグループの新しいコネクタをダウンロードする: このページから、[新しいコネクタをダウンロードする](https://download.msappproxy.net/Subscription/d3c8b69d-6bf7-42be-a529-3fe9c2e70c90/Connector/Download)ためのリンクを取得できます。 コネクタは、バックエンド アプリケーションに直接アクセスできるマシンにインストールする必要があり、通常はアプリケーションと同じサーバーに配置されます。 [コネクタのダウンロード] リンクを使用して、ターゲット コンピューターにコネクタをダウンロードします。 次に、コネクタをクリックし、[コネクタ グループ] ドロップダウンを使用して、それが正しいグループに属すようにします。

  * 非アクティブなコネクタを調査する: コネクタが非アクティブとして表示されている場合、そのコネクタはサービスに到達できません。 これは通常、必要な一部のポートがブロックされているために発生します。 この問題を解決するには、[verify all required ports are whitelisted] \(必要なすべてのポートがホワイトリストに登録されていることを確認する) に移動します。

これらの手順を使用して、動作するコネクタを含むグループにアプリケーションが割り当てられていることを確認した後、アプリケーションを再度テストします。 まだ動作しない場合は、次のセクションに進みます。

## <a name="check-all-required-ports-are-whitelisted"></a>必要なすべてのポートがホワイトリストに登録されていることを確認する

必要なすべてのポートが開いていることを確認するには、ポートの開放に関するドキュメントを参照してください。 必要なすべてのポートが開いている場合は、次のセクションに移動します。

## <a name="check-for-other-connector-errors"></a>その他のコネクタ エラーを確認する

上記のどの解決策でも問題が解決されない場合は、次の手順として、コネクタ自体の問題またはエラーを調べます。 いくつかの一般的なエラーは、[トラブルシューティング ドキュメント](https://docs.microsoft.com/azure/active-directory/active-directory-application-proxy-troubleshoot#connector-errors)で確認できます。 

また、コネクタのログを直接確認して、エラーを識別することもできます。 多くのエラー メッセージで、解決策のためのより具体的な推奨事項を共有できます。 ログを表示する方法については、[コネクタのドキュメント](https://docs.microsoft.com/azure/active-directory/application-proxy-understand-connectors#under-the-hood)を参照してください。

## <a name="additional-resolutions"></a>その他の解決策

上記の解決策によって問題が解決されない場合は、いくつかの別の原因が考えられます。 問題を識別するには、次の手順に従います。

アプリケーションが統合 Windows 認証 (IWA) を使用するように構成されている場合は、シングル サインオンなしでアプリケーションをテストします。 そうでない場合は、次の段落に移動します。 シングル サインオンなしでアプリケーションを確認するには、**[エンタープライズ アプリケーション]** からアプリケーションを開き、**[シングル サインオン]** メニューに移動します。 ドロップダウンを [統合 Windows 認証] から [Azure AD single sign-on disabled] \(Azure AD シングル サインオンは無効) に変更します。 

ここでブラウザーを開き、再度アプリケーションへのアクセスを試みます。 認証が求められ、アプリケーションが表示されます。 これが機能する場合、問題は、シングル サインオンを有効にする Kerberos の制約付き委任 (KCD) 構成に関係しています。 KCD のトラブルシューティングに関するページを参照してください。

引き続きエラーが表示される場合は、コネクタがインストールされているマシンに移動してブラウザーを開き、アプリケーションに使用されている内部 URL への到達を試みます。 コネクタは、同じマシンの別のクライアントのように動作します。 アプリケーションに到達できない場合は、そのマシンがアプリケーションに到達できない原因を調査するか、またはアプリケーションにアクセスできるサーバー上のコネクタを使用します。

そのマシンからアプリケーションに到達できる場合は、コネクタ自体の問題またはエラーを調べます。 いくつかの一般的なエラーは、[トラブルシューティング ドキュメント](https://docs.microsoft.com/azure/active-directory/active-directory-application-proxy-troubleshoot#connector-errors)で確認できます。 また、コネクタのログを直接確認して、エラーを識別することもできます。 多くのエラー メッセージで、解決策のためのより具体的な推奨事項を共有できます。 ログを表示する方法については、[コネクタのドキュメント](https://docs.microsoft.com/azure/active-directory/application-proxy-understand-connectors#under-the-hood)を参照してください。

## <a name="next-steps"></a>次のステップ
[Azure AD アプリケーション プロキシ コネクタについて](application-proxy-understand-connectors.md)
