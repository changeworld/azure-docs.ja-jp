---
title: シングル サインオンの構成 - Azure Active Directory | Microsoft Docs
description: このチュートリアルでは、Azure portal を使って、Azure Active Directory (Azure AD) による SAML ベースのシングル サインオンをアプリケーションに構成します。
services: active-directory
author: msmimart
manager: CelesteDG
ms.service: active-directory
ms.subservice: app-mgmt
ms.topic: tutorial
ms.workload: identity
ms.date: 04/08/2019
ms.author: mimart
ms.reviewer: arvinh,luleon
ms.collection: M365-identity-device-management
ms.openlocfilehash: 634c1d05847f3d4d7b7168d484cd16bf8e351b27
ms.sourcegitcommit: 0ebc62257be0ab52f524235f8d8ef3353fdaf89e
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 07/10/2019
ms.locfileid: "67723925"
---
# <a name="tutorial-configure-saml-based-single-sign-on-for-an-application-with-azure-active-directory"></a>チュートリアル:Azure Active Directory による SAML ベースのシングル サインオンをアプリケーションに構成する

このチュートリアルでは、[Azure portal](https://portal.azure.com) を使って、Azure Active Directory (Azure AD) による SAML ベースのシングル サインオンをアプリケーションに構成します。 [アプリケーション固有のチュートリアル](../saas-apps/tutorial-list.md)が利用できないとき、このチュートリアルを利用してください。

このチュートリアルでは、Azure portal を使用して次の作業を行います。

> [!div class="checklist"]
> * SAML ベースのシングル サインオン モードを選択する
> * アプリケーションに固有のドメインと URL を構成する
> * ユーザー属性を構成する
> * SAML 署名証明書を作成する
> * アプリケーションにユーザーを割り当てる
> * SAML ベースのシングル サインオンに対応するようにアプリケーションを構成する
> * SAML 設定のテスト

## <a name="before-you-begin"></a>開始する前に

1. Azure AD テナントにアプリケーションが追加されていない場合、「[クイック スタート:Azure AD テナントにアプリケーションを追加する](add-application-portal.md)」を参照してください。
1. 「[基本的な SAML オプションを構成する](#configure-basic-saml-options)」に記載されている情報をご使用のアプリケーションのベンダーに問い合わせます。
1. このチュートリアルの手順をテストする場合は、非運用環境を使用します。 Azure AD の非運用環境がない場合は、[1 か月の評価版を入手できます](https://azure.microsoft.com/pricing/free-trial/)。
1. クラウド アプリケーション管理者か Azure AD テナントのアプリケーション管理者として [Azure portal](https://portal.azure.com) にサインインします。

## <a name="select-a-single-sign-on-mode"></a>シングル サインオン モードを選択する

ご自分の Azure AD テナントにアプリケーションを追加したら、アプリケーションにシングル サインオンを構成する準備は完了です。

シングル サインオンの設定を開くには、次の手順に従います。

1. [Azure portal](https://portal.azure.com) の左側のナビゲーション パネルで、 **[Azure Active Directory]** を選択します。
1. 表示された **Azure Active Directory** のナビゲーション パネルの **[管理]** の下で **[エンタープライズ アプリケーション]** を選択します。 ご自分の Azure AD テナント内にあるアプリケーションのランダム サンプルが表示されます。
1. **[アプリケーションの種類]** メニューの **[すべてのアプリケーション]** を選択した後、 **[適用]** を選択します。
1. シングル サインオンを構成するアプリケーションの名前を入力します。 たとえば、「**GitHub-test**」と入力して、[アプリケーションの追加](add-application-portal.md)に関するクイック スタートで追加したアプリケーションを構成できます。  

   ![アプリケーションの検索バーを示すスクリーンショット](media/configure-single-sign-on-portal/azure-portal-application-search.png)

1. シングル サインオンを構成するアプリケーションを選択します。
1. **[管理]** セクションの **[シングル サインオン]** を選択します。
1. **[SAML]** を選択して、シングル サインオンを構成します。 **[SAML によるシングル サインオンのセットアップ - プレビュー]** ページが表示されます。

## <a name="configure-basic-saml-options"></a>基本的な SAML オプションを構成する

ドメインと URL を構成するには、次の手順に従います。

1. 次の設定についての正しい情報をアプリケーションのベンダーに問い合わせます。

    | 構成設定 | SP-Initiated | idP-Initiated | 説明 |
    |:--|:--|:--|:--|
    | 識別子 (エンティティ ID) | 一部のアプリでは必須 | 一部のアプリでは必須 | シングル サインオンの構成対象となるアプリケーションを一意に識別します。 Azure AD から ID が SAML トークンの Audience パラメーターとしてアプリケーションに送信されます。 アプリケーションではこの ID を検証する必要があります。 また、この値はアプリケーションによって提供される SAML メタデータ内に Entity ID として表示されます。|
    | [応答 URL] | 省略可能 | 必須 | アプリケーションが SAML トークンを受け取ることになっている場所を指定します。 応答 URL は Assertion Consumer Service (ACS) URL とも呼ばれています。 |
    | [サインオン URL] | 必須 | 指定しません | この URL をユーザーが開くと、サービス プロバイダーは、ユーザーの認証とサインインを行う Azure AD にそのユーザーをリダイレクトします。 Azure AD はその URL を使用して Office 365 または Azure AD アクセス パネルからアプリケーションを起動します。 空白の場合、Azure AD では、ユーザーがアプリケーションを起動したときにシングル サインオンを開始する際、ID プロバイダーが利用されます。|
    | リレー状態 | 省略可能 | 省略可能 | 認証が完了した後にユーザーをリダイレクトする場所をアプリケーションに指示します。 通常、値はアプリケーションで有効な URL です。 ただし、一部のアプリケーションでは、このフィールドを異なる方法で使用します。 詳細については、アプリケーションのベンダーに問い合わせてください。
    | ログアウト URL | 省略可能 | 省略可能 | SAML ログアウト応答をアプリケーションに返送するために使用します。

1. 基本的な SAML 構成オプションを編集するには、 **[基本的な SAML 構成]** セクションの右上隅にある **[編集]** アイコン (鉛筆) を選択します。

     ![基本的な SAML 構成のオプションを編集する](media/configure-single-sign-on-portal/basic-saml-configuration-edit-icon.png)

1. ページ上の適切な各フィールドに、手順 1. でアプリケーション ベンダーから提供された情報を入力します。
1. ページの最上部で **[保存]** を選択します。

## <a name="configure-user-attributes-and-claims"></a>ユーザー属性と要求を構成する

ユーザーがサインインしたときに Azure AD からアプリケーションに SAML トークンで送信される情報を制御できます。 この情報を制御するには、ユーザー属性を構成します。 たとえば、ユーザーがサインインしたときにユーザーの名前やメール アドレス、従業員 ID をアプリケーションに送信するよう Azure AD を構成できます。

シングル サインオンが適切に機能するうえで、これらの属性が必要な場合もあれば、省略可能な場合もあります。 詳細については、[ アプリケーションに固有のチュートリアル](../saas-apps/tutorial-list.md)を参照するか、アプリケーションのベンダーに問い合わせてください。

1. ユーザー属性と要求を編集するには、 **[ユーザー属性と要求]** セクションの右上隅にある **[編集]** アイコン (鉛筆) を選択します。

   **[名前識別子の値]** には、既定値の *user.principalname* が設定されています。 アプリケーション内の各ユーザーは、ユーザー識別子によって一意に識別されます。 たとえば、メール アドレスがユーザー名と一意識別子を兼ねている場合、この値を *user.mail* に設定します。

1. **[名前識別子の値]** を変更するには、 **[名前識別子の値]** フィールドの **[編集]** アイコン (鉛筆) を選択します。 必要に応じて、識別子の形式とソースに適切な変更を加えます。 完了したら、変更を保存します。 要求のカスタマイズの詳細については、ハウツー記事「[エンタープライズ アプリケーションの SAML トークンで発行された要求のカスタマイズ](../develop/active-directory-saml-claims-customization.md)」を参照してください。
1. 要求を追加するには、ページの上部にある **[新しいクレームの追加]** を選択します。 **[名前]** を入力し、適切なソースを選択します。 **[属性]** ソースを選択した場合、使用する**ソース属性**を選択する必要があります。 **[翻訳]** ソースを選択した場合、使用する**変換**と**パラメーター 1** を選択する必要があります。
1. **[保存]** を選択します。 新しい要求が表に表示されます。

## <a name="generate-a-saml-signing-certificate"></a>SAML 署名証明書を生成する

Azure AD は、アプリケーションに送信する SAML トークンに対し、証明書を使って署名します。

1. 新しい証明書を生成するには、 **[SAML 署名証明書]** セクションの右上隅にある **[編集]** アイコン (鉛筆) を選択します。
1. **[SAML 署名証明書]** セクションの **[新しい証明書]** を選択します。
1. 表示された新しい証明書の行で、 **[有効期限日]** を設定します。 使用可能な構成オプションの詳細については、[詳細な証明書署名オプション](certificate-signing-options.md)に関する記事を参照してください。
1. **[SAML 署名証明書]** セクションの上部にある **[保存]** を選択します。

## <a name="assign-users-to-the-application"></a>アプリケーションにユーザーを割り当てる

アプリケーションをご自分の組織にロールアウトする前に、複数のユーザーまたはグループを対象にシングル サインオンをテストすることをお勧めします。

> [!NOTE]
> これらの手順を実行すると、ポータルの **[ユーザーとグループ]** 構成セクションに移動します。 終了したら、チュートリアルを完了するために、 **[シングル サインオン]** セクションに戻る必要があります。

アプリケーションにユーザーまたはグループを割り当てるには、次の手順に従います。

1. ポータルでアプリケーションを開きます (まだ開いていない場合)。
1. アプリケーションの左側のナビゲーション パネルで、 **[ユーザーとグループ]** を選択します。
1. **[ユーザーの追加]** を選択します。
1. **[割り当ての追加]** セクションの **[ユーザーとグループ]** を選択します。
1. 特定のユーザーを検索するには、 **[メンバーの選択または外部ユーザーの招待]** ボックスにユーザーの名前を入力します。 次に、ユーザーのプロファイル写真またはロゴを選択し、 **[選択]** を選択します。
1. **[割り当ての追加]** セクションの **[割り当て]** を選択します。 完了すると、選択したユーザーが **[ユーザーとグループ]** の一覧に表示されます。

## <a name="set-up-the-application-to-use-azure-ad"></a>Azure AD を使用するようにアプリケーションを設定する

あともう少しで終了です。  最後の手順として、Azure AD を SAML ID プロバイダーとして使用するようアプリケーションを設定する必要があります。 

1. **[\<applicationName> のセットアップ]** セクションまで下にスクロールします。 このチュートリアルでは、このセクションは **[GitHub-test のセットアップ]** となります。
1. このセクション内の各行から値をコピーします。 次に、それぞれの値を **[基本的な SAML 構成]** セクション内の適切な行に貼り付けます。 たとえば、 **[GitHub-test のセットアップ]** セクションの **[ログイン URL]** の値をコピーし、 **[基本的な SAML 構成]** セクションの **[サインオン URL]** に貼り付けます。他も同様です。
1. すべての値を適切なフィールドに貼り付けたら、 **[保存]** を選択します。

## <a name="test-single-sign-on"></a>シングル サインオンのテスト

ご自分の設定をテストする準備が整いました。  

1. アプリケーションのシングル サインオン設定を開きます。
1. **[\<applicationName> でシングル サインオンを検証]** セクションまでスクロールします。 このチュートリアルでは、このセクションは **[GitHub-test のセットアップ]** となります。
1. **[テスト]** を選択します。 テストのオプションが表示されます。
1. **[現在のユーザーとしてサインイン]** を選択します。 このテストにより、管理者である自分に関して、シングル サインオンが機能しているかどうかを確認できます。

エラーが発生した場合は、エラー メッセージが表示されます。 次の手順を完了します。

1. 詳細をコピーして **[エラーの説明]** ボックスに貼り付けます。

    ![[エラーの説明] ボックスを使って解決のガイダンスを得る](media/configure-single-sign-on-portal/error-guidance.png)

1. **[解決ガイダンスを入手する]** を選択します。 根本原因と解決ガイダンスが表示されます。  この例では、アプリケーションにユーザーが割り当てられていませんでした。
1. 解決ガイダンスを読み、可能であれば問題を解決します。
1. 成功するまでテストを再実行します。

## <a name="next-steps"></a>次の手順

このチュートリアルでは、アプリケーションのシングル サインオン設定を構成しました。 構成の完了後、ユーザーをアプリケーションに割り当てて、SAML ベースのシングル サインオンを使うための構成をアプリケーションに対して行いました。 その作業がすべて完了した時点で、SAML のサインオンが正常に機能していることを確認しました。

以下のことを行いました。
> [!div class="checklist"]
> * シングル サインオン モードに SAML を選択しました
> * アプリケーションのベンダーに問い合わせてドメインと URL を構成しました
> * ユーザー属性を構成しました
> * SAML 署名証明書を作成しました
> * ユーザーまたはグループをアプリケーションに手動で割り当てました
> * Azure AD を SAML ID プロバイダーとして使用するようにアプリケーションを構成しました
> * SAML ベースのシングル サインオンをテストしました

ご自分の組織内の他のユーザーについてもアプリケーションをロールアウトする場合は、自動ユーザー プロビジョニングを使用します。

> [!div class="nextstepaction"]
> [自動プロビジョニングを使ってユーザーを割り当てる方法について](configure-automatic-user-provisioning-portal.md)
