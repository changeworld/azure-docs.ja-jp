---
title: Azure AD の継続的アクセス評価
description: Azure AD の継続的アクセス評価により、ユーザー状態の変化に迅速に対応
services: active-directory
ms.service: active-directory
ms.subservice: conditional-access
ms.topic: conceptual
ms.date: 04/21/2020
ms.author: joflore
author: MicrosoftGuyJFlo
manager: daveba
ms.reviewer: jlu
ms.collection: M365-identity-device-management
ms.openlocfilehash: 3713901dd3dd5d17c4e1ddcef529c663b68f5b43
ms.sourcegitcommit: 849bb1729b89d075eed579aa36395bf4d29f3bd9
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/28/2020
ms.locfileid: "82112577"
---
# <a name="continuous-access-evaluation"></a>継続的アクセス評価

Azure Active Directory (Azure AD) や Office 365 などの Microsoft サービスは、オープン標準とプロトコルを使用して相互運用性を最大化します。 最も重要なものの 1 つが、Open ID Connect (OIDC) です。 Outlook などのクライアント アプリケーションが Exchange Online などのサービスに接続する場合、API 要求は OAuth 2.0 アクセス トークンを使用して承認されます。 既定では、これらのアクセス トークンは 1 時間有効です。 これが切れると、クライアントが Azure AD にリダイレクトされて更新されます。 またこれにより、ユーザー アクセスのポリシーを再評価する機会も提供します。条件付きアクセス ポリシーのため、またはディレクトリのユーザーが無効であるために、トークンの更新を省略する場合があります。 

トークンの有効期限と更新は、業界の標準メカニズムです。 これに対して、ユーザーのリスク条件が変化したタイミング (たとえば、企業オフィスから現地のコーヒー ショップへの移動や、ブラック マーケットでのユーザー資格情報の検出など) と、その変更に関連したポリシーを適用できるタイミングとのタイム ラグに関する懸念事項が顧客から示されています。 トークンの有効期間を短縮した "ブラント オブジェクト" アプローチを用いて実験を行いましたが、この場合、リスクがなくならずにユーザー エクスペリエンスと信頼性が低下する可能性があります。

ポリシー違反やセキュリティの問題にタイムリーに対応するには、トークン発行元 (Azure AD など) と証明書利用者 (Exchange Online など) の間で "対話" を行う必要があります。 この双方向の対話では、2 つの重要な機能が提供されます。 証明書利用者は、変更 (新しい場所からのクライアントの移動など) が生じるとそれを認識し、トークン発行元に通知することができます。 また、アカウントの侵害、無効化、またはその他の懸念事項により、特定のユーザーのトークンへの信用を停止するよう証明書利用者に指示する方法が、トークン発行元に提供されます。 この対話のメカニズムは、連続的アクセス評価 (CAE) と呼ばれます。

Microsoft は、OpenID Foundation における [Shared Signals and Events](https://openid.net/wg/sse/) ワーキング グループの一部である、継続的アクセス評価プロトコル (CAEP) イニシアチブに、その一員として早くから参加しています。 ID プロバイダーと証明書利用者は、ワーキング グループによって定義されたセキュリティ イベントと通知を利用して、アクセスを再認証または終了することができるようになります。 これは、多くのプラットフォームやアプリケーションのセキュリティを向上させる、魅力的な仕事です。

その非常に優れたセキュリティ上の利点により、Microsoft 固有の初期実装を、標準機関の通常業務と並列でロールアウトします。 また、Microsoft サービス全体でこれらの継続的アクセス評価 (CAE) 機能を展開する中で得られた多くの知見については、規格コミュニティと共有しています。 Microsoft の展開の経験が業界標準をさらに向上させ、その標準が承認された暁には、実装に取り組んでいきます。これにより、参加しているすべてのサービスが恩恵を受けることができます。

## <a name="how-does-cae-work-in-microsoft-services"></a>Microsoft サービスで CAE はどのように機能しますか。

Microsoft では、継続的アクセス評価の最初の実装について、Exchange と Teams に焦点を絞っています。 今後、他の Microsoft サービスへサポートを拡張する予定です。 条件付きアクセス ポリシーがないテナントに対してのみ、継続的アクセス評価の有効化を開始します。 CAE のこのフェーズでの学びを活用して、CAE の継続的なロールアウトを通知します。

## <a name="service-side-requirements"></a>サービス側の要件

継続的アクセス評価は、サービス (リソース プロバイダー) が Azure AD の重要なイベントをサブスクライブできるようにすることで実装されます。これにより、これらのイベントをほぼリアルタイムで評価および適用できます。 この最初の CAE ロールアウトでは、次のイベントが適用されます。

- ユーザーアカウントが削除または無効化された
- ユーザーのパスワードが変更またはリセットされた
- 管理者が、ユーザーのすべての更新トークンを明示的に取り消した
- Azure AD Identity Protection によって管理者特権のユーザー リスクが検出された

将来的には、場所やデバイスの状態の変更などのイベントを含む、イベントをさらに追加する予定です。 **目標はすぐに実施されることですが、場合によっては、イベントの伝播時間によって最大 15 分の待機時間が発生することがあります**。 

## <a name="client-side-claim-challenge"></a>クライアント側の要求チャレンジ

継続的アクセス評価を行う前に、クライアントは、期限切れになっていない限り、常にキャッシュからアクセス トークンを再生しようとします。 CAE では、リソース プロバイダーが期限切れになっていない場合も、トークンを拒否できる新しいケースが導入されています。 キャッシュされたトークンの有効期限が切れていない場合でも、クライアントにキャッシュをバイパスするように通知するために、**要求チャレンジ**と呼ばれるメカニズムが導入されました。 CAE で要求チャレンジを認識するには、クライアントの更新が必要です。 次のアプリケーションの最新バージョンで、要求チャレンジがサポートされています。

- Windows 用 Outlook 
- Outlook iOS 
- Outlook Android 
- Outlook Mac 
- Windows 用 Teams
- Teams iOS 
- Teams Android 
- Teams Mac 

## <a name="token-lifetime"></a>トークンの有効期間

リスクとポリシーはリアルタイムで評価されるため、継続的アクセス評価に対応するセッションをネゴシエートするクライアントは、既存の静的アクセス トークンの有効期間ポリシーの代わりに CAE に依存します。つまり、CAE 対応のセッションをネゴシエートする CAE 対応クライアントでは、構成可能なトークンの有効期間ポリシーが受け入れられなくなります。

CAE セッションでは、アクセス トークンの有効期間が 24 時間に延長されます。 失効するかどうかは、任意の期間ではなく、重要なイベントとポリシーの評価によって決まります。 この変更により、セキュリティ体制に影響を与えることなく、アプリケーションの安定性が向上します。 

## <a name="example-flows"></a>フローの例

### <a name="user-revocation-event-flow"></a>ユーザー失効イベントのフロー:

![ユーザー失効イベントのフロー](./media/concept-fundamentals-continuous-access-evaluation/user-revocation-event-flow.png)

1. CAE 対応のクライアントは、AAD に対して資格情報または更新トークンを提示し、何らかのリソースのアクセス トークンを要求します。
1. アクセス トークンは、他の成果物と共にクライアントに返されます。
1. 管理者は、[ユーザーのすべての更新トークンを明示的に失効](https://docs.microsoft.com/powershell/module/azuread/revoke-azureaduserallrefreshtoken?view=azureadps-2.0)します。 失効イベントは、Azure AD からリソース プロバイダーに送信されます。
1. リソース プロバイダーにアクセス トークンが提示されます。 リソース プロバイダーは、トークンの有効性を評価し、ユーザーの失効イベントがあるかどうかを確認します。 リソース プロバイダーは、この情報を使用して、リソースへのアクセスを許可するかどうかを決定します。
1. この場合、リソース プロバイダーはアクセスを拒否し、401+ 要求チャレンジをクライアントに送り返します
1. CAE 対応クライアントは、401+ 要求チャレンジを認識します。 キャッシュをバイパスし、手順 1 に戻り、要求チャレンジと共に更新トークンを Azure AD に送り返します。 その後、Azure AD ですべての条件が再評価され、この場合はユーザーに再認証を求めるメッセージが表示されます。
 
## <a name="faqs"></a>FAQ

### <a name="what-is-the-lifetime-of-my-access-token"></a>アクセス トークンの有効期間はどれくらいですか。

CAE 対応クライアントを使用していない場合でも、[構成可能なトークンの有効期間 (CTL)](../develop/active-directory-configurable-token-lifetimes.md) プレビュー機能を使用してアクセス トークンの有効期間を構成しない限り、既定のアクセス トークンの有効期間は 1 時間になります。

CAE 対応のセッションをネゴシエートする CAE 対応クライアントを使用している場合は、アクセス トークンの有効期間の CTL 設定が上書きされ、アクセス トークンの有効期間は 24 時間になります。

### <a name="how-quick-is-enforcement"></a>実施にはどれぐらいの時間がかかりますか。

目標はすぐに実施されることですが、場合によっては、イベントの伝播時間によって最大 15 分の待機時間が発生することがあります。

### <a name="how-will-cae-work-with-sign-in-frequency"></a>CAE はサインインの頻度ではどのように動作しますか。

サインインの頻度は、CAE の有無にかかわらず優先されます。

## <a name="next-steps"></a>次のステップ

[継続的アクセス評価の発表](https://techcommunity.microsoft.com/t5/azure-active-directory-identity/moving-towards-real-time-policy-and-security-enforcement/ba-p/1276933)
