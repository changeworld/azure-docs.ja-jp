---
title: SQL 脆弱性評価
titleSuffix: Azure SQL Database & SQL Managed Instance & Azure Synapse Analytics
description: Azure SQL Database、Azure SQL Managed Instance、および Azure Synapse Analytics で SQL の脆弱性評価を構成する方法と、評価レポートを解釈する方法について説明します。
services: sql-database
ms.service: sql-db-mi
ms.subservice: security
ms.custom: sqldbrb=3
ms.devlang: ''
ms.topic: how-to
author: davidtrigano
ms.author: datrigan
ms.reviewer: vanto
ms.date: 04/09/2021
tags: azure-synapse
ms.openlocfilehash: bff01bbb65228ff4fba6e0a71518bc0d778220d2
ms.sourcegitcommit: b4fbb7a6a0aa93656e8dd29979786069eca567dc
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/13/2021
ms.locfileid: "107307097"
---
# <a name="sql-vulnerability-assessment-helps-you-identify-database-vulnerabilities"></a>SQL 脆弱性評価は、データベースの脆弱性を特定するのに役立ちます
[!INCLUDE[appliesto-sqldb-sqlmi-asa](../includes/appliesto-sqldb-sqlmi-asa.md)]

SQL 脆弱性評価は、データベースの潜在的な脆弱性を検出、追跡、修復するのに役立つ、構成が容易なサービスです。 これを使用すると、事前の対策としてデータベースのセキュリティを向上させることができます。

脆弱性評価は、高度な SQL セキュリティ機能の統合パッケージである [Azure Defender for SQL](azure-defender-for-sql.md) オファリングの一部です。 脆弱性評価は、Azure Defender for SQL ポータルを使用して、一元的にアクセスおよび管理できます。

> [!NOTE]
> 脆弱性評価は、Azure SQL Database、Azure SQL Managed Instance、Azure Synapse Analytics でサポートされています。 Azure SQL Database、Azure SQL Managed Instance、Azure Synapse Analytics のデータベースは、この記事の残りの部分ではまとめてデータベースと呼ばれています。また、サーバーは、Azure SQL Database と Azure Synapse のデータベースをホストする[サーバー](logical-servers.md)を指しています。

## <a name="what-is-sql-vulnerability-assessment"></a>SQL 脆弱性評価とは

SQL 脆弱性評価は、セキュリティの状態を可視化するサービスです。 脆弱性評価には、セキュリティの問題を解決し、データベースのセキュリティを強化するために実践できる手順が含まれています。 これは、変更の追跡が困難な動的なデータベース環境を監視し、SQL のセキュリティ態勢を改善するのに役立ちます。

脆弱性評価は、Azure SQL Database に組み込まれているスキャン サービスです。 このサービスでは、セキュリティの脆弱性にフラグを付ける規則のナレッジ ベースが採用されています。 これは、誤った設定、過剰なアクセス許可、保護されていない機密データなど、ベスト プラクティスからの逸脱を明らかにします。

規則は Microsoft のベスト プラクティスに基づき、データベースとその貴重なデータにとって最も大きなリスクとなるセキュリティの問題に注目します。 データベース レベルの問題と、サーバーのファイアウォール設定やサーバー レベルの権限などのサーバー レベルのセキュリティ問題がカバーされます。

スキャンの結果には、各々の問題を解決するために実践できる手順が含まれ、カスタマイズした修復スクリプトが適宜提供されます。 次に対する許容されるベースラインを設定することにより、ご利用環境に合わせて評価レポートをカスタマイズできます。

- アクセス許可の構成
- 機能の構成
- データベース設定

## <a name="configure-vulnerability-assessment"></a>脆弱性評価を構成する

次の手順を使用して脆弱性評価を構成します。

1. [Azure portal](https://portal.azure.com) で、Azure SQL Database、SQL Managed Instance データベース、または Azure Synapse の特定のリソースにアクセスします。

1. **[セキュリティ]** の見出しの下で、 **[Security Center]** を選択します。

1. リンクの **[構成]** を選択して、サーバー全体またはマネージド インスタンスの Azure Defender for SQL の設定ペインを開きます。

    :::image type="content" source="media/sql-vulnerability-assessment/opening-sql-configuration.png" alt-text="Defender for SQL 構成を開く":::

    > [!NOTE]
    > SQL 脆弱性評価でスキャンを実行できるようにするには、**Azure Defender for SQL** プランが必要です。 Azure Defender for SQL を有効にする方法の詳細については、「[Azure Defender for SQL](azure-defender-for-sql.md)」を参照してください。

1. **[サーバー設定]** ページで、Azure Defender for SQL の設定を定義します。

    :::image type="content" source="media/sql-vulnerability-assessment/sql-vulnerability-scan-settings.png" alt-text="SQL 脆弱性評価スキャンを構成する":::

    1. サーバーまたはマネージド インスタンス上のすべてのデータベースに対するスキャン結果が格納されるストレージ アカウントを構成します。 ストレージ アカウントについて詳しくは、「[Azure ストレージ アカウントについて](../../storage/common/storage-account-create.md)」をご覧ください。

        > [!TIP]
        > ファイアウォールと VNet の内側での脆弱性評価スキャンの格納の詳細については、「[ファイアウォールと VNet の内側のアクセス可能なストレージ アカウントに脆弱性評価スキャンの結果を格納する](sql-database-vulnerability-assessment-storage.md)」を参照してください。

    1. セキュリティの構成の誤りを検出するために週単位のスキャンを自動的に実行するように脆弱性評価を構成するには、 **[定期的な反復スキャン]** を **[オン]** に設定します。 結果は、 **[スキャン レポートの送信先]** で指定したメール アドレスに送信されます。 また、 **[管理者とサブスクリプションの所有者にもメール通知を送信する]** を有効にすることで、管理者とサブスクリプションの所有者に電子メール通知を送信することもできます。

1. SQL 脆弱性評価スキャンは、オンデマンドで実行することもできます。

    1. リソースの **[Security Center]** ページで、 **[その他の脆弱性評価の調査結果を表示]** を選択して、以前のスキャンのスキャン結果にアクセスします。

        :::image type="content" source="media/sql-vulnerability-assessment/view-additional-findings-link.png" alt-text="スキャン結果と手動スキャン オプションを開く":::

    1. オンデマンド スキャンを実行してデータベースの脆弱性をスキャンするには、ツールバーの **[スキャン]** を選択します。

        :::image type="content" source="media/sql-vulnerability-assessment/on-demand-vulnerability-scan.png" alt-text="SQL リソースのオンデマンド脆弱性評価スキャンを実行するには、[スキャン] を選択します":::


  > [!NOTE]
  > このスキャンは軽量で安全です。 実行にかかるのは数秒で、完全に読み取り専用です。 データベースが変更されることはありません。

## <a name="remediate-vulnerabilities"></a>脆弱性の修復

脆弱性スキャンが完了すると、レポートが Azure portal に表示されます。 レポートには次のものが表示されます。

- セキュリティ状態の概要
- 検出された問題の数、および
- リスクの重要度別の概要
- 詳細な調査の結果一覧

:::image type="content" source="media/sql-vulnerability-assessment/sample-sql-vulnerabilities-report.png" alt-text="SQL 脆弱性評価スキャナーからのサンプル スキャン レポート":::

検出された脆弱性を修復するには:

1. 結果をレビューして、自分の環境にとってレポートのどの項目がセキュリティ上の真の問題かを判断します。

1. 失敗した各結果を選択して、その影響と、セキュリティ チェックが失敗した理由を理解します。

    > [!TIP]
    > 結果の詳細ページには、問題の解決方法を説明する実行可能な修復情報が含まれています。

    :::image type="content" source="media/sql-vulnerability-assessment/examining-vulnerability-findings.gif" alt-text="脆弱性スキャンの結果を調べる":::

1. 評価の結果を確認しながら、環境において許容される *ベースライン* として特定の結果をマークできます。 ベースラインは本来、結果のレポート方法をカスタマイズするものです。 ベースラインに一致する結果は、それ以降のスキャンで合格と見なされます。 ベースラインのセキュリティ状態を確立した後は、脆弱性評価では、ベースラインからの逸脱のみが報告されます。 これにより、関連する問題に意識を集中することができます。

    :::image type="content" source="media/sql-vulnerability-assessment/baseline-approval.png" alt-text="将来のスキャンのベースラインとして結果を承認する":::

1. ベースラインを変更する場合は、 **[スキャン]** ボタンを使用してオンデマンド スキャンを実行し、カスタマイズされたレポートを表示します。 ベースラインに追加したすべての結果が、ベースラインの変更によって合格したことを示す情報と共に **[合格]** に表示されるようになります。

    :::image type="content" source="media/sql-vulnerability-assessment/passed-per-custom-baseline.png" alt-text="カスタム ベースラインに従って合格したことを示す合格評価":::

脆弱性評価スキャンを使って、データベースが高レベルのセキュリティを維持し、組織のポリシーが満たされるようになりました。 

## <a name="advanced-capabilities"></a>拡張機能

### <a name="export-an-assessment-report"></a>評価レポートのエクスポート

**[スキャン結果のエクスポート]** を選択して、ダウンロード可能なスキャン結果の Excel レポートを作成します。 このレポートの概要タブには、評価の概要が表示されます。 レポートには、失敗したすべてのチェックが含まれます。 また、 **[結果]** タブには、スキャン結果の完全セットが含まれます。 結果には、実行されたすべてのチェックと、それぞれの結果の詳細が含まれます。

### <a name="view-scan-history"></a>スキャン履歴の表示

[脆弱性評価] ペインの **[スキャンの履歴]** を選択すると、このデータベースで以前に実行されたすべてのスキャンの履歴が表示されます。 一覧から特定のスキャンを選択すると、そのスキャンの詳しい結果が表示されます。

### <a name="disable-specific-findings-from-azure-security-center-preview"></a>Azure Security Center からの特定の結果を無効にする (プレビュー)

組織のニーズとして、検出結果を修復するのではなく無視する必要がある場合は、必要に応じて検出結果を無効にできます。 無効化された検出結果は、セキュリティ スコアに影響を与えたり、不要なノイズを生成したりすることはありません。

検出結果が、無効化ルールで定義した条件に一致する場合、検出結果の一覧には表示されません。 一般的なシナリオは次のとおりです。

- 重大度が中以下の検出結果を無効にする
- パッチを適用できない検出結果を無効にする
- 定義されたスコープの対象にならないベンチマークからの結果を無効にする

> [!IMPORTANT]
> 特定の検出結果を無効にするには、Azure Policy でポリシーを編集するためのアクセス許可が必要です。 詳細については、「[Azure Policy における RBAC アクセス許可](../../governance/policy/overview.md#azure-rbac-permissions-in-azure-policy)」を参照してください。

ルールを作成するには:

1. **[マシン上の SQL サーバーの脆弱性評価の結果を修復する必要がある]** という推奨事項の詳細ページで、 **[ルールを無効にする]** を選択します。

1. 関連するスコープを選択します。

1. 条件を定義します。 次のいずれかの条件を使用できます。 
    - ID の検索 
    - 重大度 
    - ベンチマーク 

    :::image type="content" source="../../security-center/media/defender-for-sql-on-machines-vulnerability-assessment/disable-rule-vulnerability-findings-sql.png" alt-text="マシン上の SQL サーバーでの VA の結果に対して無効化ルールを作成する":::

1. **[ルールの適用]** を選択します。 変更が有効になるまでに最大 24 時間かかることがあります。

1. ルールを表示、無効化、または削除するには、次の手順に従います。 

    1. **[ルールを無効にする]** を選択します。

    1. アクティブなルールが適用されているサブスクリプションは、スコープの一覧に **[Rule applied]\(ルール適用済み\)** と表示されます。

        :::image type="content" source="../../security-center/media/remediate-vulnerability-findings-vm/modify-rule.png" alt-text="既存のルールを変更または削除する":::

    1. ルールを表示または削除するには、省略記号メニュー ("...") を選択します。

## <a name="manage-vulnerability-assessments-programmatically"></a>プログラムによる脆弱性評価の管理

### <a name="using-azure-powershell"></a>Azure PowerShell の使用

[!INCLUDE [updated-for-az](../../../includes/updated-for-az.md)]
> [!IMPORTANT]
> PowerShell Azure Resource Manager モジュールは引き続きサポートされますが、今後の開発はすべて Az.Sql モジュールを対象に行われます。 これらのコマンドレットについては、「[AzureRM.Sql](/powershell/module/AzureRM.Sql/)」を参照してください。 Az モジュールと AzureRm モジュールのコマンドの引数は実質的に同じです。

Azure PowerShell コマンドレットを使用して、脆弱性評価をプログラムで管理できます。 サポートされているコマンドレットは次のとおりです。

| コマンドレット名 (リンク) | 説明 |
| :-------------------- | :---------- |
| [Clear-AzSqlDatabaseVulnerabilityAssessmentRuleBaseline](/powershell/module/az.sql/Clear-azSqlDatabaseVulnerabilityAssessmentRuleBaseline) | 脆弱性評価規則のベースラインをクリアします。<br/>このコマンドレットを使用してクリアする前に、まずベースラインを設定します。 |
| [Clear-AzSqlDatabaseVulnerabilityAssessmentSetting](/powershell/module/az.sql/Clear-azSqlDatabaseVulnerabilityAssessmentSetting) | データベースの脆弱性評価の設定をクリアします。 |
| [Clear-AzSqlInstanceDatabaseVulnerabilityAssessmentRuleBaseline](/powershell/module/az.sql/Clear-AzSqlInstanceDatabaseVulnerabilityAssessmentRuleBaseline) | マネージド データベースの脆弱性評価規則のベースラインをクリアします。<br/>このコマンドレットを使用してクリアする前に、まずベースラインを設定します。 |
| [Clear-AzSqlInstanceDatabaseVulnerabilityAssessmentSetting](/powershell/module/az.sql/Clear-AzSqlInstanceDatabaseVulnerabilityAssessmentSetting) | マネージド データベースの脆弱性評価の設定をクリアします。 |
| [Clear-AzSqlInstanceVulnerabilityAssessmentSetting](/powershell/module/az.sql/Clear-AzSqlInstanceVulnerabilityAssessmentSetting) | マネージド インスタンスの脆弱性評価の設定をクリアします。 |
| [Convert-AzSqlDatabaseVulnerabilityAssessmentScan](/powershell/module/az.sql/Convert-azSqlDatabaseVulnerabilityAssessmentScan) | データベースの脆弱性評価のスキャン結果を Excel ファイルに変換します。 |
| [Convert-AzSqlInstanceDatabaseVulnerabilityAssessmentScan](/powershell/module/az.sql/Convert-AzSqlInstanceDatabaseVulnerabilityAssessmentScan) | マネージド データベースの脆弱性評価のスキャン結果を Excel ファイルに変換します。 |
| [Get-AzSqlDatabaseVulnerabilityAssessmentRuleBaseline](/powershell/module/az.sql/Get-azSqlDatabaseVulnerabilityAssessmentRuleBaseline) | 特定の規則の、データベースの脆弱性評価規則のベースラインを取得します。 |
| [Get-AzSqlInstanceDatabaseVulnerabilityAssessmentRuleBaseline](/powershell/module/az.sql/Get-AzSqlInstanceDatabaseVulnerabilityAssessmentRuleBaseline) | 特定の規則の、マネージド データベースの脆弱性評価規則のベースラインを取得します。 |
| [Get-AzSqlDatabaseVulnerabilityAssessmentScanRecord](/powershell/module/az.sql/Get-azSqlDatabaseVulnerabilityAssessmentScanRecord) | 特定のデータベースに関連付けられているすべての脆弱性評価スキャン レコードを取得します。 |
| [Get-AzSqlInstanceDatabaseVulnerabilityAssessmentScanRecord](/powershell/module/az.sql/Get-AzSqlInstanceDatabaseVulnerabilityAssessmentScanRecord) | 特定のマネージド データベースに関連付けられているすべての脆弱性評価スキャン レコードを取得します。 |
| [Get-AzSqlDatabaseVulnerabilityAssessmentSetting](/powershell/module/az.sql/Get-azSqlDatabaseVulnerabilityAssessmentSetting) | データベースの脆弱性評価の設定を返します。 |
| [Get-AzSqlInstanceDatabaseVulnerabilityAssessmentSetting](/powershell/module/az.sql/Get-AzSqlInstanceDatabaseVulnerabilityAssessmentSetting) | マネージド データベースの脆弱性評価の設定を返します。 |
| [Set-AzSqlDatabaseVulnerabilityAssessmentRuleBaseline](/powershell/module/az.sql/Set-azSqlDatabaseVulnerabilityAssessmentRuleBaseline) | 脆弱性評価規則のベースラインを設定します。 |
| [Set-AzSqlInstanceDatabaseVulnerabilityAssessmentRuleBaseline](/powershell/module/az.sql/Set-AzSqlInstanceDatabaseVulnerabilityAssessmentRuleBaseline) | マネージド データベースの脆弱性評価規則のベースラインを設定します。 |
| [Start-AzSqlDatabaseVulnerabilityAssessmentScan](/powershell/module/az.sql/Start-azSqlDatabaseVulnerabilityAssessmentScan) | データベースでの脆弱性評価スキャンの開始をトリガーします。 |
| [Start-AzSqlInstanceDatabaseVulnerabilityAssessmentScan](/powershell/module/az.sql/Start-AzSqlInstanceDatabaseVulnerabilityAssessmentScan) | マネージド データベースでの脆弱性評価スキャンの開始をトリガーします。 |
| [Update-AzSqlDatabaseVulnerabilityAssessmentSetting](/powershell/module/az.sql/Update-azSqlDatabaseVulnerabilityAssessmentSetting) | データベースの脆弱性評価の設定を更新します。 |
| [Update-AzSqlInstanceDatabaseVulnerabilityAssessmentSetting](/powershell/module/az.sql/Update-AzSqlInstanceDatabaseVulnerabilityAssessmentSetting) | マネージド データベースの脆弱性評価の設定を更新します。 |
| [Update-AzSqlInstanceVulnerabilityAssessmentSetting](/powershell/module/az.sql/Update-AzSqlInstanceVulnerabilityAssessmentSetting) | マネージド インスタンスの脆弱性評価の設定を更新します。 |
| &nbsp; | &nbsp; |

スクリプトの例については、[Azure SQL の脆弱性評価の PowerShell のサポート](/archive/blogs/sqlsecurity/azure-sql-vulnerability-assessment-now-with-powershell-support)に関する記事を参照してください。

### <a name="using-resource-manager-templates"></a>Resource Manager テンプレートの使用

Azure Resource Manager テンプレートを使用して脆弱性評価基準を構成するには、`Microsoft.Sql/servers/databases/vulnerabilityAssessments/rules/baselines` の種類を使用します。

基準を追加する前に、`vulnerabilityAssessments` が有効になっていることを確認します。

Resource Manager テンプレートのリソースとして、`master` データベースに基準規則 VA2065 を定義し、`user` データベースに VA1143 を定義する例を以下に示します。

```json
   "resources": [
      {
         "type": "Microsoft.Sql/servers/databases/vulnerabilityAssessments/rules/baselines",
         "apiVersion": "2018-06-01-preview",
         "name": "[concat(parameters('server_name'),'/', parameters('database_name') , '/default/VA2065/master')]",
         "properties": {
            "baselineResults": [
               {
                  "result": [
                     "FirewallRuleName3",
                     "StartIpAddress",
                     "EndIpAddress"
                  ]
               },
               {
                  "result": [
                     "FirewallRuleName4",
                     "62.92.15.68",
                     "62.92.15.68"
                  ]
               }
            ]
         },
         "type": "Microsoft.Sql/servers/databases/vulnerabilityAssessments/rules/baselines",
         "apiVersion": "2018-06-01-preview",
         "name": "[concat(parameters('server_name'),'/', parameters('database_name'), '/default/VA2130/Default')]",
         "dependsOn": [
            "[resourceId('Microsoft.Sql/servers/vulnerabilityAssessments', parameters('server_name'), 'Default')]"
         ],
         "properties": {
            "baselineResults": [
               {
                  "result": [
                     "dbo"
                  ]
               }
            ]
         }
      }
   ]
```

`master` データベースと `user` データベースでは、リソース名は異なる方法で定義されます。

- マスター データベース - "name": "[concat(parameters('server_name'),'/', parameters('database_name') , '/default/VA2065/<b>master</b>')]",
- ユーザー データベース - "name": "[concat(parameters('server_name'),'/', parameters('database_name') , '/default/VA2065/<b>default</b>')]",

ブール型 を true/false として処理するには、ベースラインの結果に "1"/"0" のようなバイナリ入力を設定します。

```json
   {
      "type": "Microsoft.Sql/servers/databases/vulnerabilityAssessments/rules/baselines",
      "apiVersion": "2018-06-01-preview",
      "name": "[concat(parameters('server_name'),'/', parameters('database_name'), '/default/VA1143/Default')]",

      "dependsOn": [
         "[resourceId('Microsoft.Sql/servers/vulnerabilityAssessments', parameters('server_name'), 'Default')]"
      ],

      "properties": {
         "baselineResults": [
            {
               "result": [
                  "1"
               ]
            }
         ]
      }

   }
```

## <a name="next-steps"></a>次のステップ  

- [Azure Defender for SQL](azure-defender-for-sql.md) についてさらに詳しく学習します。
- [データの検出と分類](data-discovery-and-classification-overview.md)についてさらに詳しく学習します。
- [ファイアウォールと VNet の内側のアクセス可能なストレージ アカウントに脆弱性評価スキャンの結果を格納する](sql-database-vulnerability-assessment-storage.md)方法についてさらに詳しく学習します。
