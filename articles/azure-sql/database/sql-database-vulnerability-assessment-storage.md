---
title: ファイアウォールと VNet の内側のアクセス可能なストレージ アカウントに脆弱性評価スキャンの結果を格納する
description: ファイアウォールまたは VNet 経由でアクセスできるストレージ アカウントに脆弱性評価 (VA) スキャンを格納する手順について説明します
services: sql-database
ms.service: sql-db-mi
ms.subservice: security
ms.topic: how-to
author: davidtrigano
ms.author: datrigan
ms.reviewer: vanto
ms.date: 12/01/2020
ms.openlocfilehash: a4edf94302e063aed7ba539f173ea1364331c4de
ms.sourcegitcommit: 867cb1b7a1f3a1f0b427282c648d411d0ca4f81f
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/19/2021
ms.locfileid: "99807531"
---
# <a name="store-vulnerability-assessment-scan-results-in-a-storage-account-accessible-behind-firewalls-and-vnets"></a>ファイアウォールと VNet の内側のアクセス可能なストレージ アカウントに脆弱性評価スキャンの結果を格納する
[!INCLUDE[appliesto-sqldb-sqlmi-asa](../includes/appliesto-sqldb-sqlmi-asa.md)]

特定の VNet またはサービスに対して Azure のストレージ アカウントへのアクセスを制限している場合は、SQL データベースまたはマネージド インスタンスに対する脆弱性評価 (VA) スキャンがそのストレージ アカウントにアクセスできるように、適切な構成を有効にする必要があります。

## <a name="enable-azure-sql-database-va-scanning-access-to-the-storage-account"></a>Azure SQL Database VA スキャンのストレージ アカウントへのアクセスを有効にする

特定のネットワークまたはサービスのみがアクセスできるように VA ストレージ アカウントを構成した場合は、Azure SQL Database に対する VA スキャンがストレージ アカウントにスキャンを格納できることを確認する必要があります。 [論理 SQL サーバー](logical-servers.md) のすべてのデータベースに対する VA スキャン結果を格納するには、既存のストレージ アカウントを使用することも、新しいストレージ アカウントを作成することもできます。

> [!NOTE]
> ストレージ アクセス キーが必要な場合、脆弱性評価サービスは、ファイアウォールまたは VNet で保護されているストレージ アカウントにアクセスできません。

ストレージ アカウントが含まれている **[リソース グループ]** に移動し、 **[ストレージ アカウント]** ペインにアクセスします。 **[設定]** で、 **[ファイアウォールと仮想ネットワーク]** を選択します。

**[信頼された Microsoft サービスによるこのストレージ アカウントに対するアクセスを許可します]** チェック ボックスがオンになっていることを確認します。

:::image type="content" source="media/sql-database-vulnerability-assessment-storage/storage-allow-microsoft-services.png" alt-text="[信頼された Microsoft サービスによるこのストレージ アカウントに対するアクセスを許可します] が選択されている、[ファイアウォールと仮想ネットワーク] ダイアログ ボックスを示すスクリーンショット。":::

どのストレージ アカウントが使用されているかを調べるには、[Azure portal](https://portal.azure.com) で **[SQL サーバー]** ペインに移動し、 **[セキュリティ]** の下にある **[Security Center]** を選択します。

:::image type="content" source="../database/media/azure-defender-for-sql/va-storage.png" alt-text="脆弱性評価の設定":::

## <a name="store-va-scan-results-for-azure-sql-managed-instance-in-a-storage-account-that-can-be-accessed-behind-a-firewall-or-vnet"></a>Azure SQL Managed Instance に対する VA スキャン結果を、ファイアウォールまたは VNet の内側でアクセスできるストレージ アカウントに格納する

Managed Instance は信頼された Microsoft サービスではなく、ストレージ アカウントとは異なる VNet を持っているため、VA スキャンを実行するとエラーが発生します。

Managed Instance に対する VA スキャンをサポートするには、次の手順に従います。

1. **[SQL Managed Instance]** ペインの **[概要]** 見出しの下にある **[仮想ネットワーク/サブネット]** リンクをクリックします。 **[仮想ネットワーク]** ペインが表示されます。

   :::image type="content" source="../managed-instance/media/public-endpoint-configure/mi-overview.png" alt-text="mi-overview2":::

1. **[設定]** で、 **[サブネット]** を選択します。 新しいペインで **[サブネット]** をクリックしてサブネットを追加し、それを *Microsoft.Sql\managedInstance* にデリゲートします。 詳細については、[サブネットの管理](../../virtual-network/virtual-network-manage-subnet.md)に関するページを参照してください。

   :::image type="content" source="media/sql-database-vulnerability-assessment-storage/mi-subnets.png" alt-text="Microsoft.sql\managedInstance にデリゲートされたサブネットを示すスクリーンショット。":::

1. **[仮想ネットワーク]** ペインで、 **[設定]** の下の **[サービス エンドポイント]** を選択します。 新しいペインで **[追加]** をクリックし、新しいサービス エンドポイントとして *Microsoft.Storage* サービスを追加します。 *ManagedInstance* サブネットが選択されていることを確認します。 **[追加]** をクリックします。

   :::image type="content" source="media/sql-database-vulnerability-assessment-storage/mi-service-endpoint.png" alt-text="エンドポイントとして Microsoft.Storage サービスを追加する、[サービス エンドポイントの追加] を示すスクリーンショット。":::

1. VA スキャンを格納するために選択した **ストレージ アカウント** に移動します。 **[設定]** で、 **[ファイアウォールと仮想ネットワーク]** を選択します。 **[既存の仮想ネットワークを追加]** をクリックします。 マネージド インスタンスの仮想ネットワークとサブネットを選択し、 **[追加]** をクリックします。

   :::image type="content" source="media/sql-database-vulnerability-assessment-storage/storage-firewall.png" alt-text="[既存の仮想ネットワークを追加] リンクが含まれている [ファイアウォールと仮想ネットワーク] ペインを示すスクリーンショット。":::

これで、マネージド インスタンスに対する VA スキャンをストレージ アカウントに格納できるようになりました。

## <a name="next-steps"></a>次のステップ

- [脆弱性評価](sql-vulnerability-assessment.md)
- [Azure ストレージ アカウントの作成](../../storage/common/storage-account-create.md)
- [Azure Defender for SQL](azure-defender-for-sql.md)
