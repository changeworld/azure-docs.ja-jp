---
title: 必要なサブネットサイズおよび範囲を決める
titleSuffix: Azure SQL Managed Instance
description: このトピックでは、Azure SQL Managed Instance のデプロイ先となるサブネットのサイズを計算する方法について説明します。
services: sql-database
ms.service: sql-managed-instance
ms.subservice: operations
ms.custom: seo-lt-2019, sqldbrb=1
ms.devlang: ''
ms.topic: how-to
author: srdan-bozovic-msft
ms.author: srbozovi
ms.reviewer: sstein, bonova
ms.date: 02/22/2019
ms.openlocfilehash: 156a4c74eea24b20c28df88be85cb32c0ebe2981
ms.sourcegitcommit: f28ebb95ae9aaaff3f87d8388a09b41e0b3445b5
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/29/2021
ms.locfileid: "96012454"
---
# <a name="determine-required-subnet-size--range-for-azure-sql-managed-instance"></a>Azure SQL Managed Instance に必要なサブネット サイズおよび範囲を決める
[!INCLUDE[appliesto-sqlmi](../includes/appliesto-sqlmi.md)]

Azure SQL Managed Instance は、Azure [仮想ネットワーク (VNet)](../../virtual-network/virtual-networks-overview.md) 内にデプロイする必要があります。

VNet のサブネットにデプロイできるマネージド インスタンスの数は、そのサブネットのサイズ (サブネット範囲) によって決まります。

マネージド インスタンスを作成する場合、Azure では、プロビジョニング中に選択された階層に応じて、仮想マシンの数を割り当てます。 これらの仮想マシンはお使いのサブネットに関連付けられているため、IP アドレスが必要です。 通常の操作とサービス メンテナンス時の高可用性を確保するために、Azure は追加の仮想マシンを割り当てることがあります。 その結果、サブネット内の必要な IP アドレスの数が、そのサブネット内のマネージド インスタンスの数より大きくなります。

仕様上、マネージド インスタンスにはサブネット内で 32 個以上の IP アドレスが必要です。 その結果、サブネットの IP 範囲を定義するときに、最小で /27 サブネット マスクを使用することができます。 マネージド インスタンスのデプロイでは、サブネットのサイズを慎重に計画することをお勧めします。 計画時に考慮する必要がある入力は、次のとおりです。

- 次のインスタンス パラメーターを含むマネージド インスタンスの数。
  - サービス階層
  - ハードウェアの世代
  - 仮想コアの数
- サービス レベルをスケールアップ/スケールダウンまたは変更する計画

> [!IMPORTANT]
> 16 個の IP アドレス (サブネット マスク /28) を持つサブネット サイズでは、その内部にマネージド インスタンスをデプロイできますが、スケーリング操作は実行されない、評価または開発/テストのシナリオで使用される、単一インスタンスをデプロイする場合にのみ使用してください。

## <a name="determine-subnet-size"></a>サブネットのサイズを決める

将来のインスタンスのデプロイとスケーリングのニーズに応じて、サブネットのサイズを設定します。 次のパラメーターを使用すると、計算を簡単に行うことができます。

- Azure では、独自のニーズに応じて、サブネット内で 5 個の IP アドレスを使用します。
- 各仮想クラスターは、追加のアドレス数を割り当てます。 
- 各マネージド インスタンスは、価格レベルとハードウェアの世代に依存するアドレス数を使用します。

> [!IMPORTANT]
> サブネット内にリソースが存在する場合、サブネットのアドレス範囲を変更することはできません。 また、あるサブネットから別のサブネットにマネージド インスタンスを移動することはできません。 将来的に問題が発生しないように、可能な限り小さいサブネットよりも大きなサブネットを使用することを検討してください。

GP = 汎用、BC = ビジネス クリティカル、VC = 仮想クラスター

| **ハードウェアの世代** | **価格レベル** | **Azure での使用** | **VC での使用** | **インスタンスでの使用** | **合計*** |
| --- | --- | --- | --- | --- | --- |
| Gen4 | GP | 5 | 1 | 5 | 11 |
| Gen4 | BC | 5 | 1 | 5 | 11 |
| 第 5 世代 | GP | 5 | 6 | 3 | 14 |
| 第 5 世代 | BC | 5 | 6 | 5 | 16 |

  \* 列の合計には、サブネットに 1 つのインスタンスがデプロイされたときに取得されるアドレスの数が表示されます。 サブネットに追加されるインスタンスごとに、[インスタンスでの使用] 列で表されるアドレスの数が追加されます。 [Azure での使用] 列で表されるアドレスは複数の仮想クラスター間で共有されますが、[VC での使用] 列で表されるアドレスは、その仮想クラスターに配置されているインスタンス間で共有されます。

通常、更新操作を実行するには、仮想クラスターのサイズ変更が必要です。 場合によっては、更新操作で仮想クラスターの作成が必要になることがあります (詳細については、[管理操作に関する記事](sql-managed-instance-paas-overview.md#management-operations)を参照してください)。 仮想クラスターを作成する場合、必要な追加アドレスの数は、[VC での使用] 列で表されるアドレスの数に、その仮想クラスターに配置されたインスタンスで必要なアドレスの数 ([インスタンスでの使用] 列) を合計した数になります。

**例 1**:1 つの汎用のマネージド インスタンス (Gen4 ハードウェア) と 1 つのビジネス クリティカルなマネージド インスタンス (Gen5 ハードウェア) を使用することを計画しています。 つまり、デプロイするには、5 + 1 + 1 * 5 + 6 + 1 * 5 = 22 個以上の IP アドレスが必要です。 IP 範囲が 2 の累乗で定義されている場合、サブネットでは、このデプロイに対して最小で 32 (2^5) の IP 範囲が必要です。<br><br>
前述のように、更新操作では仮想クラスターの作成が必要になる場合があります。 これは、たとえば、仮想クラスターの作成を必要とする Gen5 のビジネス クリティカルなマネージド インスタンスを更新する場合、追加の 6 + 5 = 11 個の IP アドレスが使用できる必要があることを意味します。 32 個のうち 22 個のアドレスを既に使用しているため、この操作に使用できるアドレスはありません。 したがって、/26 サブネット マスク (64 個のアドレス) のサブネットを予約する必要があります。

**例 2**:同じサブネットに配置された 3 つの汎用のマネージド インスタンス (Gen5 ハードウェア) と 2 つのビジネス クリティカルなマネージド インスタンス (Gen5 ハードウェア) を使用することを計画しています。 これは、5 + 6 + 3 * 3 + 2 * 5 = 30 個の IP アドレスが必要であることを意味します。 したがって、/26 サブネット マスクのサブネットを予約する必要があります。 /27 サブネット マスクを選択すると、残りのアドレス数は 2 (32 - 30) になります。これにより、インスタンスのスケーリングを実行するためにサブネットに追加のアドレスが必要になるため、すべてのインスタンスの更新操作が妨げられます。

**例 3**:1 つの汎用のマネージド インスタンス (Gen5 ハードウェア) を使用して、仮想コアの更新操作を随時実行することを計画しています。 これは、5 + 6 + 1 * 3 + 3 = 17 個の IP アドレスが必要であることを意味します。 IP 範囲は 2 のべき乗で定義されているため、32 (2^5) の IP アドレスの IP 範囲が必要です。 したがって、/27 サブネット マスクのサブネットを予約する必要があります。

### <a name="address-requirements-for-update-scenarios"></a>更新シナリオのアドレス要件

スケーリング操作中、インスタンスでは、価格レベルとハードウェアの世代に依存する追加の IP 容量が一時的に必要になります。

| **ハードウェアの世代** | **価格レベル** | **シナリオ** | **追加のアドレス*** |
| --- | --- | --- | --- |
| Gen4 | GP または BC | 仮想コアのスケーリング | 5 |
| Gen4 | GP または BC | ストレージのスケーリング | 5 |
| Gen4 | GP または BC | GP から BC または BC から GP への切り替え | 5 |
| Gen4 | GP | Gen 5 への切り替え* | 9 |
| Gen4 | BC | Gen 5 への切り替え* | 11 |
| 第 5 世代 | GP | 仮想コアのスケーリング | 3 |
| 第 5 世代 | GP | ストレージのスケーリング | 0 |
| 第 5 世代 | GP | BC への切り替え | 5 |
| 第 5 世代 | BC | 仮想コアのスケーリング | 5 |
| 第 5 世代 | BC | ストレージのスケーリング | 5 |
| 第 5 世代 | BC | GP への切り替え | 3 |

  \* Gen4 ハードウェアは段階的に廃止中であり、新しいデプロイでは利用できなくなりました。 Gen5 ハードウェア世代固有の機能を活用できるように、ハードウェアの世代を Gen4 から Gen5 に更新してください。

## <a name="next-steps"></a>次のステップ

- 概要については、「[Azure SQL Managed Instance とは](sql-managed-instance-paas-overview.md)」を参照してください。
- [SQL Managed Instance の接続アーキテクチャ](connectivity-architecture-overview.md)の詳細を確認します。
- [SQL Managed Instance のデプロイ先となる VNet の作成](virtual-network-subnet-create-arm-template.md)方法を確認します。
- DNS の問題については、[カスタム DNS の構成](custom-dns-configure.md)に関するページを参照してください。
