<properties
    pageTitle="Eclipse での Azure アプリケーションのデバッグ"
    description="Azure Toolkit for Eclipse を使用する Azure アプリケーションのデバッグについて説明します。"
    services=""
    documentationCenter="java"
    authors="rmcmurray"
    manager="wpickett"
    editor=""/>

<tags
    ms.service="multiple"
    ms.workload="na"
    ms.tgt_pltfrm="multiple"
    ms.devlang="Java"
    ms.topic="article"
    ms.date="11/30/2015" 
    ms.author="robmcm"/>

<!-- Legacy MSDN URL = https://msdn.microsoft.com/library/azure/hh690949.aspx -->

# Eclipse での Azure アプリケーションのデバッグ #

Azure Toolkit for Eclipse を使用すると、Azure で実行しているアプリケーションでも、オペレーティング システムとして Windows を使用している場合はコンピューティング エミュレーター内のアプリケーションでも、デバッグできます。次の図は、リモート デバッグを有効にするために使用する **[デバッグ]** プロパティ ダイアログを示しています。

![][ic719504]

このチュートリアルでは、アプリケーションが正常に作成されていて、コンピューティング エミュレーターおよび Azure へのデプロイを理解しているものとします。

このトピックでは、「[JSP で Azure サービス ランタイム ライブラリを使用する][]」チュートリアルで作成したアプリケーションから始めます。アプリケーションをまだ作成していない場合は、先に進む前に作成してください。

## Azure で実行しながらアプリケーションをデバッグするには ##

>[AZURE.WARNING]Toolkit でのリモート Java デバッグの現在のサポートは、主に、Azure コンピューティング エミュレーターで実行中のデプロイメントに対するものです。デバッグ接続はセキュリティで保護されていないため、運用環境のデプロイメントではリモート デバッグを有効にしないでください。Azure クラウドで実行しているアプリケーションをデバッグする必要がある場合は、ステージング デプロイメントを使用します。ただし、ステージング デプロイメントであっても、クラウド デプロイメントの IP アドレスがわかると、デバッグ セッションに不正アクセスできることを理解しておいてください。

1. エミュレーターでのテスト用のプロジェクトをビルドします。Eclipse のプロジェクト エクスプローラーで、**[MyAzureProject]** を右クリックし、**[プロパティ]**、**[Azure]** の順にクリックして、**[ビルド対象]** を **[クラウドへのデプロイ]** に設定します。
1. プロジェクトをビルドし直します。Eclipse メニューから、**[プロジェクト]**、**[すべてビルド]** の順にクリックします。
1. アプリケーションを Azure の*ステージング*にデプロイします。

    >[AZURE.IMPORTANT] 前述のように、ほとんどの場合はコンピューティング エミュレーターでデバッグし、追加のデバッグが必要な場合にのみステージング環境でデバッグすることを、強くお勧めします。運用環境ではデバッグしないことをお勧めします。
1. Azure でデプロイメントの準備ができたら、[Microsoft Azure 管理ポータル][]からデプロイメントの DNS 名を取得します。ステージング デプロイメントの DNS 名の形式は http://*&lt;guid&gt;*.cloudapp.net であり、*&lt;guid&gt;* は Azure によって割り当てられる GUID の値です。
1. Eclipse のプロジェクト エクスプローラーで、**[WorkerRole1]** を右クリックし、**[Azure]** をクリックしてから **[デバッグ]** をクリックします。
1. **[WorkerRole1 デバッグのプロパティ]** ダイアログで次のようにします。
    1. **[このロールのリモート デバッグを有効にする]** をオンにします。
    1. **[使用する入力エンドポイント]** では、**[デバッグ (パブリック: 8090、プライベート: 8090)]** を使用します。
    1. **[JVM を一時停止モードで開始し、デバッガーの接続を待機する]** がオフになっていることを確認します。

        >[AZURE.IMPORTANT] **[JVM を一時停止モードで開始し、デバッガーの接続を待機する]** オプションは、コンピューティング エミュレーターのみでの高度なデバッグ シナリオ用です (クラウド デプロイメント用ではありません)。**[JVM を一時停止モードで開始し、デバッガーの接続を待機する]** オプションを使用する場合は、Eclipse デバッガーが JVM に接続されるまで、サーバーのスタートアップ プロセスは中断されます。コンピューティング エミュレーターを使用するデバッグ セッションにこのオプションを使用している間は、クラウド デプロイメントでのデバッグ セッションに使用しないでください。Azure のスタートアップ タスクでサーバーの初期化が行われ、スタートアップ タスクが完了するまで、Azure クラウドはパブリック エンドポイントを利用できるようにしません。したがって、クラウド デプロイメントでこのオプションを有効にした場合、外部 Eclipse クライアントからの接続を受けられないため、スタートアップ プロセスが正常に完了しません。
    1. **[デバッグ構成の作成]** をクリックします。
1. **[Azure デバッグ構成]** ダイアログで次のようにします。
    1. **[デバッグする Java プロジェクト]** で、**MyHelloWorld** プロジェクトを選択します。
    1. **[デバッグ構成の対象]** で、**[Azure クラウド (ステージング)]** をオンにします。
    1. **[Azure コンピューティング エミュレーター]** がオフになっていることを確認します。
    1. **[ホスト]** には、ステージングされたデプロイメントの DNS 名を入力します。ただし、先頭の **http://** は省略します。例 (ここで示す GUID の代わりに実際の GUID を使用してください): **4e616d65-6f6e-6d65-6973-526f62657274.cloudapp.net**
1. **[OK]** をクリックして **[Azure デバッグ構成]** ダイアログを閉じます。
1. **[OK]** をクリックして **[WorkerRole1 デバッグのプロパティ]** ダイアログを閉じます。
1. index.jsp でブレークポイントをまだ設定していない場合は、設定します。
    1. Eclipse のプロジェクト エクスプローラーで、**[MyHelloWorld]**、**[WebContent]** の順に展開し、**index.jsp** をダブルクリックします。
    1. 次の図のように、index.jsp で Java コードの左側にある青いバーを右クリックし、**[ブレークポイントの切り替え]** をクリックします。![][ic551537]
1. Eclipse のメニューで、**[実行]**、**[デバッグ構成]** の順にクリックします。
1. **[デバッグ構成]** ダイアログで、左側のウィンドウの **[リモート Java アプリケーション]** を展開し、**[Azure クラウド (WorkerRole1)]** を選択して、**[デバッグ]** をクリックします。
1. ブラウザーで、ステージングしたアプリケーション ****http://***&lt;guid&gt;***.cloudapp.net/MyHelloWorld** を実行します。*&lt;guid&gt;* は実際の DNS 名の GUID に置き換えてください。**[パースペクティブ スイッチの確認]** ダイアログ ボックスにプロンプトが表示されたら、**[はい]** をクリックします。ブレークポイントを設定したコード行まで、デバッグ セッションが実行されます。

>[AZURE.NOTE]複数のロール インスタンスが実行されているデプロイメントへのリモート デバッグ接続を開始する場合、現在は、デバッガーが最初に接続されるインスタンスを制御することはできません。Azure のロード バランサーがインスタンスをランダムに選択します。そのインスタンスに接続されても、同じインスタンスのデバッグを続けます。また、非アクティブな期間が 4 分を超えると (たとえば、ブレークポイントでの停止時間が長すぎた場合)、Azure が接続を閉じる場合があることにも注意してください。

## 複数インスタンス デプロイメントでの特定のロール インスタンスのデバッグ ##

デプロイメントをクラウドで実行する場合、ほとんどは複数のコンピューティング インスタンス (つまり、ロール インスタンス) で実行します。これにより、Azure の 99.95% 可用性保証を利用でき、アプリケーションをスケールアウトできます。

このようなシナリオでは、特定のロール インスタンスの Java アプリケーションをリモート デバッグすることが必要になる場合があります。ただし、標準の入力エンドポイントのみでデバッグを有効にした場合、Azure ロード バランサーにより、ユーザーが特定のロール インスタンスにデバッガーを接続することはほぼ不可能になります。代わりに、ロード バランサーによってランダムに選択されたロール インスタンスに接続されます。

この種のシナリオでは、インスタンスの入力エンドポイントを利用すると、特定のロール インスタンスのデバッグが容易になります。

たとえば、デプロイメントの最大 5 つのロール インスタンスを実行するとします。ロール プロパティ ダイアログの **[エンドポイント]** プロパティ ページを使用して、インスタンス入力エンドポイントを作成し、単一のポート番号ではなくパブリック ポートの範囲にそれを割り当てます。たとえば、**[パブリック ポート]** 入力ボックスで「**81-85**」と指定します。

このインスタンス エンドポイントでアプリケーションをデプロイすると、Azure はこの範囲から一意のポート番号を各ロール インスタンスに割り当てます。その場合、各インスタンスに割り当てられたポート番号を調べるには、Toolkit によってデプロイメントに自動的に構成される *InstanceEndpointName***\_PUBLICPORT** 環境変数 (ここで、*InstanceEndpointName* はインスタンス エンドポイントを作成したときに割り当てた名前) を使用できます (たとえば、Web ページのフッターでその値を返すと、参照時に確認できます)。

インスタンスに割り当てられたパブリック ポート番号がわかったら、サービスのホスト名にそれを付加することによって、Eclipse のデバッグ構成で参照できます。これにより、Eclipse デバッガーは、他のインスタンスではなく、その特定のインスタンスに接続できます。

## Windows のみ: コンピューティング エミュレーターで実行中のアプリケーションをデバッグするには ##

>[AZURE.NOTE]Azure エミュレーターは Windows でのみ使用できます。Windows 以外のオペレーティング システムを使用する場合は、このセクションをスキップしてください。

1. エミュレーターでのテスト用のプロジェクトをビルドします。Eclipse のプロジェクト エクスプローラーで、**[MyAzureProject]** を右クリックし、**[プロパティ]**、**[Azure]** の順にクリックして、**[ビルド対象]** を **[エミュレーターでのテスト]** に設定します。
1. プロジェクトをビルドし直します。Eclipse メニューから、**[プロジェクト]**、**[すべてビルド]** の順にクリックします。
1. Eclipse のプロジェクト エクスプローラーで、**[WorkerRole1]** を右クリックし、**[Azure]** をクリックしてから **[デバッグ]** をクリックします。
1. **[WorkerRole1 デバッグのプロパティ]** ダイアログで次のようにします。
    1. **[このロールのリモート デバッグを有効にする]** をオンにします。
    1. **[使用する入力エンドポイント]** では、Toolkit によって自動的に生成される既定のエンドポイントを使用します (一覧では **[デバッグ (パブリック: 8090、プライベート: 8090)]** と表示されます)。
    1. **[JVM を一時停止モードで開始し、デバッガーの接続を待機する]** オプションがオフになっていることを確認します。

        >[AZURE.IMPORTANT] **[JVM を一時停止モードで開始し、デバッガーの接続を待機する]** オプションは、コンピューティング エミュレーターのみでの高度なデバッグ シナリオ用です (クラウド デプロイメント用ではありません)。**[JVM を一時停止モードで開始し、デバッガーの接続を待機する]** オプションを使用する場合は、Eclipse デバッガーが JVM に接続されるまで、サーバーのスタートアップ プロセスは中断されます。コンピューティング エミュレーターを使用するデバッグ セッションにこのオプションを使用している間は、クラウド デプロイメントでのデバッグ セッションに使用しないでください。Azure のスタートアップ タスクでサーバーの初期化が行われ、スタートアップ タスクが完了するまで、Azure クラウドはパブリック エンドポイントを利用できるようにしません。したがって、クラウド デプロイメントでこのオプションを有効にした場合、外部 Eclipse クライアントからの接続を受けられないため、スタートアップ プロセスが正常に完了しません。
    1. **[デバッグ構成の作成]** をクリックします。
1. **[Azure デバッグ構成]** ダイアログで次のようにします。
    1. **[デバッグする Java プロジェクト]** で、**MyHelloWorld** プロジェクトを選択します。
    1. **[デバッグ構成の対象]** で、**[Azure コンピューティング エミュレーター]** をオンにします。
1. **[OK]** をクリックして **[Azure デバッグ構成]** ダイアログを閉じます。
1. **[OK]** をクリックして **[WorkerRole1 デバッグのプロパティ]** ダイアログを閉じます。
1. index.jsp でブレークポイントを設定します。
    1. Eclipse のプロジェクト エクスプローラーで、**[MyHelloWorld]**、**[WebContent]** の順に展開し、**index.jsp** をダブルクリックします。
    1. 次の図のように、index.jsp で Java コードの左側にある青いバーを右クリックし、**[ブレークポイントの切り替え]** をクリックします。![][ic551537]Java コードの左側の青いバー内にブレークポイント アイコンが表示されたら、ブレークポイントは設定されています。
1. Azure ツールバーの **[Azure エミュレーターで実行]** ボタンをクリックして、コンピューティング エミュレーターでアプリケーションを開始します。
1. Eclipse のメニューで、**[実行]**、**[デバッグ構成]** の順にクリックします。
1. **[デバッグ構成]** ダイアログで、左側のウィンドウの **[リモート Java アプリケーション]** を展開し、**[Azure エミュレーター (WorkerRole1)]** を選択して、**[デバッグ]** をクリックします。
1. コンピューティング エミュレーターにアプリケーションが実行されていることが示されたら、ブラウザーで ****http://localhost:8080/MyHelloWorld** を実行します。**[パースペクティブ スイッチの確認]** ダイアログ ボックスにプロンプトが表示されたら、**[はい]** をクリックします。ブレークポイントを設定したコード行まで、デバッグ セッションが実行されます。

ここまでは、コンピューティング エミュレーターでのデバッグ方法を示しました。次のセクションでは、Azure にデプロイしたアプリケーションのデバッグ方法を示します。

## デバッグに関する注意事項 ##

* デバッグが終了したら、Eclipse のメニューで **[ウィンドウ]**、**[パースペクティブを開く]** の順にクリックして、使用するパースペクティブを選択することにより、パースペクティブを**デバッグ**から **Java** に切り替えることができます。
* GlassFish でリモート デバッグを有効にする場合は、Azure Toolkit for Eclipse のリモート デバッグ構成機能を使用しないでください。代わりに、GlassFish を手動で構成します。環境変数で定義済みの Java オプションを GlassFish が処理する方法により、Toolkit のリモート デバッグ構成機能は GlassFish では正しく動作しません。Toolkit のリモート デバッグ構成機能が有効な場合、GlassFish が起動しない可能性があります。

## 関連項目 ##

[Azure Toolkit for Eclipse][]

[Azure の Hello World アプリケーションを Eclipse で作成する][]

[Azure Toolkit for Eclipse のインストール][]

Java での Azure の使用の詳細については、[Azure Java デベロッパー センター][]を参照してください。

<!-- URL List -->

[Azure Java デベロッパー センター]: http://go.microsoft.com/fwlink/?LinkID=699547
[Microsoft Azure 管理ポータル]: http://go.microsoft.com/fwlink/?LinkID=512959
[Azure Toolkit for Eclipse]: http://go.microsoft.com/fwlink/?LinkID=699529
[Azure の Hello World アプリケーションを Eclipse で作成する]: http://go.microsoft.com/fwlink/?LinkID=699533
[Azure Toolkit for Eclipse のインストール]: http://go.microsoft.com/fwlink/?LinkId=699546
[JSP で Azure サービス ランタイム ライブラリを使用する]: http://go.microsoft.com/fwlink/?LinkID=699551

<!-- IMG List -->

[ic719504]: ./media/azure-toolkit-for-eclipse-debugging-azure-applications/ic719504.png
[ic551537]: ./media/azure-toolkit-for-eclipse-debugging-azure-applications/ic551537.png

<!----HONumber=AcomDC_1210_2015-->
