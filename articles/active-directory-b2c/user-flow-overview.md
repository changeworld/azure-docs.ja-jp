---
title: Azure Active Directory B2C でのユーザー フローとカスタム ポリシー | Microsoft Docs
titleSuffix: Azure AD B2C
description: Azure Active Directory B2C の組み込みのユーザー フローと、カスタム ポリシーで拡張可能なポリシー フレームワークの詳細について説明します。
services: active-directory-b2c
author: msmimart
manager: celestedg
ms.service: active-directory
ms.workload: identity
ms.topic: conceptual
ms.date: 04/08/2021
ms.custom: project-no-code
ms.author: mimart
ms.subservice: B2C
ms.openlocfilehash: 2e4dbc5178bec3a5b1f0931267465879f604f36f
ms.sourcegitcommit: b28e9f4d34abcb6f5ccbf112206926d5434bd0da
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/09/2021
ms.locfileid: "107226010"
---
# <a name="user-flows-and-custom-policies-overview"></a>ユーザー フローとカスタム ポリシーの概要

Azure AD B2C では、ユーザーがアプリケーションにアクセスするために従うビジネス ロジックを定義できます。 たとえば、ユーザーがサインイン、サインアップ、プロファイルの編集、またはパスワードのリセットを行うときに実行する手順の順序を決定できます。 シーケンスが完了すると、ユーザーはトークンを取得し、アプリケーションにアクセスできるようになります。 

Azure AD B2C では、次の 2 つの方法で ID ユーザーのエクスペリエンスを実現できます。

* **ユーザー フロー** は、事前に定義された組み込みの構成可能なポリシーであり、サインアップ、サインイン、ポリシー編集のエクスペリエンスを数分で作成できるように用意されています。

* **カスタム ポリシー** を使用すると、複雑な ID エクスペリエンス シナリオ用に独自のユーザー体験を作成できます。

次のスクリーンショットは、ユーザー フロー設定の UI とカスタム ポリシー構成ファイルを示しています。

![スクリーンショットは、ユーザー フロー設定の UI とカスタム ポリシー構成ファイルを示しています。](media/user-flow-overview/user-flow-vs-custom-policy.png)

この記事では、ユーザーフ ローとカスタム ポリシーの概要を説明し、どちらの方法がビジネス ニーズに最適かを判断するのに役立つ情報を提供します。

## <a name="user-flows"></a>ユーザー フロー

最も一般的な ID タスクを設定するために、Azure portal には、"*ユーザー フロー*" と呼ばれる事前定義済みで構成可能な複数のポリシーが用意されています。

アプリケーションでの ID エクスペリエンスの動作を制御するため、次のようなユーザー フロー設定を構成できます。

* サインインに使用するアカウントの種類 (Facebook などのソーシャル アカウント、またはメール アドレスとパスワードをサインインに使用するローカル アカウント)
* コンシューマーから収集される属性 (名、郵便番号、居住地の国/地域など)
* Azure AD Multi-Factor Authentication (MFA)
* ユーザー インターフェイスのカスタマイズ
* ユーザーがユーザー フローを完了した後でアプリケーションが受け取るトークン内の要求のセット
* セッションの管理
* その他...

アプリに対する一般的な ID シナリオのほとんどは、ユーザー フローを使用して効果的に定義および実装できます。 カスタム ポリシーの完全な柔軟性を必要とする複雑なユーザー体験シナリオがある場合を除き、組み込みのユーザー フローを使用することをお勧めします。

## <a name="custom-policies"></a>カスタム ポリシー

カスタム ポリシーは、Azure AD B2C テナントのユーザー エクスペリエンスの動作を定義する構成ファイルです。 ユーザー フローが、最も一般的な ID タスク用に Azure AD B2C ポータルで事前に定義されているのに対して、カスタム ポリシーは、さまざまなタスクを実行するために ID 開発者が編集できます。

カスタム ポリシーは、完全に構成可能で、ポリシーに基づきます。 これはエンティティ間の信頼を標準プロトコルに従って調整します。 たとえば、OpenID Connect、OAuth、SAML や、いくつかの非標準のもの (REST API ベースのシステム間の要求の交換など) です。 このフレームワークにより、ホワイトラベルが付けられたわかりやすいエクスペリエンスが作成されます。

カスタム ポリシーを使用すると、手順を自由に組み合わせてユーザー体験を構築できます。 次に例を示します。

* 他の ID プロバイダーとのフェデレーション
* ファーストパーティとサードパーティの多要素認証 (MFA) の課題
* ユーザー入力の収集
* REST API 通信を使用した外部システムとの統合

各ユーザー体験は、ポリシーによって定義されます。 組織に最適なユーザー エクスペリエンスを実現するために必要な数のポリシーを作成できます。

![IEF によって可能になる複雑なユーザー体験の例を示す図](media/user-flow-overview/custom-policy-diagram.png)

カスタム ポリシーは、階層型チェーンで互いを参照する複数の XML ファイルによって定義されます。 XML 要素では、要求スキーマ、要求変換、コンテンツ定義、クレーム プロバイダー、技術プロファイル、ユーザー体験のオーケストレーション手順、ID エクスペリエンスの他の側面を定義します。

カスタム ポリシーの強力な柔軟性は、複雑な ID シナリオを構築する必要がある場合に最適です。 カスタム ポリシーを構成する開発者は、信頼できる関係の詳細をメタデータ エンドポイント、正確な要求交換定義を含むように慎重に定義し、各 ID プロバイダーの必要に応じてシークレット、キー、および証明書を構成する必要があります。

カスタム ポリシーについて詳しくは、「[Azure Active Directory B2C のカスタム ポリシー](custom-policy-overview.md)」をご覧ください。

## <a name="comparing-user-flows-and-custom-policies"></a>ユーザー フローとカスタム ポリシーの比較

次の表では、Azure AD B2C のユーザー フローとカスタム ポリシーで実現できるシナリオを詳しく比較しています。

| Context | ユーザー フロー | カスタム ポリシー |
|-|-------------------|-----------------|
| 対象ユーザー | ID の専門知識を持つ、または持たないすべてのアプリケーション開発者。 | ID のプロフェッショナル、システム インテグレータ、コンサルタント、社内の ID チーム。 彼らは OpenID Connect のフローに慣れており、ID プロバイダーや要求ベースの認証を理解しています。 |
| 構成方法 | ユーザー フレンドリなユーザー インターフェイス (UI) を備えた Azure portal。 | XML ファイルを直接編集して Azure portal にアップロードします。 |
| UI のカスタマイズ | HTML、CSS、および [JavaScript](javascript-and-page-layout.md) を含む[完全な UI のカスタマイズ](customize-ui-with-html.md)。<br><br>カスタム文字列による[多言語サポート](language-customization.md)。 | 同じ |
| 属性のカスタマイズ | 標準属性とカスタム属性。 | 同じ |
| トークンおよびセッション管理 | [トークンのカスタマイズ](configure-tokens.md)と[セッションの動作](session-behavior.md)。 | 同じ |
| [ID プロバイダー] | [定義済みのローカル](identity-provider-local.md)または[ソーシャル プロバイダー](add-identity-provider.md) (Azure Active Directory テナントとのフェデレーションなど)。 | 標準ベースの OIDC、OAUTH、SAML。  REST API との統合を使用して認証を行うことも可能です。 |
| ID タスク | ローカルまたはさまざまなソーシャル アカウントによる[サインアップまたはサインイン](add-sign-up-and-sign-in-policy.md)。<br><br>[セルフサービス パスワード リセット](add-password-reset-policy.md)。<br><br>[プロファイルの編集](add-profile-editing-policy.md)。<br><br>Multi-Factor Authentication。<br><br>アクセス トークンのフロー。 | カスタム ID プロバイダーを使用したユーザー フローと同じタスクの実行、またはカスタム スコープの使用。<br><br>登録時に別のシステムでユーザー アカウントをプロビジョニング。<br><br>独自の電子メール サービス プロバイダを使用して、ウェルカム メールを送信。<br><br>Azure AD B2C の外部のユーザー ストアを使用。<br><br>ユーザーが指定した情報を信頼できるシステムで検証 (API を使用)。 |

## <a name="application-integration"></a>アプリケーションの統合

テナント内でさまざまな種類のユーザー フローまたはカスタム ポリシーを多数作成し、必要に応じてそれらをアプリケーションで使用できます。 ユーザー フローとカスタム ポリシーは、どちらもアプリケーション間で再利用できます。 この柔軟性により、最小限のコード変更で、またはコードをまったく変更せずに、ID エクスペリエンスを定義および変更できます。 

ユーザーがアプリケーションにサインインしようとすると、アプリケーションによって、ユーザー フローまたはカスタム ポリシーで提供されるエンドポイントへの認可要求が開始されます。 ユーザー フローまたはカスタム ポリシーによって、ユーザーのエクスペリエンスが定義および制御されます。 ユーザー フローが完了すると、Azure AD B2C によってトークンが生成され、ユーザーはアプリケーションにリダイレクトされます。

![モバイル アプリと、Azure AD B2C のサインイン ページ間のフローを示す矢印](media/user-flow-overview/app-integration.png)

複数のアプリケーションで、同じユーザー フローまたはカスタム ポリシーを使用できます。 1 つのアプリケーションで、複数のユーザー フローまたはカスタム ポリシーを使用できます。

たとえば、アプリケーションへのサインインの場合は、アプリケーションでは "*サインアップまたはサインイン*" のユーザー フローが使用されます。 ユーザーはアプリにサインインした後、プロファイルを編集したい場合があります。 プロファイルを編集するために、アプリケーションでは、今度は "*プロファイル編集*" のユーザー フローを使用して、別の認可要求が開始されます。

アプリケーションにより、ユーザー フローまたはカスタム ポリシー名を含む標準の HTTP 認証要求を使用して、ユーザー フローがトリガーされます。 カスタマイズされた[トークン](tokens-overview.md)は応答として受信されます。


## <a name="next-steps"></a>次のステップ

- 推奨されるユーザー フローを作成する手順については、[チュートリアル:ユーザー フローの作成](tutorial-create-user-flows.md)の指示に従います。
- [Azure AD B2C のユーザー フローのバージョン](user-flow-versions.md)を確認します。
- [Azure AD B2C のカスタム ポリシー](custom-policy-overview.md)について確認します。
