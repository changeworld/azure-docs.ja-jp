---
title: Azure Monitor for VMs を使用してパフォーマンスをグラフ化する方法 (プレビュー) | Microsoft Docs
description: パフォーマンスは、Windows および Linux システム上のアプリケーション コンポーネントを自動的に検出し、サービス間の通信をマップする、VM 用 Azure Monitor の機能です。 この記事では、さまざまなシナリオでこの機能を使用する方法について詳しく説明します。
ms.subservice: ''
ms.topic: conceptual
author: bwren
ms.author: bwren
ms.date: 10/15/2019
ms.openlocfilehash: 245d5c0fb0a54a6d129a193deaa9445bc8fefbfb
ms.sourcegitcommit: 747a20b40b12755faa0a69f0c373bd79349f39e3
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 02/27/2020
ms.locfileid: "77670697"
---
# <a name="how-to-chart-performance-with-azure-monitor-for-vms-preview"></a>Azure Monitor for VMs を使用してパフォーマンスをグラフ化する方法 (プレビュー)

VM 用 Azure Monitor には、仮想マシンがどの程度効果的に実行されているかを判定するのに役立ついくつかの主要業績評価指標 (KPI) を対象とする一連のパフォーマンス グラフが含まれています。 グラフには一定期間にわたるリソース使用率が表示されるので、ボトルネックまたは異常を識別することができます。あるいは、各マシンを一覧表示するパースペクティブに切り替えて、選択したメトリックに基づくリソース使用率を表示することもできます。 パフォーマンスを扱うときに考慮すべき要素は数多くありますが、Azure Monitor for VMs では、プロセッサ、メモリ、ネットワーク アダプター、およびディスクの使用率に関連するオペレーティング システムの主要業績評価指標を監視します。 パフォーマンスによって正常性の監視機能が補完されます。さらに、システム コンポーネントに障害がある可能性を示す問題を明らかにしたり、効率化のためのチューニングや最適化をサポートしたり、容量計画をサポートしたりするのにパフォーマンスは役立ちます。  

## <a name="multi-vm-perspective-from-azure-monitor"></a>Azure Monitor からのマルチ VM のパースペクティブ

Azure Monitor のパフォーマンス機能では、ご利用のサブスクリプションまたはご利用の環境内のワークグループにまたがってデプロイされているすべての監視対象 VM に関するビューが提供されます。 Azure Monitor からアクセスするには、次の手順を行います。 

1. Azure portal で、 **[モニター]** を選択します。 
2. **[ソリューション]** セクションの **[Virtual Machines (プレビュー)]** を選択します。
3. **[パフォーマンス]** タブを選択します。

![VM insights のパフォーマンス上位 N のリスト ビュー](./media/vminsights-performance/vminsights-performance-aggview-01.png)

**[Top N Charts]\(上位 N グラフ\)** タブ上では、Log Analytics ワークスペースが複数ある場合、ページの上部にある **[ワークスペース]** セレクターから、ソリューションで有効になっているワークスペースを選択します。 **グループ** セレクターでは、選択したワークスペースに関連するコンピューターのサブスクリプション、リソース グループ、[コンピューター グループ](../platform/computer-groups.md)、仮想マシン スケール セットが返されます。これらを使用して、このページや他のページのグラフに表示される結果に対し、さらにフィルターを適用することができます。 この選択が適用されるのは、パフォーマンス機能のみで、正常性やマップには引き継がれません。  

既定では、過去 24 時間がグラフに表示されます。 **TimeRange** セレクターを使用すると、過去の時間範囲 (最大で 30 日) に対してクエリを実行して、過去のパフォーマンスがどのような経過をたどっているかを確認できます。

ページ上に表示される 5 つの容量使用率のグラフは次のとおりです。

* CPU 使用率 % - 平均プロセッサ使用率が最も高い上位 5 つのマシンが示されます。 
* 使用可能なメモリ - 使用可能なメモリ量の平均が最も低い上位 5 つのマシンが示されます。 
* Logical Disk Space Used % (使用済み論理ディスク領域 %) - すべてのディスク ボリュームにわたって平均使用済みディスク領域 % が最も高い上位 5 つのマシンが示されます。 
* 送信バイト数の比率 - 送信バイト数の平均が最も高い上位 5 つのマシンが示されます。 
* 受信バイト数の比率 - 受信バイト数の平均が最も高い上位 5 つのマシンが示されます。 

5 つのいずれかのグラフの右上隅にあるピン アイコンをクリックすると、最後に表示した Azure ダッシュ ボードに選択したグラフがピン留めされます。  ダッシュ ボードで、グラフのサイズおよび位置を変更できます。 ダッシュ ボードからグラフを選択すると、Azure Monitor for VMs にリダイレクトされ、適切なスコープおよびビューが読み込まれます。  

5 つのいずれかのグラフ上のピン アイコンの左側にあるアイコンをクリックすると、 **[Top N List]\(上位 N リスト\)** ビューが開きます。  ここで、リスト ビュー内の VM ごとに該当するパフォーマンス メトリックに対するリソース使用率と、最も高い傾向を示しているマシンが表示されます。  

![選択したパフォーマンス メトリックに対する上位 N のリスト ビュー](./media/vminsights-performance/vminsights-performance-topnlist-01.png)

仮想マシンをクリックすると、右側に **[プロパティ]** ウィンドウが展開され、オペレーティング システムによって報告されたシステム情報や Azure VM のプロパティなど、選択した項目のプロパティが表示されます。 **[クイック リンク]** セクションでオプションのいずれかをクリックすると、選択した VM からその機能に直接リダイレクトされます。  

![[仮想マシン プロパティ] ウィンドウ](./media/vminsights-performance/vminsights-properties-pane-01.png)

**[Aggregated Charts]\(集計グラフ\)** タブに切り替えると、フィルター処理されたパフォーマンス メトリックが平均またはパーセンタイルのメジャーによって表示されます。  

![VM insights のパフォーマンス集計ビュー](./media/vminsights-performance/vminsights-performance-aggview-02.png)

次の容量使用率のグラフが用意されています。

* CPU 使用率 % - 既定では平均および上位 95 パーセンタイルが示されます。 
* 使用可能なメモリ - 既定では平均、上位 5 および 10 パーセンタイルが示されます。 
* Logical Disk Space Used % (使用済み論理ディスク領域 %) - 既定では平均および 95 パーセンタイルが示されます。 
* 送信バイト数の比率 - 既定では平均送信バイト数が示されます。 
* 受信バイト数の比率 - 既定では平均受信バイト数が示されます。

パーセンタイル セレクターで "**Avg**"、"**Min**"、"**Max**"、"**50th**"、"**90th**"、"**95th**" を選択して、時間範囲内でグラフの細分性を変更することもできます。

リスト ビュー内の VM ごとにリソース使用率を表示し、使用率が最も高い傾向を示しているマシンを確認するには、 **[Top N List]\(上位 N のリスト\)** タブを選択します。 **[Top N List]\(上位 N のリスト\)** ページには、上位 20 のマシンが表示されます。これは、メトリック *[CPU 使用率 %]* の 95 パーセンタイルによって使用率の高い順に並べ替えられたものです。  **[さらに読み込む]** を選択すると、より多くのマシンを表示することができ、その結果は上位 500 のマシンを表示するように拡張されます。 

>[!NOTE]
>500 を超えるマシンをリストに一度に表示することはできません。  
>

![[Top N List]\(上位 N のリスト\) ページの例](./media/vminsights-performance/vminsights-performance-topnlist-01.png)

リスト内の特定の仮想マシンに対する結果をフィルター処理するには、 **[名で検索]** テキスト ボックスにそのコンピューター名を入力します。  

異なるパフォーマンス メトリックに基づく使用率を表示する場合は、 **[メトリック]** ドロップダウン リストから **[使用可能なメモリ]** 、 **[Logical Disk Space Used %]\(使用済み論理ディスク領域 %\)** 、 **[Network Received Byte/s]\(ネットワーク受信バイト数/秒\)** 、または **[Network Sent Byte/s]\(ネットワーク送信バイト数/秒\)** を選択します。すると、リストが更新されて、そのメトリックにスコープが指定された使用率が表示されます。  

リストから仮想マシンを選択すると、ページの右側に **[プロパティ]** パネルが開き、そこから **[Performance detail]\(パフォーマンス詳細\)** を選択することができます。  **仮想マシンの詳細**ページが開き、その VM にスコープが指定されます。Azure VM から直接、"VM Insights パフォーマンス" にアクセスするときとエクスペリエンスは類似しています。  

## <a name="view-performance-directly-from-an-azure-vm"></a>Azure VM から直接、パフォーマンスを確認する

仮想マシンから直接アクセスするには、次の手順に従います。

1. Azure Portal で、 **[仮想マシン]** を選択します。 
2. リストから VM を選択し、 **[監視]** セクションの **[Insights (プレビュー)]** を選択します。  
3. **[パフォーマンス]** タブを選択します。 

このページには、パフォーマンス使用率グラフだけでなく、検出された各論理ディスクについて、その容量、使用率、およびメジャーごとの全体平均も表示されます。  

次の容量使用率のグラフが用意されています。

* CPU 使用率 % - 既定では平均および上位 95 パーセンタイルが示されます。 
* 使用可能なメモリ - 既定では平均、上位 5 および 10 パーセンタイルが示されます。 
* Logical Disk Space Used % (使用済み論理ディスク領域 %) - 既定では平均および 95 パーセンタイルが示されます。 
* 論理ディスク IOPS - 既定では平均および 95 パーセンタイルが表示されます。
* 論理ディスク MB/秒 - 既定では平均および 95 パーセンタイルが表示されます。
* 最大使用済み論理ディスク % - 既定では平均および 95 パーセンタイルが表示されます。
* 送信バイト数の比率 - 既定では平均送信バイト数が示されます。 
* 受信バイト数の比率 - 既定では平均受信バイト数が示されます。

いずれかのグラフの右上隅にあるピン アイコンをクリックすると、最後に表示した Azure ダッシュ ボードに選択したグラフがピン留めされます。 ダッシュ ボードで、グラフのサイズおよび位置を変更できます。 ダッシュ ボードからグラフを選択すると、Azure Monitor for VMs にリダイレクトされ、VM のパフォーマンス詳細ビューが読み込まれます。  

![VM から直接表示した VM Insights パフォーマンスビュー](./media/vminsights-performance/vminsights-performance-directvm-01.png)

## <a name="view-performance-directly-from-an-azure-virtual-machine-scale-set"></a>Azure 仮想マシン スケール セットから直接パフォーマンスを確認する

Azure 仮想マシン スケール セットから直接アクセスするには、次の手順を実行します。

1. Azure portal 上で、 **[仮想マシン スケール セット]** を選択します。
2. リストから 1 つの VM を選択し、 **[監視]** セクションの **[Insights (プレビュー)]** を選択して、 **[パフォーマンス]** タブを表示します。

このページでは、選択されたスケール セットを範囲とする Azure Monitor パフォーマンス ビューを読み込みます。 これにより、監視されている一連のメトリックにわたってスケール セット内の上位 N 個のインスタンスを表示し、スケール セット全体での集計パフォーマンスを表示し、スケール セット内の個々のインスタンスにわたって選択されたメトリックの傾向を確認することが可能になります。 リスト ビューからインスタンスを選択すると、そのマップを読み込んだり、該当のインスタンスに対する詳細なパフォーマンス ビューに移動したりできます。

いずれかのグラフの右上隅にあるピン アイコンをクリックすると、最後に表示した Azure ダッシュ ボードに選択したグラフがピン留めされます。 ダッシュ ボードで、グラフのサイズおよび位置を変更できます。 ダッシュ ボードからグラフを選択すると、Azure Monitor for VMs にリダイレクトされ、VM のパフォーマンス詳細ビューが読み込まれます。  

![VM によって仮想マシン スケール セット ビューから直接パフォーマンスを洞察する](./media/vminsights-performance/vminsights-performance-directvmss-01.png)

>[!NOTE]
>お使いのスケール セット用のインスタンス ビューから、特定のインスタンスの詳細なパフォーマンス ビューにアクセスすることもできます。 **[設定]** セクション下の **[インスタンス]** に移動して、 **[インサイト (プレビュー)]** を選択します。

## <a name="alerts"></a>警告  

Azure Monitor for VMs の構成要素として有効にされたパフォーマンス メトリックには、事前構成済みのアラート ルールが含まれていません。 Azure VM 上で検出されたパフォーマンスの問題 (高い CPU 使用率、使用可能なメモリ不足、ディスク領域不足など) に対応する[正常性アラート](vminsights-health.md#alerts) があります。ただし、これらの正常性アラートは、Azure Monitor for VMs に対して有効になっている VM にのみ適用されます。 

しかし、Log Analytics ワークスペースに収集して格納する可能性があるのは、必要なパフォーマンス メトリックの一部だけです。 実際の監視戦略上、仮想マシンの容量や正常性を有効に評価するために、他のパフォーマンス メトリックを含んだ分析またはアラートが必要な場合、あるいは独自のアラート基準やロジックを柔軟に指定する必要がある場合は、Log Analytics で[それらのパフォーマンス カウンターのコレクション](../platform/data-sources-performance-counters.md)を構成し、[ログ アラート](../platform/alerts-log.md)を定義することができます。 Log Analytics では、他の種類のデータを使った複雑な分析を実行でき、また、傾向分析をサポートするために保持期間もより長くなります。これに対して、メトリックは軽量であり、ほぼリアルタイムのシナリオに対応することができます。 これらは [Azure 診断エージェント](../../virtual-machines/windows/monitor.md)によって収集されて、Azure Monitor のメトリック ストアに格納されるため、アラート作成に伴う待ち時間が短縮され、コストも低くなります。

こうした追加メトリックの収集やアラート ルールを構成する作業に入る前に、[Azure Monitor を使用したメトリックとログの収集](../platform/data-platform.md)について概説したページを参照して、基本的な相違とその他の考慮事項について理解を深めましょう。  

## <a name="next-steps"></a>次のステップ

- Azure Monitor for VMs に含まれている [Workbooks ](vminsights-workbooks.md) を使用して、パフォーマンスとネットワークのメトリックをさらに分析する方法について説明します。  

- 検出されたアプリケーションの依存関係の詳細については、[Azure Monitor for VMs のマップの表示](vminsights-maps.md)に関するページを参照してください。
