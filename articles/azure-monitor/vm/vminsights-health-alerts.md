---
title: VM insights のゲストの正常性アラート (プレビュー)
description: VM insights のゲストの正常性によって作成されるアラートについて、それを有効にする方法と通知を構成する方法を含めて説明します。
ms.topic: conceptual
author: bwren
ms.author: bwren
ms.date: 11/10/2020
ms.openlocfilehash: 1b5fd10b3e0bd84aa7d34a918f4f2376130d2e45
ms.sourcegitcommit: 867cb1b7a1f3a1f0b427282c648d411d0ca4f81f
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/20/2021
ms.locfileid: "102052264"
---
# <a name="vm-insights-guest-health-alerts-preview"></a>VM insights のゲストの正常性アラート (プレビュー)
VM insights のゲストの正常性を使用すると、一定間隔でサンプリングされる一連のパフォーマンス測定値によって定義される、仮想マシンの正常性を表示できます。 アラートは、仮想マシンまたはモニターが異常な状態に変化するときに作成されます。 [Azure Monitor のアラート ルールによって作成されるもの](../alerts/alerts-overview.md)を含むこれらのアラートを表示して管理し、新しいアラートが作成されたときに事前に通知されるように選択できます。

## <a name="configure-alerts"></a>アラートを構成する
この機能がプレビュー段階の間は、VM insights のゲストの正常性に対して明示的なアラート ルールを作成することはできません。 既定では、アラートはモニターごとではなく、各仮想マシンに対して作成されます。  これは、モニターが仮想マシンの現在の状態に影響を与えない状態に変化した場合、仮想マシンの状態が変化しなかったためにアラートが作成されないことを意味します。 

特定の仮想マシンまたは仮想マシン上の特定のモニターに対するアラートは、Azure portal の仮想マシンの構成にある **[アラートの状態]** 設定から無効にできます。 Azure portal でモニターを構成することの詳細については、「[VM insights のゲストの正常性 (プレビュー) で監視を構成する](vminsights-health-configure.md)」を参照してください。 一連の仮想マシンにわたってモニターを構成することの詳細については、「[データ収集ルールを使用して VM insights のゲストの正常性 (プレビュー) での監視を構成する](vminsights-health-configure-dcr.md)」を参照してください。

## <a name="alert-severity"></a>アラートの重大度
ゲストの正常性によって作成されるアラートの重要度は、アラートをトリガーしている仮想マシンまたはモニターの重要度に直接マッピングされています。

| モニター状態 | アラートの重大度 |
|:---|:---|
| Critical | Sev1 |
| 警告  | Sev2 |
| Healthy  | Sev4 |

## <a name="alert-lifecycle"></a>アラートのライフサイクル
[Azure のアラート](../alerts/alerts-overview.md)は、各仮想マシンが **警告** または **クリティカル** の状態に変化するときはいつでも作成されます。 アラートは、Azure portal の、 **[Azure Monitor]** メニューまたは仮想マシンのメニューの **[アラート]** から表示します。

仮想マシンの状態が変化したときにアラートが既に **発生** 状態になっている場合、2 番目のアラートは作成されませんが、同じアラートの重要度は仮想マシンの状態に合わせて変更されます。 たとえば、**警告** アラートが既に **発生** 状態にあったときに、仮想マシンが **クリティカル** 状態に変化した場合、そのアラートの重要度は **Sev1** に変更されます。 **Sev1** アラートが既に **発生** 状態にあったときに、仮想マシンが **警告** 状態に変化した場合、そのアラートの重要度は **Sev2** に変更されます。 仮想マシンが **正常** 状態に戻った場合、重要度が **Sev4** に変更されてアラートは解除されます。

## <a name="viewing-alerts"></a>アラートの表示
[Azure portal](../platform/alerts-overview.md#alerts-experience) で、VM insights のゲストの正常性によって作成されたアラートを他の アラートと共に表示します。 **[Azure Monitor]** メニューから **[アラート]** を選択して、すべての監視対象リソースのアラートを表示するか、仮想マシンのメニューから **[アラート]** を選択して、その仮想マシンについてのみアラートを表示することができます。

## <a name="alert-properties"></a>[アラートのプロパティ]

### <a name="properties-in-the-azure-portal"></a>Azure portal でのプロパティ
次の表で、Azure portal で表示したときのアラートのプロパティについて説明します。

| プロパティ | Description |
|:---|:---|
| アラートが作成される前のモニター状態 | このアラートが初めて発生する前のモニターまたは仮想マシンの状態。 |
| アラートが作成されたときのモニター状態 | アラートが初めて発生したときのモニターまたは仮想マシンの状態。 これが、アラートが発生する原因となった状態です。 |
| アラートが作成されたときの状態遷移に関する詳細を確認するには | 正確な状態遷移を確認できる [VM の正常性] ページへのリンク。 この状態遷移は、モニターが最初に **正常** 状態から正常でない状態になったときのインスタンスを表しています。 |

たとえば、あるモニターが、時刻 t0 に **健全** から **クリティカル** に移行し、**Sev1** の新しいアラートが発生します。 次に、時刻 t1 に **クリティカル** から **警告** に移行し、アラートの重要度が **Sev2** に更新されます。 時刻 t2 には **正常** になり、アラートが解除されます。

このシーケンス全体の間に、アラートのプロパティ値は次のようになります。

- アラートが作成される前のモニター状態:Healthy
- アラートが作成されたときのモニター状態:Critical
- アラートが作成されたときの状態遷移に関する詳細を確認するには:時刻 t0 に発生した状態遷移へのナビゲーション リンク。


### <a name="properties-in-notifications"></a>通知内のプロパティ
次の表で、通知に含まれるアラートのプロパティについて説明します。

| プロパティ | Description |
|:---|:---|
| 以前のモニター状態 | 状態が変化する前のモニターまたは仮想マシンの状態。 アラートの重要度の更新によってこの通知がトリガーされる場合、このプロパティは、重要度更新の直前の状態を表します。 |
| 現在のモニター状態 | 状態が変化したときのモニターまたは仮想マシンの状態。 アラートの重要度の更新によってこの通知がトリガーされる場合、このプロパティは、新しい状態を表します。 |
| この状態遷移に関する詳細を確認するには | 正確な状態遷移を確認できる [VM の正常性] ページへのリンク。 この状態遷移は、この通知をトリガーした状態がモニターによって変更されたときのインスタンスを表します。 |

上の例を使用すると、それぞれの時点で、通知には以下のプロパティが含まれます。

時刻 t0 に受信した通知
- 以前のモニター状態:Healthy
- 現在のモニター状態:Critical
- この状態遷移に関する詳細を確認するには:時刻 t0 に発生した状態遷移へのナビゲーション リンク。

時刻 t1 に受信した通知
- 以前のモニター状態:Critical
- 現在のモニター状態:警告
- この状態遷移に関する詳細を確認するには:時刻 t1 に発生した状態遷移へのナビゲーション リンク。

時刻 t2 に受信した通知
- 以前のモニター状態:警告
- 現在のモニター状態:Healthy
- この状態遷移に関する詳細を確認するには:時刻 t2 に発生した状態遷移へのナビゲーション リンク。

## <a name="configure-notifications"></a>通知の構成
ゲストの正常性によってトリガーされるアラートの通知を事前に受け取るには、[アクション グループ](../alerts/action-groups.md) を作成して、SMS メッセージの送信やロジック アプリの起動などを実行するさまざまなアクションを定義します。 次に、モニターや仮想マシンのスコープを指定し、そのアクション グループを使用する[アクション ルール](../alerts/alerts-action-rules.md) を作成します。

Azure portal の **[モニター]** メニューで、 **[アラート]** を選択します。  **[アクションの管理]** を選択してから、 **[アクション ルール (プレビュー)]** を選択します。 

![新しいアクション ルール](media/vminsights-health-alerts/action-rule-new.png)

**[新しいアクション ルール]** をクリックして新しいルールを作成します。 スコープの横にある **[選択]** をクリックして、サブスクリプション、リソース グループ、または 1 つ以上の特定の仮想マシンを選択します。 通知は、スコープ内にある仮想マシンに対してのみ発生します。

![アクション ルールのスコープ](media/vminsights-health-alerts/action-rule-scope.png)

**[フィルター]** の横にある **[追加]** をクリックします。 **[モニター サービス] [と等しい] [VM Insights-正常]** というフィルターを作成します。 その他のフィルターを追加して、通知をトリガーする必要がある特定のアラートを指定します。 たとえば **[重要度]** を使用して、特定の重要度に一致するすべてのモニターからのアラートを照合できます。

![アクション ルール フィルター](media/vminsights-health-alerts/action-rule-filter.png)

**[このスコープでの定義]** で **[アクション グループ]** を選択してから、モニターに関連付けるアクション グループを選択します。 ルールに名前を付けて、その保存場所にするリソース グループを選択します。 **[作成]** をクリックしてルールを作成します。

![アクション ルール](media/vminsights-health-alerts/action-rule.png)


## <a name="next-steps"></a>次のステップ

- [VM insights とオンボード エージェントでゲストの正常性を有効にします。](vminsights-health-enable.md)
- [Azure portal を使用してモニターを構成します。](vminsights-health-configure.md)
- [データ収集ルールを使用してモニターを構成します。](vminsights-health-configure-dcr.md)