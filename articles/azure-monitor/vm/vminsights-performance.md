---
title: VM insights を使用してパフォーマンスをグラフ化する方法
description: パフォーマンスは VM insights の機能の 1 つであり、Windows および Linux システム上のアプリケーション コンポーネントを自動的に検出し、サービス間の通信をマップします。 この記事では、さまざまなシナリオでこの機能を使用する方法について詳しく説明します。
ms.topic: conceptual
author: bwren
ms.author: bwren
ms.date: 05/31/2020
ms.openlocfilehash: 02cb6a0c69fef1a33dd9327ddbd86e02b376a60e
ms.sourcegitcommit: 867cb1b7a1f3a1f0b427282c648d411d0ca4f81f
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/20/2021
ms.locfileid: "102046467"
---
# <a name="how-to-chart-performance-with-vm-insights"></a>VM insights を使用してパフォーマンスをグラフ化する方法

VM insights には、仮想マシンがどの程度効果的に実行されているかを判定するのに役立ついくつかの主要業績評価指標 (KPI) を対象とする一連のパフォーマンス グラフが含まれています。 グラフには一定期間にわたるリソース使用率が表示されるので、ボトルネックまたは異常を識別することができます。あるいは、各マシンを一覧表示するパースペクティブに切り替えて、選択したメトリックに基づくリソース使用率を表示することもできます。 パフォーマンスを扱うときに考慮すべき要素は数多くありますが、VM insights で監視されるオペレーティング システムの主要業績評価指標は、プロセッサ、メモリ、ネットワーク アダプター、およびディスクの使用率に関連するものです。 パフォーマンスによって正常性の監視機能が補完されます。さらに、システム コンポーネントに障害がある可能性を示す問題を明らかにしたり、効率化のためのチューニングや最適化をサポートしたり、容量計画をサポートしたりするのにパフォーマンスは役立ちます。  

## <a name="limitations"></a>制限事項
VM insights によるパフォーマンス収集の制限事項を次に示します。

- Red Hat Linux (RHEL) 6 を実行する仮想マシンでは、**使用可能なメモリ** をご利用いただけません。 このメトリックは、[カーネル バージョン 3.14](http://www.man7.org/linux/man-pages/man1/free.1.html) で導入された **MemAvailable** から計算されます。
- メトリックは、XFS ファイル システムまたは EXT ファイルシステム ファミリ (EXT2、EXT3、EXT4) を使用して、Linux 仮想マシン上のデータ ディスクに対してのみ使用できます。

## <a name="multi-vm-perspective-from-azure-monitor"></a>Azure Monitor からのマルチ VM のパースペクティブ

Azure Monitor のパフォーマンス機能では、ご利用のサブスクリプションまたはご利用の環境内のワークグループにまたがってデプロイされているすべての監視対象 VM に関するビューが提供されます。 Azure Monitor からアクセスするには、次の手順を行います。 

1. Azure portal で、 **[モニター]** を選択します。 
2. **[ソリューション]** セクションの **[Virtual Machines]** を選択します。
3. **[パフォーマンス]** タブを選択します。

![VM insights のパフォーマンス上位 N のリスト ビュー](media/vminsights-performance/vminsights-performance-aggview-01.png)

**[Top N Charts]\(上位 N グラフ\)** タブ上では、Log Analytics ワークスペースが複数ある場合、ページの上部にある **[ワークスペース]** セレクターから、ソリューションで有効になっているワークスペースを選択します。 **グループ** セレクターでは、選択したワークスペースに関連するコンピューターのサブスクリプション、リソース グループ、[コンピューター グループ](../logs/computer-groups.md)、仮想マシン スケール セットが返されます。これらを使用して、このページや他のページのグラフに表示される結果に対し、さらにフィルターを適用することができます。 この選択が適用されるのは、パフォーマンス機能のみで、正常性やマップには引き継がれません。  

既定では、過去 24 時間がグラフに表示されます。 **TimeRange** セレクターを使用すると、過去の時間範囲 (最大で 30 日) に対してクエリを実行して、過去のパフォーマンスがどのような経過をたどっているかを確認できます。

ページ上に表示される 5 つの容量使用率のグラフは次のとおりです。

* CPU 使用率 % - 平均プロセッサ使用率が最も高い上位 5 つのマシンが示されます。 
* 使用可能なメモリ - 使用可能なメモリ量の平均が最も低い上位 5 つのマシンが示されます。 
* Logical Disk Space Used % (使用済み論理ディスク領域 %) - すべてのディスク ボリュームにわたって平均使用済みディスク領域 % が最も高い上位 5 つのマシンが示されます。 
* 送信バイト数の比率 - 送信バイト数の平均が最も高い上位 5 つのマシンが示されます。 
* 受信バイト数の比率 - 受信バイト数の平均が最も高い上位 5 つのマシンが示されます。 

5 つのいずれかのグラフの右上隅にあるピン アイコンをクリックすると、最後に表示した Azure ダッシュ ボードに選択したグラフがピン留めされます。  ダッシュ ボードで、グラフのサイズおよび位置を変更できます。 ダッシュ ボードからグラフを選択すると、VM insights にリダイレクトされ、適切なスコープおよびビューが読み込まれます。  

5 つのいずれかのグラフ上のピン アイコンの左側にあるアイコンをクリックすると、 **[Top N List]\(上位 N リスト\)** ビューが開きます。  ここで、リスト ビュー内の VM ごとに該当するパフォーマンス メトリックに対するリソース使用率と、最も高い傾向を示しているマシンが表示されます。  

![選択したパフォーマンス メトリックに対する上位 N のリスト ビュー](media/vminsights-performance/vminsights-performance-topnlist-01.png)

仮想マシンをクリックすると、右側に **[プロパティ]** ウィンドウが展開され、オペレーティング システムによって報告されたシステム情報や Azure VM のプロパティなど、選択した項目のプロパティが表示されます。 **[クイック リンク]** セクションでオプションのいずれかをクリックすると、選択した VM からその機能に直接リダイレクトされます。  

![[仮想マシン プロパティ] ウィンドウ](./media/vminsights-performance/vminsights-properties-pane-01.png)

**[Aggregated Charts]\(集計グラフ\)** タブに切り替えると、フィルター処理されたパフォーマンス メトリックが平均またはパーセンタイルのメジャーによって表示されます。  

![VM insights のパフォーマンス集計ビュー](./media/vminsights-performance/vminsights-performance-aggview-02.png)

次の容量使用率のグラフが用意されています。

* CPU 使用率 % - 既定では平均および上位 95 パーセンタイルが示されます。 
* 使用可能なメモリ - 既定では平均、上位 5 および 10 パーセンタイルが示されます。 
* Logical Disk Space Used % (使用済み論理ディスク領域 %) - 既定では平均および 95 パーセンタイルが示されます。 
* 送信バイト数の比率 - 既定では平均送信バイト数が示されます。 
* 受信バイト数の比率 - 既定では平均受信バイト数が示されます。

パーセンタイル セレクターで "**Avg**"、"**Min**"、"**Max**"、"**50th**"、"**90th**"、"**95th**" を選択して、時間範囲内でグラフの細分性を変更することもできます。

リスト ビュー内の VM ごとにリソース使用率を表示し、使用率が最も高い傾向を示しているマシンを確認するには、 **[Top N List]\(上位 N のリスト\)** タブを選択します。 **[Top N List]\(上位 N のリスト\)** ページには、上位 20 のマシンが表示されます。これは、メトリック *[CPU 使用率 %]* の 95 パーセンタイルによって使用率の高い順に並べ替えられたものです。  **[さらに読み込む]** を選択すると、より多くのマシンを表示することができ、その結果は上位 500 のマシンを表示するように拡張されます。 

>[!NOTE]
>500 を超えるマシンをリストに一度に表示することはできません。  
>

![[Top N List]\(上位 N のリスト\) ページの例](./media/vminsights-performance/vminsights-performance-topnlist-01.png)

リスト内の特定の仮想マシンに対する結果をフィルター処理するには、 **[名で検索]** テキスト ボックスにそのコンピューター名を入力します。  

異なるパフォーマンス メトリックに基づく使用率を表示する場合は、 **[メトリック]** ドロップダウン リストから **[使用可能なメモリ]** 、 **[Logical Disk Space Used %]\(使用済み論理ディスク領域 %\)** 、 **[Network Received Byte/s]\(ネットワーク受信バイト数/秒\)** 、または **[Network Sent Byte/s]\(ネットワーク送信バイト数/秒\)** を選択します。すると、リストが更新されて、そのメトリックにスコープが指定された使用率が表示されます。  

リストから仮想マシンを選択すると、ページの右側に **[プロパティ]** パネルが開き、そこから **[Performance detail]\(パフォーマンス詳細\)** を選択することができます。  **仮想マシンの詳細** ページが開き、その VM にスコープが指定されます。Azure VM から直接、"VM Insights パフォーマンス" にアクセスするときとエクスペリエンスは類似しています。  

## <a name="view-performance-directly-from-an-azure-vm"></a>Azure VM から直接、パフォーマンスを確認する

仮想マシンから直接アクセスするには、次の手順に従います。

1. Azure Portal で、 **[仮想マシン]** を選択します。 
2. リストから 1 つの VM を選択し、 **[監視]** セクションの **[Insights]** を選択します。  
3. **[パフォーマンス]** タブを選択します。 

このページには、パフォーマンス使用率グラフだけでなく、検出された各論理ディスクについて、その容量、使用率、およびメジャーごとの全体平均も表示されます。  

次の容量使用率のグラフが用意されています。

* CPU 使用率 % - 既定では平均および上位 95 パーセンタイルが示されます。 
* 使用可能なメモリ - 既定では平均、上位 5 および 10 パーセンタイルが示されます。 
* Logical Disk Space Used % (使用済み論理ディスク領域 %) - 既定では平均および 95 パーセンタイルが示されます。 
* 論理ディスク IOPS - 既定では平均および 95 パーセンタイルが表示されます。
* 論理ディスク MB/秒 - 既定では平均および 95 パーセンタイルが表示されます。
* 最大使用済み論理ディスク % - 既定では平均および 95 パーセンタイルが表示されます。
* 送信バイト数の比率 - 既定では平均送信バイト数が示されます。 
* 受信バイト数の比率 - 既定では平均受信バイト数が示されます。

いずれかのグラフの右上隅にあるピン アイコンをクリックすると、最後に表示した Azure ダッシュ ボードに選択したグラフがピン留めされます。 ダッシュ ボードで、グラフのサイズおよび位置を変更できます。 ダッシュ ボードからグラフを選択すると、VM insights にリダイレクトされ、VM のパフォーマンス詳細ビューが読み込まれます。  

![VM から直接表示した VM Insights パフォーマンスビュー](./media/vminsights-performance/vminsights-performance-directvm-01.png)

## <a name="view-performance-directly-from-an-azure-virtual-machine-scale-set"></a>Azure 仮想マシン スケール セットから直接パフォーマンスを確認する

Azure 仮想マシン スケール セットから直接アクセスするには、次の手順を実行します。

1. Azure portal 上で、 **[仮想マシン スケール セット]** を選択します。
2. リストから 1 つの VM を選択し、 **[監視]** セクションの **[Insights]** を選択して、 **[パフォーマンス]** タブを表示します。

このページでは、選択されたスケール セットを範囲とする Azure Monitor パフォーマンス ビューを読み込みます。 これにより、監視されている一連のメトリックにわたってスケール セット内の上位 N 個のインスタンスを表示し、スケール セット全体での集計パフォーマンスを表示し、スケール セット内の個々のインスタンスにわたって選択されたメトリックの傾向を確認することが可能になります。 リスト ビューからインスタンスを選択すると、そのマップを読み込んだり、該当のインスタンスに対する詳細なパフォーマンス ビューに移動したりできます。

いずれかのグラフの右上隅にあるピン アイコンをクリックすると、最後に表示した Azure ダッシュ ボードに選択したグラフがピン留めされます。 ダッシュ ボードで、グラフのサイズおよび位置を変更できます。 ダッシュ ボードからグラフを選択すると、VM insights にリダイレクトされ、VM のパフォーマンス詳細ビューが読み込まれます。  

![VM によって仮想マシン スケール セット ビューから直接パフォーマンスを洞察する](./media/vminsights-performance/vminsights-performance-directvmss-01.png)

>[!NOTE]
>お使いのスケール セット用のインスタンス ビューから、特定のインスタンスの詳細なパフォーマンス ビューにアクセスすることもできます。 **[設定]** セクション下の **[インスタンス]** に移動して、 **[Insights]** を選択します。



## <a name="next-steps"></a>次のステップ

- VM insights に含まれている [Workbooks](vminsights-workbooks.md) を使用して、パフォーマンスとネットワークのメトリックをさらに分析する方法について説明します。  

- 検出されたアプリケーションの依存関係については、[VM insights のマップの表示](vminsights-maps.md)に関する記事をご覧ください。
