---
title: 1 つのメトリック アラート ルールで複数の時系列を監視する
description: 複数の時系列に対して 1 つのアラート ルールを使用して大規模にアラートを発生させる
author: harelbr
ms.author: harelbr
ms.topic: conceptual
ms.date: 01/11/2021
ms.openlocfilehash: bc3e77b560a94b45acf1ae696551dbefbabbdf0a
ms.sourcegitcommit: 867cb1b7a1f3a1f0b427282c648d411d0ca4f81f
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/20/2021
ms.locfileid: "102038205"
---
# <a name="monitor-multiple-time-series-in-a-single-metric-alert-rule"></a>1 つのメトリック アラート ルールで複数の時系列を監視する

1 つのメトリック アラート ルールを使用して、1 つまたは複数のメトリック時系列を監視し、大規模なリソースの監視を容易にすることができます。

## <a name="metric-time-series"></a>メトリックの時系列

メトリックの時系列は、一定期間にキャプチャされた一連の測定値 (つまり、"メトリック値") です。 

次に例を示します。

- 仮想マシンの CPU 使用率
- ストレージ アカウントへの受信バイト数 (イングレス)
- Web アプリケーションの失敗した要求の数



## <a name="alert-rule-on-a-single-time-series"></a>1 つの時系列のアラート ルール
アラート ルールで、次のすべての条件が満たされている場合は 1 つの時系列が監視されます。
-   ルールで 1 つのターゲット リソースを監視する 
-   1 つの条件が含まれている
-   次元を選ばずにメトリックを評価する (メトリックで次元がサポートされていることが前提)

このようなアラート ルールの例を次に示します (該当するプロパティのみが示されています)。
-   ターゲット リソース: *myVM1*
-   メトリック: *CPU 使用率*
-   演算子:*より大きい*
-   しきい値: *70*


このアラート ルールによって、1 つのメトリック時系列が監視されます。
-   *リソース*='myVM1' の CPU 使用率 > 70%

![1 つの時系列のアラート ルール](media/alerts-metric-multiple-time-series-single-rule/simple-alert-rule.png)

## <a name="alert-rule-on-multiple-time-series"></a>複数の時系列のアラート ルール
アラート ルールで、次の機能の少なくとも 1 つが使用されている場合は複数の時系列が監視されます。 
-   複数のリソース
-   複数の条件 
-   複数のディメンション


## <a name="multiple-resources-multi-resource"></a>複数のリソース (マルチリソース)

リソースが同じ種類で、同じ Azure リージョンに存在する場合は、複数のリソースを 1 つのメトリック アラート ルールで監視できます。 この種類のルールを使用すると、複雑さが軽減され、管理する必要があるアラート ルールの合計数が減ります。 

このようなアラート ルールの例を以下に示します。
-   ターゲット リソース: *myVM1、myVM2*
-   メトリック: *CPU 使用率*
-   演算子:*より大きい*
-   しきい値: *70*

このアラート ルールによって、2 つのメトリック時系列が個別に監視されています。
-   *リソース*='myVM1' の CPU 使用率 > 70%
-   *リソース*='myVM2' の CPU 使用率 > 70%

![マルチリソース アラート ルール](media/alerts-metric-multiple-time-series-single-rule/multi-resource-alert-rule.png)
 
マルチリソース アラート ルールでは、条件は、各リソースに対して (より正確に言えば、各リソースに対応するメトリック時系列ごとに) **個別に** 評価されます。 これは、各リソースに対して個別にアラートが発生することも意味します。

たとえば、70% を超える CPU を監視するように、上記のアラート ルールを設定したとします。 評価期間は、直近 5 分です。
-   *myVM1* の *CPU 使用率* は 70% を超えています 
-   *myVM2* の *CPU 使用率* は 50% です

このアラート ルールは *myVM1* でトリガーされますが、*myVM2* ではトリガーされません。 これらのトリガーされたアラートは独立しています。 また、各仮想マシンの個々の動作に応じて、異なるタイミングで解決することもできます。

マルチリソース アラート ルールと、この機能でサポートされるリソースの種類の詳細については、「[Azure Monitor のメトリック アラートによるスケールの監視](alerts-metric-overview.md#monitoring-at-scale-using-metric-alerts-in-azure-monitor)」を参照してください。

> [!NOTE] 
> 複数のリソースを監視するメトリック アラート ルールによって、許可される条件は 1 つだけです。

## <a name="multiple-conditions-multi-condition"></a>複数の条件 (複数条件)

1 つのメトリック アラート ルールで、アラート ルールごとに最大 5 つの条件を監視することもできます。 

次に例を示します。

- ターゲット リソース: *myVM1*
- Condition1
  - メトリック: *CPU 使用率*
  - 演算子:*より大きい*
  - しきい値: *70*
- Condition2
  - メトリック: *受信ネットワーク合計*
  - 演算子:*より大きい*
  - しきい値: *20 MB*

このアラート ルールによって、2 つのメトリック時系列が監視されています。

- *リソース*='myVM1' の CPU 使用率 > 70%
- *リソース*='myVM1' の受信ネットワーク合計 > 20 MB

![複数条件のアラート ルール](media/alerts-metric-multiple-time-series-single-rule/multi-condition-alert-rule.png)
 
条件の間に 'AND' 演算子が使用されます。 このアラート ルールの場合、**すべての** 条件が満たされたときにアラートが発生します。 発生したアラートは、少なくとも 1 つの条件が満たされなくなった場合に解決されます。 

> [!NOTE]
> 複数の条件があるアラート ルールで次元を使用する場合は制限事項があります。 詳細については、「[複数の条件を含むメトリック警告ルールでディメンションを使用する場合の制限事項](alerts-troubleshoot-metric.md#restrictions-when-using-dimensions-in-a-metric-alert-rule-with-multiple-conditions)」を参照してください。


## <a name="multiple-dimensions-multi-dimension"></a>複数の次元 (多次元)

1 つのメトリック アラート ルールで、メトリックの複数の次元値を監視することもできます。 メトリックの次元は、メトリック値を記述するための追加データを保持する名前と値のペアです。 たとえば、ストレージ アカウントの **トランザクション** メトリックには、**API 名** という次元があり、各トランザクションによって呼び出される API の名前 (GetBlob、DeleteBlob、PutPage など) が記述されます。 次元の使用は省略可能ですが、すべての次元値をまとめて集計してメトリックを監視するのではなく、メトリックのフィルター処理と、特定の時系列の監視のみを行うことができます。 

たとえば、すべての API 名 (集計データ) でトランザクション数が多い場合にアラートが発生するか、またはより細かく設定して、特定の API 名のトランザクション数が多い場合にのみアラートが発生するようにすることができます。 

複数の次元を監視するアラート ルールの例を以下に示します。

- ターゲット リソース: *myStorage1*
- メトリック: *トランザクション*
- Dimensions
  * API 名 = *GetBlob、DeleteBlob、PutPage*
- 演算子:*より大きい*
- しきい値: *70*

このアラート ルールによって、次の 3 つのメトリック時系列が監視されています。

- *リソース*='myStorage1' および *API 名*='GetBlob' のトランザクション > 70
- *リソース*='myStorage1' および *API 名*='DeleteBlob' のトランザクション > 70
- *リソース*='myStorage1' および *API 名*='PutPage' のトランザクション> 70

![1 次元の値がある多次元アラート ルール](media/alerts-metric-multiple-time-series-single-rule/multi-dimension-1.png)

多次元メトリック アラート ルールで、メトリックの **異なる** 次元からの複数の次元値を監視することもできます。 この場合、選択された次元値のすべての次元値の組み合わせが **個別に**、アラート ルールによって監視されます。

この種類のアラート ルールの例を次に示します。

- ターゲット リソース: *myStorage1*
- メトリック: *トランザクション*
- Dimensions
  * API 名 = *GetBlob、DeleteBlob、PutPage*
  * 認証 = *SAS、AccountKey*
- 演算子:*より大きい*
- しきい値: *70*

このアラート ルールによって、6 つのメトリック時系列が個別に監視されています。

- *リソース*='myStorage1' および *API 名*='GetBlob' および *認証*='SAS' のトランザクション > 70
- *リソース*='myStorage1' および *API 名*='GetBlob' および *認証*=’AccountKey’ のトランザクション > 70
- *リソース*='myStorage1' および *API 名*='DeleteBlob' および *認証*='SAS' のトランザクション > 70
- *リソース*='myStorage1' および *API 名*='DeleteBlob' および *認証*=’AccountKey’ のトランザクション > 70
- *リソース*='myStorage1' および *API 名*='PutPage' および *認証*='SAS' のトランザクション > 70
- *リソース*='myStorage1' および *API 名*='PutPage' および *認証*='AccountKey' のトランザクション > 70

![複数の次元からの値がある多次元アラート ルール](media/alerts-metric-multiple-time-series-single-rule/multi-dimension-2.png)
 
### <a name="advanced-multi-dimension-features"></a>高度な多次元機能

1.  **現在および将来のすべての次元の選択** – 将来の値を含め、次元の使用できるすべての値を監視するように選択できます。 このようなアラート ルールは、次元値が追加または削除されるたびにアラート ルールを変更することなく、次元のすべての値を監視するために自動的にスケーリングされます。
2.  **次元の除外** – 次元値に対して '≠' (除外) 演算子を選択することは、将来の値を含め、その次元の他のすべての値を選択することと同じです。
3.  **新規およびカスタム次元** – Azure portal に表示される次元値は、過去 1 日間に収集されたメトリック データに基づいています。 探している次元値がまだ生成されていない場合は、カスタム次元値を追加できます。
4. **プレフィックスとディメンションの照合** -'Starts with' 演算子を選択してカスタム プレフィックスを入力することにより、特定のパターンで始まるすべてのディメンション値を監視することができます。

![高度な多次元機能](media/alerts-metric-multiple-time-series-single-rule/advanced-features.png)


## <a name="metric-alerts-pricing"></a>メトリック アラートの価格

メトリック アラート ルールの価格については、「[Azure Monitor の価格](https://azure.microsoft.com/pricing/details/monitor/)」ページを参照してください。

メトリック アラート ルールを作成する場合、提供される価格の見積もりは、選択された機能と、ルールの構成および現在のメトリック値から決定される監視対象の時系列数に基づきます。 しかし、月額料金は時系列の実際の評価に基づいているため、一部の時系列に評価するデータがない場合や、アラート ルールで動的にスケーリングできる機能が使用されている場合は、元の見積りとは異なる可能性があります。

たとえば、多次元機能を利用していて、多数の次元値の組み合わせが選択されている場合、アラート ルールで高価格の見積もりが表示される可能性があるため、多くの時系列が監視されることになります。 しかし、次元値の組み合わせによって生成される時系列の一部に、実際に評価するデータが含まれていない場合、そのアラート ルールの実際の料金が低くなる可能性があります。

## <a name="number-of-time-series-monitored-by-a-single-alert-rule"></a>1 つのアラート ルールによって監視される時系列の数

超過コストを回避するために、各アラート ルールでは既定で最大 5,000 の時系列を監視できます。 サブスクリプションからこの制限を引き上げるには、サポート チケットを開いてください。


## <a name="next-steps"></a>次のステップ

メトリック アラートと[動的しきい値](../alerts/alerts-dynamic-thresholds.md)を使用した大規模な監視の詳細を確認します。
