---
title: Azure Monitor のアラートと通知のトラブルシューティング
description: Azure Monitor のアラートに関する一般的な問題と考えられる解決策。
author: ofirmanor
ms.author: ofmanor
ms.topic: reference
ms.date: 03/16/2020
ms.subservice: alerts
ms.openlocfilehash: beb47f961c6f24453bd49aa5807c9d801fc199a3
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/28/2020
ms.locfileid: "80132336"
---
# <a name="troubleshooting-problems-in-azure-monitor-alerts"></a>Azure Monitor のアラートの問題のトラブルシューティング 

この記事では、Azure Monitor のアラートに関する一般的な問題について説明します。

Azure Monitor のアラートは、監視データで重要な状態が見つかると事前に通知します。 管理者は、その通知を見て、システムのユーザーが問題に気付く前に問題を識別して対処できます。 アラートの詳細については、「[Microsoft Azure のアラートの概要](alerts-overview.md)」を参照してください。

## <a name="action-or-notification-on-my-alert-did-not-work-as-expected"></a>アラートのアクションまたは通知が想定どおりに機能しなかった

発生したアラートを Azure portal で確認できるが、そのアクションまたは通知の一部に問題がある場合は、以下のセクションを参照してください。

## <a name="did-not-receive-expected-email"></a>想定していたメールが届いていない

発生したアラートを Azure portal で確認できるが、そのアラートに設定したメールが届いていない場合は、次の手順に従います。 

1. **[アクション ルール](alerts-action-rules.md)によってメールが抑制されたか?** 

    確認するには、発生したアラートをポータルでクリックし、抑制された[アクション グループ](action-groups.md)の履歴タブを確認します。 

    ![アラート アクション ルール抑制履歴](media/alerts-troubleshoot/history-action-rule.png)

1. **アクションの種類が "Azure Resource Manager のロールへのメール" か?**

    このアクションは Azure Resource Manager ロールの割り当てのみを参照しますが、この割り当てのスコープはサブスクリプションであり、種類は *[ユーザー]* です。  リソース レベルまたはリソース グループ レベルではなくサブスクリプション レベルでロールを割り当てたことを確認してください。

1. **メール サーバーとメールボックスは外部メールを受け付けているか?**

    次の 3 つのアドレスからのメールがブロックされていないことを確認します。
      - azure-noreply@microsoft.com  
      - azureemail-noreply@microsoft.com
      - alerts-noreply@mail.windowsazure.com

    内部向けのメーリング リストや配信リストでは、外部のメール アドレスからのメールをブロックするのが一般的です。 上記のメール アドレスをホワイトリストに登録する必要があります。  
    テストするには、(メーリング リストではなく) 通常の仕事用メール アドレスをアクション グループに追加し、そのメールにアラートが届くかどうか確認します。 

1. **受信トレイのルールまたはスパム フィルターによってメールが処理されたか?** 

    これらのメールを削除したり、サイド フォルダーに移動したりする受信トレイのルールがないことを確認します。 たとえば、受信トレイのルールは、特定の送信者や、件名に含まれる特定の単語を捕捉することがあります。

    以下の点も確認してください。
    
      - メール クライアント (Outlook、Gmail など) のスパム設定
      - メール サーバー (Exchange、Office 365、G Suite など) の送信者制限/スパム設定/検査設定
      - メール セキュリティ アプライアンス (Barracuda、Cisco など) がある場合、その設定 

1. **アクション グループから誤って登録解除したか?** 

    アラート メールには、アクション グループから登録解除するためのリンクが用意されています。 このアクション グループから誤って登録解除したかどうかを確認するには、次のいずれかを実行します。

    1. ポータルでアクション グループを開き、[状態] 列を確認します。

    ![アクション グループの状態列](media/alerts-troubleshoot/action-group-status.png)

    2. メールから登録解除の確認を探します。

    ![アラート アクション グループからの登録解除](media/alerts-troubleshoot/unsubscribe-action-group.png)

    再登録するには、受信した登録解除確認メール内のリンクを使用します。または、アクション グループからメール アドレスを削除してから、再度そのアドレスを追加します。 
 
1. **1 つのメール アドレスに多くのメールが送信されたためレート制限の対象になったか?** 

    電子メールは、電子メール アドレスごとに 1 時間に 100 通以下に[レート制限](alerts-rate-limiting.md)されています。 このしきい値を超えると、超えた分のメール通知は破棄されます。  メール アドレスが一時的にレート制限されたという通知メッセージが届いていないか確認してください。 
 
   ![メールのレート制限](media/alerts-troubleshoot/email-paused.png)

   レート制限なしで大量の通知を受信することが必要な場合は、Webhook、ロジック アプリ、Azure 関数、オートメーション Runbook など、レート制限を受けない別のアクションの使用を検討してください。 

## <a name="did-not-receive-expected-sms-voice-call-or-push-notification"></a>想定していた SMS、音声通話、またはプッシュ通知が来なかったか?

発生したアラートをポータルで確認できるが、そのアラートに設定した SMS、音声通話、またはプッシュ通知が来ていない場合は、次の手順に従います。 

1. **[アクション ルール](alerts-action-rules.md)によってアクションが抑制されたか?** 

    確認するには、発生したアラートをポータルでクリックし、抑制された[アクション グループ](action-groups.md)の履歴タブを確認します。 

    ![アラート アクション ルール抑制履歴](media/alerts-troubleshoot/history-action-rule.png)

   意図したものでなかった場合、アクション ルールを変更、無効化、または削除できます。
 
1. **SMS/音声: 電話番号は正しいか?**

   SMS アクションの国番号または電話番号の入力に誤りがないか確認してください。 
 
1. **SMS/音声: レート制限されているか?** 

    SMS と音声通話による通知は、各電話番号で 5 分ごとに 1 件以下にレート制限されています。 このしきい値を超えると、通知は破棄されます。 

      - 音声通話 - 通話履歴を調べて、前の 5 分間に Azure から別の通話があったかどうか確認します。 
      - SMS - SMS の履歴を調べて、電話番号にレート制限が適用されたことを示すメッセージがないかどうかを確認します。 

    レート制限なしで大量の通知を受信することが必要な場合は、Webhook、ロジック アプリ、Azure 関数、オートメーション Runbook など、レート制限を受けない別のアクションの使用を検討してください。 
 
1. **SMS: アクション グループから誤って登録解除したか?**

    SMS の履歴を開き、(DISABLE action_group_short_name 応答を使用して) この特定のアクション グループからの、または (STOP 応答を使用して) すべてのアクション グループからの SMS 配信をオプトアウトしていないかどうか確認します。 再登録するには、適切な SMS コマンド (ENABLE action_group_short_name または START) を送信します。または、アクション グループから SMS アクションを削除してから、再度追加します。  詳細については、「[アクション グループの SMS アラート動作](alerts-sms-behavior.md)」を参照してください。

1. **端末で誤って通知をブロックしていないか?**

   ほとんどの携帯電話では、特定の電話番号やショート コードからの通話や SMS をブロックしたり、(Azure mobile app などの) 特定のアプリからのプッシュ通知をブロックしたりできます。 端末で誤って通知をブロックしていないか確認するには、お使いの端末のオペレーティング システムとモデルのドキュメントを参照するか、別の端末と電話番号を使ってテストしてください。 

## <a name="expected-another-type-of-action-to-trigger-but-it-did-not"></a>別の種類のアクションがトリガーされると想定していたが、されなかった 

発生したアラートをポータルで確認できるが、そのアラートに設定したアクションがトリガーされなかった場合は、次の手順に従います。 

1. **アクション ルールによってアクションが抑制されたか?** 

    確認するには、発生したアラートをポータルでクリックし、抑制された[アクション グループ](action-groups.md)の履歴タブを確認します。 

    ![アラート アクション ルール抑制履歴](media/alerts-troubleshoot/history-action-rule.png)
 
    意図したものでなかった場合、アクション ルールを変更、無効化、または削除できます。 

1. **Webhook がトリガーされなかったか?**

    1. **発信元 IP アドレスがブロックされていないか?**
    
       Webhook の呼び出し元 [IP アドレス](action-groups.md#action-specific-information)をホワイトリストに登録します。

    1. **Webhook エンドポイントは正しく機能しているか?**

       構成済みの Webhook エンドポイントが正しいこと、およびエンドポイントが正常に動作していることを確認します。 Webhook のログを確認するか、調査ができるように Webhook のコードをインストルメント化します (たとえば、受信ペイロードをログに記録します)。 

    1. **Slack または Microsoft Teams を呼び出しているか?**  
    これらのエンドポイントはそれぞれ、特定の JSON 形式を想定しています。 [この手順](action-groups-logic-app.md)に従って、代わりにロジック アプリ アクションを構成してください。

    1. **Webhook が応答しなくなったりエラーを返したりしたか?** 

        Webhook 応答のタイムアウト期間は 10 秒です。 Webhook の呼び出しが追加で 2 回まで再試行されるのは、HTTP 状態コードの 408、429、503、504 が返されるか、HTTP エンドポイントが応答しない場合です。 1 回目の再試行は 10 秒後に実行されます。 2 回目となる最後の再試行は 100 秒後に実行されます。 2 回目の再試行が失敗した場合、エンドポイントは 30 分間、どのアクション グループでも呼び出されません。

## <a name="action-or-notification-happened-more-than-once"></a>アクションまたは通知が複数回発生した 

アラートの通知 (メールや SMS など) を 2 回以上受信した場合や、アラートのアクション (Webhook または Azure 関数など) が複数回トリガーされた場合は、次の手順に従います。 

1. **本当に同じアラートか?** 

    複数の同じようなアラートがほぼ同時に発生する場合があります。 そのため、同じアラートによってアクションが何回もトリガーされたように見えるかもしれません。 たとえば、イベント状態フィールドでフィルター処理しないことによって、アクティビティ ログのアラート ルールがイベントの開始時と (成功か失敗かを問わず) 終了時の両方で発動するように構成できます。 

    これらのアクションまたは通知が異なるアラートからのものかどうか確認するには、アラートのタイムスタンプや、アラート ID またはその相関 ID など、アラートの詳細を調べます。または、発生したアラートの一覧をポータルで確認します。 当てはまる場合、アラート ルールのロジックを調整するか、アラートのソースを構成することが必要になります。 

1. **複数のアクション グループでアクションが繰り返されるか?** 

    アラートが発生すると、アラートのアクション グループが 1 つ 1 つ、個別に処理されます。 そのため、(メール アドレスなどの) 1 つのアクションが、トリガーされた複数のアクション グループに出現する場合、そのアクションはアクション グループごとに 1 回ずつ呼び出されます。 

    どのアクション グループがトリガーされたかを調べるには、アラート履歴タブを確認します。アラート ルールで定義されているアクション グループと、アクション ルールによってアラートに追加されたアクション グループの両方が表示されます。 

    ![複数のアクション グループで繰り返されるアクション](media/alerts-troubleshoot/action-repeated-multi-action-groups.png)

## <a name="action-or-notification-has-an-unexpected-content"></a>予期しない内容がアクションまたは通知に含まれている

アラートを受信したが、そのフィールドの一部が欠落しているか正しくないと思われる場合は、次の手順を実行します。 

1. **アクションの正しい形式を選択したか?** 

    アクションの種類 (メール、Webhook など) ごとに、2 つの形式があります。既定のレガシ形式と、[より新しい共通スキーマ形式](alerts-common-schema.md)です。 アクション グループを作成するときは、アクションごとに必要な形式を指定します。アクション グループ内のアクションごとに形式が異なる場合があります。 

    たとえば、Webhook アクションの場合は次のようになります。 

    ![Webhook アクションのスキーマ オプション](media/alerts-troubleshoot/webhook.png)

    アクション レベルで指定された形式が想定どおりかどうか確認します。 たとえば、ある形式を想定して (Webhook、関数、ロジック アプリなどの) アラートに応答するコードを開発したが、後からアクションで自分または別の人が別の形式を指定する場合があります。  

    また、[アクティビティ ログ アラート](activity-log-alerts-webhook.md)、[ログ検索アラート](alerts-log-webhook.md) (Application Insights とログ分析の両方)、[メトリック アラート](alerts-metric-near-real-time.md#payload-schema)、[一般的なアラート スキーマ](alerts-common-schema-definitions.md)、非推奨の[クラシック メトリック アラート](alerts-webhooks.md)のペイロード形式 (JSON) も確認してください。

 
1. **アクティビティ ログ アラート: アクティビティ ログに情報があるか?** 

    [アクティビティ ログ アラート](activity-log-alerts.md)は、Azure アクティビティ ログに書き込まれたイベントに基づくアラートです。イベントの例には、Azure リソースの作成、更新、削除に関するイベント、サービス正常性とリソース正常性のイベント、Azure Advisor や Azure Policy からの情報などがあります。 アクティビティ ログに基づくアラートを受信したが、必要なフィールドの一部が欠落しているか正しくない場合は、まず、アクティビティ ログ自体でイベントを確認してください。 Azure リソースのアクティビティ ログ イベントで探しているフィールドが、そのリソースによって書き込まれなかった場合、それらのフィールドは対応するアラートに含まれません。 

## <a name="action-rule-is-not-working-as-expected"></a>アクション ルールが想定どおりに機能しない 

発生したアラートをポータルで確認できるが、関連するアクション ルールが想定どおりに機能しない場合は、次の手順に従います。 

1. **アクション ルールは有効か?** 

    アクション ルールの状態列を調べて、関連するアクション ロールが有効になっていることを確認します。 

    ![図](media/alerts-troubleshoot/action-rule-status.png) 

    有効になっていない場合、アクション ルールを選択して [Enable] (有効にする) をクリックすると有効化できます。 

1. **サービス正常性アラートか?** 

    サービス正常性アラート (monitor service = "Service Health") は、アクション ルールの影響を受けません。 

1. **アクション ルールはアラートに作用したか?** 

    発生したアラートをポータルでクリックして、アクション ルールがアラートを処理したかどうかを確認し、履歴タブを確認します。

    すべてのアクション グループを抑制するアクション ルールの例を次に示します。 
 
     ![アラート アクション ルール抑制履歴](media/alerts-troubleshoot/history-action-rule.png)

    別のアクション グループを追加するアクション ルールの例を次に示します。

    ![複数のアクション グループで繰り返されるアクション](media/alerts-troubleshoot/action-repeated-multi-action-groups.png)
 

1. **アクション ルールのスコープとフィルターは発生したアラートと一致しているか?** 

    アクション ルールが発動するはずだが発動しなかった、または発動しないはずだったが発動したと思われる場合は、アクション ルールのスコープとフィルターの条件を、発生したアラートのプロパティとよく照合してください。 


## <a name="how-to-find-the-alert-id-of-a-fired-alert"></a>発生したアラートのアラート ID を調べる方法

(アラートのメール通知が届かなかった場合などに) 発生した特定のアラートに関してケースをオープンするときは、アラート ID を知らせる必要があります。 

調べるには、次の手順に従います。

1. Azure portal で、発生したアラートの一覧に移動し、その特定のアラートを探します。 フィルターを使用すると探しやすくなります。 

1. アラートをクリックすると、アラートの詳細が表示されます。 

1. 最初のタブ (概要タブ) のアラート フィールドで、ID が見つかるまで下にスクロールし、ID をコピーします。 このフィールドにある [クリップボードにコピー] ボタンも使用できます。  

    ![アラート ID の検索](media/alerts-troubleshoot/get-alert-id.png)

## <a name="problem-creating-updating-or-deleting-action-rules-in-the-azure-portal"></a>Azure portal でのアクション ルールの作成、更新、削除の問題

[アクション ルール](alerts-action-rules.md)の作成、更新、または削除中にエラーが発生した場合は、次の手順に従います。 

1. **アクセス許可エラーが発生したか?**  

     [共同作成者の監視の組み込みロール](https://docs.microsoft.com/azure/role-based-access-control/built-in-roles#monitoring-contributor)、またはアクション ルールとアラートに関連した特定のアクセス許可のいずれかが必要です。

1. **アクション ルールのパラメーターを確認したか?**  

    [アクション ルールのドキュメント](alerts-action-rules.md)、または[アクション ルールの PowerShell Set-AzActionRule ](https://docs.microsoft.com/powershell/module/az.alertsmanagement/Set-AzActionRule?view=azps-3.5.0)コマンドを確認してください。 


## <a name="next-steps"></a>次のステップ
- ログ アラートを使用する場合は、[ログ アラートのトラブルシューティング](alert-log-troubleshoot.md)も参照してください。
- [Azure portal](https://portal.azure.com) に戻り、上記のガイダンスに従って問題が解決したかどうかを確認します 
