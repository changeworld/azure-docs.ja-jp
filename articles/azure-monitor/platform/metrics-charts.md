---
title: Azure メトリックス エクスプローラーの高度な機能
description: Azure メトリックス エクスプローラーの高度な機能について説明します
author: vgorbenko
services: azure-monitor
ms.topic: conceptual
ms.date: 01/22/2019
ms.author: vitalyg
ms.subservice: metrics
ms.openlocfilehash: e6ff33b6a23cb85649a8811a8bef27ab455ab9e6
ms.sourcegitcommit: 999ccaf74347605e32505cbcfd6121163560a4ae
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 05/08/2020
ms.locfileid: "82980900"
---
# <a name="advanced-features-of-azure-metrics-explorer"></a>Azure メトリックス エクスプローラーの高度な機能

> [!NOTE]
> この記事は、メトリックス エクスプローラーの基本的な機能を理解していることを前提としています。 新規のユーザーで、初めてのメトリック グラフを作成する方法を確認するには、「[Azure メトリックス エクスプローラーの概要](metrics-getting-started.md)」を参照してください。

## <a name="metrics-in-azure"></a>Azure のメトリック

[Azure Monitor におけるメトリック](data-platform-metrics.md)は、時間をかけて収集して保存された一連の測定値とカウントです。 標準 ("プラットフォーム") メトリックとカスタム メトリックがあります。 標準メトリックは、Azure プラットフォーム自体によって提供されます。 標準メトリックは、Azure リソースの状態と使用状況の統計を反映します。 カスタム メトリックは、[カスタム イベントとメトリック用の Application Insights API](https://docs.microsoft.com/azure/application-insights/app-insights-api-custom-events-metrics)、[Windows Azure Diagnostics (WAD) 拡張機能](https://docs.microsoft.com/azure/azure-monitor/platform/diagnostics-extension-overview)、または [Azure Monitor REST API](https://docs.microsoft.com/azure/azure-monitor/platform/metrics-store-custom-rest-api) を使用して、アプリケーションによって Azure に送信されます。

## <a name="create-views-with-multiple-metrics-and-charts"></a>複数のメトリックとグラフがあるビューを作成する

複数のメトリックの線をプロットするグラフを作成することや、一度に複数のメトリック グラフを表示することができます。 この機能を利用すると、次のことが可能になります。

- 1 つの値が別の値とどのように関連しているかを確認できるように、同じグラフ上の関連するメトリックの相互関係を示す
- 測定単位が異なるメトリックを近くに表示する
- 複数のリソースのメトリックを視覚的に集計して比較する

たとえば、5 つのストレージ アカウントがあり、それらの間で消費される合計領域サイズを確認するには、特定の時点における個々の値とすべての値の合計を示す (積み上げ) 面グラフを作成します。

### <a name="multiple-metrics-on-the-same-chart"></a>同じグラフ上の複数のメトリック

まず、[新しいグラフを作成](metrics-getting-started.md#create-your-first-metric-chart)します。 **[メトリックの追加]** をクリックし、同じ手順を繰り返して同じグラフに別のメトリックを追加します。

   > [!NOTE]
   > 通常は、単位が異なるメトリック ("ミリ秒" と "キロバイト") やスケールが大幅に異なるメトリックを 1 つのグラフには表示しません。 代わりに、複数のグラフを使用することを検討してください。 メトリックス エクスプローラーで複数のグラフを作成するには、[グラフの追加] ボタンをクリックします。

### <a name="multiple-charts"></a>複数のグラフ

**[グラフの追加]** をクリックして、異なるメトリックを使用する別のグラフを作成します。

### <a name="order-or-delete-multiple-charts"></a>複数のグラフの並べ替えまたは削除

複数のグラフを並べ替えるには、省略記号 ( **...** ) をクリックしてグラフ メニューを開き、必要に応じて **[上に移動]** 、 **[下に移動]** 、または **[削除]** を選択します。

## <a name="changing-aggregation"></a>集計の変更

グラフにメトリックを追加すると、メトリック エクスプローラーによって自動的に既定の集計が選択されます。 基本的なシナリオでは既定値が適していますが、別の集計を使用することで、メトリックに関する分析情報をさらに得ることができます。 グラフ上でさまざまな集計を表示するには、メトリック エクスプローラーで、これらがどのように処理されるかを理解しておく必要があります。 

メトリックとは、ある期間内にキャプチャされた一連の測定値 (または "メトリック値") です。 グラフをプロットすると、選択されたメトリックの値は、*時間グレイン*で個別に集計されます。 時間グレインのサイズを選択するには、[メトリック エクスプローラーの時刻の選択パネル](metrics-getting-started.md#select-a-time-range)を使用します。 時間グレインを明示的に選択しない場合、時間の粒度は現在選択されている時間の範囲に基づいて自動的に選択されます。 時間グレインが決定されると、各時間グレインの間隔でキャプチャされたメトリック値が集計され、時間グレインごとに 1 つのデータポイントがグラフに配置されます。

たとえば、 **[last 24 hours]\(過去 24 時間\)** という期間における **[Average]\(平均\) **集計を使用して、** [Server Response Time]\(サーバー応答時間\)** メトリックを示すグラフがあるとします。

- 時間の粒度が 30 分に設定されている場合、グラフは集計された 48 個のデータポイントから描画されます (たとえば、折れ線グラフではグラフのプロット エリアにある 48 の点が繋げられます)。 つまり、1 時間あたり 24 時間 x 2 個のデータポイントとなります。 各データポイントは、対象となる 30 分間に発生したサーバー要求について、キャプチャされたすべての応答時間の*平均*を表します。
- 時間の粒度を 15 分に切り替えると、集計された 96 個のデータポイントが取得されます。  つまり、1 時間あたり 24 時間 x 4 個のデータポイントとなります。

メトリック エクスプローラーでは、**Sum**、**Count**、**Min**、**Max**、および **Average** という 5 種類の基本的な統計集計方法を使用できます。 **Sum** 集計は **Total** 集計とも呼ばれます。 メトリック エクスプローラーでは、多くのメトリックにおいて完全に無関係、または使用できない集計は非表示になります。

- **Sum** – 集計間隔でキャプチャされたすべての値の合計
- **Count** – 集計間隔でキャプチャされた測定値の数。 メトリックが常に 1 の値でキャプチャされる場合において、**Count** は **Sum** と等しくなることに注意してください。 これは、メトリックが個別のイベントの数を追跡し、各測定が 1 つのイベント (つまり、新しい要求が送信されるたびにメトリック レコードからコードが実行される) を表す場合によく発生します
- **Average** – 集計間隔でキャプチャされたメトリック値の平均
- **Min** –集計間隔でキャプチャされた値の最小値
- **Max** –集計間隔でキャプチャされた値の最大値

## <a name="apply-filters-to-charts"></a>グラフにフィルターを適用する

ディメンションがあるメトリックを表示しているグラフには、フィルターを適用できます。 たとえば、"トランザクション数" メトリックには "応答の種類" というディメンションがあります。このディメンションは、トランザクションからの応答が成功したか失敗したかを示します。このディメンションでフィルター処理すると、成功した (または失敗した) トランザクションのみが折れ線グラフで表示されます。 

### <a name="to-add-a-filter"></a>フィルターを追加するには

1. グラフの上の **[フィルターの追加]** を選択します

2. フィルター処理するディメンション (プロパティ) を選択します。

   ![メトリックの画像](./media/metrics-charts/00006.png)

3. グラフを描画するときに含めるディメンションの値を選択します (この例では、成功したストレージ トランザクションを除外しています)。

   ![メトリックの画像](./media/metrics-charts/00007.png)

4. フィルターの値を選択したら、フィルター セレクターの外側をクリックして、セレクターを閉じます。 これで、グラフには、失敗したストレージ トランザクションの数が表示されます。

   ![メトリックの画像](./media/metrics-charts/00008.png)

5. 手順 1 ～ 4 を繰り返して、同じグラフに複数のフィルターを適用できます。



## <a name="apply-splitting-to-a-chart"></a>グラフに分割を適用する

メトリックをディメンションによって分割し、メトリックの異なるセグメントの比較を視覚化して、ディメンションの値が異常なセグメントを識別できます。

### <a name="apply-splitting"></a>[Apply splitting]\(分割の適用\)

1. グラフの上の **[Apply splitting]\(分割の適用\)** をクリックします。
 
   > [!NOTE]
   > 分割は、複数のメトリックがあるグラフでは使用できません。 また、複数のフィルターを設定できますが、1 つのグラフに設定できるのは 1 つの分割セグメントのみとなります。

2. グラフをセグメント化するディメンションを選択します。

   ![メトリックの画像](./media/metrics-charts/00010.png)

   これで、グラフには、それぞれがディメンションのセグメントである複数の線が表示されます。

   ![メトリックの画像](./media/metrics-charts/00012.png)

3. **グループ セレクター**の外側のクリックして、セレクターを閉じます。

   > [!NOTE]
   > シナリオとは無関係のセグメントを非表示にしてグラフを読みやすくするには、同じディメンションでフィルター処理と分割の両方を使用します。

## <a name="lock-boundaries-of-chart-y-axis"></a>グラフの Y 軸の境界をロックする

大きな値のわずかな変動をグラフで示す場合、Y 軸の範囲をロックすることが重要となります。 

たとえば成功した要求のボリュームが 99.99% から 99.5% に低下した場合、サービスの品質としては、大幅な悪化を表している可能性があります。 しかし、グラフの既定の設定では、数値のわずかな変動は気付きにくいか、まったくわからないこともあります。 この場合、グラフの下限境界を 99% にロックすれば、このわずかな低下を目立たせることができます。 

また別の例としては、使用可能なメモリにおける変動が挙げられます。この値が 0 に達することは技術的にはありえません。 もっと高い値に範囲を固定すれば、使用可能なメモリ量の低下が特定しやすくなると考えられます。 

Y 軸の範囲を制御するには、 グラフの […] メニューを使用し、 **[グラフの編集]** を選択して、グラフの詳細設定にアクセスします。 [Y 軸の範囲] セクションの各値を変更してください。または、既定値に戻すには、 **[自動]** ボタンを使用します。

![メトリックの画像](./media/metrics-charts/00014-manually-set-granularity.png)

> [!WARNING]
> 通常、ある期間にわたってさまざまな個数や合計を追跡する (カウント、合計、最小、最大などの集計を使用する) グラフで Y 軸の境界をロックするためには、自動による既定の設定をそのまま使うのではなく、時間の粒度を固定的に指定する必要があります。 なぜなら、ブラウザー ウィンドウのサイズや画面の解像度をユーザーが変更することで、時間の粒度が自動的に変わると、グラフ上の値が変化するためです。 それによって生じた時間の粒度の変化がグラフの外観に影響を及ぼし、Y 軸の範囲に対する現在の選択が適さなくなってしまいます。

## <a name="change-colors-of-chart-lines"></a>グラフの線の色を変更する

グラフを構成すると、グラフの線の色は既定のパレットから自動的に割り当てられます。 これらの色は変更できます。

グラフの線の色を変更するには、グラフに対応する凡例の色分けされたバーをクリックします。 カラー ピッカーのダイアログが開きます。 カラー ピッカーを使用して、線の色を構成します。

構成したグラフの色はその後、グラフをダッシュボードにピン留めしても、そのままになります。 次のセクションでは、グラフをピン留めする方法について説明します。

![メトリックの画像](./media/metrics-charts/018.png)

## <a name="pin-charts-to-dashboards"></a>ダッシュボードにグラフをピン留めする

グラフを構成した後、他の監視テレメトリと関連して再び表示したり、チームと共有したりできるように、グラフをダッシュボードに追加できます。

構成したグラフをダッシュボードにピン留めするには:

グラフを構成した後、グラフの右上隅にある **[Chart Actions]\(グラフの操作\)** メニューをクリックし、 **[ダッシュボードに固定]** をクリックします。

![メトリックの画像](./media/metrics-charts/00013.png)

## <a name="create-alert-rules"></a>アラート ルールの作成

メトリック ベースのアラート ルールの基準として、メトリックを視覚化するために設定した条件を使用できます。 新しいアラート ルールにはターゲット リソース、メトリック、分割、およびグラフからのフィルター ディメンションが含まれます。 これらの設定は、アラート ルールの作成ウィンドウで後で変更できます。

### <a name="to-create-a-new-alert-rule-click-new-alert-rule"></a>新しいアラート ルールを作成するには、 **[新しいアラート ルール]** をクリックします。

![赤色で強調表示されている [新しいアラート ルール] ボタン](./media/metrics-charts/015.png)

カスタムのアラート ルールを生成しやすくするために、事前に設定されたグラフからの基になるメトリック ディメンションを含むアラート ルール作成ウィンドウが表示されます。

![アラート ルールの作成](./media/metrics-charts/016.png)

メトリック アラートの設定の詳細については、こちらの[記事](alerts-metric.md)を確認してください。

## <a name="troubleshooting"></a>トラブルシューティング

*グラフにデータが表示されない。*

* フィルターは、ウィンドウのすべてのグラフに適用されます。 あるグラフに注目するときに、別のグラフですべてのデータを除外するフィルターを設定していないことを確認します。

* グラフごとに異なるフィルターを設定する場合は、それぞれ異なるブレードでグラフを作成し、個別のお気に入りとして保存します。 その場合、グラフを並べて表示できるように、グラフをダッシュボードに固定できます。

* メトリックで定義されていないプロパティでグラフをセグメント化すると、グラフに何も表示されなくなります。 セグメント化 (分割) を削除するか、別のプロパティを選択してください。

## <a name="next-steps"></a>次のステップ

  [カスタム KPI ダッシュボードの作成](https://docs.microsoft.com/azure/application-insights/app-insights-tutorial-dashboards)に関する記事で、メトリックを使用した実用的なダッシュボードを作成するためのベスト プラクティスを確認します。

