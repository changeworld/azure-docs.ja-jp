---
title: Azure Application Insights の使用のコーホート | Microsoft Docs
description: 共通点を持つさまざまなユーザー セット、セッション セット、イベント セット、または操作セットを分析します。
services: application-insights
documentationcenter: ''
author: NumberByColors
manager: carmonm
ms.service: application-insights
ms.workload: tbd
ms.tgt_pltfrm: ibiza
ms.topic: conceptual
ms.date: 04/10/2018
ms.reviewer: mbullwin
ms.pm_owner: daviste;NumberByColors
ms.author: daviste
ms.openlocfilehash: 810ccae08b540c417a0e7dfecb6ad5a8b110cd7b
ms.sourcegitcommit: 8330a262abaddaafd4acb04016b68486fba5835b
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 01/04/2019
ms.locfileid: "54045284"
---
# <a name="application-insights-cohorts"></a>Application Insights コーホート

コーホートとは、共通点を持つユーザー セット、セッション セット、イベント セット、または操作セットのことです。 Azure Application Insights では、コーホートは分析クエリによって定義されます。 特定のユーザー セットまたはイベント セットを繰り返し分析する必要がある場合、コーホートを使用することで、より柔軟性の高い方法で目的のセットを正確に表現することができます。

![[コーホート] ウィンドウ](./media/usage-cohorts/001.png)

## <a name="cohorts-versus-basic-filters"></a>コーホート対基本的なフィルター

コーホートは、フィルターに似た方法で使われます。 ただし、コーホートの定義はカスタム分析クエリから作成されるため、それらははるかに適応性があり、複雑です。 フィルターとは異なり、コーホートの場合はチームの他のメンバーも再利用できるように保存することができます。

アプリの新機能を試してみたすべてのユーザーのコーホートを定義するとします。 Application Insights リソースにこのコホートを保存できます。 後で、この保存された特定のユーザーのグループを簡単に分析できます。

> [!NOTE]
> コーホートが作成されたら、ユーザー、セッション、イベント、ユーザー フローの各ツールからコーホートを利用できます。

## <a name="example-engaged-users"></a>例:関心度の高いユーザー

チームでは、特定の月間に対象のアプリを 5 回以上使用したユーザーを関心度の高いユーザーとして定義しています。 このセクションでは、このような関心度の高いユーザーのコーホートを定義します。

1. コーホート ツールを開きます。

2. **[テンプレート ギャラリー]** タブを選択します。さまざまなコーホート用テンプレートのコレクションがあります。

3. **[関心度の高いユーザー]** (利用日数による) を選択します。

    このコーホートに対しては 3 つのパラメーターがあります。
    * **アクティビティ**: "使用" としてカウントするイベントおよびページ ビューを選択します。
    * **期間**: 月の定義です。
    * **UsedAtLeastCustom**: 関心度が高いとしてカウントするために、ユーザーが期間内に何かを使用する必要がある回数。

4. **UsedAtLeastCustom** を **5 日以上**に変更し、**[期間]** を既定値の 28 日のままとします。

    ![関心度の高いユーザー](./media/usage-cohorts/003.png)

    これで、このコーホートは過去 28 日間の個別の 5 日間において、任意のカスタム イベントまたはページ ビューと共に送信されたすべてのユーザー ID を表すようになりました。

5. **[保存]** を選択します。

   > [!TIP]
   > "関心度の高いユーザー (5 日以上)" のようなコーホートの名前を付けます。 "個人用レポート" または "共有レポート" に保存します。どちらにするかは、この Application Insights リソースへのアクセス権を有する他のユーザーにもこのコーホートを表示させるかどうかによって決まります。

6. **[ギャラリーに戻る]** を選択します。

### <a name="what-can-you-do-by-using-this-cohort"></a>このコーホートを使用して行えること

ユーザー ツールを開きます。 **[表示]** ドロップダウン ボックスから、**[Users who belong to] (属するユーザー)** で作成したコーホートを選択します。

これで、ユーザー ツールはフィルター処理され、ユーザーに関するこのコーホートだけが表示されます。

![特定のコーホートを表示するようにフィルター処理された [ユーザー] ウィンドウ](./media/usage-cohorts/004.png)

注意すべき重要な点をいくつか次に示します。

* このセットは、通常のフィルターによって作成できません。 日付のロジックがより具体的になっています。
* ユーザー ツールでは通常のフィルターを使用してこのコーホートをさらにフィルター処理することができます。 したがって、コーホートは 28 日の期間に定義されていますが、ユーザー ツール内で時間の範囲を 30 日、60 日、または 90 日に調整することができます。

これらのフィルターは、クエリ ビルダーによって表現できないより高度な質問をサポートします。 たとえば、_過去 28 日間で関心が高かったユーザーがいるとします。それらの同じユーザーが過去 60 日間でどのような行動をしていたでしょうか。_

## <a name="example-events-cohort"></a>例:イベントのコーホート

イベントのコーホートを作成することもできます。 このセクションでは、イベントとページ ビューのコホートを定義します。 次に、他のツールからそれらを使用する方法を確認します。 このコホートは、チームによって_アクティブな使用_と見なされるイベント セットや特定の新機能に関連するイベント セットを定義できます。

1. コーホート ツールを開きます。

2. **[テンプレート ギャラリー]** タブを選択します。さまざまなコーホート用テンプレートのコレクションが表示されます。

3. **[Events Picker] (イベントの選択)** を選択します。

    ![イベントの選択のスクリーンショット](./media/usage-cohorts/006.png)

4. **[アクティビティ]** ドロップダウン ボックスで、コーホート内に含めるイベントを選択します。

5. コーホートを保存し、名前を付けます。

## <a name="example-active-users-where-you-modify-a-query"></a>例:クエリを修正するアクティブ ユーザー

前の 2 つのコーホートは、ドロップダウン ボックスを使用して定義されました。 ただし、全体的な柔軟性を高めるために分析クエリを使用してコーホートを定義することもできます。 方法を確認するために、英国のユーザーのコーホートを作成します。

![コーホート ツールの使い方を順を追って示すアニメーション画像](./media/usage-cohorts/cohorts0001.gif)

1. コーホート ツールを開き、**[テンプレート ギャラリー]** タブを選択して、**[Blank Users cohort] (空のユーザーのコーホート)** を選択します。

    ![空のユーザーのコーホート](./media/usage-cohorts/001.png)

    次の 3 つのセクションがあります。
    * Markdown テキスト セクション: チームの他のユーザーのためにコーホートの詳細を記述します。

    * パラメーター セクション: 前述の 2 つの例の **[アクティビティ]** やその他のドロップダウン ボックスのような独自のパラメーターを作成します。

    * クエリ セクション: 分析クエリを使用してコーホートを定義します。

    クエリ セクションには、[分析クエリを記述](/azure/kusto/query)します。 クエリは、定義するコーホートが記述された特定の行セットを選択します。 コーホート ツールによって、“| summarize by user_Id” 句が暗黙的にクエリに追加されます。 このデータはテーブル内のクエリの下にプレビュー表示されるので、クエリが結果を返していることを確認できます。

    > [!NOTE]
    > クエリが表示されない場合は、セクションの高さを高くしてクエリが表示されるようにサイズ調整を行います。 このセクションの先頭にあるアニメーション .gif に、サイズ変更の操作が示されています。

2. 以下のテキストをコピーして、クエリ エディターに貼り付けます。

    ```KQL
    union customEvents, pageViews
    | where client_CountryOrRegion == "United Kingdom"
    ```

3. **[クエリの実行]** を選択します。 ユーザー ID がテーブルに表示されない場合は、アプリケーションのユーザーがいる国に変更します。

4. コーホートを保存して名前を付けます。

## <a name="frequently-asked-questions"></a>よく寄せられる質問

_特定の国からのユーザーのコーホートを定義しました。ユーザー ツールでこのコーホートを、その国に対してフィルターを設定しただけの場合と比較すると、異なる結果が表示されます。なぜですか?_

コーホートとフィルターは異なります。 英国からのユーザーのコーホートが存在し (前の例のように定義された)、その結果を “Country or region = United Kingdom” というフィルターを設定した場合と比較するとします。

* コーホートの結果には、現在の時間の範囲において英国から 1 つ以上のイベントを送信したユーザーのすべてのイベントが表示されます。 国または地域で分割した場合は、多くの国や地域が表示される可能性が高くなります。
* フィルターの結果には、英国からのイベントのみが表示されます。 ただし、国または地域で分割した場合は、英国だけ表示されます。

## <a name="learn-more"></a>詳細情報

* [Analytics クエリ言語](https://go.microsoft.com/fwlink/?linkid=856587)
* [ユーザー、セッション、イベント](usage-segmentation.md)
* [ユーザー フロー](usage-flows.md)
* [利用状況の概要](usage-overview.md)