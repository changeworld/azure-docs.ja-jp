---
title: Web サイトの可用性と応答性の監視 | Microsoft Docs
description: Application Insights で Web テストを設定します。 Web サイトが使用できなくなったり、応答速度が低下したりした場合に、アラートを受け取ります。
services: application-insights
documentationcenter: ''
author: lgayhardt
manager: carmonm
ms.assetid: 46dc13b4-eb2e-4142-a21c-94a156f760ee
ms.service: application-insights
ms.workload: tbd
ms.tgt_pltfrm: ibiza
ms.topic: conceptual
ms.date: 12/05/2018
ms.reviewer: sdash
ms.author: lagayhar
ms.openlocfilehash: 480edbb508b875d53d972e9ac93fd4d119c7e54a
ms.sourcegitcommit: 818d3e89821d101406c3fe68e0e6efa8907072e7
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 01/09/2019
ms.locfileid: "54119664"
---
# <a name="monitor-availability-and-responsiveness-of-any-web-site"></a>Web サイトの可用性と応答性の監視
いずれかのサーバーに Web アプリまたは Web サイトをデプロイした後、テストを設定して、その可用性と応答性を監視できます。 [ Application Insights](../../azure-monitor/app/app-insights-overview.md) は、世界各地の複数のポイントから定期的にアプリケーションに Web 要求を送信します。 アプリケーションがまったく応答しなくなったりアプリケーションの応答が遅くなったりした場合は、Application Insights からその旨が通知されます。

可用性テストは、パブリック インターネットからアクセスできる任意の HTTP または HTTPS エンドポイントに対して設定できます。 テストする Web サイトには何も追加する必要はありません。 自社のサイトにも何も追加せずに、使用する REST API サービスをテストできます。

可用性テストには、次の 2 種類があります。

* [URL の Ping テスト](#create): Azure Portal で作成できる簡単なテストです。
* [複数ステップ Web テスト](#multi-step-web-tests): Visual Studio Enterprise で作成してポータルにアップロードします。

アプリケーション リソースごとに最大 100 個の可用性テストを作成できます。


## <a name="create"></a>可用性テスト レポートのリソースを開く

Web アプリ用に**既に Application Insights を構成している場合**は、[Azure Portal](https://portal.azure.com) でその Web アプリ用の Application Insights リソースを開きます。

**新しいリソースでレポートを表示する場合は、**[Azure Portal](https://portal.azure.com) に移動し、Application Insights リソースを作成します。

![[リソースの作成] > [開発者ツール] > [Application Insights]](./media/monitor-web-app-availability/1create-resource-appinsights.png)

**[すべてのリソース]** をクリックして新しいリソースの概要ブレードを開きます。

## <a name="setup"></a>URL の Ping テストを作成する
[可用性] ブレードを開き、テストを追加します。

![少なくとも自分の Web サイトの URL を入力](./media/monitor-web-app-availability/2addtest-url.png)

* **[URL]** にはテストする任意の Web ページを指定できますが、パブリック インターネットからアクセス可能である必要があります。 URL にはクエリ文字列を含めることができます。 したがって、たとえば限られた範囲でデータベースを実行できます。 URL が解決されてリダイレクトする場合、それに続いて最大で 10 個リダイレクトを使用できます。
* **[従属要求の解析]**:このオプションをオンにしていると、テスト対象の Web ページの一部である画像、スクリプト、スタイル ファイル、その他のファイルがテストから要求されます。 記録される応答時間には、これらのファイルの取得にかかる時間が含まれます。 テスト全体のタイムアウト時間内にこれらすべてのリソースを正常にダウンロードできない場合、テストは失敗します。 このオプションがオンになっていない場合、テストからは指定した URL にあるファイルのみが要求されます。

* **[可用性テストが失敗した場合の再試行を有効にします。]**:このオプションをオンにしていると、テストに失敗したとき、少し間を置いてテストを再試行します。 エラーは試行が 3 回連続で失敗した場合にのみ報告されます。 その後、後続のテストが通常のテスト間隔で実行されます。 再試行は、次の成功まで一時的に中断されます。 このルールがテスト場所ごとに独立して適用されます。 このオプションはオンにすることをお勧めします。 再試行の際に平均でエラーの約 80% がなくなります。

* **[テスト間隔]**:各テストの場所からテストを実行する頻度を設定します。 既定の間隔が 5 分で、テストの場所が 5 か所の場合、サイトは平均して毎分テストされます。

* **テストの場所** とは、指定された URL にサーバーが Web 要求を送信する送信元の場所です。 Web サイトの問題とネットワークの問題とを確実に区別するために、最低でもテストの場所を 5 か所にすることが推奨されます。 最大 16 個の場所を選択できます。

> [!NOTE]
> * 複数の場所 (少なくとも 5 か所) からテストを行うことを強くお勧めします。 これにより、特定の場所での一時的な問題による誤検知を防止します。 さらに、テストの場所の数をアラートの場所のしきい値 + 2 にすると最適な構成になることがわかっています。 
> * [依存する要求の解析] オプションを有効にすると、厳密なチェックが行われます。 サイトを手動で参照するとき、気付かない場合があるケースでは、テストが失敗する可能性があります。

* **成功の基準**:

    **[テストのタイムアウト]**:この値を引き下げると、応答が遅い場合に警告されます。 テストは、この期間内にサイトから応答が返されない場合に、エラーとしてカウントされます。 **[従属要求の解析]** をオンにした場合、すべての画像、スタイル ファイル、スクリプト、その他依存するリソースがこの期間内に受信される必要があります。

    **[HTTP 応答]**:成功としてカウントされる、返される状態コード。 200 は、通常の Web ページが返されたことを示すコードです。

    **[コンテンツの一致]**: "ようこそ!" のような、文字列。 それぞれの応答に大文字小文字を区別した完全一致があるかどうかをテストします。 文字列は、(ワイルドカードを含まない) プレーン文字列である必要があります。 ページ コンテンツが変更された場合は、この文字列も更新する必要がある可能性があることに注意してください。

* **アラートの場所のしきい値**:少なくとも 3/5 の場所にすることをお勧めします。 アラートの場所のしきい値とテストの場所の数の最適な関係は、**アラートの場所のしきい値** = **テストの場所の数** - 2 です。テストの場所は、少なくとも 5 か所にします。

## <a name="multi-step-web-tests"></a>複数手順の Web テスト
URL の順序に関連するシナリオを監視することができます。 たとえば、販売 Web サイトを監視している場合は、ショッピング カートに商品を正しく追加できるかどうかをテストできます。

> [!NOTE]
> 複数ステップ Web テストは課金対象です。 [価格の詳細](https://azure.microsoft.com/pricing/details/application-insights/)のページをご覧ください。
> 

複数手順のテストを作成するには、Visual Studio Enterprise を使用してシナリオを記録してから、その記録を Application Insights にアップロードします。 Application Insights は周期的にそのシナリオを再生し、応答を確認します。

> [!NOTE]
> * テストでは、コード化された機能またはループは使用できません。 テストは .webtest スクリプトに完全に含まれている必要があります。 ただし、標準的なプラグインは使用できます。
> * 複数ステップ Web テストでは、英語文字のみがサポートされます。 他の言語で Visual Studio を使用している場合、Web テスト定義ファイルを更新して、英語以外の文字を翻訳/除外してください。
>

#### <a name="1-record-a-scenario"></a>1.シナリオを記録する
Web セッションを記録するには、Visual Studio Enterprise を使用します。

1. Web パフォーマンス テストのプロジェクトを作成します。

    ![Visual Studio Enterprise Edition で、"Web パフォーマンスとロード テスト プロジェクト" テンプレートからプロジェクトを作成します。](./media/monitor-web-app-availability/appinsights-71webtest-multi-vs-create.png)

 * "*"Web パフォーマンスとロード テスト プロジェクト" テンプレートが表示されない場合*" は、 Visual Studio Enterprise を閉じます。 **Visual Studio インストーラー**を開き、Visual Studio Enterprise のインストールを変更します。 **[個別のコンポーネント]** で **[Web パフォーマンスとロード テスト ツール]** を選択します。

2. .webtest ファイルを開き、記録を開始します。

    ![.webtest ファイルを開き、[記録] をクリックします。](./media/monitor-web-app-availability/appinsights-71webtest-multi-vs-start.png)
3. テストでシミュレートする必要のあるユーザー操作を実行します。Web サイトを開いたり、買い物カゴに商品を追加したりしてください。 次に、テストを停止します。

    ![Internet Explorer で、Web テスト レコーダーが実行されます。](./media/monitor-web-app-availability/appinsights-71webtest-multi-vs-record.png)

    長いシナリオは作成しないでください。 ここでは、100 ステップおよび 2 分が上限です。
4. テストを編集します。

   * 受信したテキストと応答コードを確認するための検証を追加します。
   * 余分な操作を削除します。 画像を求める依存要求、または広告あるいは追跡サイトへの依存要求を削除することも可能です。

     テスト スクリプトの編集が行えるだけです。カスタム コードの追加や他の Web テストの呼び出しはできません。 テストにループを挿入しないでください。 標準的な Web テスト プラグインを使用することができます。
5. 動作を確認するには、Visual Studio でテストを実行します。

    Web テスト ランナーは、web ブラウザーを開き、記録したアクションを繰り返します。 予想どおりに動作するかどうかを確認します。

    ![Visual Studio で .webtest ファイルを開き、[実行] をクリックします。](./media/monitor-web-app-availability/appinsights-71webtest-multi-vs-run.png)

#### <a name="2-upload-the-web-test-to-application-insights"></a>2.Web テストを Application Insights にアップロードする
1. Application Insights ポータルの [可用性] ブレードで、[テストの追加] をクリックします。

    ![[可用性] ブレードで、[テストの追加] を選択します。](./media/monitor-web-app-availability/3addtest-web.png)
2. 複数手順のテストを選択し、.webtest ファイルをアップロードします。

    ping テストについても同様に、テストの場所、頻度、アラートのパラメーターを設定してください。

### <a name="plugging-time-and-random-numbers-into-your-multi-step-test"></a>複数手順のテストに対する時間とランダムな数の組み込み
外部からフィードされる株価など、時間に依存するデータを取得するツールをテストするとします。 Web テストを記録するときに、特定の時刻を使用する必要があります。ただし、その時刻は、StartTime と EndTime というテストのパラメーターとして設定しました。

![パラメーターを含む Web テスト。](./media/monitor-web-app-availability/appinsights-72webtest-parameters.png)

テストを実行するときに、EndTime を現在の時刻に、StartTime を 15 分前に常に設定する必要があるとします。

時刻をパラメーター化するためには、Web テスト プラグインを使用します。

1. 目的の各変数のパラメーター値に対して Web テスト プラグインを追加します。 Web テスト ツールバーで、 **[Web テスト プラグインを追加]** を選択します。

    ![[Web テスト プラグインを追加] を選択し、種類を選択します。](./media/monitor-web-app-availability/appinsights-72webtest-plugins.png)

    この例では、日時プラグインというインスタンスを 2 つ使用します。 1 つのインスタンスが "15 分前" 用、もう 1 つは "現在" 用です。
2. 各プラグインのプロパティを開きます。 名前を付け、現在の時刻を使用するように設定します。 いずれかのプロパティに、「Add Minutes = -15」を設定します。

    ![[名前]、[現在の時刻を使用する]、[分の追加] の各項目を設定します。](./media/monitor-web-app-availability/appinsights-72webtest-plugin-parameters.png)
3. Web テスト パラメーターで、{{プラグイン名}} を使用して、プラグイン名を参照します。

    ![テスト パラメーターでは、{{プラグイン名}} を使用します。](./media/monitor-web-app-availability/appinsights-72webtest-plugin-name.png)

ここでテストをポータルにアップロードします。 テストを実行するたびに動的な値を使用します。


## <a name="monitor"></a>可用性テストの結果を表示する

概要タブにはテストの成功率が表示され、詳細タブには散布図と特定の詳細のグリッドが表示されます。

数分後、**[更新]** をクリックしてテスト結果を表示します。

![詳細ブレードの散布図](./media/monitor-web-app-availability/4refresh.png)

散布図には、診断テスト手順の詳細が含まれたテスト結果のサンプルが表示されます。 テスト エンジンは、失敗したテストの診断の詳細を格納します。 成功したテストの場合、診断の詳細は実行のサブセットに対して格納されます。 緑色または赤色の点の上にポインターを置くと、テスト タイムスタンプ、テスト期間、場所、およびテスト名が表示されます。 散布図内の任意の点をクリックすると、テスト結果の詳細が表示されます。  

特定のテスト、場所を選択するか、または期間を短くすると、目的の期間に関するより詳細な結果が表示されます。 Search エクスプローラーを使用してすべての実行の結果を表示するか、または分析クエリを使用してこのデータに対してカスタム レポートを実行します。

生の結果に加えて、メトリックス エクスプローラーには次の 2 つの可用性メトリックがあります。 

1. 可用性:すべてのテスト実行にわたる、成功したテストの割合 (%)。 
2. テスト期間:すべてのテスト実行にわたる平均のテスト期間。

テスト名、場所にフィルターを適用すると、特定のテストまたは場所、あるいはその両方の傾向を分析できます。

## <a name="edit"></a> テストを確認または編集する

Web テストを編集、一時的に無効化、削除、またはダウンロードするには、詳細タブの特定のテストで、右端の省略記号を選択します。

特定のテストの散布図とテストの場所の詳細を表示するには、そのテストの **[テストの詳細を表示]** を選択します。

![テスト詳細を表示、Web テストの編集および無効化](./media/monitor-web-app-availability/5viewdetails.png)

サービスに対するメンテナンスを実行している間、関連付けられた可用性テストまたはアラート ルールを無効にすることもできます。

![Web テストの無効化](./media/monitor-web-app-availability/6disable.png)
![テストの編集](./media/monitor-web-app-availability/8edittest.png)

## <a name="failures"></a>エラーが発生する場合
赤い点をクリックします。

![赤い点をクリックします](./media/monitor-web-app-availability/open-instance-3.png)

可用性のテスト結果から、すべてのコンポーネントにわたるトランザクションの詳細を確認できます。 ここで、次のことを行うことができます。

* サーバーから受信した応答を調べる。
* 失敗した可用性テストの処理中に収集された、サーバー側の相関関係を持つテレメトリを使用してエラーを診断する。
* 懸案や作業の項目を Git または Azure Boards に記録して問題を追跡する。 バグには、このイベントへのリンクが含まれます。
* Visual Studio で Web テスト結果を開く。

エンドツーエンドのトランザクションの診断エクスペリエンスの詳細については、[こちら](../../azure-monitor/app/transaction-diagnostics.md)を参照してください。

例外の行をクリックすると、代理可用性テストが失敗した原因であるサーバー側の例外の詳細が表示されます。 コード レベルの豊富な診断の [デバッグ スナップショット](../../azure-monitor/app/snapshot-debugger.md)を取得することもできます。

![サーバー側の診断](./media/monitor-web-app-availability/open-instance-4.png)

## <a name="alerts"></a>可用性のアラート
クラシック アラート エクスペリエンスを使用することにより可用性データに対して次の種類のアラート ルールを設定できます。
1. 期間内に Y 箇所中 X 箇所でエラーが報告されている
2. 可用性の集計パーセンテージがしきい値を下回っている
3. 平均テスト期間が長くなりしきい値を超えている

### <a name="alert-on-x-out-of-y-locations-reporting-failures"></a>Y 箇所中 X 箇所に関するアラートでエラーが報告されている
新しい可用性テストを作成する場合、"Y 箇所中 X 箇所" アラート ルールは既定では[新しい統合アラート エクスペリエンス](https://docs.microsoft.com/azure/monitoring-and-diagnostics/monitoring-overview-unified-alerts)で有効にされます。 オプトアウトするには、"クラシック" オプションを選択するか、またはアラート ルールを無効にすることを選択します。

![エクスペリエンスを作成する](./media/monitor-web-app-availability/appinsights-71webtestUpload.png)

> [!NOTE]
>  [新しい統合アラート](https://docs.microsoft.com/azure/monitoring-and-diagnostics/monitoring-action-groups)の場合、アラート ルールの重大度と通知の基本設定**をアクション グループ**と一緒に、アラート エクスペリエンスで構成する必要があります。 次の手順を行わないと、ポータル内通知を受け取るだけとなります。

1. 可用性テストを保存した後、詳細タブで、作成したテストの省略記号をクリックします。 [アラートの編集] をクリックします。
![保存後の編集](./media/monitor-web-app-availability/9editalert.png)

2. 目的の重大度レベルとルールの説明を設定し、次に、最も重要なものとして、このアラート ルールに使用する、通知の基本設定が含まれているアクション グループを設定します。
![保存後の編集](./media/monitor-web-app-availability/10editalert.png)


> [!NOTE]
> * 上記の手順に従って、アラートがトリガーされたときに通知を受信するようにアクション グループを構成します。 この手順を行わないと、ルールがトリガーされたとき、ポータル内通知を受け取るだけとなります。
>

### <a name="alert-on-availability-metrics"></a>可用性メトリックに関するアラート
[新しい統合アラート](https://docs.microsoft.com/azure/monitoring-and-diagnostics/monitoring-overview-unified-alerts)を使用すると、セグメント化された可用性の集計メトリックおよびテスト継続期間メトリックに関するアラートを生成することもできます。

1. メトリック エクスペリエンス内で Application Insights リソースを選択し、可用性メトリックを選択します。![可用性メトリックの選択](./media/monitor-web-app-availability/selectmetric.png)

2. メニューからアラート オプションを選択すると、新しいエクスペリエンスが表示されます。そこでは、アラート ルールの設定対象とする特定のテストまたは場所を選択することができます。 ここでは、このアラート ルールに対してアクション グループを構成することもできます。
    ![可用性アラートの構成](./media/monitor-web-app-availability/availabilitymetricalert.png)

### <a name="alert-on-custom-analytics-queries"></a>カスタム分析クエリに関するアラート
[新しい統合アラート](https://docs.microsoft.com/azure/monitoring-and-diagnostics/monitoring-overview-unified-alerts)を使用すると、[カスタム ログ クエリ](https://docs.microsoft.com/azure/monitoring-and-diagnostics/monitor-alerts-unified-log)に関するアラートを生成することができます。 カスタム クエリを使用すると、可用性の問題を示す最も確かなシグナルを取得するのに役立つ任意の条件に基づいてアラートを生成することができます。 また、これは TrackAvailability SDK を使用してカスタムの可用性の結果を送信する場合、特に有効です。 

> [!Tip]
> * 可用性データに関するメトリックにはカスタムの可用性の結果が含まれます。これは、Microsoft の TrackAvailability SDK を呼び出すことによって送信することができます。 メトリックに関するアラートのサポートを使用することにより、カスタムの可用性の結果に関するアラートを生成することができます。
>

## <a name="dealing-with-sign-in"></a>サインインの処理
ユーザーがアプリにサインインする場合、サインインの背後にあるページをテストできるように、サインインをシミュレートするためのさまざまなオプションがあります。 使用する方法は、アプリで提供されるセキュリティの種類によって異なります。

どの場合も、アプリケーションでテスト目的のみのアカウントを作成する必要があります。 可能であれば、実際のユーザーが Web テストの影響を受けないように、このテスト アカウントのアクセス許可を制限します。

### <a name="simple-username-and-password"></a>単純なユーザー名とパスワード
通常の方法で Web テストを記録します。 まず Cookie を削除します。

### <a name="saml-authentication"></a>SAML 認証
Web テストに使用できる SAML プラグインを使用します。

### <a name="client-secret"></a>クライアント シークレット
アプリにクライアント シークレットを含むサインイン ルートがある場合は、それを使用します。 クライアント シークレット サインインを提供するサービスの例として、Azure Active Directory (AAD) が挙げられます。 AAD の場合、クライアント シークレットはアプリ キーです。

アプリ キーを使用した Azure Web アプリのサンプル Web テストを次に示します。

![クライアント シークレットのサンプル](./media/monitor-web-app-availability/110.png)

1. クライアント シークレット (AppKey) を使用して AAD からトークンを取得します。
2. 応答からベアラー トークンを抽出します。
3. 承認ヘッダーにベアラー トークンを使用して API を呼び出します。

Web テストが実際のクライアントであること、つまり、独自のアプリが AAD に登録されていることを確認し、clientId と appkey を使用します。 テスト対象のサービスの独自のアプリも AAD に登録されている場合: Web テストの "リソース" フィールドにはこのアプリの appID URI が反映されます。

### <a name="open-authentication"></a>オープン認証
オープン認証の例としては、Microsoft または Google アカウントを使用したサインインが挙げられます。 OAuth を使用する多くのアプリがクライアント シークレットに代わる機能を提供しているため、その可能性を調査することが最初の方法です。

テストで OAuth を使用してサインインする必要がある場合に、一般的な方法を次に示します。

* Fiddler などのツールを使用して、Web ブラウザー、認証サイト、アプリケーション間のトラフィックを調べます。
* 異なるコンピューターやブラウザーを使用するか、または長い間隔 (トークンを期限切れにさせる) で複数のサインインを実行します。
* 異なるセッションを比較して、認証サイトから返され、次にサインイン後にアプリケーション サーバーに渡されるトークンを識別します。
* Visual Studio を使用して Web テストを記録します。
* トークンをパラメーター化し、トークンが認証システムから返されたときに、パラメーターを設定し、サイトへのクエリでそれを使用します
  (Visual Studio は、テストのパラメーター化を試みますが、トークンを正しくパラメーター化しません)。

## <a name="performance-tests"></a>パフォーマンス テスト
Web サイトに対してロード テストを実行できます。 可用性テストと同じように、世界各地の複数のポイントから単純な要求または複数手順の要求を送信できます。 可用性テストとは異なり、複数の同時ユーザーをシミュレートするために、多数の要求が送信されます。

テストを作成するには、**[構成]** の下の **[パフォーマンス テスト]** に移動して、[新規作成] をクリックします。

![新しいパフォーマンス テストの作成](./media/monitor-web-app-availability/11new-performance-test.png)

テストが完了すると、応答時間と成功率が表示されます。

![パフォーマンス テストの結果](./media/monitor-web-app-availability/12performance-test.png)

> [!TIP]
> パフォーマンス テストの影響を観察するには、[Live Stream](../../azure-monitor/app/live-stream.md) と [Profiler](../../azure-monitor/app/profiler.md) を使用します。
>

## <a name="automation"></a>Automation
* [PowerShell スクリプトを使用して、可用性テストを自動的に設定します](../../azure-monitor/app/powershell.md#add-an-availability-test)。
* アラートが発生したときに呼び出される [webhook](../../azure-monitor/platform/alerts-webhooks.md) を設定する。

## <a name="qna"></a> FAQ

* *サイトには問題がないように見えますがテストが失敗します。Application Insights からアラートが通知されるのはどうしてですか?*

    * ご利用のテストでは [依存する要求の解析] が有効になっていますか。 それが有効になっていると、スクリプトやイメージなどのリソースに対して厳密なチェックが行われます。ブラウザー上で、この種のエラーはわかりにくい場合があります。 イメージ、スクリプト、スタイル シート、およびページによって読み込まれるその他のファイルすべてを確認してください。 これらのいずれかにエラーがある場合、メインの html ページの読み込みに問題がない場合でも、テストはエラーとして報告されます。 このようなリソース エラーをテストで検出しないようにするには、テスト構成で [依存する要求の解析] をオフにするだけです。 

    * ネットワークの一時的な問題によるノイズの可能性を減らすには、[Enable retries for test failures]\(テストが失敗した場合に再試行を有効にする\) 構成がオンになっていることを確認します。 複数の場所からテストを行い、アラート ルールのしきい値を適宜管理して、過度のアラートの原因となっている場所固有の問題を防ぐこともできます。

    * 可用性エクスペリエンスで赤い点のいずれかをクリックするか、または Search エクスプローラーで任意の可用性エラーをクリックすると、エラーが報告された理由の詳細が表示されます。 テスト結果に加えて、サーバー側の相関関係を持つテレメトリ (有効になっている場合) は、テストが失敗した理由を理解するのに役立つはずです。 一時的な問題が発生する原因は、一般にネットワークまたは接続の問題にあります。 

    * テストがタイムアウトになりましたか。 2 分後にテストを中止します。 ping または複数手順のテストが 2 分を経過しても完了しない場合は、エラーとして報告されます。 より短い時間で完了するようにテストを複数のテストに分割することを検討してください。

    * すべての場所でエラーが報告されましたか、それとも一部の場所でのみエラーが報告されましたか。 一部の場所でのみエラーが報告された場合は、ネットワーク/CDN の問題が原因です。 繰り返しになりますが、赤色のドットをクリックすると、その場所でエラーが報告された理由を理解するのに役立つ情報が表示されます。

* *アラートがトリガーされたとき、もしくは解決されたとき、あるいはその両方で、電子メールが届きませんでした。*

    クラシック アラート構成を調べて、目的の電子メールが直接リストされること、または表示している配布リストが通知を受信するように構成されていることを確認します。 そのようになっている場合は、配布リストの構成を調べて、外部の電子メールを受信できるように構成されていることを確認します。 また、メール管理者が所有するポリシーがこの問題を引き起こす可能性のある構成になっていないか確認します。

* *Web hook 通知を受信しませんでした。*

    Web hook 通知を受信するアプリケーションが利用可能であること、さらにそのアプリケーションによって Web hook 要求が適切に処理されることを確認します。 詳細については、[こちら](https://docs.microsoft.com/azure/monitoring-and-diagnostics/monitor-alerts-unified-log-webhook)をご覧ください。

* *プロトコル違反エラーでテストが断続的に失敗します。*

    エラー ("プロトコル違反..CR の後には LF を指定しなければなりません") は、サーバー (または依存関係) に問題があることを示しています。 これは、応答に形式が正しくないヘッダーが設定されている場合に発生します。 ロード バランサーまたは CDN が原因である可能性があります。 具体的には、行末の指定で CRLF を使用していないヘッダーがあります。これは HTTP 仕様に違反しているため、.NET WebRequest レベルで失敗します。 応答を検査して、違反の可能性のあるヘッダーを見つけます。
    
    注:HTTP ヘッダーの緩和された検証を行うブラウザーでは、URL は 失敗しない場合があります。 この問題の詳細については、こちらのブログ記事を参照してください: http://mehdi.me/a-tale-of-debugging-the-linkedin-api-net-and-http-protocol-violations/  
    
* *テストの失敗を診断するためのサーバー側の関連するテレメトリが表示されない。*
    
    サーバー側のアプリケーションに対して Application Insights を設定している場合は、[サンプリング](../../azure-monitor/app/sampling.md)操作中のためである可能性があります。 別の可用性の結果を選択します。

* *Web テストからコードを呼び出すことはできますか。*

    いいえ。 テストの手順は、.webtest ファイルに含まれている必要があります。 他の Web テストの呼び出しまたはループの使用は許可されていません。 ただし、役に立つさまざまなプラグインがあります。

* *HTTPS はサポートされていますか。*

    TLS 1.1 と TLS 1.2 がサポートされています。
* *"Web テスト" と "可用性テスト" に違いはありますか。*

    この 2 つの用語は、同じ意味で参照されることがあります。 可用性テストは、複数ステップから成る Web テストに加えて単一の URL Ping テストも含む、より一般的な用語です。
    
* *ファイアウォールの内側で稼働している内部サーバーに対して可用性テストを使用したいと考えています。*

    解決策として、次の 2 つが考えられます。
    
    * [Web テスト エージェントの IP アドレス](../../azure-monitor/app/ip-addresses.md)からの受信要求を許可するようにファイアウォールを構成します。
    * 内部サーバーを定期的にテストする独自のコードを作成します。 このコードを、バック グラウンド プロセスとして、ファイアウォールの内側のテスト サーバーで実行します。 テスト プロセスは、コア SDK パッケージ内の [TrackAvailability()](https://docs.microsoft.com/dotnet/api/microsoft.applicationinsights.telemetryclient.trackavailability) API を使用して、その結果を Application Insights に送信できます。 この方法では、テスト サーバーに Application Insights のインジェスト エンドポイントへの送信アクセスが必要となりますが、受信要求を許可する代替方法と比べて、セキュリティのリスクは大幅に小さくなります。 結果は可用性 Web テストのブレードには表示されませんが、分析、検索、メトリックス エクスプローラーでの可用性の結果として表示されます。

* *複数手順の Web テストのアップロードが失敗します。*

    これを引き起こす可能性があるいくつかの原因:
    * 300 K のサイズ制限があります。
    * ループはサポートされていません。
    * 他の Web テストへの参照はサポートされていません。
    * データ ソースはサポートされていません。

* *複数手順のテストが完了しません。*

    1 テストあたりの要求は 100 個に制限されています。 また、実行時間が 2 分を超えると、テストは停止します。

* *クライアント証明書でテストを実行するにはどうすればよいですか。*

    申し訳ありませんが、それはサポートされていません。


## <a name="next"></a>次のステップ
[診断ログを検索する][diagnostic]

[Troubleshooting][qna]

[Web テスト エージェントの IP アドレス](../../azure-monitor/app/ip-addresses.md)

<!--Link references-->

[azure-availability]: ../../insights-create-web-tests.md
[diagnostic]: ../../azure-monitor/app/diagnostic-search.md
[qna]: ../../azure-monitor/app/troubleshoot-faq.md
[start]: ../../azure-monitor/app/app-insights-overview.md
