---
title: Azure Monitor の Log Analytics には、ユーザーが自分で実行したり、自分のクエリの出発点として使用したりできるサンプル クエリのセットが用意されています。
description: 必要に応じて開始および変更できるクエリ
ms.topic: article
author: rboucher
ms.author: robb
ms.date: 06/16/2020
ms.openlocfilehash: e4f20032febe1c4afe9cb0964c1b448eaa018103
ms.sourcegitcommit: 910a1a38711966cb171050db245fc3b22abc8c5f
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/20/2021
ms.locfileid: "102030853"
---
# <a name="example-queries-in-azure-monitor-log-analytics"></a>Azure Monitor の Log Analytics のサンプル クエリ
Log Analytics には、ユーザーが自分で実行したり、自分のクエリの出発点として使用したりできるサンプル クエリのセットが用意されています。 この記事では、サンプル クエリとそれらの使用方法について説明します。

Log Analytics または KQL クエリ言語に慣れていない場合は、サンプル クエリが開始に適した方法です。 リソースに関する分析情報をすぐに得ることができ、KQL の学習と使用を円滑に開始できるため、Log Analytics の使用を開始するのにかかる時間が短くなります。 Microsoft は、お客様がすぐに活用できるよう設計された 250 超のサンプル クエリを収集、キュレーションしました。また、このサンプル クエリの数は継続的に増加しています。

## <a name="in-context-queries"></a>コンテキスト内クエリ

新しいエクスペリエンスでは、コンテキスト内でクエリがフィルターおよび提案されます。 つまり、自分が選択したスコープに関連するクエリのみが、システムによって自動的に表示されます。

- **単一のリソース** の場合 - リソースの種類に応じてクエリがフィルターされます。
- **リソース グループ** の場合 - 特定のリソース グループのリソースに応じてクエリがフィルターされます。
- **ワークスペース** の場合 - ワークスペースにインストールされたソリューションに応じてクエリがフィルターされます。

この動作は、すべての Log Analytics スコープで一貫しています。 リソースの種類でサンプル クエリが表示されない場合、コンテキスト内によるフィルターが原因の可能性があります。 後のセクションでは、すべての可能なクエリを表示できるよう、コンテキスト内のスコープ設定を削除する方法について説明します。

> [!TIP]
> スコープ内のリソースが多ければ多いほど、ポータルでサンプル クエリ ダイアログのフィルターと表示にかかる時間は長くなります。

## <a name="example-query-user-interface"></a>サンプル クエリのユーザー インターフェイス

2 つの異なる場所からサンプル クエリにアクセスできます。

### <a name="example-query-dialog"></a>サンプル クエリ ダイアログ

Log Analytics エクスペリエンスに初めてアクセスすると、"*サンプル クエリ ダイアログ*" が自動的に表示されます。  画面の右上にある **[サンプル クエリ]** をクリックしてアクセスすることもできます。

![サイドバー - サンプル クエリ](media/example-queries/sidebar-2.png)

次のように、サンプル クエリ ダイアログが表示されます。  

![[サンプル クエリ] 画面](media/example-queries/example-query-start.png)

前のスクリーンショットでは、Azure Key Vault インスタンスのログ画面を表示しています。 前にこの記事で述べたように、クエリはコンテキスト内で表示されます。  そのため、スクリーンショットには Key Vault 関連のサンプルしか表示されていません。 サブスクリプション全体を選択したら、そのサブスクリプション内にあるすべてのリソースの種類について、クエリが表示されます。  

各サンプル クエリはカードによって表されます。 クエリにすばやく目を通して、必要なものを見つけることができます。 ダイアログからクエリを直接実行できるほか、追加で細かい調整と変更を行うためにそれをクエリ エディターに読み込むこともできます。

### <a name="sidebar-query-experience"></a>サイドバー クエリのエクスペリエンス

ダイアログ エクスペリエンスのすべての同じ機能には、Log Analytics の左側のサイドバーにあるクエリ ペインからアクセスできます。 クエリ名にマウス ポインターを合わせると、クエリの説明と追加の機能を表示できます。

![[クエリ] ウィンドウを示すスクリーンショット。](media/example-queries/sidebar-3.png)

## <a name="finding-and-filtering-queries"></a>クエリの検索とフィルタリング

このセクションのオプションはダイアログとサイドバー クエリ エクスペリエンスの両方で利用できますが、ユーザー インターフェイスがわずかに異なります。  

### <a name="use-favorites"></a>お気に入りの使用

頻繁に使用するクエリは、すばやくアクセスできるようにお気に入りに登録できます。

> [!TIP]
> 最初は、クエリの収集と表示を後回しにすることをお勧めします。 必要なクエリを見つけて、そのクエリの横にある星をクリックし、お気に入りに追加しましょう。 そのクエリが後で役に立たないとわかったら、お気に入りから外すことができます。  

### <a name="filtering-and-group-by"></a>フィルタリングとグループ化

クエリ ダイアログ エクスペリエンスでは、適切なコンテキストによってフィルターされたクエリのみが表示されますが、フィルターを削除してすべてのクエリを表示することもできます。

### <a name="group-by"></a>グループ化

*[グループ化]* ドロップダウン リストをクリックして、クエリのグループ化を変更します。

![[サンプル クエリ] 画面の [グループ化]](media/example-queries/example-query-groupby.png)

このダイアログでは、以下によるグループ化がサポートされています。

- **リソースの種類** - Azure で定義されたリソース (仮想マシンなど)。 Azure Monitor ログまたは Log Analytics テーブルからリソースの種類への完全なマッピングについては、[Azure Monitor のテーブル参照](/azure/azure-monitor/reference/tables/tables-resourcetype)に関するページをご覧ください。  
- **カテゴリ** - 情報の種類 ("*セキュリティ*" や "*監査*" など) カテゴリは、[テーブル] サイド ペインで定義されているカテゴリと同じです。 カテゴリの完全な一覧については、[Azure Monitor のテーブル参照](/azure/azure-monitor/reference/tables/tables-category)に関するページをご覧ください。  
- **ソリューション** - クエリに関連付けられた Azure Monitor ソリューション
- **トピック** - サンプル クエリのトピック ("*アクティビティ ログ*" または "*アプリ ログ*")。 トピックのプロパティはサンプル クエリに固有ではなく、特定のリソースの種類によっては異なる場合があります。

グループ化する値はコンテンツのアクティブなテーブルとしても機能します。 画面の左側にあるいずれかの値をクリックすると、クリックした項目の右にクエリ ビューがスクロールします。

### <a name="filter"></a>Assert

前に説明した **グループ化** の値に応じてクエリをフィルターすることもできます。 サンプル クエリ ダイアログの上部にフィルターがあります。

![[サンプル クエリ] 画面のフィルター](media/example-queries/example-query-filter.png)

### <a name="combining-group-by-and-filter"></a>グループ化とフィルターの組み合わせ

フィルターとグループ化の機能は、連携して機能するよう設計されています。 これにより、クエリの並べ替え方の自由度が高まります。 たとえば、複数のリソースがあるリソース グループを使用している場合、特定のリソースの種類にフィルターして、結果のクエリをトピックごとに並べ替えたいことがあります。

## <a name="sample-query-dialog-appearance-behavior"></a>サンプル クエリ ダイアログの外観の動作

KQL のプロフェショナルで、クエリ エディターに直接アクセスしたい場合は、クエリ ダイアログを "オフ" にトグルできます。 トグルをオフにすると、Log Analytics 画面が読み込まれる際に、サンプル クエリ ダイアログが読み込まれません。

![サンプルのオン/オフ](media/example-queries/examples-on-off.png)

Log Analytics の上部バーにある *[サンプル クエリ]* ボタンから、いつでもサンプル クエリ ポップアップ エクスペリエンスにアクセスできます。

## <a name="query-explorer"></a>クエリ エクスプローラー

ユーザー生成クエリの保存と共有を行うためのクエリ エクスプローラーのエクスペリエンスは当面の間、変更されません。

## <a name="next-steps"></a>次のステップ

[KQL クエリの概要](./get-started-queries.md)