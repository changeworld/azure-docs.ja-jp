<properties
	pageTitle="Azure Search のインデックス | Microsoft Azure | ホステッド クラウド検索サービス"
	description="容量計画で使用されるサービス上限とホスト型クラウド検索サービスである Azure Search の要求と応答の上限。"
	services="search"
	documentationCenter=""
	authors="HeidiSteen"
	manager="mblythe"
	editor=""
    tags="azure-portal"/>

<tags
	ms.service="search"
	ms.devlang="NA"
	ms.workload="search"
	ms.topic="article"
	ms.tgt_pltfrm="na"
	ms.date="11/19/2015"
	ms.author="heidist"/>

# Azure Search サービスの制限

インデックス、ドキュメント、およびその他のオブジェクトのストレージ、ワークロード、数量の上限は、Azure Search をどのようにサブスクライブしているかによって異なります。無料のサービスは評価や概念実証用であり、リソースをより公平に共有するために、すべてのオブジェクトとワークロードでその上限は低く設定されています。

標準版は、サービス用にのみ使用される専用のマシンで実行します。専用サービスの単独使用では、最小構成を含むあらゆるレベルにおいてストレージや処理能力の追加によるスケールアップ、スケールダウンが可能です。

## 無料の (共有) Search サービスの上限

Azure サブスクライバーは、開発またはごく小規模な検索アプリケーション用に共有 (マルチテナント) Search サービスを使用できます。共有サービスは、Azure サブスクリプションに付属しています。これは、サインアップする前にサービスを試すことができる料金の発生しないオプションです。共有サービスには次のものが含まれています。

[AZURE.INCLUDE [azure-search-limits](../../includes/azure-search-limits-free.md)]

クエリに関連付けられたクォータや上限がないことに注意してください。1 秒あたりのクエリ数 (QPS) は、利用できる帯域幅とシステム リソースの競合によって異なります。共有サービスをバックアップする Azure Compute およびストレージ リソースは複数のサブスクライバーによって共有されるため、ソリューションの QPS は、その他のいくつのワークロードが同時に実行されるかによって異なります。

## 標準 (専用) Search サービスの上限

標準の価格レベルでは、専用の Search サービスはデータのみを格納し、ワークロードのみを実行します。共有サービスとは異なり、専用の Search サービスのリソース割り当ては調整可能で、必要なレベルに応じて拡張できます。パーティション (ストレージ拡張のため) とレプリカ (高可用性の実現、QPS およびインデックス作成パフォーマンスの向上のため) のリソース レベルをそれぞれ個別に設定できます。さまざまなリソース構成の詳細については、「[検索ソリューションを管理する](search-manage.md)」を参照してください。

次の表は上限の一覧です。ただし、使用可能な[パーティションとレプリカの組み合わせ](#chart)という点から容量を把握するためにマトリックス図を確認することをお勧めします。

[AZURE.INCLUDE [azure-search-limits](../../includes/azure-search-limits-standard.md)]

Azure Search の容量は、検索単位と呼ばれる単位で購入できます。標準の価格レベルでは、Search サービスあたり最大 36 の検索単位を使用できます。この上限は、パーティションとレプリカの各上限より優先されます。たとえば、サービスはパーティション 12 個とレプリカ 6 個より大きいサイズに拡張することはできません。これを行うには 72 の検索単位 (12 x 6) が必要であり、サービスあたりの 36 という検索単位の上限を超えてしまうためです。

## パーティションとレプリカについて

**パーティション**では、ストレージと IO が提供されます。1 つの Search サービスは最大 12 個のパーティションを持つことができます。各パーティションには、1,500 万個のドキュメントまたは 25 GB のストレージのいずれか (先に達したほう) のハード制限があります。パーティションを追加すれば、Search サービスでさらにドキュメントを読み込めます。たとえば、最初に最大 25 GB のデータを格納する 1 つのパーティションのあるサービスに 2 つ目のパーティションを追加すると、50 GB 格納できるようになります。

**レプリカ**は、検索エンジンのコピーです。1 つの Search サービスは最大 6 個のレプリカを持つことができます。最低 2 つのレプリカが読み取り (クエリ) 可能で、最低 3 つのレプリカが読み取り/書き込み (クエリ、インデックス作成) 可能である必要があります。

各インデックスのコピーは、各レプリカで実行されます。レプリカを追加すると、インデックスの追加のコピーがオンラインになって、より多くのクエリ ワークロードに対応し、複数のレプリカ全体の要求を負荷分散できるようになります。たとえば、インデックスが 6 個、レプリカが 3 個あった場合、各レプリカには 6 個すべてのインデックスのコピーが作成されます。

クエリの実行は、クエリの複雑さや競合するワークロードに大きく左右されることがあるため、1 秒あたりのクエリ数 (QPS) を提示していません。平均して、レプリカで約 15 個の QPS を実現できますが、クエリの複雑さ (ファセット クエリはさらに複雑です) やネットワーク待機時間によってはスループットがこれより幾分多く、または少なくなります。また、レプリカを追加するとスケールとパフォーマンスは間違いなく拡張されますが、最終的な結果は厳密に直線的な拡張にはなりません。3 つのレプリカを追加しても、スループットが 3 倍になるとは限りません。クエリの遅延は、追加のレプリカが必要かどうかのインジケーターとなります。

<a id="chart"></a>
## パーティションとレプリカのサポートされた組み合わせ

前述のように、パーティションとレプリカの有効な制限は、選択したリソースの組み合わせによって異なります (サービスあたり 36 検索単位という範囲内で)。リソースは検索単位 (SU) に基づいて割り当てられます。専用の Search サービスは、1 検索単位である 1 つのレプリカと 1 つのパーティションから開始します。

追加の容量は、パーティション数にレプリカ数をかけた、対象の構成のサポートに必要な検索単位の合計数になります。

次の表では、縦軸にレプリカ数、横軸にパーティション数を示しています。交差部分は、各組み合わせをサポートするために必要な検索単位の数を示しています (サービスあたり 36 検索単位 (SU) の上限が適用されます)。たとえば、6 つのレプリカと 2 つのパーティションが必要な場合、この構成では 12 の検索単位が必要となります。4 つのレプリカと 2 つのパーティションを使用するには、8 つの検索単位が必要です。原則として、ほとんどの検索アプリケーションで必要なレプリカ数はパーティション数よりも多くなります。

<table cellspacing="0" border="1">
<tr><td><b>12 レプリカ</b></td><td>12 SU</td><td>24 SU</td><td>36 SU</td><td>該当なし</td><td>該当なし</td><td>該当なし</td></tr>
<tr><td><b>6 つのレプリカ</b></td><td>6 SU</td><td>12 SU</td><td>18 SU</td><td>24 SU</td><td>36 SU</td><td>該当なし</td></tr>
<tr><td><b>5 つのレプリカ</b></td><td>5 SU</td><td>10 SU</td><td>15 SU</td><td>20 SU</td><td>30 SU</td><td>該当なし</td></tr>
<tr><td><b>4 つのレプリカ</b></td><td>4 SU</td><td>8 SU</td><td>12 SU</td><td>16 SU</td><td>24 SU</td><td>該当なし </td></tr>
<tr><td><b>3 つのレプリカ</b></td><td>3 SU</td><td>6 SU</td><td>9 SU</td><td>12 SU</td><td>18 SU</td><td>36 SU</td></tr>
<tr><td><b>2 つのレプリカ</b></td><td>2 SU</td><td>4 SU</td><td>6 SU</td><td>8 SU</td><td>12 SU</td><td>24 SU</td></tr>
<tr><td><b>1 つのレプリカ</b></td><td>1 SU</td><td>2 SU</td><td>3 SU</td><td>4 SU</td><td>6 SU</td><td>12 SU</td></tr>
<tr><td>該当なし</td><td><b>1 個のパーティション</b></td><td><b>2 個のパーティション</b></td><td><b>3 個のパーティション</b></td><td><b>4 個のパーティション</b></td><td><b>6 個のパーティション</b></td><td><b>12 個のパーティション</b></td></tr>
</table>

検索単位、価格、および容量の詳細については、Azure Web サイトをご覧ください。詳細については、「[料金の詳細」](http://azure.microsoft.com/pricing/details/search/)をご覧ください。

> [AZURE.NOTE]レプリカとパーティションの数は、均等に 12 分割される必要があります (具体的には、1、2、3、4、6、12)。これは、Azure Search では各インデックスがパーティション全体に分散されるように 12 のシャードに事前に分割されるためです。たとえば、サービスに 3 つのパーティションがあり、新しいインデックスを作成する場合、各パーティションにはインデックスの 4 つのシャードを含めます。Azure Search でインデックスがどのようにシャードされるかは実装の問題であり、今後のリリースで変更される場合があります。今日 12 個であっても、今後も必ず 12 個になるとは限りません。

## 高可用性を実現するパーティションとレプリカの組み合わせを選択する

通常、簡単かつ比較的速くスケールアップできるため、1 つのパーティションと 1 ～ 2 つのレプリカで開始し、クエリ数の増加に合わせてスケールアップルすことをお勧めします。多くのデプロイについて、1 つのパーティションで十分なストレージと IO が提供されます (パーティションあたり 1,500 万個のドキュメント)。

ただし、クエリのワークロードはレプリカに依存します。スループットまたは高可用性を高める必要がある場合は、レプリカを追加できます。

高可用性のための一般的な推奨事項は次のとおりです。

- 読み取り専用ワークロード (クエリ) の高可用性を実現するには 2 つのレプリカ
- 読み取り/書き込みワークロード (クエリとインデックス作成) の高可用性を実現するには 3 つ以上のレプリカ

現時点では、障害復旧のための組み込みのメカニズムはありません。追加のパーティションまたはレプリカは、障害復旧の目標を達成する手段として適切ではありません。代わりに、サービス レベルに冗長性を追加することを検討できます。回避策の詳細については、[このフォーラムの投稿](https://social.msdn.microsoft.com/Forums/ee108a26-00c5-49f6-b1ff-64c66c8b828a/dr-and-high-availability-for-azure-search?forum=azuresearch)を参照してください。

> [AZURE.NOTE]サービス レベル アグリーメントと拡張性は標準サービスの機能です。無料のサービスのリソース レベルは固定であり、レプリカとパーティションを複数のサブスクライバーで共有します。無料のサービスで開始し、アップグレードが必要になった場合は、新しい Azure Search サービスを標準レベルで作成し、インデックスとデータを新しいサービスに再読み込みする必要があります。サービス プロビジョニングについては、「[Create an Azure Search service in the portal (ポータルで Azure Search サービスを作成する)](search-create-service-portal.md)」を参照してください。

## API キーの制限

Api キーは、サービスの認証に使用されます。次の 2 つの種類があります。管理キーは、要求ヘッダーで指定されます。クエリ キーは、URL で指定します。キー管理の詳細については、「[Microsoft Azure で検索サービスを管理する](search-manage.md)」を参照してください。

- サービスあたりの最大管理キー数: 2
- サービスあたりの最大クエリ キー数: 50

## 要求の制限

- 要求あたりの最大値: 16 MB<sup>1</sup>
- URL の最大長: 8 KB
- インデックスののアップロード、マージ、または削除のバッチあたりの最大ドキュメント数: 1,000
- $orderby 句の最大フィールド数: 32
- 検索用語の最大サイズ: UTF-8 でエンコードされたテキストの 32,766 バイト (32 KB - 2 バイト)

## 応答の制限

- 検索結果のページごとに返される最大ドキュメント数: 1,000
- 検索候補 API 要求ごとに返される最大検索候補数: 100

<sup>1</sup> Azure Search では、要求の本文は上限 16 MB に左右され、それ以外では理論的制限によって制約されない個々のフィールドまたはコレクションのコンテンツに実際的な制限が課せられます (フィールドの構成と制約の詳細については、「[サポートされているデータ型](https://msdn.microsoft.com/library/azure/dn798938.aspx)」を参照してください)。

<!---HONumber=AcomDC_1210_2015-->