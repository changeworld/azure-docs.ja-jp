---
title: セマンティック ランク付け
titleSuffix: Azure Cognitive Search
description: Azure Cognitive Search でセマンティックの順位付けアルゴリズムがどのように機能するかについて説明します。
manager: nitinme
author: HeidiSteen
ms.author: heidist
ms.service: cognitive-search
ms.topic: conceptual
ms.date: 03/22/2021
ms.openlocfilehash: bf311eb2b2d0ff7a9c17380d2e384bc05c6f05f3
ms.sourcegitcommit: 32e0fedb80b5a5ed0d2336cea18c3ec3b5015ca1
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/30/2021
ms.locfileid: "105562037"
---
# <a name="semantic-ranking-in-azure-cognitive-search"></a>Azure Cognitive Search でのセマンティック ランク付け

> [!IMPORTANT]
> セマンティック検索機能はパブリック プレビュー段階にあり、プレビュー REST API とポータルを介して利用できます。 プレビュー機能は、[補足利用規約](https://azure.microsoft.com/support/legal/preview-supplemental-terms/)に基づいて、現状のまま提供されます。一般提供時に同じ実装があるとは限りません。 これらの機能は課金対象です。 詳細については、[可用性と価格](semantic-search-overview.md#availability-and-pricing)に関するページを参照してください。

セマンティックの順位付けとは、クエリ実行パイプラインの拡張機能のことで、最初の結果セットの上位の一致を再ランク付けすることにより、精度を向上します。 セマンティックの順位付けは、大規模なトランスフォーマーベースのネットワークによって支えられており、キーワードでの言語的一致でなく、クエリ用語のセマンティックの意味をキャプチャするためにトレーニングされています。 [既定の類似性ランク付けアルゴリズム](index-ranking-similarity.md)とは対照的に、セマンティック ランカーでは単語のコンテキストと意味を使用して関連性を判断します。

セマンティックの順位付けは、リソースと時間の両方を消費します。 クエリ操作の予想待機時間内に処理を完了するために、セマンティックの順位付けへの入力が統合され、削減されるため、基になる概要作成と再順位付けの手順をできるだけ早く完了できます。

## <a name="pre-processing"></a>前処理

コンテンツは、関連性によってスコアリングする前に、セマンティック ランカーによって効率的に処理できる、管理可能な入力数に減らす必要があります。

1. コンテンツ削減は、まず、キーワード検索に使用される既定の[類似性順位付けアルゴリズム](index-ranking-similarity.md)によって返される初期結果セットを使用して開始されます。 指定されたどのクエリについても、1,000 個の上限に達するまで、結果がいくつかのドキュメントであることが考えられます。 大量の一致の処理には時間がかかりすぎるので、上位 50 個のみがセマンティック ランク付けに進みます。

   ドキュメント数 (1 つでも 50 個 でも) にかかわらず、最初の結果セットによって、セマンティック ランク付けのためのドキュメント コーパスの最初のイテレーションが確立されます。

1. 次に、コーパス全体で、"searchFields" の各フィールドのコンテンツが抽出され、長い文字列に結合されます。

1. 文字列が連結された後、長さが非常に長い文字列は、全体の長さが概要作成手順の入力要件を満たすようにトリミングされます。

   このトリミングの実行が、簡潔なフィールドを最初に "searchFields" に配置し、それらが文字列に含まれるようにすることが重要である理由です。 テキストを多用するフィールドを持つ非常に大きいドキュメントがある場合は、最大値制限を超えたテキストは無視されます。

各ドキュメントは、1 つの長い文字列で表されるようになりました。

> [!NOTE]
> 文字列は、文字や単語ではなく、トークンで構成されます。 トークン化は、検索可能なフィールドに対するアナライザーの割り当てによって部分的に決定されます。 特別なアナライザー (nGram、EdgeNGram など) を使用している場合は、そのフィールドを searchFields から除外できます。 文字列がトークン化される方法の詳細については、[REST API テスト アナライザー](/rest/api/searchservice/test-analyzer)を使用したアナライザーのトークン出力について確認してください。

## <a name="extraction"></a>抽出

文字列を削減した後は、マシン読み取り理解モデルおよび言語表現モデルを介して削減された入力を渡せるようになりました。これにより、クエリを基準として、ドキュメントを最も簡単に要約した文やフレーズを特定できます。 このフェーズでは、セマンティック ランカーに進む文字列からコンテンツを抽出します。

概要作成の入力は、準備フェーズで各ドキュメントに対して取得される長い文字列です。 各文字列から、概要作成モデルによって最も代表的な一節が検索されます。 この文節は、ドキュメントの[セマンティック キャプション](semantic-how-to-query-request.md)も構成します。 各キャプションは、プレーン テキスト バージョンと強調表示バージョンで使用できます。また、多くの場合、ドキュメントあたり 200 語未満です。

"answers" パラメーターを指定した場合、クエリが質問として提示された場合、その質問に対する回答を提供する可能性のある長い文字列で文節が見つかる場合、[セマンティック回答](semantic-answers.md)も返されます。

## <a name="semantic-ranking"></a>セマンティック ランク付け

1. キャプションは、指定されたクエリに対して相対的な概念とセマンティックの関連性に対して評価されます。

   次の図は、"セマンティックの関連性" の意味を示しています。 "capital" という用語を考えてみましょう。これは、財務、法律、地理、文法の文脈で使用される可能性があります。 クエリに同じベクトル空間 ("資本" や "投資" など) からの用語が含まれている場合、同じクラスター内のトークンも含むドキュメントには、含まないドキュメントよりも高いスコアが付けられます。

   :::image type="content" source="media/semantic-search-overview/semantic-vector-representation.png" alt-text="コンテキストのベクトル表現" border="true":::

1. @search.rerankerScore は、キャプションのセマンティック関連性に基づいて各ドキュメントに割り当てられます。

1. すべてのドキュメントがスコアリングされると、スコア順に一覧表示され、クエリ応答ペイロードに含められます。 ペイロードには、回答、プレーンテキスト、強調表示されたキャプション、select 句で取得または指定されたフィールドが含まれます。

## <a name="next-steps"></a>次のステップ

セマンティック ランク付けは、特定のリージョンの Standard レベルで提供されます。 可用性とサインアップの詳細については、「[可用性と料金](semantic-search-overview.md#availability-and-pricing)」を参照してください。 新しいクエリの種類により、セマンティック検索の順位付けと応答構造が可能になります。 [セマンティック クエリを作成](semantic-how-to-query-request.md)して開始します。

または、既定の順位付けに関する次の記事を確認してください。 セマンティックの順位付けは、最初の結果を返すために類似性順位付けに依存します。 クエリの実行と順位付けについて理解することで、プロセス全体の動作について幅広く理解できるようになります。

+ [Azure Cognitive Search でのフルテキスト検索](search-lucene-query-architecture.md)
+ [Azure Cognitive Search での類似性とスコアリング](index-similarity-and-scoring.md)
+ [Azure Cognitive Search でのテキスト処理のためのアナライザー](search-analyzers.md)