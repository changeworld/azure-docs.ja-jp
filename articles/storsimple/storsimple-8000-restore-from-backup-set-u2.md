---
title: StorSimple 8000 シリーズのバックアップからのボリュームの復元 | Microsoft Docs
description: StorSimple Device Manager サービスの [バックアップ カタログ] を使用してバックアップ セットから StorSimple ボリュームを復元する方法について説明します。
services: storsimple
documentationcenter: NA
author: alkohli
manager: timlt
editor: ''
ms.assetid: ''
ms.service: storsimple
ms.devlang: NA
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: TBD
ms.date: 05/23/2017
ms.author: alkohli
ms.openlocfilehash: 6a2e022697ced90d968075b7a4abe4163be7a539
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/27/2020
ms.locfileid: "60723392"
---
# <a name="restore-a-storsimple-volume-from-a-backup-set"></a>バックアップ セットからの StorSimple ボリュームの復元

## <a name="overview"></a>概要

このチュートリアルでは、既存のバックアップ セットを使用して、StorSimple 8000 シリーズ デバイスで実行される復元操作について説明します。 **[バックアップ カタログ]** ブレードを使用し、ローカルまたはクラウド バックアップからボリュームを復元します。 **[バックアップ カタログ]** ブレードには、手動バックアップまたは自動バックアップを実行したときに作成されたすべてのバックアップ セットが表示されます。 バックアップ セットからの復元操作では、データがバックグラウンドでダウンロードされている間に、ボリュームがすぐにオンラインになります。

復元を開始する代替の方法として、 **[デバイス]、[自分のデバイス]、[ボリューム]** に移動します。 **[ボリューム]** ブレードで、ボリュームを選択して右クリックし、コンテキスト メニューを呼び出して、 **[復元]** を選択します。

## <a name="before-you-restore"></a>復元する前に

復元を開始する前に、次の注意事項を確認します。

* **ボリュームをオフラインにする必要があります** - 復元操作を開始する前に、ホストとデバイスの両方でボリュームをオフラインにします。 復元操作では、ボリュームは自動的にデバイス上でオンラインになりますが、デバイスをホスト上でオンラインにする操作は手動で行う必要があります。 ボリュームがデバイス上でオンラインになるとすぐに、ホスト上でボリュームをオンラインにすることができます。 (復元操作が完了するまで待機する必要はありません。)具体的な手順については、「[ボリュームをオフラインにする](storsimple-8000-manage-volumes-u2.md#take-a-volume-offline)」を参照してください。

* **復元後のボリュームの種類** - 削除されたボリュームは、スナップショットの種類に基づいて復元されます。つまり、ローカルに固定されていたボリュームはローカル固定ボリュームとして復元され、階層化されていたボリュームは階層化ボリュームとして復元されます。

    既存のボリュームの場合、ボリュームで現在使用されている種類は、スナップショットに格納されている種類をオーバーライドします。 たとえば、ボリュームの種類が階層化のときに作成されたスナップショットからボリュームを復元する際に、そのボリュームの種類が現在はローカル固定の場合 (変換操作が実行されたため)、そのボリュームはローカル固定ボリュームとして復元されます。 同様に、既存のローカル固定ボリュームが拡張され、その後に、ボリュームが小さかったときに作成された古いスナップショットを復元した場合、復元されたボリュームは現在の拡張サイズを保持します。

    ボリュームの復元中に、階層化ボリュームからローカル固定ボリュームに、またはローカル固定ボリュームから階層化ボリュームに変換することはできません。 復元操作が完了するまで待機し、その後で、ボリュームを別の種類に変換できます。 ボリュームを変換する方法については、「 [ボリュームの種類を変更する](storsimple-8000-manage-volumes-u2.md#change-the-volume-type)」を参照してください。 

* **ボリューム サイズは復元されたボリュームに反映される** - これは、削除されたローカル固定ボリュームを復元する場合の重要な考慮事項です (ローカル固定ボリュームは完全にプロビジョニングされるため)。 以前に削除されたローカル固定ボリュームを復元しようとする前に、十分な領域があることを確認してください。

* **ボリュームが復元されているときに、そのボリュームを拡張することはできません** - ボリュームを拡張する前に、復元操作が完了するまで待機してください。 ボリュームを拡張する方法については、「 [ボリュームを変更する](storsimple-8000-manage-volumes-u2.md#modify-a-volume)」を参照してください。

* **ローカル ボリュームを復元しているときに、バックアップを実行できます** - 具体的な手順については、「[StorSimple Device Manager サービスを使用してバックアップ ポリシーを管理する](storsimple-8000-manage-backup-policies-u2.md)」を参照してください。

* **復元操作は取り消すことができます** - 復元ジョブを取り消すと、ボリュームは復元操作を開始する前の状態にロールバックされます。 具体的な手順については、「 [ジョブを取り消す](storsimple-8000-manage-jobs-u2.md#cancel-a-job)」を参照してください。

## <a name="how-does-restore-work"></a>復元のしくみ

Update 4 以降を実行しているデバイスでは、ヒートマップ ベースの復元が実装されています。 ホストのデータ アクセス要求がデバイスに届くと、これらの要求が追跡され、ヒートマップが作成されます。 要求レートが高いと、ヒート値が高いデータ チャンクになり、要求レートが低くなると、ヒート値が低いチャンクに変換されます。 "_高_" としてマークされるには、データに 2 回以上アクセスする必要があります。 変更されたファイルも "_高_" としてマークされます。 復元を開始すると、ヒートマップに基づいてデータのプロアクティブ ハイドレーションが発生します。 Update 4 より前のバージョンでは、アクセスだけに基づいて復元時にデータがダウンロードされます。

次の注意事項は、ヒートマップ ベースのリストアに適用されます。

* ヒートマップの追跡は、階層化ボリュームにのみ対応しています。ローカル固定ボリュームはサポートされていません。

* また、ボリュームを別のデバイスに複製するときは、ヒートマップ ベースの復元はサポートされていません。 

* インプレース復元があり、復元するボリュームのローカル スナップショットがデバイス上に存在する場合は、(データがローカルで既に使用可能であるため) リハイドレートされません。 

* 既定では、復元時に、ヒートマップに基づいてデータを事前にリハイドレートするリハイドレート ジョブが開始されます。 

Update 4 では、Windows PowerShell コマンドレットを使用して、実行中のリハイドレート ジョブの照会、リハイドレート ジョブの取り消し、リハイドレート ジョブの状態の取得を行うことができます。

* `Get-HcsRehydrationJob` - このコマンドレットは、リハイドレート ジョブの状態を取得します。 1 つのボリュームに対して 1 つのリハイドレート ジョブがトリガーされます。

* `Set-HcsRehydrationJob` - このコマンドレットを使用すると、リハイドレートの実行中に、リハイドレート ジョブを一時停止、停止、再開できます。

リハイドレート コマンドレットの詳細については、[StorSimple 用 Windows PowerShell コマンドレット リファレンス](https://technet.microsoft.com/library/dn688168.aspx)をご覧ください。

自動リハイドレートでは、一般に一時的な読み取りパフォーマンスが高くなることが予想されます。 実際の向上の度合いは、アクセス パターン、データの変化、データの種類などのさまざまな要素に左右されます。 

リハイドレート ジョブを取り消すには、PowerShell コマンドレットを使用します。 今後のすべての復元でリハイドレート ジョブを完全に無効にする場合は、[Microsoft サポートに連絡してください](storsimple-8000-contact-microsoft-support.md)。

## <a name="how-to-use-the-backup-catalog"></a>バックアップ カタログの使用方法

**[バックアップ カタログ]** ブレードには、バックアップ セットの選択を絞り込むことができるクエリが用意されています。 次のパラメーターに基づいて、取得するバックアップ セットをフィルター選択できます。

* **[時間範囲]** - バックアップ セットが作成された日付と時刻の範囲。
* **[デバイス]** - バックアップ セットが作成されたデバイス。
* **[バックアップ ポリシー]** または **[ボリューム]** - このバックアップ セットに関連付けられているバックアップ ポリシーやボリューム。

フィルター選択されたバックアップ セットは、次の属性に基づいて表形式で表示されます。

* **[名前]** - バックアップ セットに関連付けられているバックアップ ポリシーまたはボリュームの名前。
* **[種類]** - バックアップ セットの種類には、ローカル スナップショットとクラウド スナップショットがあります。 ローカル スナップショットは、デバイスにローカルに格納されているすべてのボリューム データのバックアップです。クラウド スナップショットは、クラウドに存在するボリューム データのバックアップを表します。 ローカル スナップショットは、より高速なアクセスを実現します。クラウド スナップショットは、データの回復力を実現するために選択されます。
* **[サイズ]** - バックアップ セットの実際のサイズ。
* **[作成日時]** – バックアップが作成された日付と時刻。 
* **[ボリューム]** - バックアップ セットに関連付けられているボリュームの数。
* **[開始方法]** - バックアップは、スケジュールに従って自動的に開始することも、ユーザーが手動で開始することもできます (バックアップ ポリシーを使用してバックアップのスケジュールを設定できます。 また、 **[バックアップの実行]** オプションを使用して対話型またはオンデマンドのバックアップを実行することもできます)。

## <a name="how-to-restore-your-storsimple-volume-from-a-backup"></a>StorSimple ボリュームをバックアップから復元する方法

**[バックアップ カタログ]** ブレードを使用すると、特定のバックアップから StorSimple ボリュームを復元できます。 ただし、ボリュームを復元するとボリュームはバックアップが作成された時点の状態に戻ることに注意してください。 バックアップ操作の後に追加されたすべてのデータは失われます。

> [!WARNING]
> バックアップから復元すると、既存のボリュームはバックアップで置き換えられます。 その結果、バックアップが作成された時点以降に書き込まれたすべてのデータが失われます。


### <a name="to-restore-your-volume"></a>ボリュームを復元するには
1. StorSimple デバイス マネージャー サービスに移動し、 **[バックアップ カタログ]** をクリックします。

2. 次の手順に従って、バックアップ セットを選択します。
   
   1. 時間範囲を指定します。
   2. 適切なデバイスを選択します。
   3. ボックスの一覧で、選択するバックアップのボリュームまたはバックアップのポリシーを選択します。
   4. **[適用]** をクリックしてこのクエリを実行します。

      選択したボリュームまたはバックアップ ポリシーに関連付けられているバックアップが、バックアップ セットの一覧に表示されます。
   
      ![バックアップ セットの一覧](./media/storsimple-8000-restore-from-backup-set-u2/bucatalog.png)     
     
3. バックアップ セットを展開して、関連付けられているボリュームを表示します。 これらのボリュームは、復元する前にホストおよびデバイス上でオフラインにする必要があります。 ボリュームをオフラインにするには、デバイスの **[ボリューム]** ブレードでボリュームにアクセスし、「[ボリュームをオフラインにする](storsimple-8000-manage-volumes-u2.md#take-a-volume-offline)」の手順を実行します。
   
   > [!IMPORTANT]
   > 最初にホスト上のボリュームをオフラインにしてから、デバイス上のボリュームをオフラインにします。 ホスト上でボリュームをオフラインにしない場合、データの破損を招く可能性があります。
   
4. **[バックアップ カタログ]** タブに戻り、バックアップ セットを選択します。 右クリックし、コンテキスト メニューの **[復元]** を選択します。

    ![バックアップ セットの一覧](./media/storsimple-8000-restore-from-backup-set-u2/restorebu1.png)

5. 確認を求められます。 復元情報を確認し、確認のチェック ボックスをオンにします。
   
    ![確認ページ](./media/storsimple-8000-restore-from-backup-set-u2/restorebu2.png)

7. **[復元]** をクリックします。 復元ジョブが開始されます。このジョブは、 **[ジョブ]** ページに表示されます。

   ![確認ページ](./media/storsimple-8000-restore-from-backup-set-u2/restorebu5.png)

8. 復元操作が完了した後、ボリュームの内容がバックアップからのボリュームで置き換えられていることを確認します。


## <a name="if-the-restore-fails"></a>復元に失敗した場合

何らかの理由で復元操作に失敗した場合は、アラートが表示されます。 この場合、バックアップの一覧を更新してバックアップが引き続き有効であることを確認してください。 バックアップが有効であり、クラウドから復元を行っている場合、接続の問題が原因となっている可能性があります。

復元操作を完了するには、ホスト上でボリュームをオフラインにし、復元操作を再試行します。 復元の処理中に行われたボリューム データへの変更は失われることに注意してください。

## <a name="next-steps"></a>次のステップ
* [StorSimple ボリュームを管理する](storsimple-8000-manage-volumes-u2.md)方法について説明します。
* [StorSimple デバイス マネージャー サービスを使用して StorSimple デバイスを管理する](storsimple-8000-manager-service-administration.md)方法について説明します。

