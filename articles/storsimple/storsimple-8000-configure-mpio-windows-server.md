---
title: StorSimple デバイスの MPIO の構成 | Microsoft Docs
description: Windows Server 2012 R2 を実行するホストに接続されている、StorSimple デバイスのマルチパス I/O (MPIO) を構成する方法を説明します。
services: storsimple
documentationcenter: ''
author: alkohli
manager: timlt
editor: ''
ms.assetid: ''
ms.service: storsimple
ms.devlang: NA
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 03/26/2018
ms.author: alkohli
ms.openlocfilehash: eda134257edb851eea076459b44e02fc59028f46
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/27/2020
ms.locfileid: "60363334"
---
# <a name="configure-multipath-io-for-your-storsimple-device"></a>StorSimple デバイスのマルチパス IO の構成

このチュートリアルでは、Windows Server 2012 R2 が実行され、StorSimple 物理デバイスに接続されているホストにマルチパス I/O (MPIO) 機能をインストールして、その機能を使用する手順を説明します。 この記事のガイダンスは、StorSimple 8000 シリーズ物理デバイスにのみ適用されます。 StorSimple Cloud Appliance では、MPIO は現在サポートされていません。

Microsoft では、フォールト トレランスと可用性に優れた iSCSI ネットワークを構成するために、Windows Server でマルチパス I/O (MPIO) 機能をサポートしています。 MPIO では、アダプター、ケーブル、スイッチなどの冗長な物理パス コンポーネントを使用して、サーバーとストレージ デバイスの間に論理パスを作成します。 コンポーネントのエラーによって論理パスに障害が発生した場合は、マルチパス ロジックで I/O の代替パスが使用され、アプリケーションから引き続きデータにアクセスできるようにします。 さらに構成によっては、これらのすべてのパス間で負荷を分散することで、パフォーマンスを向上させることもできます。 詳細については、「[MPIO の概要](https://technet.microsoft.com/library/cc725907.aspx "MPIO の概要と機能")」を参照してください。

StorSimple ソリューションの可用性を高めるためには、StorSimple デバイスで MPIO を構成する必要があります。 Windows Server 2012 R2 を実行するホスト サーバーに MPIO をインストールすると、サーバーでリンク、ネットワーク、またはインターフェイスのフォールト トレランスが有効になります。

## <a name="mpio-configuration-summary"></a>MPIO 構成の概要

MPIO はオプションの機能であり、Windows サーバーに既定ではインストールされていません。 サーバー マネージャーを使用して、機能としてインストールする必要があります。

次の手順に従って、StorSimple デバイスに MPIO を構成します。

* 手順 1:Windows Server ホストに MPIO をインストールする
* 手順 2:StorSimple ボリュームの MPIO を構成する
* 手順 3:ホストに StorSimple ボリュームをマウントする
* 手順 4:高可用性と負荷分散のために MPIO を構成する

上記の各手順については、以降のセクションで説明します。

## <a name="step-1-install-mpio-on-the-windows-server-host"></a>手順 1:Windows Server ホストに MPIO をインストールする

Windows Server ホストにこの機能をインストールするには、次の手順を実行します。

#### <a name="to-install-mpio-on-the-host"></a>ホストに MPIO をインストールするには

1. Windows Server ホストでサーバー マネージャーを開きます。 既定では、Windows Server 2012 R2 または Windows Server 2012 を実行しているコンピューターに Administrators グループのメンバーがログオンすると、サーバー マネージャーが起動します。 サーバー マネージャーがまだ開いていない場合は、 **[スタート]、[サーバー マネージャー]** の順にクリックします。
   
   ![サーバー マネージャー](./media/storsimple-configure-mpio-windows-server/IC740997.png)

2. **[サーバー マネージャー]、[ダッシュボード]、[役割と機能の追加]** の順にクリックします。 **役割と機能の追加** ウィザードが起動します。
   
   ![役割と機能の追加ウィザード 1](./media/storsimple-configure-mpio-windows-server/IC740998.png)
3. **役割と機能の追加**ウィザードで、次の手順を実行します。
   
   1. **[開始する前に]** ページで **[次へ]** をクリックします。
   2. **[インストールの種類の選択]** ページで、 **[役割ベースまたは機能ベースのインストール]** の既定の設定をそのまま使用します。 **[次へ]** をクリックします。
   
       ![役割と機能の追加ウィザード 2](./media/storsimple-configure-mpio-windows-server/IC740999.png)
   3. **[対象サーバーの選択]** ページで、 **[サーバー プールからサーバーを選択]** を選択します。 使用中のホスト サーバーが自動的に検出されます。 **[次へ]** をクリックします。
   4. **[サーバーの役割の選択]** ページで、 **[次へ]** をクリックします。
   5. **[機能の選択]** ページで、 **[マルチパス I/O]** を選択し、 **[次へ]** をクリックします。
   
       ![役割と機能の追加ウィザード 5](./media/storsimple-configure-mpio-windows-server/IC741000.png)
   6. **[インストール オプションの確認]** ページでオプションの設定内容を確認し、次のように **[必要に応じて対象サーバーを自動的に再起動する]** を選択します。 **[インストール]** をクリックします。
   
       ![役割と機能の追加ウィザード 8](./media/storsimple-configure-mpio-windows-server/IC741001.png)
   7. インストールが完了すると、通知が表示されます。 **[閉じる]** をクリックしてウィザードを閉じます。
   
       ![役割と機能の追加ウィザード 9](./media/storsimple-configure-mpio-windows-server/IC741002.png)

## <a name="step-2-configure-mpio-for-storsimple-volumes"></a>手順 2:StorSimple ボリュームの MPIO を構成する

StorSimple ボリュームを識別するには、MPIO を構成する必要があります。 StorSimple ボリュームを認識するように MPIO を構成するには、次の手順を実行します。

#### <a name="to-configure-mpio-for-storsimple-volumes"></a>StorSimple ボリュームの MPIO を構成する

1. **[MPIO の構成]** を開きます。 **[サーバー マネージャー]、[ダッシュボード]、[ツール]、[MPIO]** の順にクリックします。
2. **[MPIO のプロパティ]** ダイアログ ボックスで、 **[マルチパスの検出]** タブを選択します。
3. **[iSCSI デバイスのサポートを追加する]** を選択し、 **[追加]** をクリックします。  
   ![MPIO プロパティ、マルチパスの検出](./media/storsimple-configure-mpio-windows-server/IC741003.png)
4. メッセージが表示されたら、サーバーを再起動します。
5. **[MPIO のプロパティ]** ダイアログ ボックスで、 **[MPIO デバイス]** タブをクリックします。 **[追加]** をクリックします。
    </br>![MPIO プロパティ、MPIO デバイス](./media/storsimple-configure-mpio-windows-server/IC741004.png)
6. **[MPIO サポートの追加]** ダイアログ ボックスで、 **[デバイスのハードウェア ID]** にデバイスのシリアル番号を入力します。 デバイスのシリアル番号を取得するには、StorSimple デバイス マネージャー サービスにアクセスし、 **[デバイス] > [ダッシュボード]** の順に移動します。 デバイスのシリアル番号は、デバイス ダッシュボードの右側の **[概要]** ウィンドウに表示されます。
    </br>
    ![MPIO サポートの追加](./media/storsimple-configure-mpio-windows-server/IC741005.png)
7. メッセージが表示されたら、サーバーを再起動します。

## <a name="step-3-mount-storsimple-volumes-on-the-host"></a>手順 3:ホストに StorSimple ボリュームをマウントする

Windows Server で MPIO が構成されると、StorSimple デバイスに作成されたボリュームをマウントし、MPIO を活用して冗長性を確保できます。 ボリュームをマウントするには、次の手順を実行します。

#### <a name="to-mount-volumes-on-the-host"></a>ホストにボリュームをマウントするには

1. Windows Server ホストで、 **[iSCSI イニシエーターのプロパティ]** ウィンドウを開きます。 **[サーバー マネージャー]、[ダッシュボード]、[ツール]、[iSCSI イニシエーター]** の順にクリックします。
2. **[iSCSI イニシエーターのプロパティ]** ダイアログ ボックスで、[探索] タブをクリックし、 **[ターゲット ポータルの探索]** をクリックします。
3. **[ターゲット ポータルの探索]** ダイアログ ボックスで、次の手順を実行します。
   
   1. StorSimple デバイスの DATA ポートの IP アドレスを入力します (たとえば、「DATA 0」と入力します)。
   2. **[OK]** をクリックして、 **[iSCSI イニシエーターのプロパティ]** ダイアログ ボックスに戻ります。
     
      > [!IMPORTANT]
      > **iSCSI 接続のプライベート ネットワークを使用している場合は、プライベート ネットワークに接続されている DATA ポートの IP アドレスを入力します。**
    
4. デバイスの 2 番目のネットワーク インターフェイス (DATA 1 など) に対して手順 2. ～ 3. を繰り返します。 これらのインターフェイスは iSCSI に対応している必要があることに注意してください。 詳細については、[ネットワーク インターフェイスの変更](storsimple-8000-modify-device-config.md#modify-network-interfaces)をご覧ください。
5. **[iSCSI イニシエーターのプロパティ]** ダイアログ ボックスで、 **[ターゲット]** タブを選択します。 **[検出されたターゲット]** に StorSimple デバイスのターゲット IQN が表示されます。

   ![iSCSI イニシエーターのプロパティ、[ターゲット] タブ](./media/storsimple-configure-mpio-windows-server/IC741007.png)
   
6. **[接続]** をクリックして、StorSimple デバイスとの iSCSI セッションを確立します。 **[ターゲットへの接続]** ダイアログ ボックスが表示されます。
7. **[ターゲットへの接続]** ダイアログ ボックスで、 **[複数パスを有効にする]** チェック ボックスをオンにします。 **[詳細設定]** をクリックします。
8. **[詳細設定]** ダイアログ ボックスで、次の手順を実行します。
   
   1. **[ローカル アダプター]** ボックスの一覧で、 **[Microsoft iSCSI イニシエーター]** を選択します。
   2. **[イニシエーター IP]** ボックスの一覧で、ホストの IP アドレスを選択します。
   3. **[ターゲット ポータル IP]** ボックスの一覧で、デバイス インターフェイスの IP を選択します。
   4. **[OK]** をクリックして、 **[iSCSI イニシエーターのプロパティ]** ダイアログ ボックスに戻ります。
9. **[プロパティ]** をクリックします。 **[プロパティ]** ダイアログ ボックスで、 **[セッションの追加]** をクリックします。
10. **[ターゲットへの接続]** ダイアログ ボックスで、 **[複数パスを有効にする]** チェック ボックスをオンにします。 **[詳細設定]** をクリックします。
11. **[詳細設定]** ダイアログ ボックスで、次の手順を実行します。

    1. **[ローカル アダプター]** ボックスの一覧で、[Microsoft iSCSI イニシエーター] を選択します。
    2. **[イニシエーター IP]** ボックスの一覧で、ホストに対応する IP アドレスを選択します。 この場合、デバイスの 2 つのネットワーク インターフェイスを、ホスト上の 1 つのネットワーク インターフェイスに接続しています。 そのため、このインターフェイスは最初のセッションで指定されたものと同じです。
    3. **[ターゲット ポータル IP]** ボックスの一覧で、デバイスで有効になっている 2 番目のデータ インターフェイスの IP アドレスを選択します。
    4. **[OK]** をクリックして、[iSCSI イニシエーターのプロパティ] ダイアログ ボックスに戻ります。 2 番目のセッションをターゲットに追加しました。
12. **[サーバー マネージャー]、[ダッシュボード]、[コンピューターの管理]** の順に移動して、 **[コンピューターの管理]** を開きます。 左側のウィンドウで、 **[ストレージ] の [ディスクの管理]** をクリックします。 このホストに表示される StorSimple デバイス上で作成したボリュームは、新しいディスクとして **[ディスクの管理]** に表示されます。
13. ディスクを初期化して、新しいボリュームを作成します。 フォーマット処理中に 64 KB のブロック サイズを選択します。
    
    ![ディスク管理](./media/storsimple-configure-mpio-windows-server/IC741008.png)
14. **[ディスクの管理]** で、 **[ディスク]** を右クリックし、 **[プロパティ]** を選択します。
15. StorSimple モデル #### の **[マルチパス ディスクのデバイス プロパティ]** ダイアログ ボックスで、 **[MPIO]** タブをクリックします。
    
    ![StorSimple 8100 マルチパス ディスクのデバイス プロパティ。](./media/storsimple-configure-mpio-windows-server/IC741009.png)
16. **[DSM 名]** セクションで、 **[詳細]** をクリックし、パラメーターが既定のパラメーターに設定されていることを確認します。 既定のパラメーターは次のとおりです。
    
    * パス確認期間 = 30
    * 再試行回数 = 3
    * PDO 削除期間 = 20
    * 再試行間隔 = 1
    * パス確認を有効化する = オフ

> [!NOTE]
> **既定のパラメーターは変更しないでください。**


## <a name="step-4-configure-mpio-for-high-availability-and-load-balancing"></a>手順 4:高可用性と負荷分散のために MPIO を構成する

高可用性と負荷分散を基にしたマルチパスでは、複数のセッションを手動で追加し、利用可能なさまざまなパスを宣言する必要があります。 たとえば、ホストの 2 つのインターフェイスが iSCSI ネットワークに接続されていて、デバイスの 2 つのインターフェイスが iSCSI ネットワークに接続されている場合は、4 つのセッションに適切なパスの順列を構成する必要があります (各 DATA インターフェイスおよびホスト インターフェイスが異なる IP サブネット上にあってルーティング可能ではない場合は、必要なセッションは 2 つだけです)。

**デバイスとアプリケーション ホスト間で少なくとも 8 つのアクティブな並行セッションがあることをお勧めします。** これを実現するには、Windows Server システムで 4 つのネットワーク インターフェイスを有効にします。 Windows Server ホスト上のハードウェアまたはオペレーティング システム レベルで、物理ネットワーク インターフェイスか、ネットワーク仮想化テクノロジを使用する仮想インターフェイスを使用します。 デバイスに 2 つのネットワーク インターフェイスがある場合、この構成でアクティブなセッション数が 8 個になります。 この構成により、デバイスとクラウドのスループットが最適化されます。

> [!IMPORTANT]
> **1 GbE と 10 GbE のネットワーク インターフェイスを混在させることはできません。2 種類のネットワーク インターフェイスを使用する場合は、どちらも同じ種類である必要があります。**

次の手順では、2 つのネットワーク インターフェイスを持つ StorSimple デバイスが 2 つのネットワーク インターフェイスを持つホストに接続されている場合に、セッションを追加する方法について説明します。 この場合、セッションは 4 つだけです。 2 つのネットワーク インターフェイスを持つ StorSimple デバイスが 4 つのネットワーク インターフェイスを持つホストに接続されている場合にも、これと同じ手順を使用します。 ただし、ここで説明する 4 つのセッションではなく、8 つのセッションを構成する必要があります。

### <a name="to-configure-mpio-for-high-availability-and-load-balancing"></a>高可用性と負荷分散のために MPIO を構成するには

1. ターゲットの検出を実行します。 **[iSCSI イニシエーターのプロパティ]** ダイアログ ボックスの **[探索]** タブで、 **[ポータルの探索]** をクリックします。
2. **[ターゲットへの接続]** ダイアログ ボックスで、いずれかのデバイス ネットワーク インターフェイスの IP アドレスを入力します。
3. **[OK]** をクリックして、 **[iSCSI イニシエーターのプロパティ]** ダイアログ ボックスに戻ります。
4. **[iSCSI イニシエーターのプロパティ]** ダイアログ ボックスの **[ターゲット]** タブで、検出したターゲットを強調表示し、 **[接続]** をクリックします。 **[ターゲットへの接続]** ダイアログ ボックスが表示されます。
5. **[ターゲットへの接続]** ダイアログ ボックスで、次の手順を実行します。
   
   1. **[この接続をお気に入りのターゲットの一覧に追加する]** を既定の選択したターゲット設定のままにします。 この設定により、デバイスはこのコンピューターが起動するたびに、接続を自動的に再起動するように試みます。
   2. **[複数パスを有効にする]** チェック ボックスをオンにします。
   3. **[詳細設定]** をクリックします。
6. **[詳細設定]** ダイアログ ボックスで、次の手順を実行します。
   
   1. **[ローカル アダプター]** ボックスの一覧で、 **[Microsoft iSCSI イニシエーター]** を選択します。
   2. **[イニシエーター IP]** ボックスの一覧で、ホストの最初のインターフェイス (iSCSI インターフェイス) に対応する IP アドレスを選択します。
   3. **[ターゲット ポータル IP]** ボックスの一覧で、デバイスで有効になっている最初のデータ インターフェイスの IP アドレスを選択します。
   4. **[OK]** をクリックして、[iSCSI イニシエーターのプロパティ] ダイアログ ボックスに戻ります。
7. **[プロパティ]** をクリックし、 **[プロパティ]** ダイアログ ボックスで、 **[セッションの追加]** をクリックします。
8. **[ターゲットへの接続]** ダイアログ ボックスで、 **[複数パスを有効にする]** チェック ボックスをオンにし、 **[詳細設定]** をクリックします。
9. **[詳細設定]** ダイアログ ボックスで、次の手順を実行します。
   
   1. **[ローカル アダプター]** ボックスの一覧で、 **[Microsoft iSCSI イニシエーター]** を選択します。
   2. **[イニシエーター IP]** ボックスの一覧で、ホストの 2 番目の iSCSI インターフェイスに対応する IP アドレスを選択します。
   3. **[ターゲット ポータル IP]** ボックスの一覧で、デバイスで有効になっている 2 番目のデータ インターフェイスの IP アドレスを選択します。
   4. **[OK]** をクリックして、 **[iSCSI イニシエーターのプロパティ]** ダイアログ ボックスに戻ります。 これで 2 番目のセッションがターゲットに追加されました。
10. 追加のセッション (パス) をターゲットに追加するには、手順 8. ～ 10. を繰り返します。 ホスト上の 2 つのインターフェイスとデバイス上の 2 つのインターフェイスを使用して、合計 4 つのセッションを追加できます。
11. 目的のセッション (パス) を追加した後、 **[iSCSI イニシエーターのプロパティ]** ダイアログ ボックスで、ターゲットを選択し、 **[プロパティ]** をクリックします。 **[プロパティ]** ダイアログ ボックスの [セッション] タブで、可能なパスの順列に対応する 4 つのセッション ID を確認します。 セッションを取り消すには、セッション ID の横にあるチェック ボックスをオンにして、 **[切断]** をクリックします。
12. セッション内に示されるデバイスを表示するには、 **[デバイス]** タブを選択します。選択したデバイスの MPIO ポリシーを構成するには、 **[MPIO]** をクリックします。 **[デバイスの詳細]** ダイアログ ボックスが表示されます。 **[MPIO]** タブで、適切な **[負荷分散ポリシー]** の設定を選択できます。 **[アクティブ]** または **[スタンバイ]** のパスの種類も表示することができます。

## <a name="next-steps"></a>次のステップ

「[StorSimple Manager サービスを使用した StorSimple デバイス構成の変更](storsimple-8000-modify-device-config.md)」の詳細を確認する。

