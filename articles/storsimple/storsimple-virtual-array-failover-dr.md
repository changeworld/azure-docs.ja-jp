---
title: StorSimple Virtual Array のディザスター リカバリーとデバイス フェールオーバー | Microsoft Docs
description: StorSimple Virtual Array をフェールオーバーする方法の詳細を確認します。
services: storsimple
documentationcenter: NA
author: alkohli
manager: timlt
editor: ''
ms.assetid: 3c1f9c62-af57-4634-a0d8-435522d969aa
ms.service: storsimple
ms.devlang: NA
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 02/27/2017
ms.author: alkohli
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: 19a676f4187af2d358934539e4ca29dbc5c25897
ms.sourcegitcommit: b07964632879a077b10f988aa33fa3907cbaaf0e
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 02/13/2020
ms.locfileid: "77190638"
---
# <a name="disaster-recovery-and-device-failover-for-your-storsimple-virtual-array-via-azure-portal"></a>Azure Portal を介した StorSimple Virtual Array のディザスター リカバリーとデバイスのフェールオーバー

## <a name="overview"></a>概要
この記事では、Microsoft Azure StorSimple Virtual Array のディザスター リカバリー、たとえば、他の仮想アレイへの詳細なフェールオーバー手順について説明します。 フェールオーバーにより、データを、データセンターの "*ソース*" デバイスから "*ターゲット*" デバイスに移動することができます。 ターゲット デバイスは、地理的に同じ場所または別の場所に配置できます。 デバイスのフェールオーバーは、デバイス全体に対して行われます。 フェールオーバーの間、ソース デバイスのクラウド データの所有権はターゲット デバイスに移ります。

この記事は、StorSimple Virtual Array にのみ適用されます。 8000 シリーズのデバイスのフェールオーバーについては、「[StorSimple デバイスのフェールオーバーと障害復旧](storsimple-device-failover-disaster-recovery.md)」を参照してください。

## <a name="what-is-disaster-recovery-and-device-failover"></a>ディザスター リカバリーとデバイスのフェールオーバーとは

ディザスター リカバリー (DR) シナリオでは、プライマリ デバイスの機能が停止します。 このシナリオでは、災害が発生したデバイスに関連付けられているクラウドのデータを別のデバイスに移動できます。 プライマリ デバイスを "*ソース*" として使用し、別のデバイスを "*ターゲット*" として指定できます。 このプロセスを *フェールオーバー*といいます。 フェールオーバー時には、ソース デバイスのすべてのボリュームまたは共有の所有権がターゲット デバイスに移ります。 データのフィルター処理はできません。

DR は、ヒート マップをベースとした階層化と追跡を使用して、デバイスの完全な復元としてモデル化されます。 ヒート マップは、読み取りと書き込みのパターンに基づいてデータにヒート値を割り当てることで定義されます。 ヒート マップによって、まずヒート値が最も低いデータ チャンクがクラウドに階層化され、ヒート値が高い (よく使用される) データ チャンクはローカル層に保持されます。 StorSimple は、DR 時にこのヒート マップを使用して、クラウドからデータを復元します。 デバイスが (内部で決められたとおりに) 最新のバックアップ内のボリューム/共有をすべてフェッチし、そのバックアップからの復元を実行します。 全体的な DR プロセスは仮想アレイによって調整されます。

> [!IMPORTANT]
> ソース デバイスはデバイスのフェールオーバーの完了時に削除されるため、フェールバックはサポートされていません。
> 
> 

ディザスター リカバリーは、デバイスのフェールオーバー機能によって調整され、 **[デバイス]** ブレードから開始されます。 このブレードには、StorSimple デバイス マネージャー サービスに接続されている StorSimple デバイスの一覧が表示されており、 デバイスごとに、表示名、状態、プロビジョニング容量と最大容量、種類、およびモデルを確認できます。

## <a name="prerequisites-for-device-failover"></a>デバイスのフェールオーバーに関する前提条件

### <a name="prerequisites"></a>前提条件

デバイスのフェールオーバーの前に、次の前提条件が満たされていることを確認してください。

* ソース デバイスが **"非アクティブ"** の状態にある必要があります。
* ターゲット デバイスは、Azure Portal で**セットアップの準備が完了している**状態として表示されている必要があります。 ターゲット仮想アレイは、ソースと同等以上の容量でプロビジョニングします。 ローカル Web UI を使用してターゲット仮想アレイを構成し、適切に登録してください。
  
  > [!IMPORTANT]
  > また、登録した仮想デバイスはサービスで構成しないでください。 デバイスの構成はサービスによって行うべきではありません。
  > 
  > 
* ターゲット デバイスの名前は、ソース デバイスと同じにはできません。
* ソース デバイスとターゲット デバイスの種類が同じである必要があります。 ファイル サーバーとして構成されている仮想アレイは、別のファイル サーバーにしかフェールオーバーできません。 これは iSCSI サーバーの場合も同様です。
* ファイル サーバーの DR の場合は、ソース デバイスと同じドメインにターゲット デバイスを参加させることをお勧めします。 このように構成することで、共有のアクセス許可が自動的に解決されます。 同じドメイン内のターゲット デバイスへのフェールオーバーのみがサポートされます。
* DR に使用できるターゲット デバイスは、ソース デバイスと同等以上の容量があるデバイスです。 サービスに接続されていても、空き領域の条件を満たしていないデバイスは、ターゲット デバイスとして使用できません。

### <a name="other-considerations"></a>その他の考慮事項

* 計画されたフェールオーバーの場合:
  
  * ソース デバイスのすべてのボリューム/共有をオフラインにすることをお勧めします。
  * データの損失を最小限に抑えるため、デバイスのバックアップを作成してからフェールオーバーすることをお勧めします。
* 計画外のフェールオーバーの場合、データの復元には最新のバックアップが使用されます。

### <a name="device-failover-prechecks"></a>デバイスのフェールオーバーの事前チェック

DR が始まる前に、事前チェックが実行されます。 事前チェックによって、DR 開始後のエラーを防ぐことができます。 事前チェックの内容:

* ストレージ アカウントを検証する。
* Azure へのクラウド接続を確認する。
* ターゲット デバイスの空き領域を確認する。
* iSCSI サーバーのソース デバイスのボリュームに次が含まれていることを確認する
  
  * 有効な ACR 名。
  * 有効な IQN (最大 220 文字)。
  * 有効な CHAP パスワード (12 ～ 16 文字)。

前の事前チェックのいずれかに問題があった場合、DR は続行できません。 問題を解決してから DR を再試行してください。

DR が正常に完了すると、ソース デバイスのクラウド データの所有権がターゲット デバイスに移ります。 また、ソース デバイスはポータルで使用できなくなります。 ソース デバイスのすべてのボリューム/共有へのアクセスがブロックされ、ターゲット デバイスがアクティブになります。

> [!IMPORTANT]
> デバイスは使用できなくなりますが、ホスト システムにプロビジョニングした仮想マシンは引き続きリソースを消費します。 DR が正常に完了したら、ホスト システムからこの仮想マシンを削除できます。
> 
> 

## <a name="fail-over-to-a-virtual-array"></a>仮想アレイへのフェールオーバー

この手順を実行する前に、他の StorSimple Virtual Array をプロビジョニングして構成し、StorSimple デバイス マネージャー サービスに登録しておくことをお勧めします。

> [!IMPORTANT]
> 
> * StorSimple 8000 シリーズのデバイスから 1200 仮想デバイスにはフェールオーバーできません。
> * 連邦情報処理標準 (FIPS) 対応の仮想デバイスから、他の FIPS 対応デバイスまたは Government ポータルにデプロイされた非 FIPS デバイスにはフェールオーバーできます。


ターゲットの StorSimple 仮想デバイスにデバイスを復元するには、次の手順を実行します。

1. [デバイスのフェールオーバーに関する前提条件](#prerequisites)を満たすターゲット デバイスをプロビジョニングおよび構成します。 ローカル Web UI を使用してデバイスの構成を完了し、StorSimple デバイス マネージャー サービスに登録します。 ファイル サーバーを作成する場合、[ファイル サーバーとしてのセットアップ](storsimple-virtual-array-deploy3-fs-setup.md#step-1-complete-the-local-web-ui-setup-and-register-your-device)に関するトピックの手順 1. に移動します。 iSCSI サーバーを作成する場合、[iSCSI サーバーとしてのセットアップ](storsimple-virtual-array-deploy3-iscsi-setup.md#step-1-complete-the-local-web-ui-setup-and-register-your-device)に関するトピックの手順 1. に移動します。

2. ホスト上のボリューム/共有をオフラインにします。 ボリューム/共有をオフラインにするには、ホストのオペレーティング システムに固有の手順を参照してください。 まだオフラインにしていない場合は、次の操作を行って、デバイスのすべてのボリューム/共有をオフラインにする必要があります。
   
    1. **[デバイス]** ブレードに移動し、デバイスを選択します。
   
    2. **[設定] > [管理] > [共有]** (または **[設定] > [管理] > [ボリューム]** ) の順に移動します。 
   
    3. 共有/ボリュームを選択して右クリックし、 **[オフラインにする]** を選択します。 
   
    4. 確認を求めるメッセージが表示されたら、 **[この共有をオフラインにした場合の影響について理解しています]** をオンにします。 
   
    5. **[オフラインにする]** をクリックします。

3. StorSimple デバイス マネージャー サービスで、 **[管理] > [デバイス]** の順に移動します。 **[デバイス]** ブレードで、ソース デバイスを選択してクリックします。

4. **[Device dashboard (デバイス ダッシュボード)]** ブレードで、 **[非アクティブ化]** をクリックします。

5. **[非アクティブ化]** ブレードで、確認を求めるメッセージが表示されます。 デバイスの非アクティブ化は "*永続的*" な操作であるため、元に戻すことはできません。 ホスト上の共有/ボリュームもオフラインにするよう通知されます。 デバイス名を入力して確認し、 **[非アクティブ化]** をクリックします。
   
    ![](./media/storsimple-virtual-array-failover-dr/failover1.png)
6. 非アクティブ化が開始されます。 非アクティブ化が正常に完了すると、その旨が通知されます。
   
    ![](./media/storsimple-virtual-array-failover-dr/failover2.png)
7. [デバイス] ページで、デバイスの状態が "**非アクティブ**" に変わります。
    ![](./media/storsimple-virtual-array-failover-dr/failover3.png)
8. **[デバイス]** ブレードで、フェールオーバーする非アクティブ化されたソース デバイスを選択してクリックします。 
9. **[Device dashboard (デバイス ダッシュボード)]** ブレードで、 **[フェールオーバー]** をクリックします。 
10. **[デバイスのフェールオーバー]** ブレードで、次の操作を行います。
    
    1. [ソース デバイス] フィールドは自動的に設定されます。 ソース デバイスの合計データ サイズに注意してください。 データ サイズは、ターゲット デバイスで利用可能な容量未満にする必要があります。 デバイス名、合計容量、フェールオーバーされる共有の名前など、ソース デバイスに関連付けられている詳細を確認します。

    2. 使用可能なデバイスの一覧で、 **[ターゲット デバイス]** を選択します。 十分な容量があるデバイスのみが一覧に表示されます。

    3. **[この操作によってデータがターゲット デバイスにフェールオーバーされることを理解しています]** をオンにします。 

    4. **[フェールオーバー]** をクリックします。
    
        ![](./media/storsimple-virtual-array-failover-dr/failover4.png)
11. フェールオーバー ジョブが開始され、その旨が通知されます。 **[デバイス] > [ジョブ]** に移動して、フェールオーバーを監視します。
    
     ![](./media/storsimple-virtual-array-failover-dr/failover5.png)
12. **[ジョブ]** ブレードに、ソース デバイス用に作成されたフェールオーバー ジョブが表示されます。 このジョブによって DR 事前チェックが実行されます。
    
    ![](./media/storsimple-virtual-array-failover-dr/failover6.png)
    
     DR 事前チェックが正常に完了したら、フェールオーバー ジョブによって、ソース デバイス上に存在する各共有またはボリュームの復元ジョブが生成されます。
    
    ![](./media/storsimple-virtual-array-failover-dr/failover7.png)
13. フェールオーバーが完了したら、 **[デバイス]** ブレードに移動します。
    
    1. フェールオーバー プロセスのターゲット デバイスとして使用された StorSimple デバイスを選択してクリックします。
    2. **[設定] > [管理] > [共有]** (iSCSI サーバーの場合は **[ボリューム]** ) に移動します。 **[共有]** ブレードでは、以前のデバイスの共有 (ボリューム) すべてを確認できます。
        ![](./media/storsimple-virtual-array-failover-dr/failover9.png)
14. 接続しようとしているアプリケーションすべてが新しいデバイスにリダイレクトされるように、[DNS エイリアスを作成](https://support.microsoft.com/kb/168322)する必要があります。

## <a name="errors-during-dr"></a>DR 時のエラー

**DR 時にクラウドの接続が切断される**

DR が開始された後、デバイスの復元が完了する前にクラウドの接続が切断されると、DR が失敗し、 失敗の通知が届きます。 DR のターゲット デバイスは、"*使用不可*" としてマークされます。 同じターゲット デバイスを今後の DR に使用することはできません。

**互換性のあるターゲット デバイスがない**

使用可能なターゲット デバイスに十分な空き領域がない場合は、互換性のあるターゲット デバイスがないというエラーが表示されます。

**事前チェックの失敗**

事前チェックのいずれかに問題があると、エラーが表示されます。

## <a name="business-continuity-disaster-recovery-bcdr"></a>ビジネス継続性ディザスター リカバリー (BCDR)

ビジネス継続性ディザスター リカバリー (BCDR) シナリオは、Azure データセンター全体が機能を停止したときに発生します。 このような状況が発生すると、StorSimple デバイス マネージャー サービスと、関連する StorSimple デバイスに影響が及ぶ可能性があります。

障害が発生する直前に登録された StorSimple デバイスがある場合は、これらの StorSimple デバイスの削除が必要になることがあります。 障害復旧後、これらのデバイスを再作成して構成できます。

## <a name="next-steps"></a>次のステップ

[ローカル Web UI を使用して StorSimple Virtual Array を管理する](storsimple-ova-web-ui-admin.md)方法の詳細を確認します。

