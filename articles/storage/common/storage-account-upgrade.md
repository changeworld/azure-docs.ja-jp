---
title: 汎用 v2 ストレージ アカウントにアップグレードする - Azure Storage | Microsoft Docs
description: 汎用 v2 ストレージ アカウントにアップグレードします。
services: storage
author: tamram
ms.service: storage
ms.topic: conceptual
ms.date: 03/26/2019
ms.author: tamram
ms.openlocfilehash: e24b7efb9f4af9f730ce79751e2fc5a9d210edbd
ms.sourcegitcommit: 5aefc96fd34c141275af31874700edbb829436bb
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 12/04/2019
ms.locfileid: "74806985"
---
# <a name="upgrade-to-a-general-purpose-v2-storage-account"></a>汎用 v2 ストレージ アカウントにアップグレードする

汎用 v2 ストレージ アカウントは最新の Azure Storage 機能をサポートし、汎用 v1 および BLOB ストレージ アカウントのすべての機能を組み込んでいます。 ほとんどのストレージ シナリオに汎用 v2 アカウントをお勧めします。 汎用 v2 アカウントは、業界内の他社に引けを取らないトランザクション料金で、Azure Storage に対してギガバイトあたり容量の最低価格を提供しています。 汎用 v2 アカウントでは、ホットまたはクールの既定のアカウント アクセス層と、ホット、クール、またはアーカイブ間の BLOB レベル階層がサポートされます。

汎用 v1 または BLOB ストレージ アカウントから汎用 v2 ストレージ アカウントへのアップグレードは単純です。 Azure portal、PowerShell、または Azure CLI を使用してアップグレードできます。

> [!IMPORTANT]
> 汎用 v1 または BLOB ストレージ アカウントから汎用 v2 へのアップグレードは永続的であり、元に戻すことはできません。

# <a name="portaltabazure-portal"></a>[ポータル](#tab/azure-portal)

1. [Azure Portal](https://portal.azure.com) にサインインします。
2. ストレージ アカウントに移動します。
3. **[設定]** セクションで **[構成]** をクリックします。
4. **[アカウントの種類]** の **[アップグレード]** をクリックします。
5. **[アップグレードの確認]** で、アカウントの名前を入力します。
6. ブレードの下部にある **[アップグレード]** をクリックします。

    ![アカウントの種類をアップグレードする](../blobs/media/storage-blob-account-upgrade/upgrade-to-gpv2-account.png)

# <a name="powershelltabazure-powershell"></a>[PowerShell](#tab/azure-powershell)

[!INCLUDE [updated-for-az](../../../includes/updated-for-az.md)]

PowerShell を使用して汎用 V1 アカウントを汎用 v2 アカウントにアップグレードするには、まず最新バージョンの **Az.Storage** モジュールを使用するように PowerShell を更新します。 PowerShell のインストールについては、「[Azure PowerShell のインストールおよび構成](https://docs.microsoft.com/powershell/azure/install-Az-ps)」を参照してください。

次に、次のコマンドを呼び出してアカウントをアップグレードします。その際、ご使用のリソース グループ名、ストレージ アカウント名、および目的のアカウント アクセス層に置き換えます。

```powershell
Set-AzStorageAccount -ResourceGroupName <resource-group> -AccountName <storage-account> -UpgradeToStorageV2 -AccessTier <Hot/Cool>
```
# <a name="azure-clitabazure-cli"></a>[Azure CLI](#tab/azure-cli)

Azure CLI を使用して汎用 V1 アカウントを汎用 v2 アカウントにアップグレードするには、まず最新バージョンの Azure CLI をインストールします。 CLI のインストールについては、[Azure CLI 2.0 のインストール](https://docs.microsoft.com/cli/azure/install-azure-cli?view=azure-cli-latest)に関するページを参照してください。

次に、次のコマンドを呼び出してアカウントをアップグレードします。その際、ご使用のリソース グループ名、ストレージ アカウント名、および目的のアカウント アクセス層に置き換えます。

```cli
az storage account update -g <resource-group> -n <storage-account> --set kind=StorageV2 --access-tier=<Hot/Cool>
```

---

## <a name="specify-an-access-tier-for-blob-data"></a>BLOB データのアクセス層を指定する

汎用 v2 アカウントは、すべての Azure ストレージ サービスとデータ オブジェクトをサポートしていますが、アクセス層は BLOB ストレージ内のブロック BLOB に対してのみ適用できます。 汎用 v2 ストレージ アカウントにアップグレードするときは、既定のアカウント アクセス層としてホットまたはクールを指定できます。これは、個々の BLOB アクセス層パラメーターが指定されていない場合と同様に、BLOB データがアップロードされる既定の層を示します。

BLOB アクセス層を使用すると、想定される使用パターンに基づいて最も費用対効果の高いストレージを選択できます。 ブロック BLOB は、ホット層、クール層、またはアーカイブ層に格納できます。 アクセス層の詳細については、「[Azure Blob Storage:ホット ストレージ層、クール ストレージ層、アーカイブ ストレージ層](../blobs/storage-blob-storage-tiers.md)」をご覧ください。

既定では、新しいストレージ アカウントはホット アクセス層に作成され、汎用 v1 ストレージ アカウントはホットまたはクール アカウント層にアップグレードできます。 アカウントのアクセス層がアップグレード時に指定されていない場合、既定でホットにアップグレードされます。 アップグレード用にどのアクセス層を使用するか検討している場合は、現在のデータ使用シナリオを考慮してください。 汎用 v2 アカウントに移行するための一般的なユーザー シナリオには、次の 2 つがあります。

* 既存の汎用 v1 ストレージ アカウントを持っており、BLOB データの適切なストレージ アクセス層を使用して、汎用 v2 ストレージ アカウントへのアップグレードを評価したいと考えている。
* 汎用 v2 ストレージ アカウントを使用することを決定しているか、または既に持っており、BLOB データのホットまたはクール ストレージ アクセス層のどちらを使用すべきかを評価したいと考えている。

どちらの場合も、最優先事項は、汎用 v2 ストレージ アカウントに格納されたデータに関する格納、アクセス、および操作のコストを見積もり、それを現在のコストと比較することです。

## <a name="pricing-and-billing"></a>価格と課金

v1 ストレージ アカウントから汎用 v2 アカウントへのアップグレードは無料です。 アップグレード プロセス中に、目的のアカウント層を指定できます。 アップグレード時にアカウント層が指定されていない場合、アップグレードされたアカウントの既定のアカウント層は `Hot` になります。 ただし、アップグレード後にストレージ アクセス層を変更すると、請求書が変更される可能性があるため、アップグレード時に新しいアカウント層を指定することをお勧めします。

すべてのストレージ アカウントでは、各 BLOB の層に基づいた Blob Storage の価格モデルを採用しています。 ストレージ アカウントを使用するときには、課金に関して次の点を考慮してください。

* **ストレージ コスト**:データの格納のコストは、格納されているデータの量だけでなく、ストレージ アクセス層にも左右されます。 よりクールな層になるほど、ギガバイトあたりのコストが下がります。

* **データ アクセス コスト**:データ アクセス料金は、よりクールな層になるほど高くなります。 クールおよびアーカイブ ストレージ アクセス層のデータの場合、読み取りに対して、ギガバイト単位のデータ アクセス料金が課金されます。

* **トランザクション コスト**:すべての層に対してトランザクションごとに課金されます。よりクールな層になるほどコストが高くなります。

* **geo レプリケーション データ転送コスト**:GRS と RA-GRS を含む geo レプリケーションが構成されているアカウントだけに適用されます。 geo レプリケーション データ転送には、ギガバイトあたりの料金がかかります。

* **送信データ転送コスト**:送信データ転送 (Azure リージョンから転送されるデータ) では、汎用ストレージ アカウントと整合性のある、帯域幅使用量への課金 (GB 単位) が発生します。

* **ストレージ アクセス層の変更**:アカウント ストレージ アクセス層をクールからホットに変更すると、ストレージ アカウントに存在するすべてのデータの読み取りと同等の課金が発生します。 ただし、アカウント アクセス層をホットからクールに変更したときは、クール層への全データの書き込みに相当する課金が発生します (GPv2 アカウントのみ)。

> [!NOTE]
> ストレージ アカウントの価格モデルの詳細については、[Azure Storage の価格](https://azure.microsoft.com/pricing/details/storage/)に関するページを参照してください。 送信データ転送の価格の詳細については、[データ転送の料金詳細](https://azure.microsoft.com/pricing/details/data-transfers/)に関するページを参照してください。

### <a name="estimate-costs-for-your-current-usage-patterns"></a>現在の使用パターンのコストを見積もる

特定の層の汎用 v2 ストレージ アカウントでの BLOB データの格納およびアクセスのコストを見積もるには、既存の使用パターンを評価するか、または予測される使用パターンを見積もります。 一般に、以下のことを調べる必要があります。

* 以下のような BLOB ストレージの使用量 (GB 単位)
    - ストレージ アカウントに格納されているデータの量はどれくらいか。
    - 月単位でデータ ボリュームがどのように変化するか。古いデータが定期的に新しいデータに置き換わるかどうか。
* 以下のような BLOB ストレージ データの主なアクセス パターン。
    - ストレージ アカウントから読み取られているデータの量とストレージ アカウントに書き込まれているデータの量はどれくらいか。
    - ストレージ アカウントのデータに対して実行されている読み取り操作と書き込み操作の数。

実際のニーズに最適なアクセス層を決定するには、BLOB データの容量と、そのデータが使用されている方法を確認すると役に立ちます。 それを行うには、アカウントの監視メトリックを調べるのが最善の方法です。

### <a name="monitoring-existing-storage-accounts"></a>既存のストレージ アカウントの監視

既存のストレージ アカウントを監視し、そのデータを収集するには、Azure Storage Analytics を利用できます。これにより、ログ記録が実行され、ストレージ アカウントのメトリック データが得られます。 Storage Analytics では、GPv1、GPv2、BLOB というストレージ アカウントの種類について、ストレージ サービスへの要求に関して集計されたトランザクション統計情報と容量データを含むメトリックを格納できます。 このデータは、同じストレージ アカウント内の既知のテーブルに格納されます。

詳細については、「[About Storage Analytics Metrics (Storage Analytics メトリックについて)](https://msdn.microsoft.com/library/azure/hh343258.aspx)」と「[Storage Analytics Metrics Table Schema (Storage Analytics メトリックのテーブル スキーマ)](https://msdn.microsoft.com/library/azure/hh343264.aspx)」を参照してください。

> [!NOTE]
> BLOB ストレージ アカウントは、そのアカウントのメトリック データの格納とアクセスのためだけに Table service エンドポイントを公開します。

BLOB ストレージのストレージ使用量を監視するには、容量メトリックを有効にする必要があります。
これを有効にすると、ストレージ アカウントの Blob service に関する容量データが毎日記録されます。これは、同じストレージ アカウント内の *$MetricsCapacityBlob* テーブルに書き込まれるテーブル エントリとして記録されます。

BLOB ストレージのデータ アクセス パターンを監視するには、API から時間単位のトランザクション メトリックを有効にする必要があります。 時間単位のトランザクション メトリックを有効にすると、API あたりのトランザクションが 1 時間ごとに集計され、同じストレージ アカウント内の *$MetricsHourPrimaryTransactionsBlob* テーブルに書き込まれるテーブル エントリとして記録されます。 *$MetricsHourSecondaryTransactionsBlob* テーブルには、RA-GRS ストレージ アカウントを使用している場合のセカンダリ エンドポイントに対するトランザクションが記録されます。

> [!NOTE]
> ページ BLOB や仮想マシン ディスク (またはキュー、ファイル、テーブル) をブロックおよび追加 BLOB データと共に格納している汎用ストレージ アカウントがある場合は、この見積もりプロセスを適用できません。 容量データにおいて、ブロック BLOB と他の種類が区別されず、他の種類のデータに関する容量データが得られません。 これらのタイプを使用する場合、直近の請求書に記載された数量に着目することで対応することもできます。

データ使用量とアクセス パターンを正確に見積もるには、通常の使用状況を表すメトリックの保有期間を選択したうえで推定することをお勧めします。 その方法の 1 つとして、メトリック データを 7 日間保持し、そのデータを毎週収集して、月末に分析を行う方法があります。 そのほかに、過去 30 日間のメトリック データを保持し、30 日の期間の最後にそのデータを収集、分析する方法もあります。

メトリック データの有効化、収集、および表示の詳細については、[Storage Analytics のメトリック](../common/storage-analytics-metrics.md?toc=%2fazure%2fstorage%2fblobs%2ftoc.json)に関するページを参照してください。

> [!NOTE]
> 分析データの格納、アクセス、ダウンロードについても、通常のユーザー データと同様に課金されます。

### <a name="utilizing-usage-metrics-to-estimate-costs"></a>コストを見積もるための使用状況メトリックの利用

#### <a name="capacity-costs"></a>容量のコスト

行キー *"data"* がある容量メトリック テーブル *$MetricsCapacityBlob* の最新のエントリは、ユーザー データによって使用されたストレージ容量を示します。 行キー *"analytics"* がある容量メトリック テーブル *$MetricsCapacityBlob* の最新のエントリは、分析ログによって使用されたストレージ容量を示します。

ユーザー データと分析ログ (有効な場合) の両方によって使用されたこの合計容量は、ストレージ アカウントにデータを格納するコストを見積もるために使用できます。 また、同じ方法を使用して、GPv1 ストレージ アカウントでのストレージ コストを見積もることができます。

#### <a name="transaction-costs"></a>トランザクション コスト

*"TotalBillableRequests"* の合計は、トランザクション メトリック テーブル内の API のすべてのエントリを対象とし、その特定の API のトランザクションの総数を示すものです。 "*たとえば*"、特定期間の "*GetBlob*" トランザクションの合計は、行キー "*user;GetBlob*" を備えたすべてのエントリに対する課金対象の要求をすべて加算することによって計算できます。

BLOB ストレージ アカウントのトランザクション コストを見積もるには、トランザクションを 3 つのグループに分類する必要があります (それぞれ価格が異なるため)。

* *"PutBlob"* 、 *"PutBlock"* 、 *"PutBlockList"* 、 *"AppendBlock"* 、 *"ListBlobs"* 、 *"ListContainers"* 、 *"CreateContainer"* 、 *"SnapshotBlob"* 、 *"CopyBlob"* などの書き込みトランザクション。
* *"DeleteBlob"* 、 *"DeleteContainer"* などの削除トランザクション。
* その他すべてのトランザクション。

GPv1 ストレージ アカウントのトランザクション コストを見積もるには、操作と API に関係なく、すべてのトランザクションを集計する必要があります。

#### <a name="data-access-and-geo-replication-data-transfer-costs"></a>データ アクセスと geo レプリケーション データ転送のコスト

Storage Analytics では、ストレージ アカウントに対する読み取りと書き込みのデータ量は示されませんが、トランザクション メトリック テーブルを確認することで大まかに見積もることは可能です。 トランザクション メトリック テーブル内の API の全エントリを対象とした *"TotalIngress"* の合計は、その特定の API の受信データの総量をバイトで示すものです。 同様に、 *"TotalEgress"* の合計は、送信データの総量をバイトで示します。

BLOB ストレージ アカウントのデータ アクセス コストを見積もるには、トランザクションを 2 つのグループに分類する必要があります。

* ストレージ アカウントから取得されたデータの量は、主に *"GetBlob"* 操作と *"CopyBlob"* 操作の *"TotalEgress"* の合計を確認することで見積もることができます。

* ストレージ アカウントに書き込まれたデータの量は、主に *"PutBlob"* 操作、 *"PutBlock"* 操作、 *"CopyBlob"* 操作、 *"AppendBlock"* 操作の *"TotalIngress"* の合計を確認することで見積もることができます。

また、BLOB ストレージ アカウントの geo レプリケーション データ転送のコストは、GRS ストレージ アカウントまたは RA-GRS ストレージ アカウントを使用する場合に書き込まれるデータ量の見積もりを使用することによって計算することもできます。

> [!NOTE]
> ホット ストレージ アクセス層またはクール ストレージ アクセス層を使用する場合のコストの計算に関する詳細な例については、「*Azure Storage の価格* 」というページにある、 ["ホットおよびクール アクセス層とはどのようなものですか? また、どちらを使用すればよいのでしょうか?"](https://azure.microsoft.com/pricing/details/storage/)にサインインします。

## <a name="next-steps"></a>次の手順

- [ストレージ アカウントの作成](storage-quickstart-create-account.md)
- [Azure Storage アカウントを管理する](storage-account-manage.md)
