---
title: Azure 向けの Microsoft マルウェア対策 | Microsoft Docs
description: この記事では、Azure 向けの Microsoft マルウェア対策のアーキテクチャの概要を説明します。Azure Cloud Services および Virtual Machines の保護の有効化、構成、デプロイに関するサポートされるシナリオと構成などについて説明します。 Microsoft Azure Service Management API、PowerShell スクリプト、Azure ポータル、Visual Studio でアクセスできる基本的な構成、管理、監視の機能を説明します。
services: security
documentationcenter: na
author: barclayn
manager: barbkess
editor: ''
ms.assetid: 265683c8-30d7-4f2b-b66c-5082a18f7a8b
ms.service: security
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 03/26/2019
ms.author: barclayn
ms.openlocfilehash: a075399dbfcc1cc3fa5b6587b3769608bbd40e6a
ms.sourcegitcommit: 6cff17b02b65388ac90ef3757bf04c6d8ed3db03
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 07/29/2019
ms.locfileid: "68611246"
---
# <a name="microsoft-antimalware-for-azure-cloud-services-and-virtual-machines"></a>Azure Cloud Services および Virtual Machines 向け Microsoft マルウェア対策

Azure に対する Microsoft マルウェア対策は、ウイルス、スパイウェアなどの悪意のあるソフトウェアの特定や駆除に役立つリアルタイムの保護です。 これにより、既知の悪意あるソフトウェアや望ましくないソフトウェアが Azure システム上にソフトウェア自体をインストールまたは実行しようとしたときに、アラートが生成されます。

このソリューションの基になっているマルウェア対策プラットフォームは、Microsoft Security Essentials \[MSE\]、Microsoft Forefront Endpoint Protection、Microsoft System Center Endpoint Protection、Windows Intune、および Windows Defender と同じです。 Azure 向け Microsoft マルウェア対策は、アプリケーションおよびテナント環境のための単一エージェント ソリューションであり、ユーザーの介入なしにバック グラウンドで実行するように作られています。 アプリケーションのワークロードのニーズに基づいて、マルウェア対策監視など、基本的な既定のセキュリティまたは高度なカスタム構成で、保護をデプロイできます。

Azure 向け Microsoft マルウェア対策をアプリケーションにデプロイして有効にすると、次のコア機能を使用できるようになります。

* **リアルタイム保護** - Cloud Services および仮想マシンでのアクティビティを監視し、マルウェアの実行を検出してブロックします。
* **スケジュールに基づくスキャン**: スキャンを定期的に実行して、マルウェアや活動量の多いプログラムを検出します。
* **マルウェアの駆除** - 悪意のあるファイルの削除や検疫、悪意のあるレジストリ エントリのクリーンアップなど、検出されたマルウェアへの対処を自動的に行います。
* **シグネチャの更新** - 最新の保護シグネチャ (ウイルスの定義) を自動的にインストールし、事前に定義された頻度で保護を最新の状態に更新します。
* **マルウェア対策エンジンの更新** - Microsoft マルウェア対策エンジンを自動的に更新します。
* **マルウェア対策プラットフォームの更新** - Microsoft マルウェア対策プラットフォームを自動的に更新します。
* **アクティブ保護** - 検出された脅威および疑わしいリソースに関するテレメトリ メタデータを Microsoft Azure に報告して発生中の脅威に迅速に対応すると共に、Microsoft Active Protection System (MAPS) を使用して同期されたシグネチャをリアルタイムで配信できるようにします。
* **サンプルのレポート** - Microsoft マルウェア対策サービスにサンプルを提供および報告し、サービスの調整およびトラブルシューティングを可能にします。
* **除外** – アプリケーションとサービスの管理者は、フファイル、プロセス、およびドライブ の除外を構成できます。  
* **マルウェア対策イベントの収集** - マルウェア対策サービスの状態、疑わしいアクティビティ、および実行された修復アクションをオペレーティング システムのイベント ログに記録し、顧客の Azure ストレージ アカウントにそれらを収集します。

> [!NOTE]
> Microsoft マルウェア対策は、Azure Security Center を使用してデプロイすることもできます。 詳細については、「[Azure Security Center で Endpoint Protection をインストールする](../../security-center/security-center-install-endpoint-protection.md)」を参照してください。

## <a name="architecture"></a>アーキテクチャ

Azure 向け Microsoft マルウェア対策には、Microsoft マルウェア対策クライアントとサービス、マルウェア対策クラシック デプロイ モデル、マルウェア対策 PowerShell コマンドレット、および Azure Diagnostics 拡張機能が含まれます。 Microsoft マルウェア対策は、Windows Server 2008 R2、Windows Server 2012、および Windows Server 2012 R2 の各オペレーティング システム ファミリでサポートされます。 Windows Server 2008 オペレーティング システムではサポートされず、Linux でもサポートされません。

Microsoft マルウェア対策クライアントおよびサーバーは、既定では、Cloud Services プラットフォームのすべてのサポートされる Azure ゲスト オペレーティング システム ファミリに無効状態でインストールされます。 Microsoft マルウェア対策クライアントおよびサービスは既定では Virtual Machines プラットフォームにはインストールされず、Azure ポータルおよび Visual Studio 仮想マシン構成のセキュリティ拡張機能でオプション機能として使用できます。

Azure App Service を使用しているときは、Web アプリケーションをホストしている基盤となるサービスでは、Microsoft マルウェア対策が有効になっています。 これは、Azure App Service のインフラストラクチャを保護するために使用されます。お客様のコンテンツでは実行されません。

> [!NOTE]
> Windows Defender は Windows Server 2016 で有効になっている組み込みのマルウェア対策です。 Windows Defender インターフェイスは、一部の Windows Server 2016 SKU でも既定で有効になっています。[詳細はこちらをご覧ください](https://docs.microsoft.com/windows/threat-protection/windows-defender-antivirus/windows-defender-antivirus-on-windows-server-2016)。 Azure VM マルウェア対策拡張機能も引き続き、Windows Server 2016 Azure VM と Windows Defender の組み合わせに追加できますが、その場合、Windows Defender によって使用される任意の[構成ポリシー](https://gallery.technet.microsoft.com/Antimalware-For-Azure-5ce70efe)があれば、それが拡張機能によって適用されます。拡張機能によって、追加のマルウェア対策サービスがデプロイされることはありません。
> この更新に関する詳細については、[こちら](https://blogs.msdn.microsoft.com/azuresecurity/2017/03/07/update-to-azure-antimalware-extension-for-cloud-services/)を参照してください。

### <a name="microsoft-antimalware-workflow"></a>Microsoft マルウェア対策のワークフロー

Azure サービスの管理者は、既定の構成で、または以下のオプションを使用してカスタム構成で、Virtual Machines および Cloud Services に対する Azure 向けマルウェア対策を有効にできます。

* Virtual Machines – Azure Portal の **[セキュリティ拡張機能]**
* Virtual Machines – Visual Studio のサーバー エクスプローラーの仮想マシン構成
* Virtual Machines および Cloud Services – マルウェア対策の[クラシック デプロイ モデル](https://msdn.microsoft.com/library/azure/ee460799.aspx)
* Virtual Machines および Cloud Services – マルウェア対策 PowerShell コマンドレット

Azure ポータルまたは PowerShell コマンドレットは、あらかじめ決められている固定の場所にある Azure システムに、マルウェア対策拡張機能パッケージ ファイルをプッシュします。 Azure ゲスト エージェント (またはファブリック エージェント) は、マルウェア対策拡張機能を起動し、入力として提供されたマルウェア対策の構成設定を適用します。 これにより、マルウェア対策サービスは既定またはカスタムの構成設定で有効になります。 カスタム構成を指定しないと、マルウェア対策サービスは既定の構成設定で有効になります。 詳細については、「[Microsoft Antimalware for Azure – Code Samples (Azure 向け Microsoft マルウェア対策 – コード サンプル)](https://aka.ms/amazsamples "Microsoft Antimalware For Azure Cloud Services and VMs Code Samples")」の "*マルウェア対策の構成*" に関するセクションをご覧ください。

Microsoft マルウェア対策クライアントは実行すると、最新の保護エンジンとシグネチャ定義をインターネットからダウンロードして、Azure システムに読み込みます。 Microsoft マルウェア対策サービスは、サービス関連のイベントをシステム OS イベント ログの "Microsoft マルウェア対策" イベント ソースに書き込みます。 イベントには、マルウェア対策クライアントの正常性状態、保護と修復の状態、新旧の構成設定、エンジンの更新とシグネチャの定義、その他が含まれます。

生成されたマルウェア対策イベント ログ イベントを Azure ストレージ アカウントに書き込むように、Cloud Service または Virtual Machine のマルウェア対策監視を構成できます。 マルウェア対策サービスは、Azure Diagnostics 拡張機能を使用して、Azure システムから顧客の Azure ストレージ アカウントのテーブルにマルウェア対策イベントを収集できます。

上記のシナリオの構成手順およびサポートされるオプションなどのデプロイ ワークフローについては、このドキュメントの「[マルウェア対策のデプロイ シナリオ](#antimalware-deployment-scenarios)」セクションを参照してください。

![Azure での Microsoft マルウェア対策](./media/antimalware/sec-azantimal-fig1.PNG)

> [!NOTE]
> 一方、Powershell/API と Azure Resource Manager テンプレートを使用して、Microsoft マルウェア対策拡張機能を含む仮想マシン スケール セットをデプロイできます。  既に実行中の仮想マシンに拡張機能をインストールする場合は、サンプル python スクリプト [vmssextn.py](https://github.com/gbowerman/vmsstools) を使用できます。 このスクリプトは、スケール セットの既存の拡張機能構成を取得し、VM スケール セットの既存の拡張機能リストに拡張機能を追加します。
>
>

### <a name="default-and-custom-antimalware-configuration"></a>マルウェア対策の既定の構成とカスタム構成

カスタム構成設定を指定しない場合、Azure Cloud Services または Virtual Machines のマルウェア対策は既定の構成設定を適用して有効になります。 既定の構成設定は、Azure 環境での実行に合わせてあらかじめ最適化されています。 Azure アプリケーションまたはサービスのデプロイメントでの必要に応じて既定の構成設定をカスタマイズし、他のデプロイメント シナリオに適用できます。

次の表は、マルウェア対策サービスで使用できる構成設定をまとめたものです。 [既定値] 列は既定の構成設定です。

![テーブル 1](./media/antimalware/sec-azantimal-tb18.PNG)

## <a name="antimalware-deployment-scenarios"></a>マルウェア対策のデプロイ シナリオ

ここでは、Azure Cloud Services および Virtual Machines の監視など、マルウェア対策を有効にして構成するシナリオについて説明します。

### <a name="virtual-machines---enable-and-configure-antimalware"></a>Virtual Machines - マルウェア対策の有効化と構成

#### <a name="deployment-while-creating-a-vm-using-the-azure-portal"></a>Azure Portal での VM の作成中のデプロイ

Azure Virtual Machines のプロビジョニングの間に Azure ポータルを使用して Virtual Machines の Microsoft マルウェア対策を有効化および構成するには、次の手順に従ってください。

1. Azure Portal ( <https://portal.azure.com> ) にサインインします。
2. 新しい仮想マシンを作成するには、 **[仮想マシン]** に移動し、 **[追加]** 、 **[Windows Server]** の順に選択します。
3. 使用する Windows Server のバージョンを選択します。
4. **作成** を選択します。
    ![仮想マシンの作成](./media/antimalware/create-vm.PNG)
5. **[名前]** 、 **[ユーザー名]** 、 **[パスワード]** を指定し、新しいリソース グループを作成するか既存のリソース グループを選択します。
6. **[OK]** を選びます。
7. VM サイズを選択します。
8. 次のセクションで、ニーズに合わせて適切な**拡張機能**を選択します。
9. **[拡張機能の追加]** を選択します。
10. **[新しいリソース]** で、 **[Microsoft マルウェア対策]** を選択します。
11. **[作成]**
12. **[拡張機能のインストール]** セクションで、ファイル、場所、およびプロセスの除外と、その他のスキャン オプションを構成できます。 **[OK]** を選択します。
13. **[OK]** を選択します。
14. **[設定]** セクションに戻り、 **[OK]** をクリックします。
15. **[作成]** 画面で、 **[OK]** を選択します。

#### <a name="deployment-using-the-visual-studio-virtual-machine-configuration"></a>Visual Studio の仮想マシン構成を使用したデプロイ

Visual Studio を使用して Microsoft マルウェア対策サービスを有効化および構成するには:

1. Visual Studio で Microsoft Azure に接続します。

2. **サーバー エクスプローラー**の **[Virtual Machines]** ノードで仮想マシンを選択します。

   ![Visual Studio での仮想マシンの構成](./media/antimalware/sec-azantimal-fig5.PNG)

3. **[構成]** を右クリックして、[仮想マシンの構成] ページを表示します

4. **[インストールされている拡張機能]** のドロップダウン リストから **[Microsoft マルウェア対策]** 拡張機能を選択し、既定のマルウェア対策構成で構成するには **[追加]** をクリックします。
    ![インストールされている拡張機能](./media/antimalware/sec-azantimal-fig6.PNG)
5. 既定のマルウェア対策構成をカスタマイズするには、インストールされている拡張機能の一覧でマルウェア対策拡張機能を選択 (強調表示) して、 **[構成]** をクリックします。

6. **[パブリック構成]** テキスト ボックスで、既定のマルウェア対策構成をサポートされる JSON 形式のカスタム構成に置き換えて [OK] をクリックします。

7. **[更新]** ボタンをクリックして、構成の更新を仮想マシンにプッシュします。

    ![仮想マシン構成拡張機能](./media/antimalware/sec-azantimal-fig7.PNG)

> [!NOTE]
>Visual Studio でのマルウェア対策の Virtual Machines 構成は、JSON 形式の構成のみをサポートします。 マルウェア対策の JSON 構成設定のテンプレートは、サポートされるマルウェア対策構成設定を示す「[Microsoft Antimalware For Azure - Code Samples (Azure 向け Microsoft マルウェア対策 – コード サンプル)](https://aka.ms/amazsamples "Microsoft Antimalware For Azure - Code Samples")」に含まれています。

#### <a name="deployment-using-powershell-cmdlets"></a>PowerShell コマンドレットを使用したデプロイ

Azure のアプリケーションまたはサービスでは、PowerShell コマンドレットを使用して Azure Virtual Machines の Microsoft マルウェア対策を有効化および構成できます。

マルウェア対策 PowerShell コマンドレットを使用して Microsoft マルウェア対策を有効化および構成するには:

1. PowerShell 環境を設定します - <https://github.com/Azure/azure-powershell> を参照してください。
2. 仮想マシンの Microsoft マルウェア対策を有効にして構成するには、[Set-AzureVMMicrosoftAntimalwareExtension マルウェア対策コマンドレット](https://docs.microsoft.com/powershell/module/servicemanagement/azure/set-azurevmmicrosoftantimalwareextension)を使用します。

> [!NOTE]
>Azure Virtual Machines でのマルウェア対策の構成は、JSON 形式の構成のみをサポートします。 マルウェア対策の JSON 構成設定のテンプレートは、サポートされるマルウェア対策構成設定を示す「[Microsoft Antimalware For Azure - Code Samples (Azure 向け Microsoft マルウェア対策 – コード サンプル)](https://aka.ms/amazsamples "Microsoft Antimalware For Azure - Code Samples")」に含まれています。

### <a name="enable-and-configure-antimalware-using-powershell-cmdlets"></a>PowerShell コマンドレットを使用したマルウェア対策の有効化と構成

Azure のアプリケーションまたはサービスでは、PowerShell コマンドレットを使用して Azure Cloud Services 向けの Microsoft マルウェア対策を有効化および構成できます。 Microsoft マルウェア対策は Cloud Services プラットフォームに無効状態でインストールされるので、Azure アプリケーションで有効化する必要があることに注意してください。

PowerShell コマンドレットを使用して Microsoft マルウェア対策を有効化および構成するには:

1. PowerShell 環境を設定します - <https://github.com/Azure/azure-powershell> を参照してください。
2. Cloud Service の Microsoft マルウェア対策を有効にして構成するには、[Set-AzureServiceAntimalwareExtension マルウェア対策コマンドレット](https://docs.microsoft.com/powershell/module/servicemanagement/azure/set-azureserviceantimalwareextension)を使用します。

マルウェア対策の XML 構成設定のテンプレートは、サポートされるマルウェア対策構成設定を示す「[Microsoft Antimalware For Azure - Code Samples (Azure 向け Microsoft マルウェア対策 – コード サンプル)](https://aka.ms/amazsamples "Microsoft Antimalware For Azure - Code Samples")」に含まれています。

### <a name="cloud-services-and-virtual-machines---configuration-using-powershell-cmdlets"></a>Cloud Services と Virtual Machines - PowerShell コマンドレットを用いた構成

Azure のアプリケーションまたはサービスでは、PowerShell コマンドレットを使用して、Cloud Services および Virtual Machines 向けの Microsoft マルウェア対策の構成を取得できます。

PowerShell コマンドレットを使用して Microsoft マルウェア対策の構成を取得するには:

1. PowerShell 環境を設定します - <https://github.com/Azure/azure-powershell> を参照してください。
2. **Virtual Machines の場合**:マルウェア対策の構成を取得するには、[Get-AzureVMMicrosoftAntimalwareExtension マルウェア対策コマンドレット](https://docs.microsoft.com/powershell/module/servicemanagement/azure/get-azurevmmicrosoftantimalwareextension)を使用します。
3. **Cloud Services の場合**:マルウェア対策の構成を取得するには、[Get-AzureServiceAntimalwareConfig マルウェア対策コマンドレット](https://docs.microsoft.com/powershell/module/servicemanagement/azure/get-azureserviceantimalwareconfig)を使用します。

### <a name="remove-antimalware-configuration-using-powershell-cmdlets"></a>PowerShell コマンドレットを使用したマルウェア対策の構成の削除

Azure アプリケーションまたはサービスでは、Cloud Service または Virtual Machine に関連付けられている関連する Azure マルウェア対策および診断サービスの拡張機能から、マルウェア対策の構成および関連付けられているマルウェア対策監視構成を削除できます。

PowerShell コマンドレットを使用して Microsoft マルウェア対策を削除するには:

1. PowerShell 環境を設定します - <https://github.com/Azure/azure-powershell> を参照してください。
2. **Virtual Machines の場合**:[Remove-AzureVMMicrosoftAntimalwareExtension マルウェア対策コマンドレット](https://docs.microsoft.com/powershell/module/servicemanagement/azure/remove-azurevmmicrosoftantimalwareextension)を使用します。
3. **Cloud Services の場合:** [Remove-AzureServiceAntimalwareExtension マルウェア対策コマンドレット](https://docs.microsoft.com/powershell/module/servicemanagement/azure/remove-azureserviceantimalwareextension)を使用します。

Azure プレビュー ポータルを使用して仮想マシンのマルウェア対策イベント収集を**有効にする**には:

1. [仮想マシン] ブレードの監視レンズのどこかをクリックします。
2. [メトリック] ブレードの [診断] コマンドをクリックします。
3. **[状態]** で [ON] を選択し、Windows イベント システムのオプションをオンにします
4. 。 一覧の他のオプションは、すべてオフにしても、アプリケーション サービスのニーズに応じて有効のままにしてもかまいません。
5. 「エラー」、「警告」、「情報」などのマルウェア対策イベント カテゴリが、Azure ストレージ アカウントに収集されます。

マルウェア対策のイベントが、Windows イベント システム ログから Azure ストレージ アカウントに収集されます。 適切なストレージ アカウントを選択することにより、マルウェア対策のイベントを収集するように仮想マシンのストレージ アカウントを構成できます。

![メトリックと診断](./media/antimalware/sec-azantimal-fig8.PNG)

> [!NOTE]
> Azure マルウェア対策の診断ログを記録する方法の詳細については、「[Enabling Diagnostics Logging for Azure Antimalware (Azure マルウェア対策の診断ログの記録の有効化)](https://blogs.msdn.microsoft.com/azuresecurity/2016/04/19/enabling-diagnostics-logging-for-azure-antimalware/)」を参照してください。

### <a name="enable-and-configure-antimalware-monitoring-using-powershell-cmdlets"></a>PowerShell コマンドレットを使用したマルウェア対策の監視の有効化と構成

マルウェア対策 PowerShell コマンドレットを使用して、Azure Diagnostics を用いた Cloud Service または Virtual Machine の Microsoft マルウェア対策イベントの収集を有効にできます。 システム イベント ログ ソース “Microsoft マルウェア対策” から Azure ストレージ アカウントにイベントをキャプチャするように、Azure Diagnostics 拡張機能を構成できます。 「エラー」、「警告」、「情報」などのマルウェア対策イベント カテゴリが、Azure ストレージ アカウントに収集されます。

PowerShell コマンドレットを使用して Azure ストレージ アカウントへのマルウェア対策イベント収集を有効にするには:

1. PowerShell 環境を設定します - <https://github.com/Azure/azure-powershell> を参照してください
2. **Virtual Machines の場合** - Monitoring ON オプションを指定して [Set-AzureVMMicrosoftAntimalwareExtension マルウェア対策コマンドレット](https://docs.microsoft.com/powershell/module/servicemanagement/azure/set-azurevmmicrosoftantimalwareextension)を使用します。
3. **Cloud Services の場合** - Monitoring ON オプションを指定して [Set-AzureServiceAntimalwareExtension マルウェア対策コマンドレット](https://docs.microsoft.com/powershell/module/servicemanagement/azure/set-azureserviceantimalwareextension)を使用します。

マルウェア対策の監視を有効にするために構成した Azure Storage アカウントの *WADWindowsEventLogsTable* テーブルで、マルウェア対策の未加工のイベントを見ることができます。 これにより、マルウェア対策サービスの正常性の詳細など、マルウェア対策イベント収集が動作していることを確認できます。 ストレージ アカウントからマルウェア対策イベントを抽出する方法についてのサンプル コードを含む詳細については、「[Microsoft Antimalware For Azure - Code Samples]」(Azure 向け Microsoft マルウェア対策 – コード サンプル) (https://aka.ms/amazsamples "Microsoft Antimalware For Azure - Code Samples") を参照してください。
