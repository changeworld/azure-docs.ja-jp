<properties
	pageTitle="VM の割り当てエラーのトラブルシューティング |Microsoft Azure"
	description="Azure で VM を作成、再起動、またはサイズ変更するときの割り当てエラーのトラブルシューティング"
	services="virtual-machines, azure-resource-manager"
	documentationCenter=""
	authors="jiangchen79"
	manager="felixwu"
	editor=""
	tags="top-support-issue"/>

<tags
	ms.service="virtual-machines"
	ms.workload="na"
	ms.tgt_pltfrm="ibiza"
	ms.devlang="na"
	ms.topic="article"
	ms.date="10/29/2015"
	ms.author="kenazk"/>



# Azure で VM を作成、再起動、またはサイズ変更するときの割り当てエラーのトラブルシューティング

VM を作成するとき、停止した (割り当て解除した) VM を再起動するとき、または VM のサイズを変更するとき、Microsoft Azure はコンピューティング リソースをサブスクリプションに割り当てます。これらの操作をしているときに、Azure サブスクリプションの制限に達していなくても、エラーが発生する場合があります。この記事では、いくつかの一般的な割り当てエラーの原因を説明し、可能な改善方法を提案します。この情報は、サービスのデプロイを計画する場合にも役立ちます。

この記事で Azure の問題に対処できない場合は、[MSDN と Stack Overflow の Azure フォーラム](https://azure.microsoft.com/support/forums/)を参照してください。問題をこれらのフォーラムまたは Twitter の @AzureSupport に投稿できます。また、[Azure サポート](http://azure.microsoft.com/support/options/) サイトの **[サポートの要求]** を選択して、Azure サポート要求を提出することもできます。

「一般的な割り当てエラーのトラブルシューティング」のセクションでは、一般的な問題を解決する手順を示します。「特定の割り当てエラーのシナリオのトラブルシューティング」のセクションでは、特定のエラー メッセージごとに問題の解決の手順を説明します。作業を開始する前に、割り当てのしくみと、割り当てエラーの発生理由を理解するための背景情報を以下に示します。

## 背景情報
### 割り当てのしくみ
Azure データセンターのサーバーは、クラスターにパーティション分割されています。通常、割り当て要求は複数のクラスターで試行されますが、割り当て要求の特定の制約によって、Azure プラットフォームが要求を 1 つのクラスターだけで試行するように強制されることがあります。この記事では、このことを "クラスターに固定されている" と言います。次の図 1 は、複数のクラスターで試行される通常の割り当てを示しています。図 2 は、クラスター 2 に固定されている割り当てを示しています。これは、既存のクラウド サービス CS\_1 または可用性セットがクラスター 2 でホストされているためです。![Allocation Diagram](./media/virtual-machines-allocation-failure/Allocation1.png)

### 割り当てエラーが発生する理由
割り当て要求がクラスターに固定されている場合、利用可能なリソース プールが小さくなるため、空きリソースを見つけられない可能性が高くなります。さらに、割り当て要求がクラスターに固定されていて、そのクラスターでは要求されたリソースの種類がサポートされていない場合、クラスターに空きリソースがあっても、要求は失敗します。次の図 3 は、唯一の候補であるクラスターに空きリソースがないため、固定された割り当てがエラーになる場合を示しています。図 4 は、唯一の候補であるクラスターに空きリソースがあるものの、要求された VM サイズをサポートしていないため、固定された割り当てがエラーになる場合を示しています。

![Pinned Allocation Failure](./media/virtual-machines-allocation-failure/Allocation2.png)

## 一般的なトラブルシューティングの手順
### クラシック デプロイ モデルでの一般的な割り当てエラーのトラブルシューティング

仮想マシンでの割り当てエラーの多くを解決するには、以下の手順が役立ちます。

- VM を別の VM サイズに変更します。<br> [すべて参照]、[仮想マシン (クラシック)]、仮想マシン、[設定]、**[サイズ]** の順にクリックします。詳細な手順については、「[Resize the virtual machine (仮想マシンのサイズの変更)](https://msdn.microsoft.com/library/dn168976.aspx)」を参照してください。

- クラウド サービスからすべての VM を削除して、VM を再作成します。<br> [すべて参照]、[仮想マシン (クラシック)]、仮想マシン、[削除] の順にクリックします。次に、[新規]、[Compute]、[仮想マシン イメージ] の順にクリックします。

### リソース マネージャー デプロイ モデルでの一般的な割り当てエラーのトラブルシューティング

仮想マシンでの割り当てエラーの多くを解決するには、以下の手順が役立ちます。

- 同じ可用性セット内のすべての VM を停止および割り当て解除し、それぞれを再起動します。<br> 停止するには: [リソース グループ]、対象とするリソース グループ、[リソース]、対象とする可用性セット、[仮想マシン]、対象とする Virtual Machines、[停止] の順にクリックします。

	すべての VM を停止した後で、最初の VM を選択し、[起動] をクリックします。

## 詳細なトラブルシューティングの手順
### クラシック デプロイ モデルでの特定の割り当てエラー シナリオのトラブルシューティング
以下に、割り当て要求が固定されることになる一般的な割り当てシナリオを示します。この記事の後の方で、各シナリオについて説明します。

- VM のサイズの変更、または既存のクラウド サービスへの VM またはロール インスタンスの追加
- 停止した (割り当て解除した) VM の再起動 - 部分的割り当て解除
- 停止した (割り当て解除した) VM の再起動 - 完全割り当て解除
- ステージング/運用デプロイ (サービスとしてのプラットフォームのみ)
- アフィニティ グループ - VM/サービス近接性
- アフィニティ グループ ベースの仮想ネットワーク

割り当てエラーを受け取った場合は、説明されているいずれかのシナリオに該当するかどうかを確認してください。Azure プラットフォームによって返される割り当てエラーを使用すると、対応するシナリオを特定できます。要求が固定されている場合は、固定している制約の一部を削除して、要求の対象となるクラスターを多くしてみてください。割り当てが成功する確率が高くなります。

一般に、エラーが "要求された VM のサイズがサポートされていない" ことを示してはいない場合は、後で再試行することができます。そのクラスターで要求に応えるための十分なリソースが解放される可能性があるためです。要求された VM サイズがサポートされていないことが問題である場合は、別の VM サイズを試してみます。そうでない場合、唯一のオプションは、固定している制約を削除することです。

2 つの一般的なエラー シナリオは、アフィニティ グループと関連しています。以前は、アフィニティ グループは、VM/サービス インスタンスの近接性を提供したり、Virtual Network (VNet) を作成できるようにするために使用されていました。リージョン仮想ネットワークの導入により、アフィニティ グループは Virtual Network の作成に必要ではなくなりました。Azure インフラストラクチャでのネットワーク待機時間の短縮により、VM/サービス近接性のためにアフィニティ グループを使用する必要性も変わりました。

次の図 5 は、(固定された) 割り当てシナリオの分類を示しています。![Pinned Allocation Taxonomy](./media/virtual-machines-allocation-failure/Allocation3.png)

> [AZURE.NOTE]割り当てシナリオごとに示されているエラーは、省略形です。詳細なエラー文字列については、「[付録](#appendix)」を参照してください。

#### 割り当てシナリオ: VM のサイズの変更、または既存のクラウド サービスへの VM またはロール インスタンスの追加
**エラー**

Upgrade\_VMSizeNotSupported* または GeneralError*

**クラスターの固定の原因**

VM のサイズの変更、または既存のクラウド サービスへの VM またはロール インスタンスの追加の要求は、既存のクラウド サービスをホストしている元のクラスターで試行する必要があります。新しいクラウド サービスを作成すると、Azure プラットフォームは、空きリソースを持つ別のクラスターや、要求された VM サイズをサポートしているクラスターを検索できます。

**対処法**

エラーが Upgrade\_VMSizeNotSupported* である場合は、別の VM サイズを試してみてください。別の VM サイズを使用できないものの、別の仮想 IP アドレス (VIP) を使用できる場合は、新しい VM をホストする新しいクラウド サービスを作成し、新しいクラウド サービスを既存の VM が実行されているリージョン仮想ネットワークに追加します。既存のクラウド サービスがリージョン仮想ネットワークを使用しない場合も、新しいクラウド サービス用の新しい Virtual Network を作成し、[既存の VNet を新しい VNet](https://azure.microsoft.com/blog/vnet-to-vnet-connecting-virtual-networks-in-azure-across-different-regions/) に接続できます。詳細については、[リージョン仮想ネットワーク](http://azure.microsoft.com/blog/2014/05/14/regional-virtual-networks/)に関するページを参照してください。

エラーが GeneralError* である場合は、リソースの種類 (特定の VM サイズなど) がクラスターでサポートされているものの、現時点ではクラスターに空きリソースがないと考えられます。上の場合と同じように、新しいクラウド サービスを作成することによって、必要なコンピューティング リソースを追加してみます (新しいクラウド サービスは、別の VIP を使用する必要がある点に注意してください)。その後、リージョン仮想ネットワークを使用して、Cloud Services に接続します。

#### 割り当てシナリオ: 停止した (割り当て解除した) VM の再起動 - 部分的割り当て解除

**エラー**

GeneralError*

**クラスターの固定の原因**

**部分的**割り当て解除とは、クラウド サービス内の VM **すべてではなく**、1 つ以上の VM を停止 (割り当て解除) したことを意味します。VM を停止 (割り当て解除) すると、関連付けられているリソースが解放されます。そのため、停止された (割り当て解除された) VM を再起動すると、新しい割り当てが要求されます。部分的に割り当て解除されたクラウド サービスで VM を再起動することは、既存のクラウド サービスに VM を追加することと同じであり、割り当て要求は既存のクラウド サービスをホストしている元のクラスターで試行する必要があります。別のクラウド サービスを作成すると、Azure プラットフォームは、空きリソースを持つ別のクラスターや、要求された VM サイズをサポートしているクラスターを検索できます。

**対処法**

別の VIP を使用できる場合は、停止 (割り当て解除) された VM を削除し (ただし、関連付けられているディスクは保持し)、別のクラウド サービスを通じて VM を追加し直します。Cloud Services に接続するには、リージョン仮想ネットワークを使用します。1. 既存のクラウド サービスがリージョン仮想ネットワークを使用している場合は、単に新しいクラウド サービスを同じ Virtual Network に追加します。2.既存のクラウド サービスがリージョン仮想ネットワークを使用しない場合は、新しいクラウド サービス用の新しい Virtual Network を作成し、[既存の VNet を新しい VNet](https://azure.microsoft.com/blog/vnet-to-vnet-connecting-virtual-networks-in-azure-across-different-regions/) に接続します。詳細については、[リージョン仮想ネットワーク](http://azure.microsoft.com/blog/2014/05/14/regional-virtual-networks/)に関するページを参照してください。

#### 割り当てシナリオ: 停止した (割り当て解除した) VM の再起動 - 完全割り当て解除
**エラー**

GeneralError*

**クラスターの固定の原因**

**完全**割り当て解除とは、クラウド サービス内の**すべて**の VM を停止 (割り当て解除) したことを意味します。現時点では、これらの VM を再起動するための割り当て要求は、クラウド サービスをホストしている元のクラスターで試行する必要があります。新しいクラウド サービスを作成すると、Azure プラットフォームは、空きリソースを持つ別のクラスターや、要求された VM サイズをサポートしているクラスターを検索できます。

**対処法**

別の VIP を使用できる場合は、停止 (割り当て解除) された元の VM を削除し (ただし、関連付けられているディスクは保持し)、対応するクラウド サービスを削除します (関連付けられているコンピューティング リソースは、VM を停止 (割り当て解除) したときに既に解放されています)。新しいクラウド サービスを作成し、VM を追加し直します。

#### 割り当てシナリオ: ステージング/運用デプロイ (サービスとしてのプラットフォームのみ)
**エラー**

New\_General* または New\_VMSizeNotSupported*

**クラスターの固定の原因**

クラウド サービスのステージング デプロイと運用デプロイは、同じクラスターでホストされます。2 つ目のデプロイを追加する場合、対応する割り当て要求は、最初のデプロイをホストする同じクラスター内で試行されます。

**対処法**

可能であれば、最初のデプロイと元のクラウド サービスを削除し、クラウド サービスを再デプロイします。この操作によって、最初のデプロイが、両方のデプロイのための十分な空きリソースを持つクラスターや、要求された VM サイズをサポートしているクラスターに配置される場合があります。

#### 割り当てシナリオ: アフィニティ グループ - VM/サービス近接性
**エラー**

New\_General* または New\_VMSizeNotSupported*

**クラスターの固定の原因**

アフィニティ グループに割り当てられているすべてのコンピューティング リソースは、1 つのクラスターに結び付けられています。そのアフィニティ グループでの新しいコンピューティング リソース要求は、既存のリソースがホストされているのと同じクラスターで試行されます。新しいリソースが新しいクラウド サービスを通じて作成された場合でも、既存のクラウド サービスを通じて作成された場合でも、そのようになります。

**対処法**

必要でなければアフィニティ グループを使用しないか、コンピューティング リソースを複数のアフィニティ グループにグループ化してみます。

#### 割り当てシナリオ: アフィニティ グループ ベースの仮想ネットワーク
**エラー**

New\_General* または New\_VMSizeNotSupported*

**クラスターの固定の原因**

リージョン仮想ネットワークが発表される以前は、Virtual Network をアフィニティ グループに関連付ける必要がありました。その結果、アフィニティ グループに配置されるコンピューティング リソースは、上の「割り当てシナリオ: アフィニティ グループ - VM/サービス近接性」のセクションで説明したのと同じ制約を受けます。つまり、コンピューティング リソースは 1 つのクラスターに結び付けられます。

**対処法**

アフィニティ グループが必要ない場合は、追加する新しいリソースのための新しいリージョン仮想ネットワークを作成し、[既存の VNet を新しい VNet に接続](https://azure.microsoft.com/blog/vnet-to-vnet-connecting-virtual-networks-in-azure-across-different-regions/)します。詳細については、[リージョン仮想ネットワーク](http://azure.microsoft.com/blog/2014/05/14/regional-virtual-networks/)に関するページを参照してください。

または、[アフィニティ グループ ベースの Virtual Network をリージョン仮想ネットワークに移行](http://azure.microsoft.com/blog/2014/11/26/migrating-existing-services-to-regional-scope/)し、必要なリソースをもう一度追加してみることもできます。

### Azure リソース マネージャー デプロイ モデルでの特定の割り当てエラー シナリオのトラブルシューティング
以下に、割り当て要求が固定されることになる一般的な割り当てシナリオを示します。この記事の後の方で、各シナリオについて説明します。

- VM のサイズの変更、または既存のクラウド サービスへの VM またはロール インスタンスの追加
- 停止した (割り当て解除した) VM の再起動 - **部分的**割り当て解除
- 停止した (割り当て解除した) VM の再起動 - **完全**割り当て解除

割り当てエラーを受け取った場合は、説明されているいずれかのシナリオに該当するかどうかを確認してください。Azure プラットフォームによって返される割り当てエラーを使用すると、対応するシナリオを特定できます。要求が既存のクラスターに固定されている場合は、固定している制約の一部を削除して、要求の対象となるクラスターを多くしてみてください。割り当てが成功する確率が高くなります。

一般に、エラーが "要求された VM のサイズがサポートされていない" ことを示してはいない場合は、後で再試行することができます。そのクラスターで要求に応えるための十分なリソースが解放される可能性があるためです。要求された VM サイズがサポートされていないことが問題である場合は、以下の回避方法を参照してください。

#### 割り当てシナリオ: VM のサイズの変更、または既存の可用性セットへの VM の追加
**エラー**

Upgrade\_VMSizeNotSupported* または GeneralError*

**クラスターの固定の原因**

VM のサイズの変更、または既存の可用性セットへの VM の追加の要求は、既存の可用性セットをホストしている元のクラスターで試行する必要があります。新しい可用性セットを作成すると、Azure プラットフォームは、空きリソースを持つ別のクラスターや、要求された VM サイズをサポートしているクラスターを検索できます。

**対処法**

エラーが Upgrade\_VMSizeNotSupported* である場合は、別の VM サイズを試してみてください。別の VM サイズを使用できない場合は、可用性セット内のすべての VM を停止します。こうすることで、仮想マシンのサイズを変更し、必要な VM サイズをサポートしているクラスターに VM を割り当てることができます。

エラーが GeneralError* である場合は、リソースの種類 (特定の VM サイズなど) がクラスターでサポートされているものの、現時点ではクラスターに空きリソースがないと考えられます。VM を別の可用性セットの一部にできる場合は、新しい VM を別の可用性セット (同じリージョン内) に作成します。この新しい VM は、同じ Virtual Network に追加できます。

#### 割り当てシナリオ: 停止した (割り当て解除した) VM の再起動 - 部分的割り当て解除
**エラー**

GeneralError*

**クラスターの固定の原因**

**部分的**割り当て解除とは、可用性セット内の VM **すべてではなく**、1 つ以上の VM を停止 (割り当て解除) したことを意味します。VM を停止 (割り当て解除) すると、関連付けられているリソースが解放されます。そのため、停止された (割り当て解除された) VM を再起動すると、新しい割り当てが要求されます。部分的に割り当て解除された可用性セットで VM を再起動することは、既存の可用性セットに VM を追加することと同じであり、割り当て要求は既存の可用性セットをホストしている元のクラスターで試行する必要があります。

**対処法**

最初の VM を再起動する前に、可用性セット内のすべての VM を停止してみてください。こうすることで、新しい割り当ての試行が実行され、利用可能な容量を持つ新しいクラスターを選択できることが保証されます。

#### 割り当てシナリオ: 停止した (割り当て解除した) VM の再起動 - 完全割り当て解除
**エラー**

GeneralError*

**クラスターの固定の原因**

**完全**割り当て解除とは、可用性セット内の**すべて**の VM を停止 (割り当て解除) したことを意味します。これらの VM を再起動するための割り当て要求は、目的のサイズをサポートしているすべてのクラスターを対象とします。

**対処法**

割り当てる新しい VM サイズを選択してみます。または、後でもう一度やり直してみます。

## 付録
### エラーの文字列の参照
**New\_VMSizeNotSupported***

デプロイ要求の制約条件のため、このデプロイに必要な VM サイズ (または VM サイズの組み合わせ) をプロビジョニングできません。可能であれば、仮想ネットワークのバインドなどの制約条件の緩和、他のデプロイがなくアフィニティ グループが別のホストされるサービスへのデプロイ、アフィニティ グループのないホストされるサービスへのデプロイ、別のリージョンへのデプロイのいずれかを試してください。

**New\_General***

割り当てに失敗しました。要求の制約条件を満たしていません。要求されている新しいサービスのデプロイがアフィニティ グループにバインドされているか、Virtual Network を対象としています。または、このホストされるサービスに既存のデプロイがあります。ここに挙げた条件に該当する場合には、新しいデプロイが特定の Azure リソースに制限されます。後でもう一度やり直すか、VM サイズを小さくするか、ロール インスタンスの数を減らしてください。可能な場合には、上に挙げた制約条件を削除することや、別のリージョンにデプロイすることもできます。

**Upgrade\_VMSizeNotSupported***

デプロイをアップグレードできません。要求された VM サイズ XXX は、既存のデプロイをサポートするリソースの中では用意できない可能性があります。後でもう一度やり直すか、VM サイズを変更するか、ロール インスタンスの数を減らしてみてください。または、空のホストされるサービスの下で、新しいアフィニティ グループを指定するかアフィニティ グループのバインドなしを指定して、デプロイを作成してください。

**GeneralError***

サーバーで内部エラーが発生しました。要求を再試行してください。または、サービスの割り当てを生成できませんでした。

<!---HONumber=AcomDC_1217_2015-->