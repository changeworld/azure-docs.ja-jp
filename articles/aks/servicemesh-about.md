---
title: サービス メッシュについて
description: サービス メッシュの概要、アーキテクチャと機能、デプロイするサービス メッシュを選択するときに考慮する必要がある基準について説明します。
author: paulbouwer
ms.topic: article
ms.date: 10/09/2019
ms.author: pabouwer
ms.openlocfilehash: eca49a3fac1ea0398ebe1d05bde20fbca3c81232
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/28/2020
ms.locfileid: "77594313"
---
# <a name="about-service-meshes"></a>サービス メッシュについて

サービス メッシュは、ワークロードに対するトラフィック管理、回復性、ポリシー、セキュリティ、強力な ID、可観測性などの機能を提供します。 アプリケーションはこれらの運用上の機能から切り離され、サービス メッシュがそれらをアプリケーション レイヤーからインフラストラクチャ レイヤーに移動します。

## <a name="scenarios"></a>シナリオ

次に示すのは、サービス メッシュを使用しているときにワークロードに対して有効にできるシナリオの一部です。

- **クラスター内のすべてのトラフィックの暗号化** - クラスター内の指定されたサービス間で相互 TLS を有効にします。 これは、ネットワーク境界でのイングレスとエグレスに拡張できます。 アプリケーション コードとインフラストラクチャの変更を必要とせずに、既定でのセキュリティ保護オプションを提供します。

- **カナリアおよびフェーズ ロールアウト** - クラスター内の一連の新しいサービスにルーティングされるトラフィックのサブセットの条件を指定します。 カナリア リリースのテストが成功したら、条件付きルーティングを削除し、新しいサービスへのすべてのトラフィックの割合を徐々に増やします。 最終的には、すべてのトラフィックが新しいサービスに送信されます。

- **トラフィック管理と操作** - 特定の配信元からのサービスのすべてのトラフィックをレート制限するポリシーをサービスに対して作成します。 つまり、指定されたサービス間の障害のクラスに再試行戦略を適用するポリシーです。 移行中または問題をデバッグするために、新しいバージョンのサービスにライブ トラフィックをミラーリングします。 テスト環境のサービス間にフォールトを挿入して、回復性をテストします。

- **可観測性** - サービス間のトラフィックがどのように接続されているかについての分析情報を得ることができます。 クラスター内のすべてのトラフィックのメトリック、ログ、およびトレースと、イングレス/エグレスを取得します。 アプリケーションに分散トレース機能を追加します。

## <a name="architecture"></a>Architecture

サービス メッシュは、通常、コントロール プレーンとデータ プレーンで構成されます。

**コントロール プレーン**には、サービス メッシュの管理をサポートするさまざまなコンポーネントがあります。 これには通常、UI や API などの管理インターフェイスが含まれます。 また、通常は、ルールを管理するコンポーネントと、サービス メッシュが特定の機能を実装する方法を定義するポリシー定義もあります。 さらに、mTLS の強力な ID や証明書などのセキュリティの側面を管理するコンポーネントもあります。 サービス メッシュには、ワークロードからメトリックとテレメトリを収集して集計する、メトリックまたは可観測性コンポーネントも含まれます。

**データ プレーン**は、通常、ワークロードにサイドカーとして透過的に挿入されるプロキシで構成されます。 このプロキシは、ワークロードを含むポッドとの間のすべてのネットワーク トラフィックを制御するように構成されています。 これにより、プロキシは、mTLS 経由でトラフィックをセキュリティで保護し、トラフィックを動的にルーティングし、トラフィックにポリシーを適用し、メトリックとトレース情報を収集するように構成することができます。 

![一般的なサービス メッシュのアーキテクチャ](media/servicemesh/typical-architecture.png)

## <a name="capabilities"></a>機能

各サービス メッシュは自然に適合し、特定のシナリオをサポートすることに重点を置いていますが、通常は、ほとんどの場合、すべてではないにしても多くの次の機能を実装します。

### <a name="traffic-management"></a>トラフィック管理 

- **プロトコル** – レイヤー 7 (http、grpc)
- **動的ルーティング** – 条件、重み付け、ミラーリング
- **回復性** – タイムアウト、再試行、サーキット ブレーカー
- **ポリシー** – アクセス制御、レート制限、クォータ
- **テスト** – フォールト挿入

### <a name="security"></a>Security

- **暗号化** – mTLS、証明書管理、外部 CA
- **強力な ID** – SPIFFE または類似
- **認証** – 認証、承認

### <a name="observability"></a>可観測性

- **メトリック** – ゴールデン メトリック、prometheus、grafana
- **トレース** – ワークロード間のトレース
- **トラフィック** – クラスター、イングレス/エグレス

### <a name="mesh"></a>メッシュ

- **サポートされているコンピューティング** – Kubernetes、仮想マシン
- **マルチクラスター** – ゲートウェイ、フェデレーション

## <a name="selection-criteria"></a>選択条件

サービス メッシュを選択する前に、要件とサービス メッシュをインストールする理由を理解していることを確認してください。 次の質問をしてみてください。

- **イングレス コントローラーはニーズに十分対応しているか。** - 必要なシナリオに対応するには、a/b テストやイングレスでのトラフィックの分割などの機能が必要な場合があります。 環境に利点のない複雑さを加えないでください。

- **ワークロードと環境は追加のオーバーヘッドを許容するか。** - サービス メッシュをサポートするために必要な追加のコンポーネントはすべて、CPU やメモリなどの追加のリソースを必要とします。 さらに、すべてのプロキシとそれに関連付けられているポリシー チェックにより、トラフィックに待機時間が追加されます。 待機時間が非常に重要なワークロードがある場合、またはサービス メッシュ コンポーネントに対応するための追加リソースを提供できない場合は、もう一度検討してください。

- **これは不必要に複雑さを加えるものか。** - サービス メッシュをインストールする理由が、ビジネス チームや運用チームにとって必ずしも重要ではない機能を利用することである場合は、インストール、メンテナンス、および構成の複雑さが増すかどうかを検討してください。

- **これは漸進的アプローチで採用できるか。** - 多くの機能を提供するサービス メッシュの中には、より漸進的なアプローチを採用するものがあります。 確実に成功するためには、必要なコンポーネントだけをインストールしてください。 自信を持って追加の機能が必要になったら、それらを調査してください。 最初から*すべてのもの*をインストールするという衝動は抑えてください。

慎重に検討したうえで、必要な機能を提供するためにサービス メッシュが必要であると判断した場合、次に決定することは*どのサービス メッシュか*ということです。

次の点を考慮して、要件に最も合うものを検討してください。 これにより、ご使用の環境とワークロードに最適な方法を見つけることができます。 「[次のステップ](#next-steps)」のセクションでは、特定のサービス メッシュに関する詳細情報と、これらの機能をこれらの領域にマップする方法について説明します。

- **技術** - トラフィック管理、ポリシー、セキュリティ、可観測性

- **ビジネス** - 法人向けサポート、基盤 (CNCF)、OSS ライセンス、ガバナンス

- **運用** - インストール/アップグレード、リソース要件、パフォーマンス要件、統合 (メトリック、テレメトリ、ダッシュボード、ツール、SMI)、混合ワークロード (Linux と Windows のノード プール)、コンピューティング (Kubernetes、仮想マシン)、マルチクラスター

- **セキュリティ** - 認証、ID、証明書の管理とローテーション、プラグ可能な外部 CA


## <a name="next-steps"></a>次のステップ

次のドキュメントでは、Azure Kubernetes Service (AKS) で試すことができるサービス メッシュの詳細について説明しています。

> [!div class="nextstepaction"]
> [Istio に関する詳細情報 ...][istio-about]

> [!div class="nextstepaction"]
> [Linkerd に関する詳細情報 ...][linkerd-about]

> [!div class="nextstepaction"]
> [Consul に関する詳細情報 ...][consul-about]

Kubernetes のサービス メッシュの標準インターフェイスである Service Mesh Interface (SMI) について確認することもできます。

- [Service Mesh Interface (SMI)][smi]


<!-- LINKS - external -->
[smi]: https://smi-spec.io/

<!-- LINKS - internal -->
[istio-about]: ./servicemesh-istio-about.md
[linkerd-about]: ./servicemesh-linkerd-about.md
[consul-about]: ./servicemesh-consul-about.md