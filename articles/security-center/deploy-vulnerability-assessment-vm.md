---
title: Azure およびハイブリッドのマシンに対する Security Center の統合された脆弱性評価
description: ご使用の Azure マシンに脆弱性評価ソリューションをインストールすると、Azure Security Center で Azure および仮想マシンの保護に役立つ推奨事項が表示されます。
services: security-center
documentationcenter: na
author: memildin
manager: rkarlin
ms.service: security-center
ms.devlang: na
ms.topic: how-to
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 02/18/2021
ms.author: memildin
ms.openlocfilehash: a675fd3a94d35beed900de3af63086123e489141
ms.sourcegitcommit: 4b7a53cca4197db8166874831b9f93f716e38e30
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/04/2021
ms.locfileid: "102100561"
---
# <a name="azure-defenders-integrated-vulnerability-assessment-solution-for-azure-and-hybrid-machines"></a>Azure およびハイブリッドのマシンに対する Azure Defender の統合された脆弱性評価

すべてのサイバーリスクとセキュリティプログラムの中核となるコンポーネントは、脆弱性の特定と分析です。 

接続されているマシンで脆弱性評価ツールが確実に実行されるように、Security Center によって定期的にチェックされます。

脆弱性評価ソリューションがデプロイされていないマシンが見つかった場合、Security Center によって次のようなセキュリティの推奨事項が生成されます。

**脆弱性評価ソリューションを仮想マシンで有効にする必要がある**

この推奨事項を使用して、ご使用の Azure 仮想マシンと Azure Arc 対応のハイブリッド マシンに脆弱性評価ソリューションをデプロイします。

ニーズと予算に最適な脆弱性評価ソリューションをデプロイします。

- **統合された脆弱性評価 (Qualys を利用)** - Azure Defender には、ご使用のマシンに対する脆弱性スキャンが含まれており、追加費用はかかりません。 Qualys ライセンスも Qualys アカウントも必要ありません。すべてが Security Center 内でシームレスに処理されます。 このページでは、このスキャナーの詳細とデプロイする手順について説明します。

    > [!TIP]
    > 統合された脆弱性評価ソリューションは、Azure 仮想マシンとハイブリッド マシンの両方に対応しています。 脆弱性評価スキャナーをオンプレミスとマルチクラウドのマシンにデプロイするには、「[Azure 以外のマシンを Security Center に接続する](quickstart-onboard-machines.md)」の説明に従って、Azure Arc を使用して最初にそれらを Azure に接続します。
    >
    > Security Center の統合された脆弱性評価ソリューションは、Azure Arc とシームレスに連携します。Azure Arc をデプロイしている場合は、Security Center にご使用のマシンが表示されます。Log Analytics エージェントは必要ありません。

- **ライセンス持ち込み (BYOL) ソリューション** - Security Center では他のベンダーからのツールの統合がサポートされていますが、ライセンスのコスト、デプロイ、および構成について対処する必要があります。 Security Center でツールをデプロイすると、ツールが不足している Azure 仮想マシンについての情報が得られます。 また、Security Center 内で結果を表示することもできます。 Azure Defender で含まれている Qualys ライセンスではなく、組織のプライベート Qualys または Rapid7 ライセンスを使用する場合は、[BYOL ソリューションをデプロイする方法](deploy-vulnerability-assessment-byol-vm.md)に関するページを参照してください。


## <a name="availability"></a>可用性

|側面|詳細|
|----|:----|
|リリース状態:|一般提供 (GA)|
|マシンの種類 (ハイブリッド シナリオ):|![はい](./media/icons/yes-icon.png) Azure の仮想マシン<br>![はい](./media/icons/yes-icon.png) Azure Arc 対応マシン|
|価格:|[Azure Defender for servers](defender-for-servers-introduction.md) が必要|
|必要なロールとアクセス許可:|**リソース所有者** は、スキャナーをデプロイできます<br>**セキュリティ閲覧者** は、結果を表示できます|
|クラウド:|![Yes](./media/icons/yes-icon.png) 商用クラウド<br>![No](./media/icons/no-icon.png) ナショナル/ソブリン (US Gov、China Gov、その他の Gov)|
|||

## <a name="overview-of-the-integrated-vulnerability-scanner"></a>統合された脆弱性スキャナーの概要

Azure Security Center に含まれている脆弱性スキャナーは、Qualys を利用しています。 Qualys のスキャナーは、脆弱性をリアルタイムで識別するための主要なツールの 1 つです。 [Azure Defender for servers](defender-for-servers-introduction.md) でのみ使用できます。 Qualys ライセンスも Qualys アカウントも必要ありません。すべてが Security Center 内でシームレスに処理されます。

### <a name="how-the-integrated-vulnerability-scanner-works"></a>統合された脆弱性スキャナーの動作

脆弱性スキャナー拡張機能は、次のように機能します。

1. **デプロイ** - Azure Security Center でマシンが監視され、選択したマシンに Qualys 拡張機能をデプロイするための推奨事項が表示されます。

1. **情報収集** - 拡張機能により成果物が収集され、定義されたリージョンの Qualys クラウド サービスでの分析用に送信されます。

1. **分析** - Qualys のクラウド サービスにより脆弱性評価が実施され、その結果が Security Center に送信されます。 

    > [!IMPORTANT]
    > Microsoft は、お客様のプライバシー、機密性、セキュリティを確保するために、お客様の詳細情報を Qualys と共有しません。 [Azure に組み込まれているプライバシー基準の詳細については、こちらを参照してください](https://www.microsoft.com/trust-center/privacy)。

1. **レポート** - 結果は Security Center で確認できます。

[![Azure Security Center の組み込みの脆弱性スキャナーのプロセス フロー図](media/built-in-vulnerability-assessment/va-vm-flow-diagram.png)](media/built-in-vulnerability-assessment/va-vm-flow-diagram.png#lightbox)


## <a name="deploy-the-integrated-scanner-to-your-azure-and-hybrid-machines"></a>統合されたスキャナーを Azure とハイブリッドのマシンにデプロイする

1. [Azure portal](https://azure.microsoft.com/features/azure-portal/) から **Security Center** を開きます。

1. Azure Security Center メニューから、 **[推奨事項]** ページを開きます。

1. **[脆弱性評価ソリューションを仮想マシンで有効にする必要]** 推奨事項を選択します。

    :::image type="content" source="./media/deploy-vulnerability-assessment-vm/recommendation-page-machine-groupings.png" alt-text="[推奨事項] ページ内のマシンのグループ" lightbox="./media/deploy-vulnerability-assessment-vm/recommendation-page-machine-groupings.png":::

    > [!TIP]
    > 上記のマシン "server16-test" は、Azure Arc 対応マシンです。 脆弱性評価スキャナーをオンプレミスとマルチクラウドのマシンにデプロイするには、「[Azure 以外のマシンを Security Center に接続する](quickstart-onboard-machines.md)」を参照してください。
    >
    > Security Center は Azure Arc とシームレスに連携します。Azure Arc をデプロイしている場合は、Security Center にご使用のマシンが表示されます。Log Analytics エージェントは必要ありません。

    マシンは、次の 1 つ以上のグループに表示されます。

    * **正常なリソース** - Security Center で、これらのマシンで実行されている脆弱性評価ソリューションが検出されました。
    * **異常なリソース** - これらのマシンに脆弱性スキャナー拡張機能をデプロイできます。 
    * **適用できないリソース** - これらのマシンには、脆弱性スキャナー拡張機能をデプロイできません。 このタブにマシンが表示される理由は、AKS クラスター内のイメージであるか、仮想マシン スケール セットの一部であるか、統合された脆弱性スキャナーでサポートされているオペレーティング システムのいずれかが実行されていないためです。

        | **ベンダー名** | **OS** | **サポートされているバージョン** |
        |----|----|----|
        |Microsoft|Windows|All|
        |Red Hat|Enterprise Linux|5.4+、6、7.0-7.8、8.0-8.1|
        |Red Hat|CentOS|5.4+、6、7.0-7.7、8.0-8.1|
        |Red Hat|Fedora|22-31|
        |SUSE|Linux Enterprise Server (SLES)|11、12、15|
        |SUSE|OpenSUSE|12、13、15.0-15.2|
        |SUSE|Leap|42.1|
        |Oracle|Enterprise Linux|5.11、6、7.0-7.5|
        |Debian|Debian|7.x-10.x|
        |Ubuntu|Ubuntu|12.04 LTS、14.04 LTS、15.x、16.04 LTS、18.04 LTS、19.10、20.04 LTS|

1. 異常なマシンの一覧から、脆弱性評価ソリューションを受信するマシンを選択し、 **[修復]** を選択ます。

    >[!IMPORTANT]
    > 構成によっては、この一覧の表示が異なる場合があります。 
    >
    > - サードパーティ製の脆弱性スキャナーが構成されていない場合は、デプロイすることができません。
    > - 選択したマシンが Azure Defender で保護されていない場合、ASC の統合された脆弱性スキャナー オプションは使用できません。

    :::image type="content" source="./media/deploy-vulnerability-assessment-vm/recommendation-remediation-options-builtin.png" alt-text="[脆弱性評価ソリューションを仮想マシンで有効にする必要がある] 推奨事項ページへの応答時に選択する推奨事項フローの種類のオプション":::

1. 推奨されるオプションを選択し、**ASC の統合された脆弱性スキャナーをデプロイして**、**続行します**。

1. さらに確認が求められます。 **[修復]** を選択します。

    スキャナー拡張機能が、選択したすべてのマシンに数分以内にインストールされます。
    
    拡張機能が正常にデプロイされるとすぐに、スキャンが自動的に開始されます。 スキャンはその後、4 時間間隔で実行されます。 この間隔は構成できません。

    >[!IMPORTANT]
    > 1 つ以上のマシンでデプロイが失敗した場合は、次の URL を許可リストに追加することで、ターゲット マシンが Qualys のクラウド サービスと通信できるようにします (ポート 443 経由 - HTTPS の規定値)。
    >
    >   - https://qagpublic.qg3.apps.qualys.com - Qualys の米国のデータ センター
    >   - https://qagpublic.qg2.apps.qualys.eu - Qualys の欧州のデータ センター
    >
    > マシンが欧州の Azure リージョンにある場合、その成果物は Qualys の欧州のデータ センターで処理されます。 他の場所にある仮想マシンの成果物は、米国のデータ センターに送信されます。


## <a name="automate-at-scale-deployments"></a>大規模なデプロイを自動化する

> [!NOTE]
> このセクションで説明されているすべてのツールは、[Security Center の GitHub コミュニティ リポジトリ](https://github.com/Azure/Azure-Security-Center/blob/master/README.md)から入手できます。 ここでは、ASC デプロイ全体で使用するスクリプト、自動化、その他の有用なリソースを見つけることができます。
>
> これらのツールの一部は、大規模なデプロイで有効にした後に接続された新しいマシンにのみ影響します。 それ以外は、既存のマシンにもデプロイされます。 複数のアプローチを組み合わせることができます。

統合スキャナーの大規模なデプロイを自動化するには、いくつかの方法があります。

- **[Azure Resource Manager]** – この方法は、Azure portal の **[推奨ロジックの表示]** から使用できます。 修復スクリプトには、自動化に使用できる関連の ARM テンプレートが含まれています。:::image type="content" source="./media/deploy-vulnerability-assessment-vm/deploy-at-scale-remediation-logic.png" alt-text="修復スクリプトには、自動化に使用できる関連の ARM テンプレートが含まれています" lightbox="./media/deploy-vulnerability-assessment-vm/deploy-at-scale-remediation-logic.png":::
- **DeployIfNotExists ポリシー** – 新しく作成されたすべてのマシンでスキャナーを受信できるようにするための [カスタム ポリシー](https://github.com/Azure/Azure-Security-Center/tree/master/Remediation%20scripts/Enable%20the%20built-in%20vulnerability%20assessment%20solution%20on%20virtual%20machines%20(powered%20by%20Qualys)/Azure%20Policy)です。 **[Azure へのデプロイ]** を選択し、関連するパラメーターを設定します。 このポリシーは、リソース グループ、サブスクリプション、または管理グループのレベルで割り当てることができます。
- **PowerShell スクリプト** – ```Update qualys-remediate-unhealthy-vms.ps1``` スクリプトを使用して、すべての異常な仮想マシンの拡張機能をデプロイします。 新しいリソース上にインストールするには、[Azure Automation](../automation/automation-intro.md) でスクリプトを自動化します。 このスクリプトは、推奨事項によって検出されたすべての異常なマシンを検索し、Azure Resource Manager の呼び出しを実行します。
- **Azure Logic Apps** – [サンプル アプリ](https://github.com/Azure/Azure-Security-Center/tree/master/Workflow%20automation/Install-VulnAssesmentAgent)に基づいてロジック アプリを構築します。 Security Center の [ワークフロー自動化](workflow-automation.md)ツールを使用してロジック アプリをトリガーし、**仮想マシンで脆弱性評価ソリューションを有効にする必要がある場合** に、常にリソースに対して推奨事項が生成されるようにスキャナーがデプロイされます。
- **REST API** – Security Center の REST API を使用して統合された脆弱性評価ソリューションをデプロイするには、次の URL の PUT 要求を行い、関連するリソース ID を追加します。```https://management.azure.com/<resourceId>/providers/Microsoft.Security/serverVulnerabilityAssessments/default?api-Version=2015-06-01-preview```



## <a name="trigger-an-on-demand-scan"></a>オンデマンド スキャンをトリガーする

ローカルまたはリモートで実行されたスクリプトまたはグループ ポリシー オブジェクト (GPO) を使用して、マシン自体からオンデマンド スキャンをトリガーできます。 また、パッチのデプロイ ジョブの最後に、ソフトウェア配布ツールにこれを統合することもできます。 

次のコマンドを実行すると、オンデマンド スキャンがトリガーされます。

- **Windows マシン**: ```REG ADD HKLM\SOFTWARE\Qualys\QualysAgent\ScanOnDemand\Vulnerability /v "ScanOnDemand" /t REG_DWORD /d "1" /f```
- **Linux マシン**: ```sudo /usr/local/qualys/cloud-agent/bin/cloudagentctl.sh action=demand type=vm```

## <a name="faq---integrated-vulnerability-scanner-powered-by-qualys"></a>FAQ -統合された脆弱性スキャナー (Qualys を利用)

### <a name="are-there-any-additional-charges-for-the-qualys-license"></a>Qualys ライセンスに対して追加料金は発生しますか?
いいえ。 すべての Azure Defender ユーザーが、組み込みスキャナーを無料でご利用いただけます。 この推奨事項では、スキャナーがライセンスと構成情報と共にデプロイされます。 追加のライセンスは必要ありません。 

### <a name="what-prerequisites-and-permissions-are-required-to-install-the-qualys-extension"></a>Qualys 拡張機能をインストールするために必要な前提条件とアクセス許可は何ですか。
拡張機能をデプロイするすべてのマシンに対する書き込みアクセス許可が必要です。

Azure Security Center 脆弱性評価拡張機能 (Qualys を利用) は、他の拡張機能と同様に、Azure 仮想マシン エージェント上で実行されます。 つまり、Windows ではローカル ホストとして、Linux では Root として実行されます。

セットアップ時に、Security Center によってマシンが次の 2 つの Qualys データ センターと通信できることが確認されます (ポート 443 経由 - HTTPS の既定値)。

- https://qagpublic.qg3.apps.qualys.com - Qualys の米国のデータ センター
- https://qagpublic.qg2.apps.qualys.eu - Qualys の欧州のデータ センター

現在、この拡張機能ではプロキシ構成の詳細が受け入れられません。

### <a name="can-i-remove-the-security-center-qualys-extension"></a>Security Center の Qualys 拡張機能を削除できますか? 
マシンから拡張機能を削除する場合は、手動で、または任意のプログラム ツールを使用して実行できます。 

次の詳細情報が必要になります。

* Linux では、拡張機能は "LinuxAgent.AzureSecurityCenter" と呼ばれ、パブリッシャー名は "Qualys" です
* Windows では、拡張機能は "WindowsAgent.AzureSecurityCenter" と呼ばれ、プロバイダー名は "Qualys" です

### <a name="how-does-the-extension-get-updated"></a>拡張機能の更新はどのように行われますか?
Azure Security Center エージェント自体およびその他すべての Azure 拡張機能と同様に、Qualys スキャナーのマイナー更新はバックグラウンドで自動的に行われる場合があります。 すべてのエージェントと拡張機能は、自動的にデプロイされる前に広範囲にわたってテストされます。

### <a name="why-does-my-machine-show-as-not-applicable-in-the-recommendation"></a>推奨事項で自分のマシンが "適用不可" として表示されるのはなぜですか?
推奨事項の詳細ページでは、マシンが **正常**、**異常**、**適用不可** のリストにグループ化されます。

マシンが **適用不可** のリソース グループにある場合は、Security Center を使用してそれらのマシンに脆弱性スキャナー拡張機能をデプロイできないことを意味します。

次の理由により、マシンがこのタブに表示される場合があります。

- Azure Defender によって保護されていません。前述のように、Azure Security Center に含まれる脆弱性スキャナーは、[Azure Defender for servers](defender-for-servers-introduction.md) によって保護されているマシンでのみ使用できます。

- AKS クラスター内のイメージであるか、仮想マシン スケール セットの一部である。この拡張機能は、PaaS リソースである VM をサポートしていません。

- サポートされているオペレーティング システムのいずれかが実行されていない。

    | **ベンダー名** | **OS** | **サポートされているバージョン** |
    |----|----|----|
    |Microsoft|Windows|All|
    |Red Hat|Enterprise Linux|5.4+、6、7.0-7.8、8.0-8.1|
    |Red Hat|CentOS|5.4+、6、7.0-7.7、8.0-8.1|
    |Red Hat|Fedora|22-31|
    |SUSE|Linux Enterprise Server (SLES)|11、12、15|
    |SUSE|OpenSUSE|12、13、15.0-15.2|
    |SUSE|Leap|42.1|
    |Oracle|Enterprise Linux|5.11、6、7.0-7.5|
    |Debian|Debian|7.x-10.x|
    |Ubuntu|Ubuntu|12.04 LTS、14.04 LTS、15.x、16.04 LTS、18.04 LTS、19.10、20.04 LTS|
    ||||

### <a name="what-is-scanned-by-the-built-in-vulnerability-scanner"></a>組み込みの脆弱性スキャナーでは何がスキャンされますか?
スキャナーはマシン上で実行され、マシン自体の脆弱性を探します。 マシンからネットワークをスキャンすることはできません。

### <a name="does-the-scanner-integrate-with-my-existing-qualys-console"></a>スキャナーは既存の Qualys コンソールと統合されますか?
Security Center 拡張機能は、既存の Qualys スキャナーとは別のツールです。 ライセンス制限は、Azure Security Center 内でのみ使用できることを意味します。

### <a name="microsoft-defender-for-endpoint-also-includes-threat--vulnerability-management-tvm-how-is-this-azure-defender-vulnerability-assessment-extension-different"></a>Microsoft Defender for Endpoint にも、脅威および脆弱性管理 (TVM) が含まれています。 この Azure Defender の脆弱性評価拡張機能はどのように異なりますか?
Microsoft では、Windows に組み込まれている Microsoft Defender for Endpoint の脅威および脆弱性管理ソリューションを使用して、世界クラスの脆弱性管理サービスを積極的に開発しています。

現在、Azure Security Center の脆弱性評価拡張機能では Qualys を利用しています。 Qualys の拡張機能により、Windows と Linux 両方のマシンが確実にサポートされます。 また、この拡張機能は、まだ CVE を持たない脆弱性に関する Qualys 独自の知識の恩恵も得ることができます。

### <a name="how-quickly-will-the-scanner-identify-newly-disclosed-critical-vulnerabilities"></a>新たに公開された重大な脆弱性はどのくらい迅速に特定されますか?
Qualys では、重大な脆弱性が公開されてから 48 時間以内に、その情報を処理に組み込み、影響を受けるマシンを特定できます。



## <a name="next-steps"></a>次のステップ

> [!div class="nextstepaction"]
> [脆弱性評価ソリューションの結果を修復する](remediate-vulnerability-findings-vm.md)


Security Center では、次の脆弱性分析も提供しています：

- SQL データベース - 「[脆弱性評価ダッシュボードで脆弱性評価レポートの探索をする](defender-for-sql-on-machines-vulnerability-assessment.md#explore-vulnerability-assessment-reports) 」を参照する
- Azure Container Registry イメージ - 「[コンテナー レジストリ用の Azure Defender を使用してイメージの脆弱性をスキャンする](defender-for-container-registries-usage.md)」をご覧ください