---
title: ID モデル
titleSuffix: An Azure Communication Services concept
description: ID とアクセス トークンについて説明します
author: tomaschladek
manager: nmurav
services: azure-communication-services
ms.author: tchladek
ms.date: 03/10/2021
ms.topic: conceptual
ms.service: azure-communication-services
ms.openlocfilehash: 5e53f9e89dd9718111da4f8016bc3e5a7f791627
ms.sourcegitcommit: 772eb9c6684dd4864e0ba507945a83e48b8c16f0
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/20/2021
ms.locfileid: "103496577"
---
# <a name="identity-model"></a>ID モデル

Azure Communication Services は、ID に依存しないサービスです。 この設計には、次のような複数の利点があります。

- ID 管理システムの既存の ID を再利用する
- 統合シナリオに対する柔軟性を提供する
- Azure Communication Services で ID を非公開にする

システム内の情報を複製するのではなく、ビジネス ケースで必要なマッピング関係を維持します。 たとえば、1:1、1:N、N:1、N:M のように ID をマップできます。 電話番号、ユーザー、デバイス、アプリケーション、GUID などの外部識別子を Azure Communication Services の ID として使用することはできません。 Azure Communication Services ID 用に生成されたアクセス トークンは、チャットや通話などのプリミティブにアクセスするために使用されます。

## <a name="identity"></a>ID

ID は、Azure Communication Services ID ライブラリを使用して作成できます。 ID は、会話で識別子として機能します。 これは、アクセス トークンを作成するために使用されます。 同じ ID が、複数のデバイスにまたがる複数の同時セッションに参加する場合があります。 ID には、同時に複数のアクティブなアクセス トークンがある場合があります。

ID、リソース、またはサブスクリプションを削除すると、すべてのアクセス トークンが無効になります。 このアクションにより、ID のために格納されているすべてのデータも削除されます。 削除された ID は、新しいアクセス トークンを作成することも、以前に格納されたデータ (たとえば、チャット メッセージ) にアクセスすることもできません。

所有している ID の数に対して課金されることはありません。 代わりに、プリミティブの使用に対して課金されます。 ID の数によって、アプリケーションの ID を Azure Communication Services の ID にマップする方法が制限されることはありません。

マッピングの自由には、プライバシーの責任が伴います。 ユーザーがシステムからの削除を希望した場合は、そのユーザーに関連付けられたすべての ID を削除する必要があります。

Azure Communication Services によって、匿名ユーザーの特別な ID は提供されません。 ユーザーと ID 間のマッピングは保持されず、ID が匿名であるかどうかを判別することはできません。 要件に合わせて ID の概念を設計できます。 各アプリケーションの匿名ユーザーごとに新しい ID を作成することをお勧めします。

有効なアクセス トークンを持つユーザーは誰でも、現在の ID コンテンツにアクセスできます。 たとえば、ユーザーは自分が送信したチャット メッセージにアクセスできます。 アクセスは、アクセス トークンに含まれるスコープのみに制限されます。 詳細については、この記事の「[アクセス トークン](#access-tokens)」セクションを参照してください。

### <a name="identity-mapping"></a>ID のマッピング

Azure Communication Services では、Azure ID 管理システムの機能はレプリケートされません。 顧客が顧客固有の ID を使用する方法は提供されません。 たとえば、顧客は電話番号や電子メール アドレスを使用することはできません。 代わりに、Azure Communication Services によって一意の識別子が提供されます。 それらの一意識別子をアプリケーションの ID に割り当てることができます。 Azure Communication Services によって、ユーザーの正体を明かす可能性のある情報が格納されることはありません。

システム内で情報が重複しないようにするために、ID ドメインのユーザーを Azure Communication Services の ID にマップする方法を計画してください。 任意の種類のパターンに従うことができます。 たとえば、1:1、1:N、N:1、M:N を使用できます。 単一のユーザーを単一の ID または複数の ID のどちらにマップするかを決定します。

新しい ID を作成したら、アプリケーションのユーザー (単一または複数) へのマッピングを格納します。 ID には、プリミティブを使用するためにアクセス トークンが必要なため、アプリケーションの単一または複数のユーザーに ID を認識させる必要があります。

リレーショナル データベースを使用してユーザー情報を格納する場合は、マッピング シナリオに基づいて設計を調整できます。 1:1 または N:1 をマップするシナリオの場合、テーブルに `CommunicationServicesId` 列を追加して、Azure Communication Services の ID を格納できます。 1:N または N:M のリレーションシップを使用するシナリオでは、リレーショナル データベースに個別のテーブルを作成することを検討してください。

## <a name="access-tokens"></a>アクセス トークン

アクセス トークンは、Azure Communication Services のプリミティブにアクセスするために使用できる JSON Web Token (JWT) トークンです。 発行されたアクセス トークンには、整合性保護があります。 つまり、発行後にそのクレームを変更することはできません。 したがって、ID、有効期限、またはスコープなどのプロパティを手動で変更すると、アクセス トークンは無効になります。 無効になったトークンでプリミティブを使用すると、プリミティブへのアクセスが拒否されます。

アクセス トークンのプロパティは次のとおりです。
* ID。
* Expiration。
* Scopes。

アクセス トークンは、常に 24 時間有効です。 有効期限が切れると、アクセス トークンは無効になり、どのプリミティブへのアクセスにも使用できなくなります。

ID には、サーバー側のサービスに対して新しいアクセス トークンを要求する手段が必要です。 *scope* パラメーターを使用して、空ではない使用可能なプリミティブ セットを定義します。 Azure Communication Services により、アクセス トークンに対して次のスコープがサポートされます。

|名前|説明|
|---|---|
|チャット|  チャットに参加する機能を許可します|
|VoIP|  ID と電話番号を呼び出す機能を許可します|


有効期限が切れる前にアクセス トークンを取り消すには、Azure Communication Services ID ライブラリを使用します。 トークンの失効はすぐにはできません。 反映されるまでに最大 15 分かかります。 ID、リソース、またはサブスクリプションを削除すると、すべてのアクセス トークンが取り消されます。

特定の機能にアクセスするユーザーの権限を削除する場合は、すべてのアクセス トークンを取り消します。 次に、スコープ セットがより制限された新しいアクセス トークンを発行します。

Azure Communication Services では、アクセス キーをローテーションすると、以前のアクセス キーを使用して作成されたすべてのアクティブなアクセス トークンが取り消されます。 すべての ID が Azure Communication Services にアクセスできなくなり、新しいアクセス トークンの発行が必要になります。

クライアントのアプリケーションではなくサーバー側のサービスでアクセス トークンを発行することをお勧めします。 これは、発行にはアクセス キーまたはマネージド ID が必要であるためです。 セキュリティ上の理由から、アクセス キーをクライアントのアプリケーションと共有することは推奨されません。

クライアント アプリケーションでは、クライアントを認証できる、信頼できるサービス エンドポイントを使用する必要があります。 エンドポイントは、ユーザーの代わりにアクセス トークンを発行する必要があります。 詳細については、「[クライアントとサーバーのアーキテクチャ](./client-and-server-architecture.md)」を参照してください。

アクセス トークンをバッキング ストアにキャッシュする場合、暗号化を使用することをお勧めします。 アクセス トークンは、機密データです。 保護されていない場合、悪意のあるアクティビティに使用される可能性があります。 アクセス トークンを持つ人物は、SDK を起動して API にアクセスできます。 アクセス可能な API は、アクセス トークンに含まれるスコープに基づいてのみ制限されます。 必要なスコープのみを含むアクセス トークンを発行することをお勧めします。

## <a name="next-steps"></a>次のステップ

* アクセス トークンの管理の概要については、「[アクセス トークンを作成して管理する](../quickstarts/access-tokens.md)」を参照してください。
* 認証の概要については、「[Azure Communication Services に対する認証](./authentication.md)」を参照してください。
* データ所在地とプライバシーの概要については、「[利用可能なリージョンとデータの保存場所](./privacy.md)」を参照してください。