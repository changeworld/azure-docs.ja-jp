---
title: Azure SQL Database サーバーレス (プレビュー) | Microsoft Docs
description: この記事では、新しいサーバーレス コンピューティング レベルについて説明し、既存のプロビジョニング済みコンピューティング レベルと比較します
services: sql-database
ms.service: sql-database
ms.subservice: service
ms.custom: ''
ms.devlang: ''
ms.topic: conceptual
author: oslake
ms.author: moslake
ms.reviewer: sstein, carlrab
manager: craigg
ms.date: 07/05/2019
ms.openlocfilehash: 5a1a5ea39c9c0ed8973e1ecfa46977d2d06f83e7
ms.sourcegitcommit: f10ae7078e477531af5b61a7fe64ab0e389830e8
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 07/05/2019
ms.locfileid: "67603605"
---
# <a name="azure-sql-database-serverless-preview"></a>Azure SQL Database サーバーレス (プレビュー)

Azure SQL Database サーバーレス (プレビュー) は、ワークロードの需要に基づいてコンピューティングを自動的にスケーリングし、1 秒あたりのコンピューティング使用量に対して請求を行うコンピューティング レベルです。 またサーバーレス コンピューティング レベルでは、アイドル期間にデータベースを自動的に一時停止します。このときはストレージのみに課金され、再びアクティブになると自動的にデータベースが再開されます。

## <a name="serverless-compute-tier"></a>サーバーレス コンピューティング レベル

単一データベースのサーバーレス コンピューティング レベルは、コンピューティングの自動スケーリング範囲と自動一時停止遅延でパラメーター化されます。  これらのパラメーターの構成によって、データベース パフォーマンス エクスペリエンスとコンピューティング コストが決まります。

![サーバーレスの請求](./media/sql-database-serverless/serverless-billing.png)

### <a name="performance-configuration"></a>パフォーマンス構成

- **最小仮想コア**と**最大仮想コア**は、データベースに使用可能なコンピューティング容量の範囲を定義する構成可能なパラメーターです。 メモリと IO の上限は、指定された仮想コアの範囲に比例します。  
- **自動一時停止遅延**は、データベースが自動的に一時停止するために必要な非アクティブ期間を定義する構成可能なパラメーターです。 次のログインまたはその他のアクティビティが発生すると、データベースは自動的に再開されます。  自動一時停止を無効にすることもできます。

### <a name="cost"></a>コスト

- サーバーレス データベースのコストは、コンピューティング コストとストレージ コストの合計です。
- コンピューティングの使用量が構成された最小制限と最大制限の間にある場合、コンピューティング コストは仮想コアとメモリの使用に基づきます。
- コンピューティングの使用量が構成された最小制限を下回っている場合、コンピューティング コストは、構成された最小仮想コア数と最小メモリに基づきます。
- データベースが一時停止すると、コンピューティング コストはゼロになり、ストレージ コストのみが発生します。
- ストレージ コストは、プロビジョニングされたコンピューティング レベルと同じ方法で決定されます。

より詳細なコストについては、[課金](sql-database-serverless.md#billing)に関する項目を参照してください。

## <a name="scenarios"></a>シナリオ

サーバーレスは、アイドル使用期間後のコンピューティング ウォームアップにおいてある程度の遅延を許容できる一時的な予測できない使用パターンの単一データベースに対して価格とパフォーマンスが最適化されています。 これに対し、プロビジョニング済みコンピューティング レベルは、コンピューティング ウォームアップの遅延を許容できない平均的に使用量が多いエラスティック プール内の単一データベースまたは複数のデータベースに対して価格とパフォーマンスが最適化されています。

### <a name="scenarios-well-suited-for-serverless-compute"></a>サーバーレス コンピューティングに最適なシナリオ

- 間欠的で予測できない使用パターンの単一データベースで、長期にわたってアクティブではない期間と平均コンピューティング使用率が低い期間が散在している場合。
- 頻繁に再スケールされるプロビジョニング済みコンピューティング レベル内の単一データベースと、コンピューティングの再スケールをサービスに委任することを好むお客様。
- SQL Database へのデプロイ前にコンピューティング サイズを見積もることが困難か不可能な、使用履歴のない新しい単一データベース。

### <a name="scenarios-well-suited-for-provisioned-compute"></a>プロビジョニング済みコンピューティングに最適なシナリオ

- より定期的で予測できる使用パターンを持ち、長期にわたって平均コンピューティング使用率が高い単一データベース。
- 頻繁なメモリ トリミングまたは一時停止状態からの自動再開での遅延によるパフォーマンスのトレードオフを許容できないデータベース。
- 価格とパフォーマンスの最適化向上のためにエラスティック プールに統合できる、間欠的な予測できない使用パターンを持つ複数のデータベース。

## <a name="comparison-with-provisioned-compute-tier"></a>プロビジョニング済みコンピューティング レベルとの比較

次の表は、サーバーレス コンピューティング レベルとプロビジョニング済みコンピューティング レベル間の違いをまとめたものです。

| | **サーバーレス コンピューティング** | **プロビジョニング済みコンピューティング** |
|:---|:---|:---|
|**データベースの使用パターン**| 長期にわたって平均コンピューティング使用率が低い、間欠的で予測できない使用状況。 |  長期間にわたって平均コンピューティング使用率が高い、より定期的な使用パターン、またはエラスティック プールを使用する複数のデータベース。|
| **パフォーマンス管理作業** |低|高|
|**コンピューティングのスケーリング**|自動|マニュアル|
|**コンピューティングの応答性**|非アクティブな期間の後は低い|即時|
|**請求の最小単位**|1 秒あたり|1 時間あたり|

## <a name="purchasing-model-and-service-tier"></a>購入モデルとサービス レベル

SQL Database サーバーレスは、現在、仮想コア購入モデルの第 5 世代ハードウェアの General Purpose レベルでのみサポートされます。

## <a name="autoscaling"></a>自動スケール

### <a name="scaling-responsiveness"></a>スケーリング応答性

一般に、サーバーレス データベースは、リソースの需要を満たすために十分な容量を備え、最大仮想コア値によって設定される制限内で要求されたどのようなコンピューティング量に対しても中断することのないコンピューター上で実行されます。 場合によっては、コンピューターが数分以内にリソースの需要を満たすことができない場合、自動的に負荷分散が行われることがあります。 たとえば、リソースの需要が 4 個の仮想コアであるが、利用できる仮想コアが2 個のみの場合は、4 個の仮想コアが提供される前の負荷分散に数分かかる可能性があります。 データベースは、接続が切断されるときの操作の最後の短時間を除き、負荷分散の間オンライン状態を維持します。

### <a name="memory-management"></a>メモリ管理

サーバーレス データベースのメモリは、プロビジョニング済みコンピューティング データベースより頻繁に回収されます。 この動作は、サーバーレスでのコストを管理するために重要で、パフォーマンスに影響を及ぼすことがあります。

#### <a name="cache-reclamation"></a>キャッシュの再利用

プロビジョニング済みコンピューティング データベースとは異なり、CPU またはキャッシュの使用率が低いとき、SQL キャッシュからのメモリはサーバーレス データベースから回収されます。

- 最近使用したキャッシュ エントリの合計サイズが一定期間しきい値を下回ると、キャッシュ使用率が低いと見なされます。
- キャッシュの回収がトリガーされると、ターゲットのキャッシュ サイズは段階的に減少して前のサイズよりも少なくなります。回収は、使用率が低い状態が続く場合にのみ続行されます。
- キャッシュの回収が発生している場合、削除するキャッシュ エントリの選択ポリシーは、メモリ負荷が高いときのプロビジョニングされたコンピューティング データベースの選択ポリシーと同じです。
- キャッシュ サイズは、構成可能な最小仮想コアで定義されている最小メモリ制限よりも小さくなることはありません。

サーバーレス コンピューティング データベースとプロビジョニング済みコンピューティング データベースの両方で、使用可能なメモリがすべて使用されている場合、キャッシュ エントリを削除できます。

#### <a name="cache-hydration"></a>キャッシュのハイドレーション

データがディスクからフェッチされると、SQL キャッシュは、プロビジョニング済みデータベースと同じ方法および速度で拡大します。 データベースがビジー状態の場合、キャッシュは、最大メモリ制限に達するまで制約なしで拡大できます。

## <a name="autopausing-and-autoresuming"></a>自動一時停止と自動再開

### <a name="autopausing"></a>自動一時停止

自動一時停止遅延の期間を通して次のすべての条件が満たされた場合、自動一時停止がトリガーされます。

- セッション数 = 0
- ユーザー プールで実行されているユーザー ワークロードの場合は CPU = 0

必要な場合に自動一時停止を無効にするオプションが用意されています。

次の機能では、自動一時停止はサポートされません。  つまり、次の機能のいずれかを使用する場合、データベースの非アクティブな期間に関係なくデータベースはオンラインのままになります。

- geo レプリケーション (アクティブ geo レプリケーションと自動フェールオーバー グループ)
- 長期的なバックアップ保有期間 (LTR)。
- SQL データ同期で使用される同期データベース。

データベースをオンラインにする必要がある一部のサービス更新プログラムのデプロイ中は、自動一時停止は一時的に回避されます。  このような場合、サービス更新プログラムが完了すると、自動一時停止は再び許可されます。

### <a name="autoresuming"></a>自動再開

次の条件のいずれかに該当した場合は常に、自動再開がトリガーされます。

|機能|自動再開トリガー|
|---|---|
|認証と権限承認|ログイン|
|脅威の検出|データベース レベルまたはサーバー レベルでの脅威検出の設定の有効化/無効化。<br>データベース レベルまたはサーバー レベルでの脅威検出の設定の変更。|
|データの検出と分類|機密ラベルの追加、変更、削除、表示|
|監査|監査レコードの表示。<br>監査ポリシーの更新または表示。|
|データ マスク|データ マスク ルールの追加、変更、削除、表示|
|透過的なデータ暗号化|透過的データ暗号化の状態またはステータスの表示|
|クエリ (パフォーマンス) データ ストア|クエリ ストアの設定の変更または表示、自動チューニング|
|自動調整|自動インデックス作成などの自動調整の推奨事項の適用と検証|
|データベースのコピー|コピーとしてのデータベースの作成。<br>BACPAC ファイルへのエクスポート。|
|SQL データ同期|構成可能なスケジュールまたは手動で実行される、ハブとメンバー データベースの間の同期|
|特定のデータベース メタデータの変更|新しいデータベース タグの追加。<br>最大仮想コア数、最小仮想コア数、または自動一時停止遅延の変更。|
|SQL Server Management Studio (SSMS)|SSMS バージョン 18 を使用し、サーバーでデータベースの新しいクエリ ウィンドウを開くと、同じサーバーで自動一時停止されていたデータベースが再開します。 この動作は、IntelliSense をオフにした SSMS バージョン 17.9.1 を使用している場合は発生しません。|

データベースをオンラインにする必要がある一部のサービス更新プログラムのデプロイ中にも、自動再開がトリガーされます。

### <a name="connectivity"></a>接続

サーバーレス データベースが一時停止されている場合、データベースは最初のログインで再開され、データベースが使用できないことを示すエラーがエラー コード 40613 で返されます。 データベースが再開され後、ログインを再試行して接続を確立する必要があります。 接続再試行ロジックを備えたデータベース クライアントは、変更する必要はありません。

### <a name="latency"></a>Latency

サーバーレス データベースの自動再開および自動一時停止の待機時間は、通常、自動再開までに 1 分、自動停止までに 1 - 10 分かかります。

## <a name="onboarding-into-serverless-compute-tier"></a>サーバーレス コンピューティング レベルへのオンボード

サーバーレス コンピューティング レベルでの新しいデータベースの作成または既存のデータベースの移動は、プロビジョニング済みコンピューティング レベルでの新規データベースの作成と同じパターンに従い、次の 2 つのステップが含まれます。

1. サービス目標名を指定します。 サービス目標では、サービス レベル、ハードウェアの世代、および最大仮想コア数が規定されます。 次の表にサービス目標のオプションを示します。

   |サービス目標名|サービス階層|ハードウェアの世代|最大仮想コア数|
   |---|---|---|---|
   |GP_S_Gen5_1|汎用|第 5 世代|1|
   |GP_S_Gen5_2|汎用|第 5 世代|2|
   |GP_S_Gen5_4|汎用|第 5 世代|4|

2. 必要に応じて、最小仮想コア数と自動一時停止遅延を指定して、既定値を変更します。 これらのパラメーターに対して使用可能な値を次の表に示します。

   |パラメーター|値の選択肢|Default value|
   |---|---|---|---|
   |最小仮想コア|最大仮想コア数を超えない {0.5、1、2、4} のいずれか|0.5 仮想コア|
   |自動一時停止遅延|最小:60 分 (1 時間)<br>最大値:10080 分 (7 日)<br>増分: 約 60 分<br>自動一時停止の無効化: -1|約 60 分|

> [!NOTE]
> T-SQL を使用して、サーバーレスに既存データベースを移動すること、またはコンピューティング サイズを変更することは、現在はサポートされていませんが、Azure portal または PowerShell を使用して行うことができます。

### <a name="create-new-database-in-serverless-compute-tier"></a>サーバーレス コンピューティング レベルで新しいデータベースを作成する 

#### <a name="use-azure-portal"></a>Azure Portal の使用

「[クイック スタート:Azure portal を使用して Azure SQL Database で単一データベースを作成する](sql-database-single-database-get-started.md)」をご覧ください。

#### <a name="use-powershell"></a>PowerShell の使用

次の例では、サーバーレス コンピューティング レベルで新しいデータベースを作成します。  この例では、最小仮想コア数、最大仮想コア数、および自動一時停止遅延を明示的に指定します。

```powershell
New-AzSqlDatabase `
  -ResourceGroupName $resourceGroupName `
  -ServerName $serverName `
  -DatabaseName $databaseName `
  -ComputeModel Serverless `
  -Edition GeneralPurpose `
  -ComputeGeneration Gen5 `
  -MinVcore 0.5 `
  -MaxVcore 2 `
  -AutoPauseDelayInMinutes 720
```

### <a name="move-database-from-provisioned-compute-tier-into-serverless-compute-tier"></a>プロビジョニングされたコンピューティング レベルからサーバーレス コンピューティング レベルにデータベースを移動する

#### <a name="use-powershell"></a>PowerShell の使用

次の例では、プロビジョニングされたコンピューティング レベルからサーバーレス コンピューティング レベルにデータベースを移動します。 この例では、最小仮想コア数、最大仮想コア数、および自動一時停止遅延を明示的に指定します。

```powershell
Set-AzSqlDatabase
  -ResourceGroupName $resourceGroupName `
  -ServerName $serverName `
  -DatabaseName $databaseName `
  -Edition GeneralPurpose `
  -ComputeModel Serverless `
  -ComputeGeneration Gen5 `
  -MinVcore 1 `
  -MaxVcore 4 `
  -AutoPauseDelayInMinutes 1440
```

### <a name="move-database-from-serverless-compute-tier-into-provisioned-compute-tier"></a>サーバーレス コンピューティング レベルからプロビジョニングされたコンピューティング レベルにデータベースを移動する

プロビジョニング済みコンピューティング データベースをサーバーレス コンピューティング レベルに移動するのと同じ方法で、サーバーレス データベースをプロビジョニング済みコンピューティング レベルに移動できます。

## <a name="modifying-serverless-configuration"></a>サーバーレス構成の変更

### <a name="maximum-vcores"></a>最大仮想コア数

#### <a name="use-powershell"></a>PowerShell の使用

最大仮想コア数の変更は、PowerShell の [Set-AzSqlDatabase](https://docs.microsoft.com/powershell/module/az.sql/set-azsqldatabase) コマンドと `MaxVcore` 引数を使用して実行します。

### <a name="minimum-vcores"></a>最小仮想コア数

#### <a name="use-powershell"></a>PowerShell の使用

最小仮想コア数の変更は、PowerShell の [Set-AzSqlDatabase](https://docs.microsoft.com/powershell/module/az.sql/set-azsqldatabase) コマンドと `MinVcore` 引数を使用して実行します。

### <a name="autopause-delay"></a>自動一時停止遅延

#### <a name="use-powershell"></a>PowerShell の使用

自動一時停止遅延の変更は、PowerShell の [Set-AzSqlDatabase](https://docs.microsoft.com/powershell/module/az.sql/set-azsqldatabase) コマンドと `AutoPauseDelayInMinutes` 引数を使用して実行されます。

## <a name="monitoring"></a>監視

### <a name="resources-used-and-billed"></a>使用済みおよび請求対象のリソース

サーバーレス データベースのリソースは、アプリ パッケージ、SQL インスタンス、およびユーザー リソース プール エンティティによってカプセル化されます。

#### <a name="app-package"></a>アプリ パッケージ

アプリ パッケージは、データベースがサーバーレスまたはプロビジョニング済みのどちらのコンピューティング レベルであるかに関係なく、データベースに対する最も外側のリソース管理境界です。 アプリ パッケージには SQL インスタンスと外部サービスが含まれ、両者によって SQL Database のデータベースによって使用されるすべてのユーザー リソースとシステム リソースのスコープが決まります。 外部サービスの例としては、R やフルテキスト検索などがあります。 一般に、アプリ パッケージでの全体的なリソース使用量より、SQL インスタンスの方が優位です。

#### <a name="user-resource-pool"></a>ユーザー リソース プール

ユーザー リソース プールは、データベースがサーバーレスまたはプロビジョニング済みのどちらのコンピューティング レベルであるかに関係なく、データベースに対する最も内側のリソース管理境界です。 ユーザー リソース プールのスコープは、DDL クエリ (CREATE、ALTER など) および DML クエリ (SELECT、INSERT、UPDATE、DELETE など) によって生成されるユーザー ワークロードに対する CPU と IO です。 これらのクエリは、一般に、アプリ パッケージでの使用量の最も大きな割合を表します。

### <a name="metrics"></a>メトリック

サーバーレス データベースのアプリ パッケージとユーザー プールのリソース使用量を監視するためのメトリックは、次の表のとおりです。

|エンティティ|メトリック|説明|Units|
|---|---|---|---|
|アプリ パッケージ|app_cpu_percent|アプリに許可されている最大仮想コア数に対する、アプリによって使用された仮想コア数の割合。|割合|
|アプリ パッケージ|app_cpu_billed|レポート期間中にアプリに対して請求されるコンピューティングの量。 この期間中に支払われる金額は、このメトリックと仮想コアの単位価格の積です。 <br><br>このメトリックの値は、1 秒ごとに使用された CPU とメモリの最大値を時間で集計することによって決定されます。 使用された金額が、最小仮想コア数と最小メモリによって設定されるプロビジョニング済みの最低額より少ない場合、プロビジョニング済みの最低額が請求されます。 請求のために CPU とメモリを比較するため、メモリは GB 単位のメモリ量を仮想コアあたり 3 GB で再スケーリングすることによって、仮想コアの単位に正規化されます。|仮想コア秒数|
|アプリ パッケージ|app_memory_percent|アプリに許可されている最大メモリに対する、アプリによって使用されたメモリの割合。|割合|
|ユーザー プール|cpu_percent|ユーザー ワークロードに許可されている最大仮想コア数に対する、ユーザー ワークロードによって使用された仮想コア数の割合。|割合|
|ユーザー プール|data_IO_percent|ユーザー ワークロードに許可されている最大データ IOPS に対する、ユーザー ワークロードによって使用されたデータ IOPS の割合。|割合|
|ユーザー プール|log_IO_percent|ユーザー ワークロードに許可されている最大ログ MB/秒に対する、ユーザー ワークロードによって使用されたログ MB/秒の割合。|割合|
|ユーザー プール|workers_percent|ユーザー ワークロードに許可されている最大ワーカー数に対する、ユーザー ワークロードによって使用されたワーカー数の割合。|割合|
|ユーザー プール|sessions_percent|ユーザー ワークロードに許可されている最大セッション数に対する、ユーザー ワークロードによって使用されたセッション数の割合。|割合|

### <a name="pause-and-resume-status"></a>一時停止と再開の状態

Azure portal では、データベースの状態は、サーバーに含まれるデータベースの一覧が表示される概要ウィンドウで示されます。 データベースの状態は、データベースの概要ウィンドウにも表示されます。

データベースの一時停止と再開の状態を照会するには、次の PowerShell コマンドを使用します。

```powershell
Get-AzSqlDatabase `
  -ResourceGroupName $resourcegroupname `
  -ServerName $servername `
  -DatabaseName $databasename `
  | Select -ExpandProperty "Status"
```

## <a name="resource-limits"></a>リソース制限

リソースの制限については、[サーバーレス コンピューティング レベル](sql-database-vCore-resource-limits-single-databases.md#serverless-compute-tier)に関する記事をご覧ください

## <a name="billing"></a>課金

コンピューティング請求金額は、各秒に使用された CPU およびメモリの最大量です。 CPU とメモリの使用量がそれぞれのプロビジョニング済みの最小量より少ない場合、プロビジョニング済みの量が請求されます。 請求のために CPU とメモリを比較するため、メモリは GB 単位のメモリ量を仮想コアあたり 3 GB で再スケーリングすることによって、仮想コアの単位に正規化されます。

- **請求されるリソース**: CPU とメモリ
- **請求される金額**: 仮想コア単位価格 * (最小仮想コア数、使用された仮想コア数、最小メモリ GB * 1/3、使用されたメモリ GB * 1/3) のうち最大の値 
- **請求頻度**: 1 秒あたり

1 秒あたり、仮想コアあたりのコストの仮想コア単位価格。 特定のリージョンの特定の単位価格については、[Azure SQL Database の価格に関するページ](https://azure.microsoft.com/pricing/details/sql-database/single/)をご覧ください。

請求されるコンピューティングの金額は、次のメトリックで示されます。

- **メトリック**: app_cpu_billed (仮想コア秒数)
- **定義**: (最小仮想コア数、使用された仮想コア数、最小メモリ GB * 1/3、使用されたメモリ GB * 1/3) のうち最大の値
- **レポート頻度**: 1 分あたり

この量が 1 秒ごとに計算され、1 分間について集計されます。

最小仮想コア数に 1、最大仮想コア数に 4 が指定されているサーバーレス データベースについて考えてみます。  この場合、最小メモリは約 3 GB、最大メモリは約 12 GB です。  自動一時停止遅延が 6 時間に設定され、24 時間のうち最初の 2 時間だけデータベースのワークロードがアクティブで、それ以外の時間は非アクティブだとすると、    

このデータベースは、最初の 8 時間はコンピューティングとストレージに対して課金されます。  2 時間を過ぎるとデータベースは非アクティブになりますがオンラインなので、その後の 6 時間については、プロビジョニングされた最小コンピューティングに基づいて、コンピューティングに対して引き続き課金されます。  24 時間のうち、データベースが一時停止中の残りの時間については、ストレージのみが課金されます。

正確には、この例のコンピューティングに対する課金は次のように計算されます。

|期間|使用された 1 秒あたりの仮想コア数|使用された 1 秒あたりの GB 数|課金対象となるコンピューティング ディメンション|対象期間内で課金対象となる仮想コア秒数|
|---|---|---|---|---|
|0:00-1:00|4|9|使用された仮想コア数|4 個の仮想コア × 3,600 秒 = 14,400 仮想コア秒|
|1:00-2:00|1|12|使用されたメモリ|12 GB * 1/3 * 3,600 秒 = 14,400 仮想コア秒|
|2:00-8:00|0|0|プロビジョニング済み最小メモリ|3 GB × 1/3 × 21,600 秒 = 21,600 仮想コア秒|
|8:00-24:00|0|0|一時停止中、コンピューティングには課金なし|0 仮想コア秒|
|24 時間で課金対象となる合計仮想コア秒数||||50,400 仮想コア秒|

コンピューティングの単位価格は $0.000073/仮想コア/秒とします。  この場合、この 24 時間で課金対象となるコンピューティングは、コンピューティング ユニット価格と課金対象の仮想コア秒数の積になります: $0.000073/仮想コア/秒 × 50,400 仮想コア秒 = $3.68

## <a name="available-regions"></a>対応リージョン

サーバーレス コンピューティング レベルは、次のリージョンを除く全世界で利用できます。オーストラリア中部、中国東部、中国北部、フランス南部、ドイツ中部、ドイツ北東部、インド西部、韓国南部、南アフリカ西部、英国北部、英国南部、英国西部、および米国中西部。

## <a name="next-steps"></a>次の手順

- 使用を開始するには、「[クイック スタート: Azure portal を使用して Azure SQL Database で単一データベースを作成する](sql-database-single-database-get-started.md)」をご覧ください。
- リソースの制限については、[サーバーレス コンピューティング レベルのリソース制限](sql-database-vCore-resource-limits-single-databases.md#serverless-compute-tier)に関する記事をご覧ください。
