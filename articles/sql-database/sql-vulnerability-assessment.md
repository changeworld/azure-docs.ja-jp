---
title: SQL 脆弱性評価
description: Azure SQL Database で SQL の脆弱性評価を構成する方法と、評価レポートの内容について説明します。
services: sql-database
ms.service: sql-database
ms.subservice: security
ms.custom: ''
ms.devlang: ''
ms.topic: conceptual
author: mibar
ms.author: mibar
ms.reviewer: vanto, carlrab
ms.date: 04/19/2020
tags: azure-synapse
ms.openlocfilehash: 80629898b56f81fc738cb30df63766ea39adea6d
ms.sourcegitcommit: acb82fc770128234f2e9222939826e3ade3a2a28
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/21/2020
ms.locfileid: "81684252"
---
# <a name="sql-vulnerability-assessment-helps-you-identify-database-vulnerabilities"></a>SQL 脆弱性評価は、データベースの脆弱性を特定するのに役立ちます

SQL 脆弱性評価は、データベースの潜在的な脆弱性を検出、追跡、修復するのに役立つ、構成が容易なサービスです。 これを使用すると、事前の対策としてデータベースのセキュリティを向上させることができます。

脆弱性評価は、高度な SQL セキュリティ機能の統合パッケージである [Advanced Data Security](sql-database-advanced-data-security.md) オファリングの一部です。 脆弱性評価は、SQL Advanced Data Security ポータルを使って一元的にアクセスおよび管理できます。

> [!NOTE]
> 脆弱性評価は、Azure SQL Database、Azure SQL Database マネージド インスタンス、Azure Synapse Analytics でサポートされています。 わかりやすくするため、この記事では、マネージド データベース サービスを SQL Database と呼んでいます。

## <a name="vulnerability-assessment"></a>脆弱性評価

SQL 脆弱性評価は、セキュリティの状態を可視化するサービスです。 脆弱性評価には、セキュリティの問題を解決し、データベースのセキュリティを強化するために実践できる手順が含まれています。 以下のことに役立ちます。 

- データベース スキャン レポートが必要なコンプライアンス要件を満たす。
- データのプライバシー基準を満たす。
- 変更の追跡が困難である動的データベース環境を監視する。

脆弱性評価は、Azure SQL Database に組み込まれているスキャン サービスです。 このサービスでは、セキュリティの脆弱性にフラグを付ける規則のナレッジ ベースが採用されています。 これは、誤った設定、過剰なアクセス許可、保護されていない機密データなど、ベスト プラクティスからの逸脱を明らかにします。

規則は Microsoft のベスト プラクティスに基づき、データベースとその貴重なデータにとって最も大きなリスクとなるセキュリティの問題に注目します。 データベース レベルの問題と、サーバーのファイアウォール設定やサーバー レベルの権限などのサーバー レベルのセキュリティ問題がカバーされます。 これらのルールでは、さまざまな規制機関の数多くのコンプライアンス基準を満たすための要件も示しています。

スキャンの結果には、各々の問題を解決するために実践できる手順が含まれ、カスタマイズした修復スクリプトが適宜提供されます。 次に対する許容されるベースラインを設定することにより、ご利用環境に合わせて評価レポートをカスタマイズできます。
* アクセス許可の構成。
* 機能の構成。
* データベースの設定。

## <a name="implement-vulnerability-assessment"></a>脆弱性評価を実装する

次の手順では SQL Database で脆弱性評価を実装します。

### <a name="1-run-a-scan"></a>1.スキャンを実行する

[Azure SQL Database] ペインで、 **[セキュリティ]** の見出しの下から **[Advanced Data Security]** を選択します。 次に、 **[脆弱性評価]** ペインで **[Select Storage]\(記憶域の選択\)** をクリックして、SQL Server 全体の [脆弱性評価の設定] ペインを開きます。

サーバー上のすべてのデータベースに対するスキャン結果が格納されるストレージ アカウントを構成します。 ストレージ アカウントについて詳しくは、「[Azure ストレージ アカウントについて](../storage/common/storage-create-storage-account.md)」をご覧ください。 ストレージを構成した後、 **[スキャン]** を選択してデータベースの脆弱性をスキャンします。

![データベースのスキャン](./media/sql-vulnerability-assessment/pp_va_initialize.png)

  > [!NOTE]
  > このスキャンは軽量で安全です。 実行にかかるのは数秒で、完全に読み取り専用です。 データベースが変更されることはありません。

### <a name="2-view-the-report"></a>2.レポートを表示する

スキャンが終了すると、スキャン レポートが Azure portal に自動的に表示されます。 このレポートには、セキュリティ状態の概要が示されます。 検出された問題の数とそれぞれの重大度が表示されます。 結果には、ベスト プラクティスからの逸脱に関する警告と、セキュリティ関連の設定 (データベースのプリンシパルとロール、および関連付けられている権限など) のスナップショットが含まれます。 スキャン レポートでは、データベースで検出された機密データのマップも提供されます。 [データ検出と分類](sql-database-data-discovery-and-classification.md)を使用してそのデータを分類するための推奨事項が含まれています。

![レポートを表示する](./media/sql-vulnerability-assessment/pp_main_getstarted.png)

### <a name="3-analyze-the-results-and-resolve-issues"></a>3.結果を分析し問題を解決する

結果を確認し、レポートで示されている結果のうち環境で実際にセキュリティの問題となるものを判断します。 問題となった各結果をドリルダウンして、問題の影響と、各セキュリティ チェックが不合格になった理由を理解します。 レポートが提供する実践可能な修復情報を使用し、問題を解決します。

![レポートを出力する](./media/sql-vulnerability-assessment/pp_fail_rule_show_remediation.png)

### <a name="4-set-your-baseline"></a>4.ベースラインを設定する

評価の結果を確認しながら、環境において許容される*ベースライン*として特定の結果をマークできます。 このベースラインは本来、結果のレポート方法をカスタマイズするものです。 ベースラインに一致する結果は、それ以降のスキャンで合格と見なされます。 ベースラインのセキュリティ状態を確立した後は、脆弱性評価では、ベースラインからの逸脱のみが報告されます。 これにより、関連する問題に意識を集中することができます。

![ベースラインを設定する](./media/sql-vulnerability-assessment/pp_fail_rule_show_baseline.png)

### <a name="5-run-a-new-scan-to-see-your-customized-tracking-report"></a>5.新しいスキャンを実行してカスタマイズした追跡レポートを表示する

**規則のベースライン**の設定が完了したら、新しいスキャンを実行して、カスタマイズしたレポートを表示します。 脆弱性評価では、ユーザーが承認したベースライン状態から逸脱したセキュリティの問題のみが報告されるようになります。

![カスタマイズしたレポートを表示する](./media/sql-vulnerability-assessment/pp_pass_main_with_baselines.png)

脆弱性評価を使って、データベースが常に高レベルのセキュリティを維持し、組織のポリシーが満たされていることを、監視できるようになりました。 コンプライアンスのレポートが必要な場合、脆弱性評価レポートはコンプライアンス プロセスを促進するのに役立ちます。

### <a name="6-set-up-periodic-recurring-scans"></a>6.定期的な反復スキャンの設定

脆弱性評価の設定に移動して、 **[定期的な反復スキャン]** を有効にします。 この設定により、データベースの脆弱性評価スキャンが毎週 1 回自動的に実行されるようになります。 スキャン結果の概要は、指定したメール アドレスに送信されます。

![カスタマイズしたレポートを表示する](./media/sql-vulnerability-assessment/pp_recurring_scans.png)

### <a name="7-export-an-assessment-report"></a>7.評価レポートのエクスポート

**[スキャン結果のエクスポート]** を選択して、ダウンロード可能なスキャン結果の Excel レポートを作成します。 このレポートの概要タブには、評価の概要が表示されます。 レポートには、失敗したすべてのチェックが含まれます。 また、 **[結果]** タブには、スキャン結果の完全セットが含まれます。 結果には、実行されたすべてのチェックと、それぞれの結果の詳細が含まれます。

### <a name="8-view-scan-history"></a>8.スキャン履歴の表示

[脆弱性評価] ペインの **[スキャンの履歴]** を選択すると、このデータベースで以前に実行されたすべてのスキャンの履歴が表示されます。 一覧から特定のスキャンを選択すると、そのスキャンの詳しい結果が表示されます。

脆弱性評価を使って、データベースが常に高レベルのセキュリティを維持し、組織のポリシーが満たされていることを、監視できるようになりました。 コンプライアンスのレポートが必要な場合、脆弱性評価レポートはコンプライアンス プロセスを促進するのに役立ちます。

## <a name="manage-vulnerability-assessments-by-using-azure-powershell"></a>Azure PowerShell を使用して脆弱性評価を管理する

[!INCLUDE [updated-for-az](../../includes/updated-for-az.md)]
> [!IMPORTANT]
> PowerShell Azure Resource Manager モジュールは Azure SQL Database で引き続きサポートされますが、今後の開発はすべて Az.Sql モジュールを対象に行われます。 これらのコマンドレットについては、「[AzureRM.Sql](https://docs.microsoft.com/powershell/module/AzureRM.Sql/)」を参照してください。 Az モジュールと AzureRm モジュールのコマンドの引数は実質的に同じです。

Azure PowerShell コマンドレットを使用して、脆弱性評価をプログラムで管理できます。 サポートされているコマンドレットは次のとおりです。

| コマンドレット名 (リンク) | 説明 |
| :-------------------- | :---------- |
| [Clear-AzSqlDatabaseVulnerabilityAssessmentRuleBaseline](https://docs.microsoft.com/powershell/module/az.sql/Clear-azSqlDatabaseVulnerabilityAssessmentRuleBaseline) | 脆弱性評価規則のベースラインをクリアします。<br/>このコマンドレットを使用してクリアする前に、まずベースラインを設定します。 |
| [Clear-AzSqlDatabaseVulnerabilityAssessmentSetting](https://docs.microsoft.com/powershell/module/az.sql/Clear-azSqlDatabaseVulnerabilityAssessmentSetting) | データベースの脆弱性評価の設定をクリアします。 |
| [Convert-AzSqlDatabaseVulnerabilityAssessmentScan](https://docs.microsoft.com/powershell/module/az.sql/Convert-azSqlDatabaseVulnerabilityAssessmentScan) | 脆弱性評価のスキャン結果を Excel ファイルに変換します。 |
| [Get-AzSqlDatabaseVulnerabilityAssessmentRuleBaseline](https://docs.microsoft.com/powershell/module/az.sql/Get-azSqlDatabaseVulnerabilityAssessmentRuleBaseline) | 特定の規則の脆弱性評価規則のベースラインを取得します。 |
| [Get-AzSqlDatabaseVulnerabilityAssessmentScanRecord](https://docs.microsoft.com/powershell/module/az.sql/Get-azSqlDatabaseVulnerabilityAssessmentScanRecord) | 特定のデータベースに関連付けられているすべての脆弱性評価スキャン レコードを取得します。 |
| [Get-AzSqlDatabaseVulnerabilityAssessmentSetting](https://docs.microsoft.com/powershell/module/az.sql/Get-azSqlDatabaseVulnerabilityAssessmentSetting) | データベースの脆弱性評価の設定を返します。 |
| [Set-AzSqlDatabaseVulnerabilityAssessmentRuleBaseline](https://docs.microsoft.com/powershell/module/az.sql/Set-azSqlDatabaseVulnerabilityAssessmentRuleBaseline) | 脆弱性評価規則のベースラインを設定します。 |
| [Start-AzSqlDatabaseVulnerabilityAssessmentScan](https://docs.microsoft.com/powershell/module/az.sql/Start-azSqlDatabaseVulnerabilityAssessmentScan) | 脆弱性評価スキャンの開始をトリガーします。 |
| [Update-AzSqlDatabaseVulnerabilityAssessmentSetting](https://docs.microsoft.com/powershell/module/az.sql/Update-azSqlDatabaseVulnerabilityAssessmentSetting) | データベースの脆弱性評価の設定を更新します。 |
| &nbsp; | &nbsp; |

スクリプトの例については、[Azure SQL の脆弱性評価の PowerShell のサポート](https://blogs.msdn.microsoft.com/sqlsecurity/20../../azure-sql-vulnerability-assessment-now-with-powershell-support/)に関する記事を参照してください。

## <a name="manage-vulnerability-assessment-baseline-rules-by-using-resource-manager-templates"></a>Resource Manager テンプレートを使用して脆弱性評価の基準規則を管理する

Azure Resource Manager テンプレートを使用して脆弱性評価基準を構成するには、`Microsoft.Sql/servers/databases/vulnerabilityAssessments/rules/baselines` の種類を使用します。

基準を追加する前に、SQL Server が稼働しているコンピューターで `vulnerabilityAssessments` が有効になっていることを確認してください。

Resource Manager テンプレートのリソースとして、masterdb にベースラインの規則 VA2065 を定義し、userdb に VA1143 を定義する例を以下に示します。

```json
   "resources": [
      {
         "type": "Microsoft.Sql/servers/databases/vulnerabilityAssessments/rules/baselines",
         "apiVersion": "2018-06-01-preview",
         "name": "[concat(parameters('server_name'),'/', parameters('database_name') , '/default/VA2065/master')]",
         "properties": {
            "baselineResults": [
               {
                  "result": [
                     "FirewallRuleName3",
                     "StartIpAddress",
                     "EndIpAddress"
                  ]
               },
               {
                  "result": [
                     "FirewallRuleName4",
                     "62.92.15.68",
                     "62.92.15.68"
                  ]
               }
            ]
         },
         "type": "Microsoft.Sql/servers/databases/vulnerabilityAssessments/rules/baselines",
         "apiVersion": "2018-06-01-preview",
         "name": "[concat(parameters('server_name'),'/', parameters('database_name'), '/default/VA2130/Default')]",
         "dependsOn": [
            "[resourceId('Microsoft.Sql/servers/vulnerabilityAssessments', parameters('server_name'), 'Default')]"
         ],
         "properties": {
            "baselineResults": [
               {
                  "result": [
                     "dbo"
                  ]
               }
            ]
         }
      }
   ]
```

マスター データベースとユーザー データベースでは、リソース名は異なる方法で定義されます。

* マスター データベース - "name": "[concat(parameters('server_name'),'/', parameters('database_name') , '/default/VA2065/<b>master</b>')]",
* ユーザー データベース - "name": "[concat(parameters('server_name'),'/', parameters('database_name') , '/default/VA2065/<b>default</b>')]",
 
 
 ブール型 を true/false として処理するには、ベースラインの結果に "1"/"0" のようなバイナリ入力を設定します。
 
```json
   {
      "type": "Microsoft.Sql/servers/databases/vulnerabilityAssessments/rules/baselines",
      "apiVersion": "2018-06-01-preview",
      "name": "[concat(parameters('server_name'),'/', parameters('database_name'), '/default/VA1143/Default')]",

      "dependsOn": [
         "[resourceId('Microsoft.Sql/servers/vulnerabilityAssessments', parameters('server_name'), 'Default')]"
      ],

      "properties": {
         "baselineResults": [
            {
               "result": [
                  "1"
               ]
            }
         ]
      }

   }
```

## <a name="next-steps"></a>次のステップ  

- [Advanced Data Security](sql-database-advanced-data-security.md) の詳細について学習します。
- [データの検出と分類](sql-database-data-discovery-and-classification.md)についてさらに詳しく学習します。
