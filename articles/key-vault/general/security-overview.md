---
title: Azure Key Vault のセキュリティの概要
description: Azure Key Vault のセキュリティ機能とベスト プラクティスの概要。
services: key-vault
author: msmbaldwin
tags: azure-resource-manager
ms.service: key-vault
ms.subservice: general
ms.topic: conceptual
ms.date: 01/05/2021
ms.author: mbaldwin
ms.openlocfilehash: c7635fdc2012ab404709733d8f5849465c2ee82f
ms.sourcegitcommit: 910a1a38711966cb171050db245fc3b22abc8c5f
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/19/2021
ms.locfileid: "99071569"
---
# <a name="azure-key-vault-security"></a>Azure Key Vault セキュリティ

クラウド内の暗号化キーやシークレット (証明書、接続文字列、パスワードなど) を保護するには、Azure Key Vault を使用します。 ビジネスに不可欠な機密データを格納する場合は、コンテナーとそこに格納されるデータのセキュリティを最大化するための手順を実行する必要があります。

この記事では、Azure Key Vault のセキュリティ機能とベスト プラクティスの概要について説明します。 

> [!NOTE]
> Azure Key Vault のセキュリティに関する推奨事項の包括的な一覧については、「[Key Vault 用の Azure セキュリティ ベースライン](security-baseline.md)」を参照してください。

## <a name="network-security"></a>ネットワークのセキュリティ

コンテナーに対するアクセス権を持つ IP アドレスを指定することで、コンテナーの公開を縮小できます。 Azure Key Vault の仮想ネットワーク サービス エンドポイントを使用すると、指定した仮想ネットワークに対するアクセスを制限できます。 エンドポイントでは、IPv4 (インターネット プロトコル バージョン 4) アドレス範囲のリストへのアクセスを制限することもできます。 このようなソースの外部からお使いのキー コンテナーに接続するユーザーはすべて、アクセスを拒否されます。  詳細については、「[Azure Key Vault の仮想ネットワーク サービス エンドポイント](overview-vnet-service-endpoints.md)」を参照してください。

ファイアウォール ルールを有効にした後は、要求が許可された仮想ネットワークまたは IPv4 アドレス範囲から送信された場合にのみ、ユーザーは Key Vault のデータを読み取ることができます。 これは、Azure portal から Key Vault にアクセスする場合にも適用されます。 ユーザーは Azure portal からキー コンテナーを参照できますが、クライアント マシンが許可リストに登録されていない場合、キー/シークレット/証明書を一覧表示できない場合があります。 これは、他の Azure サービスによる Key Vault 選択機能にも影響します。 ファイアウォール ルールでクライアント マシンが許可されていない場合、ユーザーはキー コンテナーを一覧表示できても、キーは一覧表示できないことがあります。  実装の手順については、「[Azure Key Vault のファイアウォールと仮想ネットワークを構成する](network-security.md)」を参照してください。

Azure Private Link サービスを使用すると、自分の仮想ネットワーク内のプライベート エンドポイント経由で、Azure Key Vault および Azure でホストされている顧客サービスやパートナー サービスにアクセスできます。 Azure プライベート エンドポイントは、Azure Private Link を使用するサービスにプライベートかつ安全に接続するためのネットワーク インターフェイスです。 プライベート エンドポイントは、ご自分の VNet からのプライベート IP アドレスを使用して、サービスを実質的に VNet に取り込みます。 サービスへのすべてのトラフィックをプライベート エンドポイント経由でルーティングできるため、ゲートウェイ、NAT デバイス、ExpressRoute または VPN 接続、パブリック IP アドレスは必要ありません。 仮想ネットワークとサービスの間のトラフィックは、Microsoft のバックボーン ネットワークを経由して、パブリック インターネットからの公開を排除します。 最高レベルの細分性でアクセスを制御しながら Azure リソースのインスタンスに接続できます。  実装の手順については、「[Key Vault を Azure Private Link と統合する](private-link-service.md)」を参照してください。

## <a name="tls-and-https"></a>TLS と HTTPS

- Key Vault のフロントエンド (データ プレーン) はマルチテナント サーバーです。 つまり、異なる顧客のキー コンテナーで同じパブリック IP アドレスを共有できます。 分離を実現するため、各 HTTP 要求は、他の要求とは別に認証および承認されます。
- 古いバージョンの TLS で脆弱性が報告される場合がありますが、パブリック IP アドレスが共有されているため、Key Vault サービス チームは、トランスポート レベルで個別のキー コンテナーに対して古いバージョンの TLS を無効にすることはできません。
- HTTPS プロトコルを使用すると、クライアントは TLS ネゴシエーションに参加できます。 **クライアントで最新バージョンの TLS を強制する** ことができ、クライアントでそれを行うと常に、接続全体で対応するレベルの保護が使用されます。 Key Vault で古い TLS バージョンが引き続きサポートされているからといって、新しい TLS バージョンを使用する接続のセキュリティが損なわれることはありません。
- TLS プロトコルには既知の脆弱性がありますが、攻撃者が脆弱性のある TLS のバージョンで接続を開始したときに、悪意のあるエージェントがキー コンテナーから情報を抽出できるような、既知の攻撃はありません。 攻撃者はやはり認証と承認を行う必要があり、正当なクライアントが常に最新バージョンの TLS で接続している限り、古いバージョンの TLS の脆弱性によって資格情報が漏洩することはありません。

## <a name="identity-management"></a>ID 管理

Azure サブスクリプション内でキー コンテナーを作成すると、作成したキー コンテナーは、そのサブスクリプションの Azure AD テナントに自動的に関連付けられます。 コンテナーのコンテンツを管理または取得しようとするすべてのユーザーは Azure AD で認証される必要があります。 どちらの場合も、アプリケーションは次の 3 つの方法で Key Vault にアクセスできます。

- **アプリケーションのみ**: このアプリケーションは、サービス プリンシパルまたはマネージド ID を表します。 この ID は、キー コンテナーの証明書、キー、またはシークレットに定期的にアクセスする必要があるアプリケーションの最も一般的なシナリオです。 このシナリオが機能するには、アプリケーションの `objectId` をアクセス ポリシーで指定する必要があり、`applicationId` を指定 _しない_ ようにするか、または `null` にする必要があります。
- **ユーザーのみ**: ユーザーは、テナントに登録されている任意のアプリケーションからキー コンテナーにアクセスします。 この種類のアクセスの例として、Azure PowerShell や Azure portal があります。 このシナリオが機能するには、ユーザーの `objectId` をアクセス ポリシーで指定する必要があり、`applicationId` を指定 _しない_ ようにするか、または `null` にする必要があります。
- **アプリケーションとユーザー** (_複合 ID_ とも呼ばれます): ユーザーは、特定のアプリケーションからキー コンテナーにアクセスする必要があり、_かつ_ そのアプリケーションは On-Behalf-Of 認証 (OBO) フローを使用してそのユーザーを偽装する必要があります。 このシナリオが機能するには、`applicationId` と `objectId` の両方をアクセス ポリシーで指定する必要があります。 `applicationId` によってその必要なアプリケーションが識別され、`objectId` によってそのユーザーが識別されます。 現時点では、このオプションはデータ プレーンの Azure RBAC (プレビュー) では使用できません。

すべての種類のアクセスで、アプリケーションは Azure AD を使用して認証します。 アプリケーションでは、アプリケーションの種類に基づいて[サポートされる認証方法](../../active-directory/develop/authentication-vs-authorization.md)が使用されます。 アプリケーションでは、アクセス権を付与するプレーン内のリソース用のトークを取得します。 このリソースは、管理プレーンまたはデータ プレーン内にあるエンドポイントであり、Azure 環境に基づいています。 アプリケーションでは、このトークンを使用して、Key Vault に REST API 要求を送信します。 詳細については、[認証フロー全体](../../active-directory/develop/v2-oauth2-auth-code-flow.md)に関するページを確認してください。

詳細については、「[Key Vault 認証の基礎](authentication-fundamentals.md)」を参照してください。

## <a name="privileged-access"></a>特権アクセス

承認によって、呼び出し元が実行できる操作が決定されます。 Key Vault での認可では、[Azure ロール ベースのアクセス制御](../../role-based-access-control/overview.md) (Azure RBAC) と Azure Key Vault アクセス ポリシーの組み合わせが使用されます。

コンテナーに対するアクセスは 2 つのインターフェイスすなわちプレーンを介して行います。 これらのプレーンは、管理プレーンとデータ プレーンです。

- "*管理プレーン*" は Key Vault そのものを管理する場所であり、コンテナーの作成と削除に使用されるインターフェイスです。 キー コンテナーのプロパティを読み取り、アクセス ポリシーを管理することもできます。
- "*データ プレーン*" では、キー コンテナーに格納されているデータを操作できます。 キー、シークレット、証明書の追加、削除、および変更を行うことができます。

アプリケーションによって、エンドポイントを介してプレーンにアクセスされます。 2 つのプレーンに対するアクセス制御は独立して機能します。 キー コンテナー内のキーを使用するためのアクセスをアプリケーションに許可する場合は、Key Vault アクセス ポリシーまたは Azure RBAC (プレビュー) を使用してデータ プレーンのアクセスを許可します。 ユーザーに対して Key Vault のプロパティおよびタグの読み取りアクセスは許可するが、データ (キー、シークレット、証明書) へのアクセスは許可しない場合は、Azure RBAC を使用して管理プレーンのアクセスを許可します。

次の表に、管理プレーンとデータ プレーンのエンドポイントを示します。

| アクセス&nbsp; プレーン | アクセス エンドポイント | 操作 | アクセス制御メカニズム&nbsp; |
| --- | --- | --- | --- |
| 管理プレーン | **グローバル:**<br> management.azure.com:443<br><br> **Azure China 21Vianet:**<br> management.chinacloudapi.cn:443<br><br> **Azure US Government:**<br> management.usgovcloudapi.net:443<br><br> **Azure Germany:**<br> management.microsoftazure.de:443 | キー コンテナーの作成、読み取り、更新、削除<br><br>Key Vault アクセス ポリシーの設定<br><br>Key Vault タグの設定 | Azure RBAC |
| データ プレーン | **グローバル:**<br> &lt;vault-name&gt;.vault.azure.net:443<br><br> **Azure China 21Vianet:**<br> &lt;vault-name&gt;.vault.azure.cn:443<br><br> **Azure US Government:**<br> &lt;vault-name&gt;.vault.usgovcloudapi.net:443<br><br> **Azure Germany:**<br> &lt;vault-name&gt;.vault.microsoftazure.de:443 | キー: 暗号化、暗号化解除、キーのラップ、キーのラップ解除、署名、確認、取得、一覧表示、作成、更新、インポート、削除、回復、バックアップ、復元、消去<br><br> 証明書: 連絡先の管理、発行者の取得、発行者の一覧表示、発行者の設定、発行者の削除、発行者の管理、取得、一覧表示、作成、インポート、更新、削除、回復、バックアップ、復元、消去<br><br>  シークレット: 取得、一覧表示、設定、削除、回復、バックアップ、復元、消去 | Key Vault アクセス ポリシーまたは Azure RBAC (プレビュー)|

### <a name="managing-administrative-access-to-key-vault"></a>キー コンテナーに対する管理アクセスの管理

リソース グループ内にキー コンテナーを作成するとき、Azure AD を使用してアクセスを管理します。 リソース グループ内のキー コンテナーを管理する権限をユーザーまたはグループに付与します。 適切な Azure ロールを割り当てることで、特定のスコープ レベルでアクセスを付与できます。 キー コンテナーを管理するためのアクセス権をユーザーに付与するには、定義済みの `key vault Contributor` ロールを特定のスコープでそのユーザーに割り当てます。 Azure ロールには以下のスコープ レベルを割り当てることができます。

- **サブスクリプション**:サブスクリプション レベルで割り当てられた Azure ロールは、そのサブスクリプション内のすべてのリソース グループとリソースに適用されます。
- **[リソース グループ]** :リソース グループ レベルで割り当てられた Azure ロールは、そのリソース グループ内のすべてのリソースに適用されます。
- **特定のリソース**: 特定のリソースに対して割り当てられた Azure ロールは、そのリソースに適用されます。 この場合、リソースは特定のキー コンテナーです。

定義済みのロールが複数あります。 定義済みのロールがニーズに合わない場合は、独自のロールを定義できます。 詳細については、[Azure RBAC: 組み込みのロール](../../role-based-access-control/built-in-roles.md)に関するページをご覧ください。

> [!IMPORTANT]
> ユーザーがキー コンテナーの管理プレーンに対する `Contributor` 権限を持っている場合は、そのユーザーは Key Vault アクセス ポリシーを設定することで、データ プレーンへのアクセス権を自分自身に付与できます。 ご利用のキー コンテナーへの `Contributor` ロール アクセス権を持つユーザーの管理は厳密に行う必要があります。 承認されたユーザーだけがコンテナー、キー、シークレット、証明書にアクセスできるようにします。

### <a name="controlling-access-to-key-vault-data"></a>Key Vault データへのアクセスの制御

Key Vault アクセス ポリシーでは、キー、シークレット、または証明書へのアクセス許可が個別に付与されます。 ユーザーに対してはキーへのアクセス権のみ付与でき、シークレットへのアクセス権は付与できません。 キー、シークレット、証明書へのアクセス許可は、コンテナー レベルで管理されます。

> [!IMPORTANT]
> Key Vault アクセス ポリシーでは、特定のキー、シークレット、証明書など、細かいオブジェクト レベルのアクセス許可はサポートされていません。 キーを作成および削除するためのアクセス許可を付与されたユーザーは、そのキー コンテナー内のすべてのキーに対してそれらの操作を実行できます。

キー コンテナーのアクセス ポリシーは、[Azure portal](assign-access-policy-portal.md)、[Azure CLI](assign-access-policy-cli.md)、[Azure PowerShell](assign-access-policy-powershell.md)、または [Key Vault 管理 REST API](/rest/api/keyvault/) を使用して設定できます。

データ プレーンのアクセスは、[Azure Key Vault の仮想ネットワーク サービス エンドポイント](overview-vnet-service-endpoints.md)を使用して制限することができます。 追加のセキュリティ層に対して[ファイアウォールと仮想ネットワーク規則](network-security.md)を構成するできます。

## <a name="logging-and-monitoring"></a>ログ記録と監視

Key Vault のログによって、コンテナーに対して実行されたアクティビティの情報が保存されます。 詳細については、[Key Vault のログ記録](logging.md)に関する記事を参照してください。

Key Vault を Event Grid に統合して、キー コンテナーに格納されているキー、証明書、またはシークレットの状態が変更されたときに通知を受けることができます。 詳細については、「[Azure Event Grid での Key Vault の監視](event-grid-overview.md)」を参照してください。

また、サービスが意図したとおりに動作していることを確認するために、キー コンテナーの正常性を監視することも重要です。 その方法の詳細については、「[Azure Key Vault の監視とアラート](alert.md)」を参照してください。

## <a name="backup-and-recovery"></a>バックアップと回復

Azure Key Vault の論理的な削除と消去保護を使用すると、削除されたコンテナーとコンテナー オブジェクトを復旧できます。 詳細については、「[Azure Key Vault の論理的な削除の概要](soft-delete-overview.md)」を参照してください。

また、コンテナー内のオブジェクトの更新、削除、作成の際には、コンテナーの定期的バックアップを取る必要があります。  

## <a name="next-steps"></a>次の手順

- [Azure Key Vault 用の Azure セキュリティ ベースライン](security-baseline.md)
- [Azure Key Vault のベスト プラクティス](security-baseline.md)
- [Azure Key Vault の仮想ネットワーク サービス エンドポイント](overview-vnet-service-endpoints.md)
- [Azure RBAC: 組み込みのロール](../../role-based-access-control/built-in-roles.md)に関するページを参照してください。
