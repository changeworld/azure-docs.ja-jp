---
title: "Azure のネットワーク セキュリティの概要 | Microsoft Docs"
description: "Azure リソース間のネットワーク トラフィック フローを制御するためのセキュリティ オプションについて説明します。"
services: virtual-network
documentationcenter: na
author: jimdial
manager: jeconnoc
editor: 
ms.assetid: 
ms.service: virtual-network
ms.devlang: NA
ms.topic: get-started-article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 09/19/2017
ms.author: jdial
ms.openlocfilehash: 98559cbb0acab91c4b2c30c6d0129e955eef85f9
ms.sourcegitcommit: 6699c77dcbd5f8a1a2f21fba3d0a0005ac9ed6b7
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 10/11/2017
---
# <a name="network-security"></a>ネットワークのセキュリティ

ネットワーク セキュリティ グループを使って、仮想ネットワーク内のリソースへのネットワーク トラフィックを制限することができます。 ネットワーク セキュリティ グループには、ソースまたはターゲット IP アドレス、ポート、およびプロトコルを基に、受信/送信ネットワーク トラフィックを許可または拒否するセキュリティ規則の一覧が含まれています。 

## <a name="network-security-groups"></a>ネットワーク セキュリティ グループ

各ネットワーク インターフェイスには、1 つのネットワーク セキュリティ グループが関連付けられているか、または関連付けられていません。 各ネットワーク インターフェイスは、[仮想ネットワーク](virtual-networks-overview.md) サブネットに存在します。 各サブネットにも、1 つのネットワーク セキュリティ グループが関連付けられているか、または関連付けられていません。 

サブネットにセキュリティ規則を適用すると、サブネット内のすべてのリソースにセキュリティ規則が適用されます。 ネットワーク インターフェイスに加えて、HDInsight、仮想マシン スケール セット、サブネットにデプロイされている Application Service Environments などの他の Azure サービスのインスタンスが存在する場合があります。

ネットワーク セキュリティ グループが、ネットワーク インターフェイスと、ネットワーク インターフェイスがあるサブネットの両方に関連付けられている場合、ネットワーク セキュリティ グループは次のように適用されます。

- **受信トラフィック**: ネットワーク インターフェイスがあるサブネットに関連付けられているネットワーク セキュリティ グループが最初に評価されます。 サブネットに関連づけられているネットワーク セキュリティ グループを通して許可されたトラフィックは、次に、ネットワーク インターフェイスに関連付けられているネットワーク セキュリティ グループによって評価されます。 たとえば、仮想マシンへの受信アクセスは、インターネットからポート 80 を経由する必要があります。 ネットワーク インターフェイスと、ネットワーク インターフェイスのあるサブネットの両方にネットワーク セキュリティ グループを関連付けている場合は、サブネットとネットワーク インターフェイスに関連付けられているネットワーク セキュリティ グループでポート 80 の使用が許可されている必要があります。 サブネットまたはサブネットのあるネットワーク インターフェイスのいずれか一方のみに関連づけられているネットワーク セキュリティ グループでポート 80 が許可されていても、既定のセキュリティ規則のため通信が失敗します。 詳しくは、「[既定セキュリティ規則](#default-security-rules)」をご覧ください。 たとえば、サブネットまたはネットワーク インターフェイスのいずれか一方にのみネットワーク セキュリティ グループを適用し、そのネットワーク セキュリティ グループに受信ポート 80 のトラフィックを許可する規則が含まれている場合は、通信は成功します。 
- **送信トラフィック**: ネットワーク インターフェイスに関連付けられているネットワーク セキュリティ グループが最初に評価されます。 ネットワーク インターフェイスに関連付けられているネットワーク セキュリティ グループを通して許可されたトラフィックは、次に、サブネットに関連付けられているネットワーク セキュリティ グループによって評価されます。

ネットワーク セキュリティ グループが、ネットワーク インターフェイスとサブネットの両方に適用されているかわからない場合があります。 ネットワーク インターフェイスの[有効なセキュリティ規則](virtual-network-manage-nsg-arm-portal.md)を表示すると、ネットワーク インターフェイスに適用されている規則の集計を簡単に確認できます。 Azure Network Watcher の [[IP フローの確認]](../network-watcher/network-watcher-check-ip-flow-verify-portal.md?toc=%2fazure%2fvirtual-network%2ftoc.json) 機能を使って、ネットワーク インターフェイスの受信/送信が許可されているかどうかを確認することもできます。 このツールを使うと、通信が許可されているか、どのネットワーク セキュリティ規則でトラフィックが許可/拒否されているかを確認できます。
 
> [!NOTE]
> ネットワーク セキュリティ グループは、Resource Manager デプロイメント モデルのネットワーク インターフェイスではなく、サブネット、またはクラシック デプロイメント モデルにデプロイされた仮想マシンクラウド サービスに関連付けられています。 Azure のデプロイメント モデルについて詳しくは、[Azure のデプロイメント モデルの概要](../azure-resource-manager/resource-manager-deployment-model.md?toc=%2fazure%2fvirtual-network%2ftoc.json)に関する記事をご覧ください。

同じネットワーク セキュリティ グループを、任意の数のネットワーク インターフェイスとサブネットに適用できます。

## <a name="security-rules"></a>セキュリティ規則

ネットワーク セキュリティ グループには、0 個、または Azure サブスクリプションの[制限](../azure-subscription-service-limits.md?toc=%2fazure%2fvirtual-network%2ftoc.json#azure-resource-manager-virtual-networking-limits)内の任意の数の規則が含まれています。 各規則では次のプロパティを指定します。

|プロパティ  |説明  |
|---------|---------|
|名前|ネットワーク セキュリティ グループ内で一意の名前。|
|優先順位 | 100 ～ 4096 の数値。 規則は、優先順位に従って処理され、数値が小さいほど優先順位が高いために、大きい数値の前に小さい数値が処理されます。 トラフィックが規則に一致すると、処理が停止します。 この結果、優先順位低く (数値が大きい)、優先順位が高い規則と同じ属性を持つ規則は処理されません。|
|ソース/ターゲット| IP アドレス、CIDR ブロック (例: 10.0.0.0/24)、サービス タグ、またはアプリケーション セキュリティ グループ。 [サービス タグ](#service-tags)と[アプリケーションのセキュリティ グループ](#application-security-groups)の詳細をご覧ください。 範囲、サービス タグ、またはアプリケーション セキュリティ グループを指定すると、作成するセキュリティ規則の数を減らせます。 規則内で複数の個別 IP アドレスと範囲 (複数のサービス タグまたはアプリケーション グループは指定できません) を指定する機能はプレビュー リリースで実装されており、拡張セキュリティ規則と呼ばれています。 拡張セキュリティ規則は、Resource Manager デプロイメント モデルで作成されたネットワーク セキュリティ グループでのみ作成できます。 クラシック デプロイメント モデルで作成されたネットワーク セキュリティ グループで、複数の IP アドレスおよび IP アドレス範囲を指定することはできません。|
|プロトコル     | TCP、UDP、または Any。Any には TCP、UDP、ICMP が含まれます。 ICMP だけを指定することはできないので、ICMP が必要な場合は、Any を使う必要があります。 |
|方向| 規則が受信トラフィックまたは送信トラフィックに適用されるかどうか。|
|ポートの範囲     |個別のポートまたはポートの範囲を指定できます。 たとえば、80 や 10000-10005 などと指定できます。 範囲を指定すると、作成するセキュリティ規則の数を減らすことができます。 規則内で複数の個別ポートとポートの範囲を指定する機能はプレビュー リリースで実装されており、拡張セキュリティ規則と呼ばれています。 拡張セキュリティ規則を使う前に、[プレビュー機能](#preview-features)の重要な情報をお読みください。 拡張セキュリティ規則は、Resource Manager デプロイメント モデルで作成されたネットワーク セキュリティ グループでのみ作成できます。 クラシック デプロイメント モデルで作成されたネットワーク セキュリティ グループで、複数のポートまたはポート範囲を指定することはできません。   |
|[操作]     | 許可または拒否        |

**考慮事項**

- **ホスト ノードの仮想 IP:** DHCP、DNS、正常性の監視などの基本的なインフラストラクチャ サービスは、仮想化されたホストの IP アドレス 168.63.129.16 および 169.254.169.254 を通じて提供されます。 このパブリック IP アドレスは Microsoft に属し、この目的のためにすべてのリージョンで使われる唯一の仮想化 IP アドレスです。 このアドレスは、仮想マシンをホストしているサーバー マシン (ホスト ノード) の物理 IP アドレスにマッピングされます。 ホスト ノードは、DHCP リレー、DNS の再帰的リゾルバー、および Load Balancer の正常性プローブとマシンの正常性プローブのプローブ元として機能します。 この IP アドレスへの通信は攻撃ではありません。 これらの IP アドレスの受信/送信トラフィックをブロックすると、仮想マシンが正しく機能しない可能性があります。
- **ライセンス (キー管理サービス)**: 仮想マシンで実行されている Windows イメージのライセンスを取得する必要があります。 ライセンスを適用するために、そのような問い合わせを処理するキー管理サービスのホスト サーバーには要求が送信されます。 この要求は、ポート 1688 を通じて送信されます。
- **負荷分散プール内の仮想マシン**: 適用されるソース ポートおよびアドレス範囲は、元のコンピューターからのもので、ロード バランサーではありません。 ターゲット ポートとアドレス範囲は、ロード バランサーのものではなく、ターゲット コンピューターのものになります。
- **Azure のサービス インスタンス**: HDInsight、Application Service Environments、および仮想マシン スケール セットなどの Azure サービスのインスタンスが仮想ネットワークのサブネットにデプロイされています。 リソースがデプロイされているサブネットにネットワーク セキュリティ グループを適用する前に、各サービスのポート要件を確認してください。 サービスに必要なポートを拒否すると、サービスは正しく機能しません。 

セキュリティ規則はステートフルです。 たとえば、ポート 80 経由で任意のアドレスに送信セキュリティ規則を指定した場合、送信トラフィックへの応答に受信セキュリティ規則を指定する必要はありません。 通信が外部から開始された場合は、受信セキュリティ規則のみを指定する必要があります。 反対の場合も同じです。 ポートで受信トラフィックが許可されている場合、そのポートでのトラフィックに応答するために、送信セキュリティ規則を指定する必要はありません。 セキュリティ規則を作成するときの制限について詳しくは、[Azure の制限](../azure-subscription-service-limits.md?toc=%2fazure%2fvirtual-network%2ftoc.json#azure-resource-manager-virtual-networking-limits)に関する記事をご覧ください。

## <a name="augmented-security-rules"></a>拡張セキュリティ規則

拡張規則を使うと仮想ネットワークのセキュリティ定義が簡略化され、大規模で複雑なネットワーク セキュリティ ポリシーを少ない規則で定義できます。 複数のポート、複数の明示的 IP アドレス、サービス タグ、アプリケーション セキュリティ グループを組み合わせて、単一のわかりやすいセキュリティ規則を作成できます。 拡張規則は、規則のソース、ターゲット、ポート フィールドで使います。 規則を作成するときは、複数の明示的 IP アドレス、CIDR 範囲、およびポートを指定できます。 セキュリティ規則の定義の保守を簡素化するには、拡張セキュリティ規則とサービス タグまたはアプリケーション セキュリティ グループを組み合わせます。 

拡張セキュリティ規則は、プレビュー リリースで利用できます。 拡張セキュリティ規則を作成するときの制限について詳しくは、[Azure の制限](../azure-subscription-service-limits.md?toc=%2fazure%2fvirtual-network%2ftoc.json#azure-resource-manager-virtual-networking-limits)に関する記事をご覧ください。 プレビュー状態の機能の可用性と信頼性は、一般公開リリースの機能と同じレベルではありません。 プレビュー機能は、米国東部、米国西部、米国西部 2、米国中西部、オーストラリア東部、オーストラリア南東部、英国南部の各リージョンでのみ利用できます。

## <a name="default-security-rules"></a>既定セキュリティ規則

ネットワーク セキュリティ グループがサブネットまたはネットワーク インターフェイスに関連付けられていない場合、サブネットまたはネットワーク インターフェイスで送受信されるすべてのトラフィックが許可されます。 ネットワーク セキュリティ グループを作成すると直ちに、ネットワーク セキュリティ グループに次の既定の規則が作成されます。

### <a name="inbound"></a>受信

#### <a name="allowvnetinbound"></a>AllowVNetInBound

|優先順位|ソース|ソース ポート|変換先|ターゲット ポート|プロトコル|Access (アクセス)|
|---|---|---|---|---|---|---|
|65000|VirtualNetwork|0-65535|VirtualNetwork|0-65535|すべて|ALLOW|

#### <a name="allowazureloadbalancerinbound"></a>AllowAzureLoadBalancerInBound

|優先順位|ソース|ソース ポート|変換先|ターゲット ポート|プロトコル|Access (アクセス)|
|---|---|---|---|---|---|---|
|65001|AzureLoadBalancer|0-65535|0.0.0.0/0|0-65535|すべて|ALLOW|

#### <a name="denyallinbound"></a>DenyAllInbound

|優先順位|ソース|ソース ポート|変換先|ターゲット ポート|プロトコル|Access (アクセス)|
|---|---|---|---|---|---|---|
|65500|0.0.0.0/0|0-65535|0.0.0.0/0|0-65535|すべて|DENY|

### <a name="outbound"></a>送信

#### <a name="allowvnetoutbound"></a>AllowVnetOutBound

|優先順位|ソース|ソース ポート| 変換先 | ターゲット ポート | プロトコル | Access (アクセス) |
|---|---|---|---|---|---|---|
| 65000 | VirtualNetwork | 0-65535 | VirtualNetwork | 0-65535 | すべて | ALLOW |

#### <a name="allowinternetoutbound"></a>AllowInternetOutBound

|優先順位|ソース|ソース ポート| 変換先 | ターゲット ポート | プロトコル | Access (アクセス) |
|---|---|---|---|---|---|---|
| 65001 | 0.0.0.0/0 | 0-65535 | インターネット | 0-65535 | すべて | ALLOW |

#### <a name="denyalloutbound"></a>DenyAllOutBound

|優先順位|ソース|ソース ポート| 変換先 | ターゲット ポート | プロトコル | Access (アクセス) |
|---|---|---|---|---|---|---|
| 65500 | 0.0.0.0/0 | 0-65535 | 0.0.0.0/0 | 0-65535 | すべて | DENY |

"**ソース**" 列と "**ターゲット**" 列の *VirtualNetwork*、*AzureLoadBalancer*、および *Internet* は、IP アドレスではなく[サービス タグ](#tags)です。 "プロトコル" 列で "**すべて**" は TCP、UDP、ICMP を含みます。 規則を作成するとき、TCP、UDP、またはすべてを指定できますが、ICMP だけを指定することはできません。 そのため、規則で ICMP が必要な場合は、プロトコルとして "*すべて*" を選ぶ必要があります。 "**ソース**" 列と "**ターゲット**" 列の *0.0.0.0/0* は、すべてのアドレスを表します。
 
既定の規則は削除できませんが、優先順位の高い規則を作成することでオーバーライドできます。

## <a name="service-tags"></a>サービス タグ

 サービス タグは IP アドレス プレフィックスのグループを表し、セキュリティ規則の作成の複雑さを最小限に抑えるのに役立ちます。 独自のサービス タグを作成したり、タグに含まれる IP アドレスを指定したりすることはできません。 サービス タグに含まれるアドレス プレフィックスの管理は Microsoft が行い、アドレスが変化するとサービス タグは自動的に更新されます。 セキュリティ規則を作成するときは、特定の IP アドレスの代わりにサービス タグを使うことができます。 セキュリティ規則の定義で使うことができるサービス タグは次のとおりです。 サービス タグの名前は、[Azure のデプロイメント モデル](../azure-resource-manager/resource-manager-deployment-model.md?toc=%2fazure%2fvirtual-network%2ftoc.json)により若干異なります。

* **VirtualNetwork** (*Resource Manager) (クラシックの場合は **VIRTUAL_NETWORK**): このタグには、仮想ネットワーク アドレス空間 (仮想ネットワークに対して定義されているすべての CIDR 範囲)、すべての接続されたオンプレミスのアドレス空間、および[ピアリングされた](virtual-network-peering-overview.md)仮想ネットワークまたは[仮想ネットワーク ゲートウェイ](../vpn-gateway/vpn-gateway-about-vpngateways.md?toc=%2fazure%2fvirtual-network%2ftoc.json)に接続された仮想ネットワークが含まれます。
* **AzureLoadBalancer** (Resource Manager) (クラシックの場合は **AZURE_LOADBALANCER**): このタグは、Azure のインフラストラクチャのロード バランサーを表します。 このタグは、Azure の正常性プローブが開始される [Azure データセンター IP アドレス](https://www.microsoft.com/download/details.aspx?id=41653)に変換されます。 Azure Load Balancer を使っていない場合は、この規則を上書きできます。
* **Internet** (Resource Manager) (クラシックの場合は **INTERNET**): このタグは、パブリック インターネットによってアクセスできる仮想ネットワークの外部の IP アドレス空間を表します。 [Azure に所有されているパブリック IP アドレス空間](https://www.microsoft.com/download/details.aspx?id=41653)がこのアドレス範囲に含まれます。
* **AzureTrafficManager** (Resource Manager のみ): このタグは、Azure Traffic Manager サービスの IP アドレス空間を表します。
* **Storage** (Resource Manager のみ): このタグは、Azure Storage サービスの IP アドレス空間を表します。 値として *Storage* を指定した場合、ストレージへのトラフィックが許可または拒否されます。 特定の[リージョン](https://azure.microsoft.com/regions)のストレージに対するアクセスのみを許可する場合は、リージョンを指定することができます。 たとえば、米国東部リージョンの Azure Storage へのアクセスのみを許可する場合は、サービス タグとして *Storage.EastUS* と指定できます。 その他の使用可能なリージョン サービス タグは、Storage.AustraliaEast、Storage.AustraliaSoutheast、Storage.EastUS、Storage.UKSouth、Storage.WestCentralUS、Storage.WestUS、Storage.WestUS2 です。 タグはサービスだけを表し、サービスの特定のインスタンスは表しません。 たとえば、このタグは Azure Storage サービスを表しますが、特定の Azure Storage アカウントは表しません。
* **Sql** (Resource Manager のみ): このタグは、Azure SQL Database サービスおよび Azure SQL Data Warehouse サービスのアドレス プレフィックスを表します。 このサービス タグでは、特定のリージョンだけを指定することができます。 たとえば、米国東部リージョンの Azure SQL Database へのアクセスのみを許可する場合は、サービス タグとして *Sql.EastUS* と指定できます。 すべての Azure リージョンに対してのみ Sql を指定することはできません、リージョンを個別に指定する必要があります。 その他の使用可能なリージョン サービス タグは、Sql.AustraliaEast、Sql.AustraliaSoutheast、Sql.EastUS、Sql.UKSouth、Sql.WestCentralUS、Sql.WestUS、Sql.WestUS2 です。 タグはサービスだけを表し、サービスの特定のインスタンスは表しません。 たとえば、このタグは Azure SQL Database サービスを表しますが、特定の Azure SQL データベースは表しません。

> [!WARNING]
> AzureTrafficManager、Storage、Sql の各サービス タグは、プレビュー リリースで使うことができます。 プレビュー状態の機能の可用性と信頼性は、一般公開リリースの機能と同じレベルではありません。 サービス タグは、米国東部、米国西部、米国西部 2、米国中西部、オーストラリア東部、オーストラリア南東部、英国南部の各リージョンでのみ利用できます。

> [!NOTE]
> Azure Storage や Azure SQL Database などのサービスの仮想ネットワーク サービス エンドポイントを実装する場合、Azure はサービスの仮想ネットワーク サブネットへのルートを追加します。 ルートのアドレス プレフィックスは、対応するサービス タグと同じアドレス プレフィックスまたは CIDR 範囲です。

## <a name="application-security-groups"></a>アプリケーション セキュリティ グループ

アプリケーション セキュリティ グループを使うと、ネットワーク セキュリティをアプリケーションの構造の自然な拡張として構成でき、仮想マシンをグループ化して、それらのグループに基づくネットワーク セキュリティ ポリシーを定義できます。 この機能では、明示的な IP アドレスを手動でメンテナンスせずに、大きなセキュリティ ポリシーを再利用することができます。 プラットフォームが明示的な IP アドレスと複数の規則セットの複雑さを処理するので、ユーザーはビジネス ロジックに専念することができます。

セキュリティ規則のソースおよびターゲットとして、アプリケーション セキュリティ グループを指定できます。 セキュリティ ポリシーを定義した後は、仮想マシンを作成し、仮想マシンのネットワーク インターフェイスをアプリケーション セキュリティ グループに割り当てることができます。 ポリシーは、仮想マシン内の各ネットワーク インターフェイスのアプリケーション セキュリティ グループのメンバーシップに基づいて適用されます。 次の例では、サブスクリプションのすべての Web サーバーにアプリケーション セキュリティ グループを使う方法を示します。

1. *WebServers* という名前のアプリケーション セキュリティ グループを作成します。
2. *MyNSG* という名前のネットワーク セキュリティ グループを作成します。
3. ネットワーク セキュリティ グループで受信セキュリティ規則を作成し、ソース アドレスとして *Internet* サービス タグ、ターゲット アドレスとして *WebServers* アプリケーション セキュリティ グループを指定し、ポート 80 と 443 を許可します。
4. Web サーバー アプリケーションを実行する仮想マシンをデプロイします。 仮想マシンのネットワーク インターフェイスを、*WebServers* アプリケーション セキュリティ グループのメンバーとして指定します。 これにより、ポート 80 と 443 が仮想マシンに対して許可されます。 これ以降に *WebServers* アプリケーション セキュリティ グループのメンバーとして作成するすべての Web サーバーについても、これらのポートが許可されます。 

他の規則を作成し、ターゲットとして他のアプリケーション セキュリティ グループを指定した場合、前の例の Web サーバーにはそれらの規則は適用されません。 アプリケーション セキュリティ グループが指定されている規則は、そのアプリケーション セキュリティ グループのメンバーであるネットワーク インターフェイスにのみ適用されます。 アプリケーション セキュリティ グループを拡張セキュリティ規則およびサービス タグと組み合わせて使うと、最小限の数のネットワーク セキュリティ グループを作成して、サブスクリプション内のネットワーク セキュリティを管理できます。
 
アプリケーション セキュリティ グループを作成するとき、およびセキュリティ規則でアプリケーション セキュリティ グループを指定するときの制限については、[Azure の制限](../azure-subscription-service-limits.md?toc=%2fazure%2fvirtual-network%2ftoc.json#azure-resource-manager-virtual-networking-limits)に関する記事をご覧ください。

アプリケーション セキュリティ グループは、プレビュー リリースで利用できます。 アプリケーション セキュリティ グループを使う前に、[アプリケーション セキュリティ グループでネットワーク セキュリティ グループを作成する方法](create-network-security-group-preview.md#powershell)に関する記事の手順 1. ～ 5. を完了してそれらの使用を登録し、[プレビュー機能](#preview-features)についての重要な情報を読んでおく必要があります。 プレビューの期間中、アプリケーション セキュリティ グループは仮想ネットワークの範囲に制限されます。 ネットワーク セキュリティ グループ上のアプリケーション セキュリティ グループに対する相互参照とピアリングされた仮想ネットワークには適用されませんです。 

プレビュー状態の機能の可用性と信頼性は、一般公開リリースの機能と同じレベルではありません。 アプリケーション セキュリティ グループを使う前に、アプリケーション セキュリティ グループの使用を登録する必要があります。 この機能は、米国中西部リージョンでのみ使用可能です。

## <a name="next-steps"></a>次のステップ

* [ネットワーク セキュリティ グループの作成](virtual-networks-create-nsg-arm-pportal.md)に関するチュートリアルを行います
* [アプリケーション セキュリティ グループを使ったネットワーク セキュリティ グループの作成](create-network-security-group-preview.md)に関するチュートリアルを行います
