---
title: Azure IoT Edge セキュリティ マネージャー - Azure IoT Edge
description: IoT Edge デバイスのセキュリティ方針とセキュリティ サービスの整合性を管理します。
services: iot-edge
keywords: セキュリティ, セキュリティで保護された要素, エンクレーブ, TEE, IoT Edge
author: eustacea
manager: philmea
ms.author: eustacea
ms.date: 08/30/2019
ms.topic: conceptual
ms.service: iot-edge
ms.openlocfilehash: d5cfa16196a8815b711fd5277a80f6eb67d3a388
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/27/2020
ms.locfileid: "76548698"
---
# <a name="azure-iot-edge-security-manager"></a>Azure IoT Edge セキュリティ マネージャー

Azure IoT Edge セキュリティ マネージャーは、セキュア シリコン ハードウェアを抽象化することによって IoT Edge デバイスとそのすべてのコンポーネントを保護するための、適切に境界付けられたセキュリティ コアです。 セキュリティ マネージャーはセキュリティ強化の中心点であり、相手先ブランド製造 (OEM) にテクノロジの統合ポイントを提供します。

![Azure IoT Edge セキュリティ マネージャー](media/edge-security-manager/iot-edge-security-manager.png)

IoT Edge セキュリティ マネージャーの目的は、IoT Edge デバイスとすべての本質的なソフトウェア動作の整合性を保護することです。 セキュリティ マネージャーは、基になる信頼のハードウェア ルート ハードウェア (ある場合) から信頼を移行して、IoT Edge ランタイムをブートストラップし、進行中の操作を監視します。  IoT Edge セキュリティ マネージャーは、セキュア シリコン ハードウェア (使用可能な場合) と共に動作するソフトウェアで、可能な最高のセキュリティ保証を提供する助けとなります。  

IoT Edge セキュリティ マネージャーには次のような役割がありますが、これらに限定されているわけではありません。

* Azure IoT Edge デバイスのセキュリティで保護されて測定されたブートストラップ。
* デバイス ID のプロビジョニングと信頼の切り替え (該当する場合)。
* Device Provisioning Service などのクラウド サービスのデバイス コンポーネントのホストと保護。
* 一意の ID による、セキュリティで保護された、IoT Edge モジュールのプロビジョニング。
* 公証人サービスによる信頼のデバイス ハードウェア ルートに対するゲートキーパー。
* 実行時の IoT Edge の動作の整合性の監視。

IoT Edge セキュリティ マネージャーには、次の 3 つのコンポーネントが含まれます。

* IoT Edge セキュリティ デーモン。
* ハードウェア セキュリティ モジュール プラットフォーム抽象化レイヤー (HSM PAL)。
* 必須ではないが強く推奨される信頼のハードウェア シリコン ルート (HSM)。

## <a name="the-iot-edge-security-daemon"></a>IoT Edge セキュリティ デーモン

IoT Edge セキュリティ デーモンは、IoT Edge セキュリティ マネージャーの論理動作を担当します。 これは、IoT Edge デバイスの信頼できるコンピューティング ベースの重要な部分を表します。

### <a name="design-principles"></a>設計原則

IoT Edge セキュリティ デーモンは、動作の整合性を最大にする、肥大化とチャーンを最小限にするという 2 つの中心原則に従います。

#### <a name="maximize-operational-integrity"></a>動作の整合性を最大にする

IoT Edge セキュリティ デーモンは、特定の信頼のハードウェア ルートに備わる防御機能内で、可能な限り高い整合性を持って動作します。 適切な統合により、信頼のルート ハードウェアは、静的および実行時にセキュリティ デーモンを測定および監視して改ざんを防ぎます。

物理的なアクセスは、常に IoT デバイスに対する脅威となっています。 信頼のハードウェア ルートは、IoT Edge セキュリティ デーモンの整合性の保護において重要な役割を果たします。  信頼のハードウェア ルートには、次の 2 種類があります。

* シークレットや暗号化キーなどの機密情報を保護するためのセキュリティで保護された要素。
* キーのようなシークレットおよび測定や課金のような機密性の高いワークロードなどを保護するためのセキュリティで保護されたエンクレーブ。

信頼のハードウェア ルートを利用するために、次の 2 種類の実行環境があります。

* 機密情報の保護をセキュリティで保護された要素の使用に依存する標準またはリッチ実行環境 (REE)。
* 機密情報の保護およびソフトウェア実行に対する保護の提供をセキュリティで保護されたエンクレーブ テクノロジの使用に依存する、信頼できる実行環境 (TEE)。

信頼のハードウェア ルートとしてセキュリティで保護されたエンクレーブを使用するデバイスの場合、IoT Edge セキュリティ デーモン内の機密性の高いロジックはエンクレーブ内に存在する必要があります。  セキュリティ デーモンの重要ではない部分は、TEE の外部に存在できます。  いずれの場合も、元の設計製造 (ODM) およ相手先ブランド製造 (OEM) は、それらの HSM から信頼を拡張し、起動時と実行時に IoT Edge セキュリティ デーモンの整合性を測定して保護する必要があります。

#### <a name="minimize-bloat-and-churn"></a>肥大化とチャーンを最小にする

IoT Edge セキュリティ デーモンのもう 1 つの中心原則は、チャーンを最小限に抑えることです。  最高レベルの信頼のために、IoT Edge セキュリティ デーモンは信頼のデバイス ハードウェア ルートと緊密に結合し、ネイティブ コードとして動作することができます。  この種の実現方法では、(OS で提供される更新メカニズムではなく) 信頼のハードウェア ルートのセキュリティで保護された更新パスによってデーモンのソフトウェアを更新するのが一般的であり、一部のシナリオでは困難になる可能性があります。  IoT デバイスに対してはセキュリティの更新が推奨されますが、過剰な更新要件や大規模な更新ペイロードは、さまざまな方法で脅威にさらされる面を拡大する可能性があります。  たとえば、動作の可用性を最大化する更新のスキップ、または大きな更新ペイロードを処理するために過度に制約される信頼のルート ハードウェアなどです。  そのため、IoT Edge セキュリティ デーモンの設計は、フットプリントにしたがって信頼できるコンピューティング ベースを小さく保ち、更新要件を最小限に抑えるために、簡潔なものになっています。

### <a name="architecture-of-iot-edge-security-daemon"></a>IoT Edge セキュリティ デーモンのアーキテクチャ

![Azure IoT Edge セキュリティ デーモン](media/edge-security-manager/iot-edge-security-daemon.png)

IoT Edge セキュリティ デーモンは、セキュリティ強化のために利用可能な信頼のハードウェア ルート テクノロジを活用します。  ハードウェア テクノロジによって、信頼できる実行環境 (TEE) が提供される場合は、標準/リッチ実行環境 (REE) と信頼できる実行環境の間の分割動作も可能となっています。 ロール固有のインターフェイスによって、IoT Edge の主要コンポーネントは、IoT Edge デバイスとその動作の整合性を確保できます。

#### <a name="cloud-interface"></a>クラウド インターフェイス

クラウド インターフェイスにより、IoT Edge セキュリティ デーモンは、セキュリティ更新のようなデバイス セキュリティに対するクラウド補完などのクラウド サービスにアクセスできます。  たとえば、IoT Edge セキュリティ デーモンは、現在、このインターフェイスを使用してデバイス ID ライフサイクル管理のために Azure IoT Hub の [Device Provisioning Service](https://docs.microsoft.com/azure/iot-dps/) にアクセスします。  

#### <a name="management-api"></a>管理 API

IoT Edge セキュリティ デーモンには管理 API が用意されており、IoT Edge モジュールの作成/開始/停止/削除時に IoT Edge エージェントによって呼び出されます。 このセキュリティ デーモンは、すべてのアクティブなモジュールの "登録" を保持しています。 これらの登録は、モジュールの ID をモジュールの一部のプロパティにマップします。 これらのモジュール プロパティには例えば、コンテナーで実行しているプロセスのプロセス ID (pid) や、Docker コンテナーの内容のハッシュなどがあります。

これらのプロパティは、呼び出し元がアクションを許可されていることを確認するために、ワークロード API (後述) によって使用されます。

管理 API は特権を持つ API であり、IoT Edge エージェントからのみ呼び出すことができます。  IoT Edge セキュリティ デーモンは、IoT Edge エージェントをブートストラップして開始するので、IoT Edge エージェントが改ざんされていないことを確認した後で、IoT Edge エージェントの暗黙の登録を作成できます。 ワークロード API が使用するものと同じ構成証明プロセスによって、管理 API へのアクセスが IoT Edge エージェントだけに制限されます。

#### <a name="container-api"></a>コンテナー API

コンテナー API は、モジュール管理に使用されているコンテナー システム (Moby や Docker など) と対話します。

#### <a name="workload-api"></a>ワークロード API

ワークロード API は、すべてのモジュールからアクセスできます。 これが、HSM ルート化署名付きトークンまたは X509 証明書のいずれかで ID の証明を提供し、対応する信頼バンドルをモジュールに提供します。 信頼バンドルには、モジュールが信頼する必要のある他のすべてのサーバーの CA 証明書が含まれています。

IoT Edge セキュリティ デーモンは、構成証明プロセスを使用してこの API を保護します。 モジュールがこの API を呼び出すと、このセキュリティ デーモンは ID の登録の検出を試みます。 見つかった場合は、登録のプロパティを使ってモジュールを測定します。 測定プロセスの結果が登録と一致する場合は、新しい ID の証明が生成されます。 モジュールには、対応する CA 証明書 (信頼バンドル) が返されます。  モジュールは、この証明書を使って、IoT Hub や他のモジュールに接続したり、サーバーを起動したりします。 署名付きトークンまたは証明書の有効期限が近づいたときは、モジュールが新しい証明書を要求する必要があります。

### <a name="integration-and-maintenance"></a>統合とメンテナンス

Microsoft は、[GitHub 上の IoT Edge セキュリティ デーモン](https://github.com/Azure/iotedge/tree/master/edgelet)に対するメイン コード ベースを保持しています。

#### <a name="installation-and-updates"></a>インストールと更新

IoT Edge セキュリティ デーモンのインストールと更新は、オペレーティング システムのパッケージ管理システムによって管理されます。 信頼のハードウェア ルートを備えた IoT Edge デバイスでは、セキュリティで保護された起動および更新管理システムによってライフサイクルを管理することで、デーモンの整合性がさらに強化されるはずです。 デバイスの製造元は、それぞれのデバイス機能に基づいて、これらの手段を検討する必要があります。

#### <a name="versioning"></a>バージョン管理

IoT Edge ランタイムは、IoT Edge セキュリティ デーモンのバージョンを追跡して報告します。 バージョンは、IoT Edge エージェント モジュールが報告するプロパティの *runtime.platform.version* 属性として報告されます。

### <a name="hardware-security-module-platform-abstraction-layer-hsm-pal"></a>ハードウェア セキュリティ モジュール プラットフォーム抽象化レイヤー (HSM PAL)

HSM PAL は、すべての信頼のルート ハードウェアを抽象化して、IoT Edge の開発者やユーザーをそれらの複雑さから切り離します。  これには、アプリケーション プログラミング インターフェイス (API) と、ドメイン内通信手順 (標準実行環境とセキュリティで保護されたエンクレーブとの間の通信など) の組み合わせが含まれます。  HSM PAL の実際の実装は、使用されている特定のセキュリティ保護されたハードウェアに依存します。 それが存在することで、ほとんどすべてのセキュア シリコン ハードウェアが使用可能になります。

## <a name="secure-silicon-root-of-trust-hardware"></a>信頼のセキュア シリコン ルート ハードウェア

セキュア シリコンは、IoT Edge デバイス ハードウェア内に信頼を固定するために必要です。  セキュア シリコンは、トラステッド プラットフォーム モジュール (TPM)、埋め込みセキュア エレメント (eSE)、ARM TrustZone、Intel SGX、カスタム セキュア シリコン テクノロジなど、さまざまな形式で提供されます。  IoT デバイスの物理的なアクセシビリティに関連する脅威のため、デバイスでは信頼のセキュア シリコン ルートを使うことをお勧めします。

## <a name="iot-edge-security-manager-integration-and-maintenance"></a>IoT Edge セキュリティ マネージャーの統合とメンテナンス

IoT Edge セキュリティ マネージャーの目的は、Azure IoT Edge プラットフォームのセキュリティと整合性を保護するコンポーネントを識別して分離し、独自のセキュリティ強化を図ることです。 デバイス製造元などのサード パーティは、それぞれのデバイス ハードウェアで使用できるカスタム セキュリティ機能を活用する必要があります。  Linux および Windows プラットフォームでトラステッド プラットフォーム モジュール (TPM) を使用して Azure IoT セキュリティ マネージャーのセキュリティを強化する方法が示されているページへのリンクについては、「次の手順」セクションをご覧ください。 これらの例は、ソフトウェアまたは仮想 TPM を使用していますが、個別の TPM デバイスの使用について直接当てはまります。  

## <a name="next-steps"></a>次のステップ

ブログ「[Securing the intelligent edge](https://azure.microsoft.com/blog/securing-the-intelligent-edge/)」(インテリジェント エッジをセキュリティで保護する) を読む。

[Linux 仮想マシン上で、仮想 TPM を使用する IoT Edge デバイス](how-to-auto-provision-simulated-device-linux.md)を作成し、プロビジョニングする。

[Windows 上で、シミュレートされた TPM を使用する IoT Edge デバイス](how-to-auto-provision-simulated-device-windows.md)を作成し、プロビジョニングする。
