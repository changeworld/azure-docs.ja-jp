---
title: ダウンストリーム デバイスのゲートウェイ - Azure IoT Edge | Microsoft Docs
description: Azure IoT Edge を使って、複数のダウンストリーム デバイスからクラウドにデータを送信する、またはデータをローカルに処理する、透過的デバイス、非透過的デバイス、またはプロキシ ゲートウェイ デバイスを作成します。
author: kgremban
manager: philmea
ms.author: kgremban
ms.date: 08/21/2020
ms.topic: conceptual
ms.service: iot-edge
services: iot-edge
ms.custom:
- amqp
- mqtt
ms.openlocfilehash: 0589779de2ddb0bc75dde3b57d6444634b879f86
ms.sourcegitcommit: 419cf179f9597936378ed5098ef77437dbf16295
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/27/2020
ms.locfileid: "89017024"
---
# <a name="how-an-iot-edge-device-can-be-used-as-a-gateway"></a>IoT Edge デバイスをゲートウェイとして使用する方法

IoT Edge ソリューションのゲートウェイは、デバイス接続とエッジ分析を IoT デバイスに提供します。ゲートウェイ以外ではこれらの機能は提供されません。 Azure IoT Edge を使うと、目的が接続、ID、エッジ分析のいずれに関係していても、IoT ゲートウェイのあらゆるニーズを満たすことができます。 この記事のゲートウェイ パターンでは、ダウンストリーム デバイスの接続の特性とデバイスの ID のみが示されており、ゲートウェイでのデバイス データの処理方法は示されていません。

## <a name="patterns"></a>パターン

ゲートウェイとして IoT Edge デバイスを使用する方法には、透過、プロトコル変換、ID 変換の 3 パターンがあります。

各パターンの大きな違いは、透過的なゲートウェイでは、追加の処理を必要とせずに、ダウンストリーム デバイスと IoT Hub 間でメッセージが渡されることです。 ただし、プロトコル変換と ID 変換では、通信を可能にするためにゲートウェイで処理する必要があります。

ゲートウェイでは IoT Edge モジュールを使用して、ダウンストリーム デバイスから IoT Hub にメッセージを渡す前に、エッジで分析や事前処理を実行できます。

![ダイアグラム - 透過、プロトコル、および ID ゲートウェイ パターン](./media/iot-edge-as-gateway/edge-as-gateway.png)

### <a name="transparent-pattern"></a>透過パターン

"*透過的*" ゲートウェイ パターンの場合、IoT Hub に理論的に接続できるデバイスは、代わりにゲートウェイ デバイスに接続できます。 ダウンストリーム デバイスは独自の IoT Hub ID を持ち、MQTT、AMQP、HTTP のいずれかのプロトコルを使用しています。 ゲートウェイは、デバイスと IoT Hub の間の通信を単純に受け渡します。 デバイスも、IoT Hub を介してそれと対話しているユーザーも、ゲートウェイが通信を仲介していることを認識しません。 このように認識されないことは、ゲートウェイが "*透過的*" と見なされることを意味します。

IoT Edge ランタイムには、透過的なゲートウェイ機能が含まれています。 詳細については、「[透過的なゲートウェイとして機能するように IoT Edge デバイスを構成する](how-to-create-transparent-gateway.md)」を参照してください。

### <a name="protocol-translation-pattern"></a>プロトコル変換パターン

"*プロトコル変換*" ゲートウェイは、透過的なゲートウェイ パターンとは対照的に "*非透過的*" ゲートウェイとも呼ばれます。 このパターンの場合、MQTT、AMQP、または HTTP をサポートしていないデバイスでは、代わりにゲートウェイ デバイスを使用して IoT Hub にデータを送信できます。 ゲートウェイは、ダウンストリーム デバイスによって使用されているプロトコルを認識します。またゲートウェイは、IoT Hub 内で ID を持つ唯一のデバイスです。 すべての情報は、1 つのデバイスつまりゲートウェイから送信されているように見えます。 クラウド アプリケーションでデバイスごとにデータを分析する必要がある場合、ダウンストリーム デバイスは追加の識別情報をメッセージに埋め込む必要があります。 また、ツインやメソッドなどの IoT Hub プリミティブは、ゲートウェイ デバイスでのみ使用でき、ダウンストリーム デバイスでは使用できません。

IoT Edge ランタイムには、プロトコル変換機能は含まれていません。 このパターンでは、使用されるハードウェアやプロトコルに固有であることが多いカスタムまたはサード パーティのモジュールが必要です。 [Azure Marketplace](https://azuremarketplace.microsoft.com/marketplace/apps/category/internet-of-things?page=1&subcategories=iot-edge-modules) には、選択できるプロトコル変換モジュールがいくつか含まれています。

### <a name="identity-translation-pattern"></a>ID 変換パターン

"*ID 変換*" ゲートウェイ パターンの場合、IoT Hub に接続できないデバイスは、代わりにゲートウェイ デバイスに接続できます。 ゲートウェイでは、ダウンストリーム デバイスに代わって、IoT Hub の ID とプロトコル変換が提供されます。 ゲートウェイは、ダウンストリーム デバイスによって使われているプロトコルを認識し、ダウンストリーム デバイスに ID を提供し、IoT Hub のプリミティブを変換できるほど十分にスマートです。 ダウンストリーム デバイスは、ツインとメソッドを備えたファースト クラスのデバイスとして IoT Hub に認識されます。 ユーザーは、IoT Hub のデバイスと対話することができ、中間にゲートウェイ デバイスがあることには気付きません。

IoT Edge ランタイムには、ID 変換機能は含まれていません。 このパターンでは、使用されるハードウェアやプロトコルに固有であることが多いカスタムまたはサード パーティのモジュールが必要です。 ID 変換パターンを使用する例については、「[Azure IoT Edge LoRaWAN スタート キット](https://github.com/Azure/iotedge-lorawan-starterkit)」を参照してください。

## <a name="use-cases"></a>ユース ケース

すべてのゲートウェイ パターンには次の利点があります。

* **エッジでの分析** – AI サービスをローカルに使って、クラウドに完全に忠実なテレメトリを送信することなく、ダウンストリーム デバイスからのデータを処理します。 ローカルに洞察を検索して対応し、データのサブセットのみを IoT Hub に送信します。
* **ダウンストリーム デバイスの分離** – ゲートウェイ デバイスは、すべてのダウンストリーム デバイスをインターネットへの露出から保護できます。 接続されていない OT ネットワークと、Web へのアクセスを提供する IT ネットワークの間に配置できます。
* **接続の多重化** - IoT Edge ゲートウェイを介して IoT Hub に接続するデバイスはすべて、基になっている同じ接続を使用します。
* **トラフィックのスムージング** - IoT Edge デバイスは、メッセージをローカルに保持しながら、IoT Hub でトラフィックを調整する場合に指数のバックオフを自動的に実装します。 このメリットにより、急増するトラフィックに対するソリューションの回復力が高まります。
* **オフライン サポート** - ゲートウェイ デバイスは、IoT Hub に配信できないメッセージとツインの更新を保存します。

プロトコル変換を行うゲートウェイでは、リソースに制約がある既存のデバイスと新しいデバイスをサポートできます。 既存の多くのデバイスは、ビジネスの洞察に役立つデータを生成します。しかし、クラウドへの接続を考慮して設計されてはいません。 非透過的なゲートウェイを使うと、このデータの制約がなくなり、IoT ソリューションで使用できるようになります。

ID 変換を行うゲートウェイを使うと、プロトコル変換の利点が提供され、さらにクラウドからダウンストリーム デバイスを完全に管理できます。 IoT ソリューションのすべてのデバイスは、使用しているプロトコルに関係なく、IoT Hub に認識されます。

## <a name="cheat-sheet"></a>チート シート

透過的、非透過的 (プロトコル)、およびプロキシ ゲートウェイを使ったときの IoT Hub プリミティブを比較した簡単なチート シートを次に示します。

| プリミティブ | 透過的なゲートウェイ | プロトコル変換 | ID 変換 |
|--------|-------------|--------|--------|
| IoT Hub ID レジストリに格納されている ID | 接続されているすべてのデバイスの ID | ゲートウェイ デバイスの ID のみ | 接続されているすべてのデバイスの ID |
| デバイス ツイン | 各接続のデバイスには、独自のデバイス ツインが含まれている | デバイスとモジュール ツインはゲートウェイにのみ含まれている | 各接続のデバイスには、独自のデバイス ツインが含まれている |
| ダイレクト メソッドおよびクラウドからデバイスへのメッセージ | クラウドは接続された各デバイスを個別にアドレスできる | クラウドはゲートウェイ デバイスのみをアドレスできる | クラウドは接続された各デバイスを個別にアドレスできる |
| [IoT Hub のスロットルおよびクォータ](../iot-hub/iot-hub-devguide-quotas-throttling.md) | 各デバイスに適用する | ゲートウェイ デバイスに適用する | 各デバイスに適用する |

非透過的なゲートウェイ (プロトコル変換) パターンを使用する場合、そのゲートウェイを介して接続するすべてのデバイスは、同一のクラウドからデバイスのキューを共有します。これには最大で 50 のメッセージを含めることができます。 したがって、各フィールド ゲートウェイを介して接続するデバイスが非常に少なく、クラウドからデバイスへのトラフィックが少ない場合にのみ、非透過的なゲートウェイ パターンを使用する必要があります。

## <a name="next-steps"></a>次のステップ

透過的なゲートウェイを設定する 3 つの手順を学習します。

* [透過的なゲートウェイとして機能するように IoT Edge デバイスを構成](how-to-create-transparent-gateway.md)します。
* [Azure IoT Hub に対するダウンストリーム デバイスの認証を行う](how-to-authenticate-downstream-device.md)
* [ダウンストリーム デバイスを Azure IoT Edge ゲートウェイに接続する](how-to-connect-downstream-device.md)
