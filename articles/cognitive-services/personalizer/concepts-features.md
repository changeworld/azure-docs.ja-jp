---
title: '機能: アクションとコンテキスト - Personalizer'
titleSuffix: Azure Cognitive Services
description: Personalizer では、ランキングでより良い提案を行う目的で、フィーチャー、つまり、アクションとコンテキストに関する情報が利用されます。 フィーチャーは非常に包括的になることがあれば、ある項目に固有となることもあります。
services: cognitive-services
author: edjez
manager: nitinme
ms.service: cognitive-services
ms.subservice: personalizer
ms.topic: concept
ms.date: 06/24/2019
ms.author: edjez
ms.openlocfilehash: 2353b8c735602aff0386f44cc29d2be5eb9f90c4
ms.sourcegitcommit: a12b2c2599134e32a910921861d4805e21320159
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 06/24/2019
ms.locfileid: "67340889"
---
# <a name="features-are-information-about-actions-and-context"></a>フィーチャーはアクションとコンテキストに関する情報です。

Personalizer サービスは、特定のコンテキストでアプリケーションがユーザーに表示する内容を学習することで機能します。

Personalizer では、**現在のコンテキスト**に関する情報である**フィーチャー**を利用し、最良の**アクション**が選択されます。 フィーチャーは、より高いリワードを得る目的でパーソナライズに役立つと思われるあらゆる情報です。 フィーチャーは非常に包括的になることがあれば、ある項目に固有となることもあります。 

**フィーチャー**の例:

* `UserID` など、_ユーザー_。 
* _コンテンツ_。動画が `Documentary`、`Movie`、または `TV Series` であるかどうかや、ある品物を店舗で利用できるかどうかなど。
* _現在_の期間。現在の曜日など。

Personalizer では、アクションとコンテキストに対して送信できるフィーチャーを規定したり、制限したり、修正したりすることはありません。

* あるフィーチャーを一部のアクションに対して送信できても、他のアクションに対しては、それが与えられていなければ送信できません。 たとえば、テレビ シリーズには映画に与えられていない属性が与えられていることがあります。
* 一部のフィーチャーは利用できる時間帯が限られていることがあります。 たとえば、モバイル アプリケーションの場合、Web ページより提供する情報が多いことがあります。 
* 時間の経過と共に、コンテキストやアクションに関するフィーチャーを追加したり、削除したりすることができます。 Personalizer では、利用可能な情報から学習が継続されます。
* コンテキストに対してはフィーチャーが少なくとも 1 つ存在する必要があります。 Personalizer では、空のコンテキストはサポートされていません。 毎回、決まったコンテキストばかり送信する場合、Personalizer は、アクション内のフィーチャーに関してのみ、ランキングのアクションを選択します。 
* Personalizer は常に、誰に対しても最適に機能するアクションを選択するように努めます。

## <a name="supported-feature-types"></a>サポートされているフィーチャーの種類

Personalizer では、フィーチャーとして文字列、数値、ブールをサポートしています。

### <a name="how-choice-of-feature-type-affects-machine-learning-in-personalizer"></a>フィーチャーの種類の選択が Personalizer で Machine Learning に及ぼす影響

* **文字列**:文字列型の場合、キーと値のすべての組み合わせが、Personalizer の機械学習モデルに新しい重みを作成します。 
* **数値**:数字に比例した影響をパーソナライズ結果に及ぼす必要がある場合は、数値を使用してください。 これはシナリオに大きく依存します。 店舗体験をパーソナライズする場合のような単純化した例では、2 匹または 3 匹のペットを飼っている人が、1 匹しか飼っていない人の 2 倍または 3 倍、パーソナライズ結果に影響を及ぼすようにしたいので、数値である NumberOfPetsOwned がフィーチャーの候補になります。 数値の単位に基づいているが (年齢、気温、人の身長のように) 意味が線形ではないフィーチャーは文字列としてエンコードするのが最適であり、フィーチャーの品質は通常、範囲を使用して向上させることができます。 たとえば、年齢は "Age":"0-5"、"Age":"6-10" などのようにエンコードできます。
* "false" の値で送信された**ブール**値は、まったく送信されなかったかのように機能します。

存在しないフィーチャーは要求から除外してください。 null 値を含むフィーチャーの送信は避けてください。モデルをトレーニングするとき、存在するものとして、かつ、値 "null" で処理されます。

## <a name="categorize-features-with-namespaces"></a>名前空間でフィーチャーを分類する

Personalizer では、フィーチャーが名前空間で整理されます。 ユーザーは自分のアプリケーションで、名前空間が使用されているかどうかとそれがどのような名前空間であるかを判断します。 名前空間は、同様のトピックなどのフィーチャーや情報源を同じくするフィーチャーをグループ化する目的で使用されます。

アプリケーションで使用されるフィーチャーの名前空間の例:

* User_Profile_from_CRM
* Time
* Mobile_Device_Info
* http_user_agent
* VideoResolution
* UserDeviceInfo
* Weather
* Product_Recommendation_Ratings
* current_time
* NewsArticle_TextAnalytics

有効な JSON キーである限り、自分の命名規則でフィーチャーの名前空間に名前を付けることができます。

次の JSON では、`user`、`state`、`device` がフィーチャーの名前空間です。

JSON オブジェクトには、入れ子にした JSON オブジェクトと単純なプロパティ/値を含めることができます。 配列は、配列の項目が数値の場合にのみ含めることができます。 

```JSON
{
    "contextFeatures": [
        { 
            "user": {
                "name":"Doug",
                "latlong": [47.6, -122.1]
            }
        },
        {
            "state": {
                "timeOfDay": "noon",
                "weather": "sunny"
            }
        },
        {
            "device": {
                "mobile":true,
                "Windows":true
            }
        }
    ]
}
```

## <a name="how-to-make-feature-sets-more-effective-for-personalizer"></a>Personalizer のためにフィーチャー セットをより効果的にする方法

最高のリワードを作り出すアクションを予測する方法が Personalizer で学習されるようにするには、優れたフィーチャー セットが有用です。 

次の推奨項目に従う Personalizer Rank API にフィーチャーを送信することを検討してください。

* パーソナライズを進めるために十分なフィーチャーがあります。 コンテンツの対象を絞り込む必要性が上がるにつれて、必要とされるフィーチャーの数も増えます。

* 多様な*密度*のフィーチャーが十分にあります。 たくさんの項目が 2、3 のバケットにグループ化される場合、フィーチャーは*密度が高く*なります。 たとえば、大量の動画を "長編" (5 分以上) と "短編" (5 分未満) に分類できます。 これは*非常に密度の高い*フィーチャーです。 一方で、同じくらい大量の項目に "タイトル" という属性を与えることができます。その属性に項目間で同じ値が与えられることはほとんどありません。 これは密度が非常に低い、*まばらな*フィーチャーです。  

フィーチャーの密度が高ければ、Personalizer により項目間で推測しながら学習されます。 ただし、フィーチャーがいくつかあり、密度が高すぎる場合、Personalizer では、数少ない選択可能なバケットから、コンテンツの対象がより正確に絞り込まれるように試行されます。

### <a name="improve-feature-sets"></a>フィーチャー セットを改善する 

オフライン評価でユーザーの行動を分析する これにより、過去のデータを見て、ポジティブなリワードに大きく貢献しているフィーチャーと貢献度が低いフィーチャーを比較できます。 どのフィーチャーが役立っているのか判断できます。Personalizer に送信するより良いフィーチャーを見つけ、結果をさらに改善するのは利用者とそのアプリケーション次第となります。

次のセクションでは、Personalizer に送信されるフィーチャーを改善するための一般的な慣例を紹介します。

#### <a name="make-features-more-dense"></a>フィーチャーの密度を高くする

編集してもっと大きくしたり、密度を高くしたり、低くしたりすることでフィーチャーセットを改善できます。

たとえば、タイムスタンプを秒まで下げると、フィーチャーが非常にまばらになります。 これは "朝"、"真昼"、"午後" などに時間帯を分類することで高密度にする (効率的にする) ことができます。


#### <a name="expand-feature-sets-with-extrapolated-information"></a>推定した情報でフィーチャーセットを拡大する

まだ推定されていないが、既に与えられている情報から引き出せる属性を思い付くことでもフィーチャーを増やすことができます。 たとえば、架空の映画リストをパーソナライズするとき、週末と平日で異なる行動をユーザーから引き出せるでしょうか? 時間帯を拡大し、"週末" または "平日" 属性を与えることができます。 国の文化的休日は特定の種類の映画に対する注目を促しますか? たとえば、"ハロウィーン" という属性はそれが関連する箇所で便利です。 多くの人にとって雨が映画の選択に大きな影響を与えるということがあるでしょうか? 天気サービスはそのような情報を時間と場所と共に提供することがあります。それを特別のフィーチャーとして追加できます。 

#### <a name="expand-feature-sets-with-artificial-intelligence-and-cognitive-services"></a>人工知能や認知サービスでフィーチャーセットを拡大する

Artificial Intelligence や、すぐに実行できる Cognitive Services は Personalizer にとって非常に強力な追加機能となります。 

人工知能サービスを利用して項目を事前に処理することで、パーソナライズに関連する可能性がある情報を自動的に抽出できます。

例:

* [Video Indexer](https://azure.microsoft.com/services/media-services/video-indexer/) で映画ファイルを実行し、シーンの要素、テキスト、センチメント、その他さまざまな属性を抽出できます。 そのような属性は密度を高くし、元の項目メタデータにはなかった特性を反映できます。 
* たとえば、画像は物体検出で、顔はセンチメントで実行できます。
* テキストに含まれる情報は、エンティティの抽出、センチメント、Bing ナレッジ グラフによるエンティティの拡大などで強化できます。

他にも次のような [Azure Cognitive Services](https://www.microsoft.com/cognitive-services) を利用できます。

* [Entity Linking](../entitylinking/home.md)
* [Text Analytics](../text-analytics/overview.md)
* [Emotion](../emotion/home.md)
* [Computer Vision](../computer-vision/home.md)

## <a name="actions-represent-a-list-of-options"></a>アクションはオプションの一覧を表します

各アクション:

* ID があります。
* フィーチャーの一覧があります。
* フィーチャーの一覧は大規模 (数百単位) になることがありますが、フィーチャーの効果を評価し、リワードに貢献しないフィーチャーを取り除くことが推奨されます。 
* **アクション**のフィーチャーは、Personalizer によって使用される**コンテキスト**のフィーチャーとの間に相関関係がある場合とない場合があります。
* アクションのフィーチャーは、一部のアクションにのみ存在することがあります。 
* 特定のアクション ID のフィーチャーは 1 日だけ利用できて、その後は利用不可能になることがあります。 

Personalizer の機械学習アルゴリズムは、フィーチャーセットが安定しているときにより効果的に実行されますが、Rank コールは、フィーチャーセットが時間と共に変化する場合、失敗しません。

アクションに順位を付けるとき、50 を超えるアクションを送信しないでください。 毎回同じ 50 のアクションになることもあれば、変わることもあります。 たとえば、eコマース アプリケーションに品物が 10,000 個の製品カタログを用意している場合、レコメンデーションまたはフィルター エンジンを使用し、顧客が気に入りそうな上位 40 品目を決定することがあります。また、Personalizer を使用し、現在のコンテキストに対して生成するリワードが最も大きい (たとえば、ユーザーが買い物かごに追加する) 品目を見つけることがあります。


### <a name="examples-of-actions"></a>アクションの例

Rank API に送信するアクションは、パーソナライズしようとしている内容に依存します。

次に例をいくつか示します。

|目的|Action|
|--|--|
|ニュース Web サイトで強調表示する記事をパーソナライズします。|各アクションは潜在的にニュース記事です。|
|Web サイトでの広告配置を最適化します。|各アクションはレイアウトか広告のレイアウトを作成するルールになります (たとえば、上に小さい画像、右に大きい画像)。|
|買い物 Web サイトにお勧めの品目を個人的にランク付けして表示します。|各アクションは特定の製品になります。|
|特定の写真に適用するフィルターなど、ユーザー インターフェイス要素を提案します。|各アクションは異なるフィルターになることがあります。|
|チャット ボットの応答を選択し、ユーザーの意図を明確にするか、アクションを提案します。|各アクションは、応答を解釈する方法の選択肢です。|
|検索結果一覧の一番上に表示するものを選択します|各アクションは上位検索結果の 1 つです。|


### <a name="examples-of-features-for-actions"></a>アクションのフィーチャーの例

次は、アクションのフィーチャーの好例です。 これらは各アプリケーションに大きく依存します。

* アクションの特性を持つフィーチャー。 たとえば、それは映画ですか? それともテレビ シリーズですか?
* 過去にユーザーがこのアクションとどのようにやりとりした可能性があるかに関するフィーチャー。 たとえば、この映画は人口統計 A または B の住民が一番多く見ています。再生回数は概して 1 回のみです。
* ユーザーがアクションを*見る*方法という特性に関するフィーチャー。 たとえば、サムネイルに表示されている映画のポスターには、顔、車、または景色が含まれていますか?

### <a name="load-actions-from-the-client-application"></a>クライアント アプリケーションからアクションを読み込む

アクションのフィーチャーは通常、コンテンツ管理システム、カタログ、推奨システムを情報源とします。 アプリケーションは、関連するデータベースやシステムからアクションに関する情報を読み込む役目を担います。 アクションが変わらない場合、あるいは毎回読み込むことがパフォーマンスに不要な影響を与える場合、この情報をキャッシュするロジックをアプリケーションに追加できます。

### <a name="prevent-actions-from-being-ranked"></a>ランク付けの対象からアクションを外す

ユーザーに見せたくないアクションが存在する場合があります。 アクションが一番上にランクされることを防ぐ最も良い方法は、Rank API のアクション一覧にアクションをそもそも含めないことです。

Rank API コールの結果として生成される_アクション_をユーザーに見せる場合、ビジネス ロジックの後半でそれを判断することがあります。 そのような場合、_非アクティブ イベント_を使用してください。

## <a name="json-format-for-actions"></a>アクションの JSON 形式

Rank を呼び出すとき、次から複数のアクションを選択して送信します。

JSON オブジェクトには、入れ子にした JSON オブジェクトと単純なプロパティ/値を含めることができます。 配列は、配列の項目が数値の場合にのみ含めることができます。 

```json
{
    "actions": [
    {
      "id": "pasta",
      "features": [
        {
          "taste": "salty",
          "spiceLevel": "medium",
          "grams": [400,800]
        },
        {
          "nutritionLevel": 5,
          "cuisine": "italian"
        }
      ]
    },
    {
      "id": "ice cream",
      "features": [
        {
          "taste": "sweet",
          "spiceLevel": "none",
          "grams": [150, 300, 450]
        },
        {
          "nutritionalLevel": 2
        }
      ]
    },
    {
      "id": "juice",
      "features": [
        {
          "taste": "sweet",
          "spiceLevel": "none",
          "grams": [300, 600, 900]
        },
        {
          "nutritionLevel": 5
        },
        {
          "drink": true
        }
      ]
    },
    {
      "id": "salad",
      "features": [
        {
          "taste": "salty",
          "spiceLevel": "low",
          "grams": [300, 600]
        },
        {
          "nutritionLevel": 8
        }
      ]
    }
  ]
}
```

## <a name="examples-of-context-information"></a>コンテキスト情報の例

_コンテキスト_の情報は各アプリケーションとユース ケースに左右されますが、通常、次のような情報が含まれます。

* ユーザーの人口統計情報とプロフィール情報。
* ユーザー エージェントなど、HTTP ヘッダーから抽出された情報、または IP アドレスに基づく地理的逆参照など、HTTP 情報から誘導された情報。
* 曜日、週末または平日、午前または午後、休暇期または労働期など、現在の時間に関する情報。
* 場所、移動、バッテリ レベルなど、モバイル アプリケーションから抽出された情報。
* このユーザーが最も多く視聴している映画のジャンルなど、ユーザーの過去の行動の集計。

アプリケーションは、関連するデータベース、センサー、システムからコンテキストに関する情報を読み込む役目を担います。 コンテキスト情報が変わらない場合、Rank API に送信する前に、この情報をキャッシュするロジックをアプリケーションに追加できます。

## <a name="json-format-for-context"></a>コンテキストの JSON 形式 

コンテキストは、Rank API に送信される JSON オブジェクトとして表現されます。

JSON オブジェクトには、入れ子にした JSON オブジェクトと単純なプロパティ/値を含めることができます。 配列は、配列の項目が数値の場合にのみ含めることができます。 

```JSON
{
    "contextFeatures": [
        { 
            "user": {
                "name":"Doug"
            }
        },
        {
            "state": {
                "timeOfDay": "noon",
                "weather": "sunny"
            }
        },
        {
            "device": {
                "mobile":true,
                "Windows":true,
                "screensize": [1680,1050]
                }
            }
        }
    ]
}
```

## <a name="next-steps"></a>次の手順

[強化学習](concepts-reinforcement-learning.md) 
