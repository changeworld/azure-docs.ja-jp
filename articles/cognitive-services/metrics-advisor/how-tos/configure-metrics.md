---
title: Web ポータルを使用して Metrics Advisor インスタンスを構成する
titleSuffix: Azure Cognitive Services
description: Metrics Advisor インスタンスを構成し、異常検出の結果を微調整する方法。
services: cognitive-services
author: mrbullwinkle
manager: nitinme
ms.service: cognitive-services
ms.subservice: metrics-advisor
ms.topic: conceptual
ms.date: 09/10/2020
ms.author: mbullwin
ms.openlocfilehash: 7923dad3d47122c0ceb04d1240736e2b66a0dd64
ms.sourcegitcommit: f28ebb95ae9aaaff3f87d8388a09b41e0b3445b5
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/30/2021
ms.locfileid: "92048255"
---
# <a name="how-to-configure-metrics-and-fine-tune-detecting-configuration"></a>方法:メトリックを構成して検出構成を微調整する

この記事では、Web ポータルを使用して Metrics Advisor インスタンスの構成を開始する方法について説明します。 特定のデータ フィードのメトリックを参照するには、 **[データ フィード]** ページに移動し、フィードの 1 つを選択します。 これにより、関連付けられているメトリックの一覧が表示されます。

:::image type="content" source="../media/metrics/select-metric.png" alt-text="メトリックを選択する" lightbox="../media/metrics/select-metric.png":::

メトリック名の 1 つをクリックすると、その詳細が表示されます。 この詳細ビューでは、画面の右上隅にあるドロップダウン リストを使用して、同じデータ フィード内の別のメトリックに切り替えることができます。

メトリックの詳細を初めて表示する場合は、Metrics Advisor に 1 つを自動的に選択させるか、各ディメンションに含める値を指定することで、時系列を読み込むことができます。 

時間の範囲を選択し、ページのレイアウトを変更することもできます。

> [!NOTE]
> - 開始時刻は含まれます。
> - 終了時刻は含まれません。 

**[インシデント]** タブをクリックして異常を表示し、[インシデント ハブ](diagnose-incident.md)へのリンクを見つけることができます。

## <a name="tune-the-detecting-configuration"></a>検出構成を調整する

メトリックに 1 つ以上の検出構成を適用できます。 各メトリックには既定の構成があり、監視のニーズに応じて編集または追加することができます。

### <a name="tune-the-configuration-for-all-series-in-current-metric"></a>現在のメトリックのすべての系列について構成を調整する

この構成は、このメトリックのすべての系列に適用されます。ただし、個別の構成を持つものは除きます。 既定では、メトリック レベルの構成は、データがオンボードされるときに適用され、左側のパネルに表示されます。 ユーザーは、メトリックのページでメトリック レベルの構成を直接編集できます。 

**[方向]** や **[Valid anomaly]\(有効な異常\)** など、構成をさらに調整するために使用できる追加のパラメーターがあります。 さまざまな検出方法を組み合わせることもできます。 

:::image type="content" source="../media/configuration-combination.png" alt-text="構成の組み合わせ" lightbox="../media/configuration-combination.png":::

### <a name="tune-the-configuration-for-a-specific-series-or-group"></a>特定の系列またはグループの構成を調整する

メトリック レベルの構成オプションの下にある **[詳細構成]** をクリックして、グループ レベルの構成を表示します。このウィンドウの **+** アイコンをクリックすると、個々の系列、または系列のグループに対して構成を追加できます。 パラメーターは、メトリック レベルの構成パラメーターと同様ですが、グループ レベルの構成では、系列のグループを識別するディメンション値を 1 つ以上指定することが必要な場合があります。 さらに、系列レベルの構成では、特定の系列を識別するディメンション値をすべて指定します。 

この構成は、メトリック レベルの構成ではなく、系列のグループまたは特定の系列に適用されます。 このグループの条件を設定した後、保存します。

:::image type="content" source="../media/advanced-configuration.png" alt-text="詳細な構成" lightbox="../media/advanced-configuration.png":::

### <a name="anomaly-detection-methods"></a>異常検出メソッド

Metrics Advisor では、複数の異常検出方法が用意されています。 **+** ボタンをクリックして、1 つを使用するか、または論理演算子を使用して複数を組み合わせることができます。 

**スマート検出** 

スマート検出では、機械学習を利用して、履歴データからパターンを学習し、それらを将来の検出に使用します。 この方法を使用する場合、検出の結果を調整するために最も重要なパラメーターは、 **[検出感度]** です。 それを小さいまたは大きい値にドラッグして、ページの右側の視覚化に影響を与えることができます。 データに適合するものを選択して、保存します。 


スマート検出モードでは、検出感度と境界のバージョン パラメーターを使用して、異常検出の結果を微調整します。

検出感度は、各ポイントの期待される値の範囲の幅に影響を与える可能性があります。 検出感度を上げると、期待される値の範囲は狭まり、報告される異常は多くなります。

:::image type="content" source="../media/metrics/smart-detection-high-sensitivity.png" alt-text="高い検出感度のスマート検出":::

検出感度を下げると、期待される値の範囲は広がり、報告される異常は少なくなります。

:::image type="content" source="../media/metrics/smart-detection-low-sensitivity.png" alt-text="低い検出感度のスマート検出":::

**しきい値の変更** 

通常、しきい値の変更は、メトリック データが全般的に特定の範囲内にある場合に使用されます。 しきい値は、 **[Change percentage]\(変化率\)** に応じて設定されます。 **[Change threshold]\(しきい値の変更\)** モードを使用すると、次のシナリオで異常を検出できます。

* 通常、データは安定しており、平滑です。 変動がある場合に通知を受け取ります。
* 通常、データは非常に不安定で、大きく変動します。 安定しすぎたり、平坦になったりしたときに通知を受け取ります。

このモードを使用するには、次の手順を実行します。

1. メトリックまたは時系列の異常検出構成を設定するときに、異常検出方法として **[Change threshold]\(しきい値の変更\)** を選択します。
    
    :::image type="content" source="../media/metrics/change-threshold.png" alt-text="しきい値の変更":::

2. シナリオに基づいて、**範囲外** または **範囲内** パラメーターを選択します。

    変動を検出する場合は、**範囲外** を選択します。 たとえば、次の設定を使用すると、前のデータ ポイントと比較して変化率が 10% を超えるすべてのデータ ポイントが外れ値として検出されます。
    :::image type="content" source="../media/metrics/out-of-the-range.png" alt-text="範囲外パラメーター":::

    データ内の平坦な線を検出する場合は、**範囲内** を選択します。 たとえば、次の設定を使用すると、前のデータ ポイントと比較して変化率が 0.01% 内であるすべてのデータ ポイントが外れ値として検出されます。 しきい値は非常に小さい (0.01%) ため、データ内の平坦な線は外れ値として検出されます。

    :::image type="content" source="../media/metrics/in-the-range.png" alt-text="範囲内パラメーター":::

3. 異常としてカウントされる変化率と、以前にキャプチャされ、比較に使用するデータ ポイントを設定します。 この比較は常に、現在のデータ ポイントと、それより N 個前の単一のデータ ポイントとの間で行われます。
    
    **[方向]** は、**範囲外** モードを使用する場合にのみ有効です。
    
    * **[上]** では、(現在のデータ ポイント) - (比較するデータ ポイント) > **+** しきい値パーセンテージの場合にのみ異常を検出するように検出が構成されます。
    * **[下]** では、(現在のデータ ポイント) - (比較するデータ ポイント) < **-** しきい値パーセントの場合にのみ異常を検出するように検出が構成されます。
 
**ハードしきい値**

 ハードしきい値は、異常検出の基本的な方法です。 上限または下限、あるいはその両方を設定して、期待される値の範囲を決定できます。 境界外のポイントはすべて、異常として識別されます。 


## <a name="preset-events"></a>事前設定イベント

場合によっては、予期されるイベントや出来事 (休日など) によって異常のデータが生成されることがあります。 事前設定イベントを使用すると、指定された時間中、異常検出の出力にフラグを追加できます。 この機能は、データ フィードのオンボード後に構成する必要があります。 各メトリックに構成できる事前設定イベントは 1 つのみです。

> [!Note]
> 事前設定イベントの構成では、異常検出中に休日が考慮され、結果が変わる可能性があります。 これは、この構成を保存した後に取り込まれるデータ ポイントに適用されます。 

各メトリックの詳細ページで、メトリック ドロップダウン リストの横にある **[Configure Preset Event]\(事前設定イベントの構成\)** ボタンをクリックします。
 
:::image type="content" source="../media/metrics/preset-event-button.png" alt-text="事前設定イベント ボタン":::

表示されたウィンドウで、使用状況に応じてオプションを構成します。 この構成を使用するには、 **[Enable holiday event]\(休日イベントを有効にする\)** がオンになっていることを確認します。 

**[Holiday event]\(休日\)** セクションは、休日中に不要な異常が検出されるのを抑制するのに役立ちます。 適用できる **[戦略]** オプションとしては、次の 2 つのオプションがあります。

* **[Suppress holiday]\(休日を抑制する\)** : 休日期間中、異常検出の結果内のすべての異常およびアラートを抑制します。
* **[Holiday as weekend]\(週末としての休日\)** : 休日以前のいくつかの対応する週末の平均期待値を計算し、これらの値に基づいて異常状態を決定します。

この他にも構成できる値がいくつかあります。

|オプション  |説明  |
|---------|---------|
|**[Choose one dimension as country]\(国として 1 つのディメンションを選択する\)**     | 国情報を含むディメンションを選択します。 たとえば、国番号などです。         |
|**[Country code mapping]\(国番号のマッピング\)**     | 標準の[国番号](https://wikipedia.org/wiki/ISO_3166-1_alpha-2)と選択されたディメンションの国データのマッピング。        |
|**[Holiday options]\(休日オプション\)**    | すべての休日、PTO (有給休暇) のみ、PTO 以外の休日のみのいずれを考慮するかを指定します。         |
|**[拡張する日数]**    |  休日前後の影響を受ける日数。        |


一部のシナリオでは、データ内の循環パターンを使用して不要なアラートを削減するために、 **[Cycle event]\(循環イベント\)** セクションを使用することができます。 次に例を示します。 

- 週次と月次の両方のパターンなど、複数のパターンまたはサイクルを持つメトリック。 
- 明確なパターンを持たないが、データを前年比 (YoY)、前月比 (MoM)、前週比 (WoW)、前日比 (DoD) で比較できるメトリック。
 
すべての細分性に対してすべてのオプションを選択できるとは限りません。 細分性ごとの使用可能なオプションは次のとおりです。

| 粒度 | YoY | MoM | WoW | DoD |
|:-|:-|:-|:-|:-|
| 年単位 | X | X | X | X |
| 月単位 | X | X | X | X |
| 週次 | ✔ | X | X | X |
| 毎日 | ✔ | ✔ | ✔ | X |
| 1 時間ごと | ✔ | ✔ | ✔ | ✔ |
| 1 分ごと | X | X | X | X |
| 1 秒ごと | X | X | X | X |
| カスタム* | ✔ | ✔ | ✔ | ✔ |

X - 使用不可。  
✔ - 使用可能。
  
\* 秒単位のカスタム細分性を使用する場合、メトリックが 1 時間より長く、1 日未満の場合にのみ使用できます。

循環イベントは、循環パターンに従う場合に異常を削減するために使用されますが、複数のデータ ポイントがパターンに従わない場合は異常を報告します。 **厳格モード** は、1 つのデータ ポイントでもパターンに従わない場合に異常レポートを有効にするために使用されます。 

:::image type="content" source="../media/metrics/preset-events.png" alt-text="事前設定イベントの構成":::

## <a name="view-recent-incidents"></a>最近のインシデントを表示する

Metrics Advisor では、取り込み時にすべての時系列データの異常を検出します。 ただし、必ずしもすべての異常が大きな影響を及ぼすとは限らないため、これらをすべてエスカレートする必要はありません。 異常に対して集計が実行され、関連性のある異常をインシデントにグループ化します。 これらのインシデントは、メトリックの詳細ページの **[インシデント]** タブを使用して表示できます。 

インシデントをクリックして、 **[Incidents analysis]\(インシデントの分析\)** ページに移動します。このページには、インシデントに関する詳細が表示されます。 **[Manage incidents in new Incident hub]\(新しいインシデント ハブでインシデントを管理する\)** をクリックして、[[Incident hub]\(インシデント ハブ\)](diagnose-incident.md) ページを表示します。このページには、特定のメトリックのすべてのインシデントが表示されます。 

## <a name="subscribe-anomalies-for-notification"></a>通知のために異常をサブスクライブする

異常が検出されたときに常に通知を受信したい場合は、フックを使用して、メトリックに関するアラートをサブクライブすることができます。 詳細については、「[フックを使用してアラートを構成し、通知を取得する](alerts.md)」を参照してください。


## <a name="next-steps"></a>次のステップ 
- [フックを使用してアラートを構成し、通知を取得する](alerts.md)
- [フィードバックを使用して異常検出を調整する](anomaly-feedback.md)
- [インシデントを診断する](diagnose-incident.md)

