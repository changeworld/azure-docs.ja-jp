---
title: V3 機械学習エンティティに移行する
description: V3 作成では、新しいエンティティ型である機械学習エンティティが用意されているほか、アプリケーションの機械学習エンティティやその他のエンティティ、または特徴にリレーションシップを追加することができます。
ms.topic: how-to
ms.date: 05/08/2020
ms.openlocfilehash: aaa5472f25a5eca5ceadf979c57a83874ce4cb6e
ms.sourcegitcommit: 50673ecc5bf8b443491b763b5f287dde046fdd31
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 05/20/2020
ms.locfileid: "83684592"
---
# <a name="migrate-to-v3-authoring-entity"></a>V3 作成エンティティに移行する

V3 作成では、新しいエンティティ型である機械学習エンティティが用意されているほか、アプリケーションの機械学習エンティティやその他のエンティティ、または特徴にリレーションシップを追加することができます。

## <a name="entities-are-decomposable-in-v3"></a>V3 ではエンティティが分解可能

[API](https://westeurope.dev.cognitive.microsoft.com/docs/services/luis-programmatic-apis-v3-0-preview) またはポータルのいずれかを使って V3 作成 API で作成されたエンティティを使用すると、親と子が含まれる多層エンティティ モデルを構築できます。 親は**機械学習エンティティ**、子は機械学習済みエンティティの**サブエンティティ**と呼ばれます。

各サブエンティティは、機械学習エンティティでもありますが、特徴の構成オプションが追加されています。

* **必須の特徴**は、エンティティが特徴と一致したときに抽出されることを保証する規則です。 この規則は、モデルに対する必須の特徴によって定義されます。
    * [事前構築済みのエンティティ](luis-reference-prebuilt-entities.md)
    * [正規表現エンティティ](reference-entity-regular-expression.md)
    * [リスト エンティティ](reference-entity-list.md)。

## <a name="how-do-these-new-relationships-compare-to-v2-authoring"></a>これらの新しいリレーションシップと V2 作成の比較

V2 作成には、階層エンティティと複合エンティティ、およびこの同じタスクを実行するための役割と機能が用意されていました。 エンティティ、機能、および役割が明示的かつ相互に関連していなかったため、予測中、LUIS が示すリレーションシップを理解するのが困難でした。

V3 では、リレーションシップは明示的で、アプリの作成者によって設計されています。 これによりアプリの作成者は以下を行うことができます。

* 発話の例で、LUIS がこれらのリレーションシップをどのように予測しているかを視覚的に確認する
* [対話型のテスト ウィンドウ](luis-interactive-test.md)またはエンドポイントで、これらのリレーションシップをテストする
* これらのリレーションシップを、適切に構造化された入れ子になった名前付き [json オブジェクト](reference-entity-machine-learned-entity.md)を介して、クライアント アプリケーションで使用する

## <a name="planning"></a>計画

移行するときは、次の移行プランを考慮してください。

* LUIS アプリをバックアップし、別のアプリで移行を実行します。 V2 と V3 のアプリを同時に使用できるようにすると、必要な変更と、予測結果への影響を検証することができます。
* 現在の予測成功メトリックをキャプチャします
* 現在のダッシュボード情報を、アプリの状態のスナップショットとしてキャプチャします
* 既存の意図、エンティティ、フレーズ リスト、パターン、およびバッチ テストを確認します
* 次の要素は、**変更せずに**移行できます。
    * 意図
    * エンティティ
        * 正規表現エンティティ
        * リスト エンティティ
    * 特徴
        * フレーズ リスト
* 次の要素は、**変更せずに**移行する必要があります。
    * エンティティ
        * 階層構造エンティティ
        * 複合エンティティ
    * ロール - ロールは機械学習 (親) エンティティにのみ適用できます。 ロールはサブエンティティには適用できません
    * 階層エンティティと複合エンティティが使用されるバッチ テストとパターン

移行プランを設計するときは、すべての階層エンティティと複合エンティティが移行された後に、最終的な機械学習エンティティをレビューする時間を確保してください。 直接的な移行が動作している間、変更を加えてバッチ テストの結果と予測 JSON をレビューした後、より統一した JSON によって変更を行うことになる可能性があります。この場合、クライアント側アプリに配信される最終的な情報は、異なる方法で整理されます。 これはコードのリファクタリングに似ており、組織のレビュー プロセスで処理する必要があります。

V2 モデルに対してバッチ テストを適用していない場合、移行の一環としてバッチ テストを V3 モデルに移行すると、その移行が、エンドポイントの予測結果にどのように影響するかを検証できなくなります。

## <a name="migrating-from-v2-entities"></a>V2 エンティティからの移行

V3 作成モデルへの移行を開始するときは、機械学習エンティティと、そのサブエンティティと特徴への移行方法を検討する必要があります。

次の表は、V2 から V3 エンティティ設計に移行する必要があるエンティティを示しています。

|V2 作成エンティティ型|V3 作成エンティティ型|例|
|--|--|--|
|複合エンティティ|機械学習エンティティ|[詳細情報](#migrate-v2-composite-entity)|
|階層構造エンティティ|機械学習エンティティのロール|[詳細情報](#migrate-v2-hierarchical-entity)|

## <a name="migrate-v2-composite-entity"></a>V2 複合エンティティを移行する

V2 複合の子それぞれを、V3 機械学習エンティティのサブエンティティで表す必要があります。 複合の子が事前構築済み、正規表現、またはリスト エンティティの場合、これは、サブエンティティに必須の特徴として適用する必要があります。

機械学習エンティティへの複合エンティティの移行を計画する際の考慮事項:
* 子エンティティはパターンでは使用できません
* 子エンティティは共有されなくなりました
* 以前は機械学習以外の子エンティティだった場合、そのエンティティにはラベルを付ける必要があります

### <a name="existing-features"></a>既存の特徴

複合エンティティ内のワードをブーストするためのフレーズ リストは、機械学習 (親) エンティティ、サブエンティティ (子) エンティティ、意図 (フレーズ リストが 1 つの意図にのみ適用される場合) のいずれかに、特徴として適用する必要があります。 最も大幅にブーストされるエンティティに特徴を追加することを計画します。 特徴を追加することでサブエンティティ (子) の予測が最も大幅にブーストされる場合は、一般的に、機械学習 (親) エンティティには特徴を追加しないでください。

### <a name="new-features"></a>新機能

V3 作成で、エンティティを評価するための計画手順を、すべてのエンティティと意図の使用可能な特徴として追加します。

### <a name="example-entity"></a>エンティティの例

このエンティティは一例です。 ご自身のエンティティ移行では、他の考慮事項が必要になる場合があります。

以下が使用されているピザ `order` を変更する V2 複合について考えてみましょう。
* 配達時刻のための事前構築済み datetimeV2
* ピザ、パイ、生地、トッピングなどの特定のワードをブーストするフレーズ リスト
* マッシュルーム、オリーブ、ペペロニなどのトッピングを検出するリスト エンティティ。

このエンティティの発話の例を次に示します。

`Change the toppings on my pie to mushrooms and delivery it 30 minutes later`

次の表は移行を示しています。

|V2 モデル|V3 モデル|
|--|--|
|親 - `Order` という名前のコンポーネント エンティティ|親 - `Order` という名前の機械学習エンティティ|
|子 - 事前構築済み datetimeV2|* 事前構築済みエンティティを新しいアプリに移行します。<br>* 事前構築済みの datetimeV2 の親に必須の特徴を追加します。|
|子 - トッピングのリスト エンティティ|* リスト エンティティを新しいアプリに移行します。<br>* 次に、リスト エンティティの親に必須の特徴を追加します。|


## <a name="migrate-v2-hierarchical-entity"></a>V2 階層構造エンティティを移行する

V2 作成では、LUIS に存在する役割の前に階層構造エンティティが提供されていました。 両方とも目的は、コンテキスト使用に基づいてエンティティを抽出するというものでした。 階層構造エンティティがある場合、そのエンティティは、役割が含まれる単純なエンティティと考えることができます。

V3 作成:
* 機械学習 (親) エンティティでロールを適用できます。
* ロールをサブエンティティに適用することはできません。

このエンティティは一例です。 ご自身のエンティティ移行では、他の考慮事項が必要になる場合があります。

次のピザ `order` を変更するための V2 階層構造エンティティを考えてみましょう。
* それぞれの子によって元のトッピングか最終的なトッピングかが判断される状況

このエンティティの発話の例を次に示します。

`Change the topping from mushrooms to olives`

次の表は移行を示しています。

|V2 モデル|V3 モデル|
|--|--|
|親 - `Order` という名前のコンポーネント エンティティ|親 - `Order` という名前の機械学習エンティティ|
|子 - ピザの元のトッピングと最終的なトッピングが含まれる階層構造エンティティ|* 各トッピングに対してロールを `Order` に追加します。|

## <a name="api-change-constraint-replaced-with-required-feature"></a>API 変更制約は必須の特徴に置き換えられました

この変更は 2020 年 5 月に //Build 会議で行われたもので、アプリが制約付きの特徴を使用している v3 オーサリング API にのみ適用されます。 v2 オーサリングから v3 オーサリングに移行する場合、または v3 で制約付きの特徴を使用していない場合は、このセクションをスキップします。

**機能** - 既存のエンティティを別のモデルの特徴として要求し、エンティティが検出された場合にのみそのモデルを抽出する機能。 この機能は変更されていませんが、API と用語は変更されました。

|以前の用語|新しい用語|
|--|--|
|`constrained feature`<br>`constraint`<br>`instanceOf`|`required feature`<br>`isRequired`|

#### <a name="automatic-migration"></a>自動移行

**2020 年 6 月 19 日**以降、この特徴を公開した以前のオーサリング API を使用して、プログラムで制約を作成することはできなくなります。

既存のすべての制約付きの特徴は、必須の特徴フラグに自動的に移行されます。 予測 API に必要なプログラムの変更はありません。そのため、予測精度の品質に対する変更する必要もありません。

#### <a name="luis-portal-changes"></a>LUIS ポータルの変更

LUIS プレビュー ポータルでは、この機能が**制約付き**と呼ばれていました。 現在の LUIS ポータルでは、この機能は**必須の特徴**と呼ばれます。

#### <a name="previous-authoring-api"></a>以前のオーサリング API

この機能は、エンティティの子の `instanceOf` プロパティを使用して、エンティティの定義の一部として、プレビューの作成の **[Create Entity Child API](https://westus.dev.cognitive.microsoft.com/docs/services/luis-programmatic-apis-v3-0-preview/operations/5d86cf3c6a25a45529767d77)** で適用されました。

```json
{
    "name" : "dayOfWeek",
    "instanceOf": "datetimeV2",
    "children": [
        {
           "name": "dayNumber",
           "instanceOf": "number",
           "children": []
        }
    ]
}
```

#### <a name="new-authoring-api"></a>新しい オーサリング API

この機能は、`featureName` プロパティと `isRequired` プロパティを使用して **[Add entity feature relation API](https://westus.dev.cognitive.microsoft.com/docs/services/luis-programmatic-apis-v3-0-preview/operations/5d9dc1781e38aaec1c375f26)** で適用されるようになりました。 `featureName` プロパティの値はモデルの名前です。

```json
{
    "featureName": "YOUR-MODEL-NAME-HERE",
    "isRequired" : true
}
```


## <a name="next-steps"></a>次のステップ

* [開発者向けリソース](developer-reference-resource.md)
