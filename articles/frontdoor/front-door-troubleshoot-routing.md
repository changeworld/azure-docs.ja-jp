---
title: Azure Front Door の構成に関する問題のトラブルシューティング
description: このチュートリアルでは、Front Door で発生する可能性のある、一般的な問題のいくつかを自己解決する方法を説明します。
services: frontdoor
documentationcenter: ''
author: sharad4u
editor: ''
ms.service: frontdoor
ms.workload: infrastructure-services
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 09/22/2018
ms.author: sharadag
ms.openlocfilehash: 962c884eb8adc05e5d50b6b254d5c3f0b18af556
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/28/2020
ms.locfileid: "79471508"
---
# <a name="troubleshooting-common-routing-issues"></a>ルーティングの一般的な問題のトラブルシューティング

この記事では、Azure Front Door の構成で、よく発生する可能性のあるルーティングの問題をトラブルシューティングする方法について説明します。

## <a name="503-response-from-front-door-after-a-few-seconds"></a>数秒後に Front Door から 503 応答

### <a name="symptom"></a>症状

- Front Door を経由せずにバックエンドに送信される通常の要求は成功しますが、Front Door を経由すると 503 エラー応答が返されます。

- Front Door からのエラーが数秒後 (通常は約 30 秒後) に表示されます

### <a name="cause"></a>原因

この現象は、バックエンドが Front Door からの要求を受信するためにタイムアウト構成 (既定では 30 秒) を超えた場合、または Front Door からの要求に応答を送信するためにこのタイムアウト値を超えた場合に発生します。 

### <a name="troubleshooting-steps"></a>トラブルシューティングの手順

- バックエンドに要求を直接 (Front Door を経由せずに) 送信し、バックエンドが応答に要する通常の時間を確認します。
- Front Door 経由で要求を送信し、503 応答が表示されているかどうかを確認します。 そうでない場合、タイムアウトの問題ではない可能性があります。 サポートにお問い合わせください。
- Front Door を経由したときに 503 エラー応答コードが生成される場合は、フロント ドアの sendReceiveTimeout フィールドを構成して、既定のタイムアウトを最大 4 分 (240 秒) に延長します。 この設定は `backendPoolSettings` の下にあり、`sendRecvTimeoutSeconds` と呼ばれます。 

## <a name="requests-sent-to-the-custom-domain-returns-400-status-code"></a>カスタム ドメインに送信された要求で 400 状態コードが返される

### <a name="symptom"></a>症状

- ユーザーがフロント ドアを作成しましたが、ドメインまたはフロントエンド ホストへの要求で HTTP 400 の状態コードが返されます。

- ユーザーは、カスタム ドメインから構成したフロントエンド ホストへ DNS マッピングを作成しています。 しかし、カスタム ドメインのホスト名に要求を送信すると、HTTP 400 の状態コードが返され、構成したバックエンドにルーティングされません。

### <a name="cause"></a>原因

この現象は、フロントエンド ホストとして追加したカスタム ドメイン用にルーティング規則を構成していない場合に発生する可能性があります。 カスタム ドメインが DNS マッピングされている Front Door サブドメイン (*.azurefd.net) の下でフロントエンド ホストに既に構成されている場合でも、フロントエンド ホストにはルーティング規則を明示的に追加する必要があります。

### <a name="troubleshooting-steps"></a>トラブルシューティングの手順

カスタム ドメインから希望のバックエンド プールにルーティング規則を追加します。

## <a name="front-door-is-not-redirecting-http-to-https"></a>Front Door が HTTP を HTTPS にリダイレクトしていない

### <a name="symptom"></a>症状

フロント ドアには HTTP を HTTPS にリダイレクトするルーティング規則がありますが、ドメインへのアクセスではプロトコルとして HTTP が維持されます。

### <a name="cause"></a>原因

この動作は、フロント ドアのルーティング規則が正しく構成されていない場合に発生する可能性があります。 基本的に、現在の構成は固有ではなく、規則が競合している可能性があります。

### <a name="troubleshooting-steps"></a>トラブルシューティングの手順

## <a name="request-to-frontend-hostname-returns-404-status-code"></a>フロントエンドのホスト名の要求で状態コード 404 が返される

### <a name="symptom"></a>症状

- Front Door を作成し、フロントエンド ホスト、少なくとも 1 つ以上のバックエンドがあるバックエンド プール、フロントエンド ホストをバックエンド プールに接続するルーティング規則を作成しました。 構成したフロントエンドに要求を送信しても、HTTP 404 の状態コードが返されるのでコンテンツを利用できないようです。

### <a name="cause"></a>原因

この現象には、以下のような複数の原因が考えられます。

- バックエンドが一般向けのバックエンドではなく、フロント ドアから参照できません。
- バックエンドが不正に構成されていることが原因で、フロント ドアが不正な要求を送信しています (つまり、バックエンドでは HTTP のみが許可されるにもかかわらず、HTTPS の許可のチェックがオフになっていないので、Front Door が HTTPS 要求の送信を試行してしまいます)。
- バックエンドが、バックエンドへの要求で送信されたホスト ヘッダーを拒否しています。
- バックエンドの構成が、まだ完全にはデプロイされていません。

### <a name="troubleshooting-steps"></a>トラブルシューティングの手順

1. デプロイ時間
   - 構成がデプロイされるまで確実に 10 分間は待ちます。

2. バックエンドの設定を確認する
    - 要求がルートされるべき (ルーティング規則の構成によります) バックエンド プールに移動し、_バックエンドのホストの種類_ とバックエンドのホスト名が正しいことを確認します。 バックエンドがカスタム ホストの場合は、確実に正しいスペルであるようにします。 

    - HTTP および HTTPS ポートを確認します。 多くの場合、80 と 443 が (それぞれ) 正しく、変更をする必要はありません。 ただし、バックエンドの構成がこのようにはなっておらず、別のポートをリッスンしている場合もあります。

        - フロントエンド ホストのルート先のバックエンドに構成されている _バックエンド ホスト ヘッダー_ を確認します。 多くの場合、このヘッダーは _バックエンド ホスト名_ と同じである必要があります。 ただし、バックエンドが別のものを期待している場合、不正な値によってさまざまな HTTP 4xx の状態コードが発生する場合があります。 バックエンドの IP アドレスを入力した場合、_バックエンドのホスト ヘッダー_ をバックエンドのホスト名に設定する必要があります。


3. ルーティング規則の設定を確認する
    - 問題のフロントエンド ホスト名からバックエンド プールにルーティングする、ルーティング規則に移動します。 許可されているプロトコルが確実に正しく構成されるようにします。構成されていない場合、要求の送信時に Front Door が使用するプロトコルが確実に正しく構成されているようにします。 _[accepted protocols]_ \(許可されているプロトコル\) フィールドにより、Front Door で許可される要求が決定されます。また、 _[転送プロトコル]_ により、Front Door がバックエンドの要求の転送に使用するプロトコルが決定されます。
         - たとえば、バックエンドが HTTP 要求のみを許可している場合、次の構成が有効になります。
            - _[accepted protocols]_ \(許可されているプロトコル\) は、HTTP および HTTPS です。 _[転送プロトコル]_ は HTTP です。 HTTPS は許可されているプロトコルであるため、一致要求は機能しません。要求が HTTPS で受信された場合、Front Door は HTTPS を使用してそれを転送します。

            - _[accepted protocols]_ \(許可されているプロトコル\) は、HTTP です。 _[転送プロトコル]_ は、一致要求または HTTPS です。

    - 既定で _[Url の書き換え]_ は無効になっており、バックエンドでホストされている使用可能にしたいリソースの範囲を限定する場合にのみこのフィールドは使用する必要があります。 これを無効にすると、Front Door は受信したのと同じ要求パスを転送します。 このフィールドの構成が不正で、Front Door が使用不能なバックエンドからリソースを要求しているため、HTTP 404 の状態コードが返されることもあります。

