---
title: インクルード ファイル
description: インクルード ファイル
services: event-hubs
author: spelluru
ms.service: event-hubs
ms.topic: include
ms.date: 01/05/2021
ms.author: spelluru
ms.custom: include file
ms.openlocfilehash: f6bd0c13d5cbad802613e2bdea8fd6002f4deea2
ms.sourcegitcommit: ba676927b1a8acd7c30708144e201f63ce89021d
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/07/2021
ms.locfileid: "102445399"
---
イベント ハブでは、イベントのシーケンスを 1 つまたは複数のパーティションにまとめて整理します。 新しいイベントが到着すると、このシーケンスの末尾に追加されます。 パーティションは "コミット ログ" として考えることができます。

イベント本体、イベントを表すユーザー定義のプロパティ バッグ、メタデータ (パーティションにおけるオフセット、ストリーム シーケンスにおける番号、イベントが受理されたサービス側のタイムスタンプなど) を含んだイベント データがパーティションに格納されます。

![古いものから新しいものへのイベントのシーケンスを表示する図。](./media/event-hubs-partitions/partition.png)

Event Hubs の目的は、大量のイベントの処理を支援することです。パーティションは、2 つの方法でそれを支援します。

まず、Event Hubs は PaaS サービスであるとはいえ、根底には物理的な現実があります。イベントの順序を保持するログを維持するためには、根底にあるストレージとそのレプリカにそれらのイベントがまとめて保持されている必要があるため、そのようなログにはスループットの上限が生じます。 パーティションに分割することにより、同じイベント ハブで複数の並列ログを使用できるため、生の IO の処理に利用できるスループット容量が増えます。

次に、個々のアプリケーションは、イベント ハブに送信される量のイベントの処理に遅れずついていくことができなければなりません。 これは複雑で、相当にスケールアウトされた並列処理能力が必要となる場合があります。 この課題を解決しているのも、やはりパーティションです。1 つのプロセスで処理できるイベントには限度があるため、複数のプロセスが必要になります。パーティションを使用することで、そうしたプロセスにイベントをフィードしながら、各イベントの処理の所有者を明確化することができます。 

Event Hubs は構成された期間にわたりイベントを保持します。これは、すべてのパーティションに適用されます。 保持期間が経過するとイベントは自動的に削除されます。 保持期間を 1 日に指定すると、イベントは、その受領からちょうど 24 時間で利用できなくなります。 イベントを明示的に削除することはできません。 

設定できる保持期間は、Event Hubs Standard で最大 7 日、Event Hubs Dedicated で最大 90 日です。 保持期間の上限を超えてイベントをアーカイブする必要がある場合、[Event Hubs Capture 機能を有効にして Azure Storage または Azure Data Lake にそれらを自動的に格納](../articles/event-hubs/event-hubs-capture-overview.md)することができます。また、そのような大量のアーカイブを検索したり分析したりする必要がある場合は、[それらを Azure Synapse に簡単にインポート](../articles/event-hubs/store-captured-data-data-warehouse.md)することができます。他の同様のストアや分析プラットフォームにインポートすることも可能です。 

Event Hubs でデータの保持期間に上限を設けている理由は、タイムスタンプによってのみインデックスされ、順次アクセスしかできない大きなストアに、過去に発生した大量のカスタマー データが無造作に取り込まれるのを避けるためです。 履歴データには、Event Hubs や Kafka が提供するリアルタイムのイベント処理インターフェイスよりも高度なインデックス処理と直接アクセスが必要であるという思想の下に設計されています。 イベント ソーシングの長期的アーカイブやデータ レイク用途には、イベント ストリーム エンジンは適しません。 

パーティションは独立していて、それぞれ独自のデータ シーケンスを含んでいるため、多くの場合、拡大するペースは異なります。 Event Hubs では、Apache Kafka などのように管理者の介入が必要になることはありませんが、均等に分散されていないと、ダウンストリームのイベント プロセッサに負荷の偏りが生じます。

![Event Hubs](./media/event-hubs-partitions/multiple-partitions.png)

パーティションの数は、作成時に 1 から 32 の間 (Event Hubs Standard の場合) で指定する必要があります。 Event Hubs Dedicated では、容量ユニットあたり最大 2,000 パーティションまで指定できます。 

アプリケーションの負荷がピークに達している状態で[スループット ユニット (TU)](../articles/event-hubs/event-hubs-faq.md#what-are-event-hubs-throughput-units) の持続に必要となるであろう数以上のパーティションを、その特定のイベント ハブに選択することをお勧めします。 1 つのパーティションのスループット容量は 1 TU (1 MB の入力、2 MB の出力) として計算する必要があります。 パーティション数とは別にクラスターの容量ユニットまたは名前空間の TU をスケーリングすることができます。 名前空間の容量が 1 TU に設定されているとき、パーティションが 32 個のイベント ハブとパーティションが 1 個のイベント ハブで発生するコストはまったく同じです。 

パーティションへのイベントのマッピングは、アプリケーションが 3 つのうちいずれかの方法で制御します。

- パーティション キーを指定する。これは、利用可能ないずれかのパーティションに、(ハッシュ関数を使用して) 矛盾なくマップされます。 
- パーティション キーを指定しない。この場合、特定のイベントのパーティションをブローカーがランダムに選択できます。
- 特定のパーティションに明示的にイベントを送信する。

パーティション キーを指定すると、関連するイベントを同じパーティションにまとめて、送信されたときとまったく同じ順番で保存することができます。 パーティション キーは、アプリケーションのコンテキストから得られる文字列で、イベントの相互関係を識別するものです。

パーティション キーによって識別される一連のイベントが "*ストリーム*" です。 パーティションは、そのようなたくさんのストリームが混在するログ ストアです。 

[専用の Event Hubs クラスター](../articles/event-hubs/event-hubs-dedicated-overview.md)内のイベント ハブのパーティション数は、イベント ハブの作成後に[増やす](../articles/event-hubs/dynamically-add-partitions.md)こともできますが、パーティションへのパーティション キーのマッピングが変わるので、パーティション全体に対するストリームの配分が変化します。そのため、アプリケーションの中でイベントの相対的な順序が重要な場合は、そのような変更は極力避けるようにしてください。

パーティション数を上限に設定したくなるかもしれませんが、複数のパーティションの利点を実際に活かせるようにイベント ストリームを構築する必要があることを常に念頭に置いてください。 すべてのイベントについて、または一部のサブストリームのみについて、絶対的な順序を保持する必要がある場合、多くのパーティションを活用できないことがあります。 また、パーティション数が多いと処理する側もより複雑になります。 

パーティションに直接送信することもできますが、これはお勧めしません。 その代わり、「[イベント発行元](../articles/event-hubs/event-hubs-features.md#event-publishers)」のセクションで紹介する、より高いレベルの構造を使用できます。 

